import{e,r as t,ab as a,Z as i,d as s,g as n,h as o,f as l,k as r,R as c,W as h,H as m,z as d,S as p,t as u,ac as g,ad as f,ae as w,a6 as y,I as b,a as S,C as v,P as I,G as E,af as k,w as C,x as _,ag as x,B as T,O as P,E as R,V as D,T as N,j as G,n as U,l as O,D as A,Q as L,X as V,U as F,b as W,a8 as M,ah as z,ai as j,a3 as B,u as H,aj as q,ak as Y,al as K,K as $,m as J,$ as Z,am as Q,an as X,ao as ee,ap as te,c as ae,aq as ie,a1 as se,a0 as ne,ar as oe,as as le,a2 as re,at as ce,F as he,a7 as me,au as de,A as pe,av as ue,L as ge,aw as fe}from"./localization-kgGUpfrJ.chunk.js";import{C as we,I as ye,aK as be,T as Se,U as ve,aU as Ie,M as Ee,F as ke,aV as Ce,k as _e,A as xe,aW as Te,aX as Pe,aY as Re,aZ as De,a_ as Ne,a$ as Ge,b0 as Ue,b1 as Oe,l as Ae,b2 as Le,j as Ve,b3 as Fe,D as We,b4 as Me,P as ze,b5 as je,b6 as Be,b7 as He,b8 as qe,aS as Ye,b9 as Ke,aL as $e,aC as Je,aD as Ze,ax as Qe,ay as Xe,au as et,aq as tt,ba as at,bb as it,bc as st,ah as nt,bd as ot,ab as lt,a1 as rt,Y as ct,be as ht,J as mt,bf as dt,bg as pt,bh as ut,bi as gt,bj as ft,bk as wt,bl as yt,bm as bt,bn as St,bo as vt,bp as It,bq as Et,br as kt,bs as Ct,bt as _t,bu as xt,bv as Tt,bw as Pt,bx as Rt,G as Dt,by as Nt,bz as Gt,bA as Ut,bB as Ot,r as At,bC as Lt,bD as Vt,a6 as Ft,ar as Wt,bE as Mt,bF as zt,bG as jt,bH as Bt,bI as Ht,bJ as qt,bK as Yt,bL as Kt,bM as $t,bN as Jt,bO as Zt,bP as Qt,bQ as Xt,b as ea,bR as ta,bS as aa,bT as ia,bU as sa,bV as na,bW as oa,bX as la,bY as ra,bZ as ca,b_ as ha,b$ as ma,c0 as da,c1 as pa,c2 as ua,c3 as ga,c4 as fa,c5 as wa,c6 as ya,c7 as ba,c8 as Sa,c9 as va,ca as Ia,cb as Ea,cc as ka,cd as Ca,ce as _a,cf as xa,cg as Ta,ch as Pa,ci as Ra,cj as Da,ck as Na,cl as Ga,cm as Ua,cn as Oa,co as Aa,cp as La,cq as Va,cr as Fa,cs as Wa,ct as Ma,cu as za,cv as ja,cw as Ba,cx as Ha,cy as qa,cz as Ya,cA as Ka,cB as $a,cC as Ja,cD as Za,cE as Qa,cF as Xa,cG as ei,cH as ti,cI as ai,cJ as ii,cK as si,cL as ni,cM as oi,cN as li,cO as ri,cP as ci,cQ as hi,cR as mi,cS as di,cT as pi,cU as ui,cV as gi,cW as fi,cX as wi,cY as yi,cZ as bi,c_ as Si,c$ as vi,d0 as Ii,d1 as Ei,d2 as ki,d3 as Ci,d4 as _i,d5 as xi,d6 as Ti,d7 as Pi,d8 as Ri,d9 as Di,da as Ni,db as Gi,dc as Ui,dd as Oi,de as Ai,df as Li,dg as Vi,dh as Fi,di as Wi,dj as Mi,dk as zi,dl as ji,dm as Bi,dn as Hi,dp as qi,dq as Yi,dr as Ki,ds as $i,dt as Ji,du as Zi,dv as Qi,dw as Xi,dx as es,dy as ts,dz as as,dA as is,dB as ss,dC as ns,dD as os,dE as ls,dF as rs,dG as cs,dH as hs,dI as ms,dJ as ds,dK as ps,dL as us,dM as gs,dN as fs,dO as ws,dP as ys,dQ as bs,dR as Ss,dS as vs,dT as Is,dU as Es,dV as ks,dW as Cs,dX as _s,dY as xs,dZ as Ts,d_ as Ps,d$ as Rs,e0 as Ds,e1 as Ns,e2 as Gs,p as Us,e3 as Os,e4 as As,e5 as Ls,e6 as Vs,x as Fs,e7 as Ws,aP as Ms,q as zs,e8 as js,e9 as Bs,ea as Hs,eb as qs,ec as Ys,ed as Ks,ee as $s,a as Js,ef as Zs,eg as Qs,eh as Xs,t as en,ei as tn,f as an,n as sn,h as nn,s as on,e as ln,ej as rn,ek as cn,el as hn,em as mn,en as dn,eo as pn,ep as un,eq as gn,er as fn,es as wn,et as yn,eu as bn,ev as Sn,ew as vn,ex as In,ey as En,ez as kn,eA as Cn,y as _n,eB as xn,eC as Tn,eD as Pn,eE as Rn,eF as Dn,eG as Nn,eH as Gn,eI as Un,eJ as On,eK as An,eL as Ln,z as Vn,E as Fn,eM as Wn,eN as Mn,eO as zn,eP as jn,eQ as Bn,eR as Hn,eS as qn,eT as Yn,eU as Kn,eV as $n,eW as Jn,eX as Zn,eY as Qn,eZ as Xn,e_ as eo,e$ as to,f0 as ao,f1 as io,g as so,f2 as no,c as oo,f3 as lo,i as ro,f4 as co,f5 as ho,f6 as mo,f7 as po,f8 as uo,f9 as go,o as fo,fa as wo,fb as yo,fc as bo,fd as So}from"./detailed_results-BEc8O_jh.chunk.js";const vo={footer:!1,header:!0,scrollContents:!1,size:"lg",title:null};class Io extends we{constructor(i,s,n={disposeOnClose:!0}){super(i,"modal"),this.isOpen=!1,this.onHideCallbacks=[],this.modalConfig={...vo,...n};const o=t(),l=t(),r=t(),c=t(),h=this.modalConfig.size&&"md"!=this.modalConfig.size?`modal-${this.modalConfig.size}`:"";this.rootElem.classList.add("fade"),this.rootElem.appendChild(e("div",{className:`modal-dialog ${s} ${h} ${this.modalConfig.scrollContents?"modal-overflow-scroll":""}`,ref:o},e("div",{className:"modal-content"},e("div",{className:"modal-header "+(this.modalConfig.header||this.modalConfig.title?"":"p-0 border-0"),ref:l},this.modalConfig.title&&e("h5",{className:"modal-title"},this.modalConfig.title),e("button",{type:"button",className:"btn-close "+(this.modalConfig.closeButton?.fixed?"position-fixed":""),onclick:()=>this.close(),attributes:{"aria-label":"Close"}},e("i",{className:"fas fa-times fa-2xl"}))),e("div",{className:"modal-body",ref:r}),this.modalConfig.footer&&e("div",{className:"modal-footer",ref:c})))),this.dialog=o.value,this.header=l.value,this.body=r.value,this.footer=c.value,this.modal=new a(this.rootElem),this.modalConfig.disposeOnClose&&this.rootElem.addEventListener("hidden.bs.modal",()=>{this.rootElem.remove(),this.dispose()},{once:!0})}open(){const e=this.closeModalOnEscKey.bind(this),t=this.showBSFn.bind(this),a=this.hideBSFn.bind(this),i=this.hiddenBSFn.bind(this);document.addEventListener("keydown",e),this.rootElem.addEventListener("show.bs.modal",t),this.rootElem.addEventListener("hide.bs.modal",a),this.rootElem.addEventListener("hidden.bs.modal",i),this.addOnHideCallback(()=>document.removeEventListener("keydown",e)),this.addOnHideCallback(()=>this.rootElem.removeEventListener("show.bs.modal",t)),this.addOnHideCallback(()=>this.rootElem.removeEventListener("hide.bs.modal",a)),this.addOnHideCallback(()=>this.rootElem.removeEventListener("hidden.bs.modal",i)),this.modal.show(),this.isOpen=!0}close(){this.modal.hide(),this.isOpen=!1}addOnHideCallback(e){this.onHideCallbacks.push(e)}onShow(e){}onHide(e){this.onHideCallbacks.forEach(e=>e())}async showBSFn(e){e.stopImmediatePropagation();const t=await new Promise(e=>{setTimeout(()=>{this.modal._backdrop._element&&e(this.modal._backdrop._element)},100)});this.rootElem.insertAdjacentElement("afterend",t),this.onShow(e)}hideBSFn(e){e.stopImmediatePropagation(),this.onHide(e)}hiddenBSFn(e){e.stopPropagation()}closeModalOnEscKey(e){"Escape"==e.key&&this.close()}}const Eo={[i.ItemQualityJunk]:"text-junk",[i.ItemQualityCommon]:"text-common",[i.ItemQualityUncommon]:"text-uncommon",[i.ItemQualityRare]:"text-rare",[i.ItemQualityEpic]:"text-epic",[i.ItemQualityLegendary]:"text-legendary",[i.ItemQualityArtifact]:"text-artifact",[i.ItemQualityHeirloom]:"text-heirloom"};function ko(e,t){Object.values(Eo).forEach(t=>e.classList.remove(t)),t&&e.classList.add(Eo[t])}class Co extends ye{constructor(e,t,a){super(e,"number-picker-root",t,a),this.float=a.float??!1,this.maxDecimalDigits=a.maxDecimalDigits??2,this.positive=a.positive??!1,this.showZeroes=a.showZeroes??!0,this.inputElem=document.createElement("input"),this.inputElem.id=a.id,this.inputElem.type="text",this.inputElem.classList.add("form-control","number-picker-input"),this.positive&&this.inputElem.addEventListener("change",()=>{this.float?this.inputElem.value=be(Math.abs(Number(this.inputElem.value)),{minimumFractionDigits:2,maximumFractionDigits:this.maxDecimalDigits}):this.inputElem.value=Math.abs(parseInt(this.inputElem.value)).toString()},{signal:this.signal}),this.inputElem.addEventListener("change",()=>{this.inputChanged(Se.nextEventID())},{signal:this.signal}),this.inputElem.addEventListener("input",()=>{this.updateSize()},{signal:this.signal}),this.rootElem.appendChild(this.inputElem),this.init(),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.float?Number(this.inputElem.value||"")||0:parseInt(this.inputElem.value||"")||0}setInputValue(e){0!==e||this.showZeroes?this.float?this.inputElem.value=be(e,{useGrouping:!1,minimumFractionDigits:2,maximumFractionDigits:this.maxDecimalDigits}):this.inputElem.value=String(e):this.inputElem.value=""}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}class _o extends we{constructor(a,i,r,c,h,m){super(a,"character-stats-root"),this.hasRacialHitBonus=!1,this.hasRacialExpertiseBonus=!1,this.stats=[],this.player=r,this.modifyDisplayStats=h,this.overwriteDisplayStats=m;const d=document.createElement("label");d.classList.add("character-stats-label"),d.textContent=s.t("sidebar.character_stats.title"),this.rootElem.appendChild(d);const p=document.createElement("table");p.classList.add("character-stats-table"),this.rootElem.appendChild(p),this.valueElems=[];const u=new Map([["Primary",[ve.fromStat(n.StatHealth),ve.fromStat(n.StatMana)]],["Attributes",[ve.fromStat(n.StatStrength),ve.fromStat(n.StatAgility),ve.fromStat(n.StatStamina),ve.fromStat(n.StatIntellect),ve.fromStat(n.StatSpirit)]],["Defense",[ve.fromStat(n.StatArmor),ve.fromStat(n.StatBonusArmor),ve.fromPseudoStat(o.PseudoStatDodgePercent),ve.fromPseudoStat(o.PseudoStatParryPercent),ve.fromPseudoStat(o.PseudoStatBlockPercent)]],["Physical",[ve.fromStat(n.StatAttackPower),ve.fromStat(n.StatRangedAttackPower),ve.fromPseudoStat(o.PseudoStatMeleeHastePercent),ve.fromPseudoStat(o.PseudoStatRangedHastePercent),ve.fromPseudoStat(o.PseudoStatPhysicalHitPercent),ve.fromPseudoStat(o.PseudoStatPhysicalCritPercent)]],["Spell",[ve.fromStat(n.StatSpellPower),ve.fromPseudoStat(o.PseudoStatSpellHastePercent),ve.fromPseudoStat(o.PseudoStatSpellHitPercent),ve.fromPseudoStat(o.PseudoStatSpellCritPercent)]]]);if(this.player.getPlayerSpec().isTankSpec){const e=u.get("Physical").findIndex(e=>e.equalsPseudoStat(o.PseudoStatPhysicalHitPercent));u.get("Physical").splice(e+1,0,ve.fromStat(n.StatExpertiseRating)),u.get("Defense").push(ve.fromStat(n.StatMasteryRating))}else if([n.StatIntellect,n.StatSpellPower].includes(i.individualConfig.epReferenceStat)){const e=u.get("Spell").findIndex(e=>e.equalsPseudoStat(o.PseudoStatSpellHitPercent));u.get("Spell").splice(e+1,0,ve.fromStat(n.StatExpertiseRating)),u.get("Spell").push(ve.fromStat(n.StatMasteryRating))}else{const e=u.get("Physical").findIndex(e=>e.equalsPseudoStat(o.PseudoStatPhysicalHitPercent));u.get("Physical").splice(e+1,0,ve.fromStat(n.StatExpertiseRating)),u.get("Physical").push(ve.fromStat(n.StatMasteryRating))}u.forEach((a,i)=>{const h=a.filter(e=>c.find(t=>t.equals(e)));if(!h.length)return;if(["Physical","Spell"].includes(i)&&1===h.length)return;const m=e("tbody",null);h.forEach(a=>{this.stats.push(a);const i=a.getShortName(r.getClass()),c=t(),h=e("tr",{className:"character-stats-table-row"},e("td",{className:"character-stats-table-label"},i,a.equalsStat(n.StatMasteryRating)&&e(l,null,e("br",null),Ie.get(this.player.getSpec()))),e("td",{ref:c,className:"character-stats-table-value"},a.hasRootStat()&&this.bonusStatsLink(a)));if(m.appendChild(h),this.valueElems.push(c.value),a.isPseudoStat()&&a.getPseudoStat()===o.PseudoStatPhysicalCritPercent&&this.shouldShowMeleeCritCap(r)){const t=e("tr",{className:"character-stats-table-row"},e("td",{className:"character-stats-table-label"},s.t("sidebar.character_stats.melee_crit_cap")),e("td",{className:"character-stats-table-value"},e("span",{className:"px-2 border-start border-end border-body border-brand",style:{"--bs-border-opacity":"0"}})));m.appendChild(t);const a=t.getElementsByClassName("character-stats-table-value")[0];this.valueElems.push(a)}}),p.appendChild(m)}),this.updateStats(r),Se.onAny([r.currentStatsEmitter,r.sim.changeEmitter,r.talentsChangeEmitter]).on(()=>{this.updateStats(r)})}hasRacialHitOrExpBonus(){const e=this.player.getEquippedItem(r.ItemSlotMainHand)?.item;switch(this.player.getRace()){case c.RaceDraenei:return[!0,!1];case c.RaceDwarf:if(e&&(e.rangedWeaponType===d.RangedWeaponTypeBow||e.rangedWeaponType===d.RangedWeaponTypeCrossbow||e.rangedWeaponType===d.RangedWeaponTypeGun||e.weaponType===h.WeaponTypeMace))return[!1,!0];case c.RaceTroll:if(e&&(e.rangedWeaponType===d.RangedWeaponTypeBow||e.rangedWeaponType===d.RangedWeaponTypeCrossbow||e.rangedWeaponType===d.RangedWeaponTypeGun))return[!1,!0];break;case c.RaceGnome:if(e&&e.handType===m.HandTypeOneHand&&(e.weaponType===h.WeaponTypeSword||e.weaponType===h.WeaponTypeDagger))return[!1,!0];break;case c.RaceHuman:if(e&&(e.weaponType===h.WeaponTypeSword||e.weaponType===h.WeaponTypeMace))return[!1,!0];break;case c.RaceOrc:if(e&&(e.weaponType===h.WeaponTypeAxe||e.weaponType===h.WeaponTypeFist))return[!1,!0]}return[!1,!1]}convertRacialBonuses(e){return this.hasRacialExpertiseBonus?this.convertRacialExpertiseRating(e):this.hasRacialHitBonus?this.convertRacialHitRating(e):e}convertRacialExpertiseRating(e){return e.addStat(n.StatExpertiseRating,-4*Ee)}convertRacialHitRating(e){return e.addStat(n.StatHitRating,-340)}updateStats(a){const i=a.getCurrentStats(),l=this.modifyDisplayStats?this.modifyDisplayStats(this.player):{},[r,c]=this.hasRacialHitOrExpBonus();this.hasRacialHitBonus=r,this.hasRacialExpertiseBonus=c;const h=this.convertRacialBonuses(ke.fromProto(i.baseStats)),m=this.convertRacialBonuses(ke.fromProto(i.gearStats)),d=this.convertRacialBonuses(ke.fromProto(i.talentsStats)),g=this.convertRacialBonuses(ke.fromProto(i.buffsStats)),f=this.convertRacialBonuses(ke.fromProto(i.consumesStats)),w=a.getBonusStats();let y=this.convertRacialBonuses(ke.fromProto(i.finalStats)).add(l.base||new ke).add(l.gear||new ke).add(l.talents||new ke).add(l.buffs||new ke).add(l.consumes||new ke).add(l.final||new ke),b=h.add(l.base||new ke),S=m.subtract(h).subtract(w).add(l.gear||new ke),v=d.subtract(m).add(l.talents||new ke),I=g.subtract(d).add(l.buffs||new ke),E=f.subtract(g).add(l.consumes||new ke);if(this.overwriteDisplayStats){const e=this.overwriteDisplayStats(this.player);e.stats&&e.stats.forEach((t,a)=>{b=b.withStat(t,e.base.getStat(t)),S=S.withStat(t,e.gear.getStat(t)),v=v.withStat(t,e.talents.getStat(t)),I=I.withStat(t,e.buffs.getStat(t)),E=E.withStat(t,e.consumes.getStat(t)),y=y.withStat(t,e.final.getStat(t))})}const k=this.player.getBaseMastery()+(i.finalStats?.stats[n.StatMasteryRating]||0)/Ce;let C=0;this.stats.forEach(i=>{const l=i.hasRootStat()?w.getStat(i.getRootStat()):0;let r;r=0==l?"text-white":l>0?"text-success":"text-danger";const c=t();let h=[this.player.getMasteryPerPointModifier()],m=[0];switch(a.getSpec()){case p.SpecDestructionWarlock:m=[1,0],h=[1,...h];break;case p.SpecDemonologyWarlock:m=[0,0],h=[1,...h];break;case p.SpecProtectionWarrior:m=[0,0],h=[.5,...h];break;case p.SpecWindwalkerMonk:m=[3.5,0];break;case p.SpecBalanceDruid:m=[15]}const d=e("div",{className:"stat-value-link-container"},e("button",{ref:c,className:_e("stat-value-link",r)},`${this.statDisplayString(y,i,!0)} `),i.equalsStat(n.StatMasteryRating)&&h.map((t,a)=>e("a",{href:xe.makeSpellUrl(Te.get(this.player.getSpec())||0),className:_e("stat-value-link-mastery",r),target:"_blank"},`${(k*t+m[a]).toFixed(2)}%`))),g=c.value;this.valueElems[C].querySelector(".stat-value-link-container")?.remove(),this.valueElems[C].prepend(d);const f=e("div",null,e("div",{className:"character-stats-tooltip-row"},e("span",null,s.t("sidebar.character_stats.tooltip.base")),e("span",null,this.statDisplayString(b,i,!0))),e("div",{className:"character-stats-tooltip-row"},e("span",null,s.t("sidebar.character_stats.tooltip.gear")),e("span",null,this.statDisplayString(S,i))),e("div",{className:"character-stats-tooltip-row"},e("span",null,s.t("sidebar.character_stats.tooltip.talents")),e("span",null,this.statDisplayString(v,i))),e("div",{className:"character-stats-tooltip-row"},e("span",null,s.t("sidebar.character_stats.tooltip.buffs")),e("span",null,this.statDisplayString(I,i))),e("div",{className:"character-stats-tooltip-row"},e("span",null,s.t("sidebar.character_stats.tooltip.consumes")),e("span",null,this.statDisplayString(E,i))),0!==l&&e("div",{className:"character-stats-tooltip-row"},e("span",null,s.t("sidebar.character_stats.tooltip.bonus")),e("span",null,this.statDisplayString(w,i))),e("div",{className:"character-stats-tooltip-row"},e("span",null,s.t("sidebar.character_stats.tooltip.total")),e("span",null,this.statDisplayString(y,i,!0))));if(i.isPseudoStat()&&i.getPseudoStat()===o.PseudoStatPhysicalCritPercent&&this.shouldShowMeleeCritCap(a)){C++;const t=a.getMeleeCritCapInfo(),i=e("button",{className:"stat-value-link"},this.meleeCritCapDisplayString(a,y)," "),s=t.playerCritCapDelta;0==s?i.classList.add("text-white"):s>0?i.classList.add("text-danger"):s<0&&i.classList.add("text-success"),this.valueElems[C].querySelector(".stat-value-link-container")?.remove(),this.valueElems[C].prepend(e("div",{className:"stat-value-link-container"},i));const n=e("div",null,e("div",{className:"character-stats-tooltip-row"},e("span",null,"Glancing:"),e("span",null,`${t.glancing.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Suppression:"),e("span",null,`${t.suppression.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"To Hit Cap:"),e("span",null,`${t.remainingMeleeHitCap.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"To Exp Cap:"),e("span",null,`${t.remainingExpertiseCap.toFixed(2)}%`)),0!=t.specSpecificOffset&&e("div",{className:"character-stats-tooltip-row"},e("span",null,"Spec Offsets:"),e("span",null,`${t.specSpecificOffset.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Final Crit Cap:"),e("span",null,`${t.baseCritCap.toFixed(2)}%`)),e("hr",null),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Can Raise By:"),e("span",null,`${(t.remainingExpertiseCap+t.remainingMeleeHitCap).toFixed(2)}%`)));u(i,{content:n})}u(g,{content:f}),C++})}statDisplayString(e,t,a){const i=t.hasRootStat()?e.getStat(t.getRootStat()):null;let o=t.convertDefaultUnitsToPercent(e.getUnitStat(t));t.equalsStat(n.StatMasteryRating)&&a?o+=this.player.getBaseMastery():t.equalsStat(n.StatExpertiseRating)&&a&&this.hasRacialExpertiseBonus&&(o+=1);const l=null===i||0===i&&null!==o,r=l?"":String(Math.round(i)),c=t.equalsStat(n.StatMasteryRating)?` ${s.t("sidebar.character_stats.points_suffix")}`:s.t("sidebar.character_stats.percent_suffix"),h=null===o?"":`${o.toFixed(2)}`+c;return r+(l||null===o?h:` (${h})`)}bonusStatsLink(a){const i=a.getRootStat(),n=Pe(i),o=t(),l=t(),r=e("button",{ref:o,className:"add-bonus-stats text-white ms-2",dataset:{bsToggle:"popover"}},e("i",{ref:l,className:"fas fa-plus-minus"}));return u(l.value,{content:`${s.t("sidebar.character_stats.bonus_prefix")} ${n}`}),u(o.value,{interactive:!0,trigger:"click",theme:"bonus-stats-popover",placement:"right",onShow:e=>{const t=new Co(null,this.player,{id:`character-bonus-stat-${i}`,label:`${s.t("sidebar.character_stats.bonus_prefix")} ${n}`,extraCssClasses:["mb-0"],changedEvent:e=>e.bonusStatsChangeEmitter,getValue:e=>e.getBonusStats().getStat(i),setValue:(t,a,s)=>{const n=a.getBonusStats().withStat(i,s);a.setBonusStats(t,n),e?.hide()}});e.setContent(t.rootElem)}}),r}shouldShowMeleeCritCap(e){return e.getPlayerSpec().isMeleeDpsSpec}meleeCritCapDisplayString(e,t){const a=e.getMeleeCritCap();if(0===a)return s.t("sidebar.character_stats.crit_cap.exact");return`${a>0?s.t("sidebar.character_stats.crit_cap.over_by"):s.t("sidebar.character_stats.crit_cap.under_by")} ${Math.abs(a).toFixed(2)}%`}}const xo=({children:t,buttonClassName:a,linkRef:i,...s})=>"href"in s&&s.href?e("a",{ref:i,href:s.href,target:"_blank",className:_e(a)},t):e("button",{type:"button",ref:i,className:_e(a)},t),To=({ref:t,linkRef:a,iconRef:i,icon:s,className:n,children:o,...l})=>e("div",{ref:t,className:"sim-toolbar-item"},e(xo,{linkRef:a,className:_e(n),...l},s&&e("i",{ref:i,className:s}),o)),Po=e("ul",{className:"text-start ps-3 mb-0"});class Ro extends we{constructor(a){super(a,"results-viewer"),this.warnings=[],this.warningsTooltip=null;const i=t(),s=t(),n=t(),o=t();this.rootElem.appendChild(e(l,null,e("div",{ref:i,className:"results-pending"},e("div",{className:"loader"})),e("div",{ref:s,className:"results-content"}),e("div",{ref:o,className:"button-zone text-center"}),e("div",{ref:n,className:"warning-zone text-center"}))),this.pendingElem=i.value,this.contentElem=s.value,this.warningElem=n.value,this.buttonElem=o.value,this.warningsLink=this.addWarningsLink(),this.updateWarnings(),this.hideAll()}addWarningLink({parent:a,tooltip:i,classes:s,text:n,...o}){const l=t();return a.appendChild(e(To,{linkRef:l,buttonClassName:s,...o},n)),i&&(this.warningsTooltip=u(l.value,{appendTo:"parent",content:i,placement:"bottom",inlinePositioning:!0,plugins:[g]})),l.value}addWarningsLink(){return this.addWarningLink({parent:this.warningElem,icon:"fas fa-exclamation-triangle fa-3x",tooltip:Po,classes:"warning link-warning"})}addWarning(e){this.warnings.push(e),e.updateOn.on(()=>this.updateWarnings()),this.updateWarnings()}updateWarnings(){const t=this.warnings.map(e=>e.getContent()).flat().filter(e=>""!==e),a=this.warningsTooltip?.props.content?.cloneNode(!0)||e(l,null);a&&(a.innerHTML=""),a.appendChild(e(l,null,t?.map(t=>e("li",null,t)))),this.warningsLink.parentElement?.classList?.[t.length?"remove":"add"]("hide"),this.warningsTooltip?.setContent(a)}hideAll(){this.contentElem.style.display="none",this.pendingElem.style.display="none",this.buttonElem.style.display="none"}setPending(){this.contentElem.style.display="none",this.pendingElem.style.display="block"}setContent(e){"string"==typeof e?this.contentElem.innerHTML=e:this.contentElem.replaceChildren(e),this.contentElem.style.display="block",this.pendingElem.style.display="none"}addAbortButton(t){this.buttonElem.replaceChildren(e("button",{className:"sim-abort-button",onclick:t},e("i",{className:"fa fa-times fa-lg me-1"}),"Stop")),this.buttonElem.style.display="block"}removeAbortButton(){this.buttonElem.replaceChildren(),this.buttonElem.style.display="none"}}class Do extends we{constructor(e,t,a){super(e,"sim-tab"),this.rootElem.classList.add(a.identifier),this.simUI=t,this.config=a,this.rootElem.id=this.config.identifier,this.rootElem.classList.add("tab-pane","fade"),0==e.childNodes.length&&this.rootElem.classList.add("active","show"),this.navItem=this.buildNavItem(),this.navLink=this.navItem.children[0],this.contentContainer=document.createElement("div"),this.contentContainer.classList.add("tab-pane-content-container"),this.rootElem.appendChild(this.contentContainer),this.simUI.simHeader.addSimTabLink(this)}buildNavItem(){const e=document.createElement("fragment");return e.innerHTML=`\n\t\t\t<li class="${this.config.identifier} nav-item" role="presentation">\n\t\t\t\t<button\n\t\t\t\t\tclass="nav-link"\n\t\t\t\t\ttype="button"\n\t\t\t\t\tdata-bs-toggle="tab"\n\t\t\t\t\tdata-bs-target="#${this.config.identifier}"\n\t\t\t\t\trole="tab"\n\t\t\t\t\taria-controls="${this.config.identifier}"\n\t\t\t\t>${this.config.title}</button>\n\t\t\t</li>\n\t\t`,e.children[0]}buildColumn(e,t){const a=document.createElement("div");return a.classList.add("tab-panel-col",`${t}-${e}`),a}}class No{constructor(e){const{title:t,variant:a,autoShow:i=!0,canClose:s=!0,body:n,additionalClasses:o,container:l,...r}=e||{};this.container=l||document.getElementById("toastContainer"),this.additionalClasses=o,this.title=t||"WowSims",this.variant=a||"info",this.body=n,this.canClose=s,this.element=this.template(),this.container.appendChild(this.element),this.instance=f.getOrCreateInstance(this.element,{delay:3e3,...r}),i&&this.instance.show(),this.element.addEventListener("hidden.bs.toast",()=>{this.destroy()})}destroy(){this.instance.dispose(),this.element.remove()}show(){this.instance.show()}hide(){this.instance.hide()}getVariantIcon(){switch(this.variant){case"info":return"fa-info-circle";case"success":return"fa-check-circle";case"error":return"fa-exclamation-circle";case"warning":return"fa-triangle-exclamation"}}template(){return e("div",{className:_e("toast position-relative bottom-0 end-0",`toast--${this.variant}`,this.additionalClasses),attributes:{role:"alert","aria-live":"assertive","aria-atomic":"true"}},e("div",{className:"toast-header"},e("i",{className:_e("d-block fas fa-2xl me-2",this.getVariantIcon())}),e("strong",{className:"me-auto"},this.title),this.canClose&&e("button",{className:"btn-close",attributes:{"aria-label":"Close"},dataset:{bsDismiss:"toast"},"aria-label":"Close"},e("i",{className:_e("fas fa-times fa-1xl",this.getVariantIcon())}))),e("div",{className:"toast-body"},this.body))}}class Go extends we{constructor(e,t,a){super(e,"content-block",a.rootElem),this.config=a,this.rootElem.classList.add(t),a.extraCssClasses&&this.rootElem.classList.add(...a.extraCssClasses),this.headerElement=this.buildHeader(),this.bodyElement=this.buildBody(),a.bodyClasses?.forEach(e=>{this.bodyElement.classList.add(e)})}buildHeader(){if(this.config.header&&Object.keys(this.config.header).length){const a=this.config.header.titleTag||"h6",i=t(),s=e("div",{className:"content-block-header"},e(a,{ref:i,className:"content-block-title"},this.config.header.title));return this.config.header.extraCssClasses&&s.classList.add(...this.config.header.extraCssClasses),this.config.header.tooltip&&u(i.value,{content:this.config.header.tooltip}),this.rootElem.appendChild(s),s}return null}buildBody(){const t=e("div",{className:"content-block-body"});return this.rootElem.appendChild(t),t}}const Uo=()=>e("p",{className:"mb-0"},"Want to help out by providing additional information? Contact us on our Discord!"),Oo=e("p",{className:"mb-0"},"Please select a random suffix"),Ao=e(l,null,e("p",{className:"fw-bold"},"This item is not implemented!"),e("p",null,"We are working hard on gathering all the old resources to allow for an initial implementation."),e(Uo,null)),Lo=e(l,null,e("p",null,"This item ",e("span",{className:"fw-bold"},"is")," implemented, but detailed proc behavior will be confirmed on PTR."),e(Uo,null)),Vo=e(l,null,"The equip/use effect on this item will not be implemented!"),Fo=new Map([...[].map(e=>[e,{[p.SpecUnknown]:Vo}]),...[].map(e=>[e,{[p.SpecUnknown]:Lo}]),...[77530,81136,84373,84835,85028,88585,91149,91150,91502,93454,94364,94525,95763,96135,96507,96879,98785,99807,100034,100245,100594,101038,101102,101135,101179,101247,102247,102293,102294,102295,102299,102300,102301,102302,102303,102304,102305,102308,102309,102310,102311,102650,102847,103180,103377,103678,104313,104426,104463,104478,104531,104544,104553,104576,104584,104611,104613,104616,104619,104636,104652,104675,104712,104727,104780,104793,104802,104825,104833,104860,104862,104865,104868,104885,104901,104924,104961,104976,105029,105042,105051,105074,105082,105109,105111,105114,105117,105134,105150,105173,105210,105225,105278,105291,105300,105323,105331,105358,105360,105363,105366,105383,105399,105422,105459,105474,105527,105540,105549,105572,105580,105607,105609,105612,105615,105632,105648].map(e=>[e,{[p.SpecUnknown]:Ao}])]),Wo=new Map([[2,"Not yet implemented"],[4,"Not yet implemented"]]),Mo=new Map([]);let zo=null;async function jo(e){return(await(null==zo&&(zo=fetch("/mop/assets/enchants/descriptions.json").then(e=>e.json()).then(e=>{const t={};for(const a in e)t[parseInt(a)]=e[a];return t})),zo))[e.effectId]||e.name}function Bo(e){return e.effectId+"-"+e.type}class Ho extends we{constructor(e,t){super(null,"item-notice"),this.tooltip=null,this.rootElem.classList.add("d-inline"),this.itemId=t.itemId,this.player=e,this.additionalNoticeData=t.additionalNoticeData,this.hasNotice&&this.template&&this.rootElem.appendChild(this.template),this.addOnDisposeCallback(()=>{this.tooltip?.destroy(),this.rootElem?.remove()})}get hasNotice(){return Fo.has(this.itemId)||!!this.additionalNoticeData}get noticeContent(){if(!this.hasNotice)return null;const t=Fo.get(this.itemId),a=t?.[p.SpecUnknown],i=t?.[this.player.getSpec()],s=[];return i?s.push(i?.cloneNode(!0)):a&&s.push(a?.cloneNode(!0)),this.additionalNoticeData&&s.push(this.additionalNoticeData.cloneNode(!0)),s.length?e(l,null,s.map(e=>e)):null}get template(){if(!this.hasNotice)return null;const a=this.noticeContent;if(!a)return null;const i=t(),s=e("button",{ref:i,className:"warning fa fa-exclamation-triangle fa-xl me-2"});return this.tooltip=u(i.value,{content:a}),s}static registerSetBonusNotices(t){Mo.forEach((a,i)=>{const s=a||Wo,n=e(l,null,e("p",{className:"mb-1"}," This item set has the following warnings:"),e("ul",{className:"mb-0"},Array.from(s.keys()).map(t=>e("li",null,t.toFixed(0),"-piece: ",s.get(t)))));for(const e of t.getItemIdsForSet(i))Fo.set(e,{[p.SpecUnknown]:n})})}}class qo{constructor(e){this.tooltip=null,this.config=e,this.item=e.item,this.attachTooltip()}attachTooltip(){const e={trigger:"mouseenter",triggerTarget:this.config.tippyElement,interactive:!0,interactiveBorder:10,offset:[0,5],animation:!1,placement:"bottom",theme:"tooltip-quick-swap",content:()=>this.buildList(),onCreate:e=>{e.popper.addEventListener("click",()=>e.hide())},onShow:e=>{w({exclude:e})},...this.config.tippyConfig};this.tooltip=u(this.config.tippyElement,e)}update(e){this.config={...this.config,...e},e.item&&(this.item=e.item),this.tooltip?.setContent(this.buildList())}buildList(){return Yo(this.config)}}const Yo=a=>{const i=a.getItems(a.item);return e(l,null,e("h3",{className:"tooltip-quick-swap__title h6 text-center"},a.title),i.length?e("ul",{className:"tooltip-quick-swap__list"},i.map(i=>{const s=t(),n=t(),o=t(),l=e("li",{className:"tooltip-quick-swap__list-item"},e("a",{ref:s,href:"javascript:void(0)",className:"tooltip-quick-swap__anchor d-flex align-items-center "+(i.active?" active":""),onclick:e=>{e?.preventDefault(),a.onItemClick(i.item)}},e("img",{ref:n,alt:i.item.name,className:"tooltip-quick-swap__icon gem-icon flex-shrink-0"}),e("span",{ref:o,className:"tooltip-quick-swap__label text-start"},i.item.name)));return o.value&&ko(o.value,i.item.quality),("spellId"in i.item?xe.fromSpellId(i.item.spellId):xe.fromItemId(i.item.id)).fill().then(e=>{e.setWowheadHref(s.value),n.value.src=e.iconUrl}),l})):e("p",{className:"tooltip-quick-swap__empty"},a.emptyMessage),a.footerButton&&e("div",{className:"tooltip-quick-swap__footer d-flex justify-content-center"},e("button",{onclick:a.footerButton.onClick,className:"btn btn-sm btn-primary"},a.footerButton.label)))},Ko={[r.ItemSlotHead]:"/mop/assets/item_slots/head.jpg",[r.ItemSlotNeck]:"/mop/assets/item_slots/neck.jpg",[r.ItemSlotShoulder]:"/mop/assets/item_slots/shoulders.jpg",[r.ItemSlotBack]:"/mop/assets/item_slots/shirt.jpg",[r.ItemSlotChest]:"/mop/assets/item_slots/chest.jpg",[r.ItemSlotWrist]:"/mop/assets/item_slots/wrists.jpg",[r.ItemSlotHands]:"/mop/assets/item_slots/hands.jpg",[r.ItemSlotWaist]:"/mop/assets/item_slots/waist.jpg",[r.ItemSlotLegs]:"/mop/assets/item_slots/legs.jpg",[r.ItemSlotFeet]:"/mop/assets/item_slots/feet.jpg",[r.ItemSlotFinger1]:"/mop/assets/item_slots/finger.jpg",[r.ItemSlotFinger2]:"/mop/assets/item_slots/finger.jpg",[r.ItemSlotTrinket1]:"/mop/assets/item_slots/trinket.jpg",[r.ItemSlotTrinket2]:"/mop/assets/item_slots/trinket.jpg",[r.ItemSlotMainHand]:"/mop/assets/item_slots/mainhand.jpg",[r.ItemSlotOffHand]:"/mop/assets/item_slots/offhand.jpg"};function $o(e){return Ko[e]}const Jo=t=>e("small",null,e("span",{className:"heroic-label"},"(",t,")")),Zo=(a,i,s)=>{const n=t(),o=t(),l=e("a",{ref:o,className:"gem-socket-container",href:"javascript:void(0)",dataset:{socketIdx:s}},e("img",{ref:n,className:"gem-icon "+(i?"":"hide")}),e("img",{className:"socket-icon",src:Re(a)}));return i&&xe.fromItemId(i.id).fill().then(e=>{e.setWowheadHref(o.value),n.value.src=e.iconUrl}),l};class Qo extends we{constructor(a,i,s){super(a,"gear-picker-root");const n=t(),o=t();this.rootElem.appendChild(e(l,null,e("div",{ref:n,className:"gear-picker-left tab-panel-col"}),e("div",{ref:o,className:"gear-picker-right tab-panel-col"})));const c=[r.ItemSlotHead,r.ItemSlotNeck,r.ItemSlotShoulder,r.ItemSlotBack,r.ItemSlotChest,r.ItemSlotWrist,r.ItemSlotMainHand,r.ItemSlotOffHand].map(e=>new el(n.value,this,i,s,e)),h=[r.ItemSlotHands,r.ItemSlotWaist,r.ItemSlotLegs,r.ItemSlotFeet,r.ItemSlotFinger1,r.ItemSlotFinger2,r.ItemSlotTrinket1,r.ItemSlotTrinket2].map(e=>new el(o.value,this,i,s,e));this.itemPickers=c.concat(h).sort((e,t)=>e.slot-t.slot),this.selectorModal=new cg(i.rootElem,i,s,this,{id:"gear-picker-selector-modal"})}}class Xo extends we{constructor(a,i,s){super(a,"item-picker-root",i),this.notice=null,this.socketsElem=[],this.player=s;const n=t(),o=t(),r=t(),c=t(),h=t(),m=t(),d=t(),p=t();this.rootElem.appendChild(e(l,null,e("div",{className:"item-picker-icon-wrapper"},e("span",{className:"item-picker-ilvl",ref:c}),e("a",{ref:n,className:"item-picker-icon",href:"javascript:void(0)",attributes:{role:"button"}}),e("div",{ref:p,className:"item-picker-sockets-container"})),e("div",{className:"item-picker-labels-container"},e("div",{ref:o,className:"item-picker-name-row d-flex gap-1"},e("a",{ref:r,className:"item-picker-name-container",href:"javascript:void(0)",attributes:{role:"button"}})),e("a",{ref:h,className:"item-picker-enchant hide",href:"javascript:void(0)",attributes:{role:"button"}}),e("a",{ref:m,className:"item-picker-tinker hide",href:"javascript:void(0)",attributes:{role:"button"}}),e("a",{ref:d,className:"item-picker-reforge hide",href:"javascript:void(0)",attributes:{role:"button"}})))),this.iconElem=n.value,this.nameContainerElem=o.value,this.nameElem=r.value,this.ilvlElem=c.value,this.reforgeElem=d.value,this.enchantElem=h.value,this.tinkerElem=m.value,this.socketsContainerElem=p.value}clear(e){this.abortController?.abort(),this.nameElem.removeAttribute("data-wowhead"),this.nameElem.removeAttribute("href"),this.notice?.dispose(),this.notice=null,this.iconElem.removeAttribute("data-wowhead"),this.iconElem.removeAttribute("href"),this.enchantElem.removeAttribute("data-wowhead"),this.enchantElem.removeAttribute("href"),this.tinkerElem.removeAttribute("data-wowhead"),this.tinkerElem.removeAttribute("href"),this.enchantElem.classList.add("hide"),this.reforgeElem.classList.add("hide"),this.iconElem.style.backgroundImage=`url('${$o(e)}')`,this.enchantElem.replaceChildren(),this.tinkerElem.replaceChildren(),this.reforgeElem.replaceChildren(),this.socketsContainerElem.replaceChildren(),this.nameElem.replaceChildren(),this.ilvlElem.replaceChildren(),this.socketsElem=[]}update(t){this.abortController=new AbortController,this.signal=this.abortController.signal;const a=e("span",{className:"item-picker-name"},t.item.name),i=!!t.hasRandomSuffixOptions(),s=!!t.randomSuffix;this.nameElem.replaceChildren(a),this.ilvlElem.replaceChildren(e(l,null,t.ilvl.toString(),!(t.upgrade===y.ChallengeMode||!t.ilvlFromBase)&&e("span",{className:"item-quality-uncommon"},"+",t.ilvlFromBase))),s&&(a.textContent+=" "+t.randomSuffix.name),t.item.nameDescription&&this.nameElem.appendChild(Jo(t.item.nameDescription)),this.notice=new Ho(this.player,{itemId:t.item.id,additionalNoticeData:i&&!s?Oo:void 0}),this.notice.hasNotice&&this.nameContainerElem.appendChild(this.notice.rootElem);const n=t.withDynamicStats().getReforgeData();if(n){const e=Ne.get(n.reforge?.fromStat),t=Ne.get(n.reforge?.toStat);this.reforgeElem.innerText=`Reforged ${Math.abs(n.fromAmount)} ${e} → ${n.toAmount} ${t}`,this.reforgeElem.classList.remove("hide")}else this.reforgeElem.innerText="",this.reforgeElem.classList.add("hide");ko(this.nameElem,t.item.quality),this.player.setWowheadData(t,this.iconElem),this.player.setWowheadData(t,this.nameElem),t.asActionId().fill(void 0,{signal:this.signal}).then(e=>{this.signal?.aborted||(e.setBackgroundAndHref(this.iconElem),e.setWowheadHref(this.nameElem))}),t.enchant?(jo(t.enchant).then(e=>{this.enchantElem.textContent=e}),t.enchant.spellId?(this.enchantElem.href=xe.makeSpellUrl(t.enchant.spellId),xe.makeSpellTooltipData(t.enchant.spellId).then(e=>{this.enchantElem.dataset.wowhead=e})):(this.enchantElem.href=xe.makeItemUrl(t.enchant.itemId),xe.makeItemTooltipData(t.enchant.itemId).then(e=>{this.enchantElem.dataset.wowhead=e})),this.enchantElem.dataset.whtticon="false",this.enchantElem.classList.remove("hide")):this.enchantElem.classList.add("hide"),t.tinker?(jo(t.tinker).then(e=>{this.tinkerElem.textContent=e}),t.tinker.spellId?(this.tinkerElem.href=xe.makeSpellUrl(t.tinker.spellId),xe.makeSpellTooltipData(t.tinker.spellId).then(e=>{this.tinkerElem.dataset.wowhead=e})):(this.enchantElem.href=xe.makeItemUrl(t.tinker.itemId),xe.makeItemTooltipData(t.tinker.itemId).then(e=>{this.tinkerElem.dataset.wowhead=e})),this.tinkerElem.dataset.whtticon="false",this.tinkerElem.classList.remove("hide")):this.tinkerElem.classList.add("hide"),t.allSocketColors().forEach((e,a)=>{const i=Zo(e,t.gems[a],a);if(a===t.numPossibleSockets-1&&t.couldHaveExtraSocket()){const e=()=>{i.classList[this.player.isBlacksmithing()?"remove":"add"]("hide")};this.player.professionChangeEmitter.on(e),e()}this.socketsElem.push(i),this.socketsContainerElem.appendChild(i)})}}class el extends we{constructor(e,t,a,i,s){super(e,"item-picker-root"),this.onUpdateCallbacks=[],this._equippedItem=null,this.quickSwapEnchantPopover=null,this.quickSwapGemPopover=[],this.gearPicker=t,this.simUI=a,this.player=i,this.slot=s,this.itemElem=new Xo(e,this.rootElem,i),this.item=i.getEquippedItem(s),i.sim.waitForInit().then(()=>{const e=e=>{e.preventDefault(),this.openSelectorModal(rg.Items)};this.itemElem.iconElem.addEventListener("click",e),this.itemElem.nameElem.addEventListener("click",e),this.itemElem.reforgeElem.addEventListener("click",e=>{e.preventDefault(),this.openSelectorModal(rg.Reforging)}),this.itemElem.tinkerElem.addEventListener("click",e=>{e.preventDefault(),this.openSelectorModal(rg.Tinkers)}),this.addQuickEnchantHelpers()}),i.gearChangeEmitter.on(()=>{this.item=this.player.getEquippedItem(this.slot),this._equippedItem&&(this._equippedItem!==this.quickSwapEnchantPopover?.item&&this.quickSwapEnchantPopover?.update({item:this._equippedItem}),this.addQuickGemHelpers())}),i.sim.filtersChangeEmitter.on(()=>{this._equippedItem&&(this.quickSwapEnchantPopover?.update({item:this._equippedItem}),this.quickSwapGemPopover.forEach(e=>e.update({item:this._equippedItem})))}),i.sim.showQuickSwapChangeEmitter.on(()=>{this.quickSwapEnchantPopover?.tooltip?.[this.player.sim.getShowQuickSwap()?"enable":"disable"](),this.quickSwapGemPopover.forEach(e=>e.tooltip?.[this.player.sim.getShowQuickSwap()?"enable":"disable"]())}),i.professionChangeEmitter.on(()=>{this._equippedItem&&this.player.setWowheadData(this._equippedItem,this.itemElem.iconElem)})}createGearData(){return{equipItem:(e,t)=>{this.player.equipItem(e,this.slot,t)},getEquippedItem:()=>this.player.getEquippedItem(this.slot)?.withChallengeMode(this.player.getChallengeModeEnabled()).withDynamicStats()||null,changeEvent:this.player.gearChangeEmitter}}get item(){return this._equippedItem}set item(e){this.itemElem.clear(this.slot),this.quickSwapGemPopover=[],this.itemElem.nameElem.textContent=De.get(this.slot)??"",ko(this.itemElem.nameElem,null),e&&this.itemElem.update(e),this._equippedItem=e,this.onUpdateCallbacks.forEach(e=>e())}onUpdate(e){this.onUpdateCallbacks.push(e)}openSelectorModal(e){this.gearPicker.selectorModal.openTab(this.slot,e,this.createGearData())}addQuickGemHelpers(){if(!this._equippedItem)return;const e=e=>this.openSelectorModal(`Gem${e+1}`);this.itemElem.socketsElem?.forEach(t=>{const a=Number(t.dataset.socketIdx)||0;t.addEventListener("click",t=>{t.preventDefault(),e(0)});const i=((e,t,a,i,s,n)=>new qo({title:"Favorite gems",emptyMessage:"Add favorite gems.",tippyElement:t,tippyConfig:{appendTo:document.querySelector(".sim-ui")},item:a,getItems:t=>{const a=e.sim.getFilters().favoriteGems,i=t.curSocketColors(e.isBlacksmithing())[s];return e.getGems(i).filter(e=>a.includes(e.id)).sort((e,t)=>e.color>t.color?1:-1).map(e=>({item:e,active:t.gems[s]?.id===e.id}))},onItemClick:t=>{e.equipItem(Se.nextEventID(),i,a.withGem(t,s))},footerButton:{label:"Open Gems",onClick:n}}))(this.player,t,this._equippedItem,this.slot,a,()=>e(a));this.player.sim.getShowQuickSwap()||i.tooltip?.disable(),this.quickSwapGemPopover.push(i)})}addQuickEnchantHelpers(){if(!this._equippedItem)return;const e=()=>this.openSelectorModal(rg.Enchants);var t,a,i,s,n;this.itemElem.enchantElem.addEventListener("click",t=>{t?.preventDefault(),e()}),this.quickSwapEnchantPopover=(t=this.player,a=this.itemElem.enchantElem,i=this._equippedItem,s=this.slot,n=e,new qo({title:"Favorite Enchants",emptyMessage:"Add favorite Enchants",tippyElement:a,tippyConfig:{appendTo:document.querySelector(".sim-ui")},item:i,getItems:e=>{const a=t.sim.db.getEnchants(s),i=t.sim.getFilters().favoriteEnchants,n=i?.map(e=>{const[t,i]=e.split("-").map(Number);return a.find(e=>e.effectId===t&&e.type===i)}).filter(e=>!!e);return n.map(t=>({item:t,active:e.enchant?.effectId===t.effectId}))},onItemClick:e=>{t.equipItem(Se.nextEventID(),s,i.withEnchant(e))},footerButton:{label:"Open Enchants",onClick:n}})),this.player.sim.getShowQuickSwap()||this.quickSwapEnchantPopover.tooltip?.disable()}}class tl extends we{constructor(e,t,a,i,s,n){super(e,"bulk-item-picker"),this.simUI=t,this.bulkUI=a,this.bulkSlot=s,this.index=n,this.item=i,this.itemElem=new Xo(e,this.rootElem,t.player),this.abortController=new AbortController,this.signal=this.abortController.signal,this.isEditable()||(this.rootElem.classList.add("bulk-item-picker-equipped"),e.insertAdjacentElement("afterbegin",this.rootElem)),this.addActions(),this.simUI.sim.waitForInit().then(()=>this.setItem(i)),this.addOnDisposeCallback(()=>this.rootElem.remove())}setItem(e){this.itemElem.clear(r.ItemSlotHead),this.itemElem.update(e),this.item=e,this.setupHandlers()}isEditable(){return this.index>=0}setupHandlers(){const e=Ge(this.item.item)[0],t=!!this.simUI.sim.db.getEnchants(e).length,a=this.item?.item?this.simUI.player.getAvailableReforgings(this.item):[],i=t=>{t.preventDefault(),this.isEditable()&&this.bulkUI.selectorModal.openTab(e,rg.Items,this.createGearData())},s=(t,a)=>{if(t.preventDefault(),!this.isEditable())return;let i=rg.Gem1;1===a&&(i=rg.Gem2),2===a&&(i=rg.Gem3),this.bulkUI.selectorModal.openTab(e,i,this.createGearData())};this.itemElem.iconElem.addEventListener("click",i,{signal:this.signal}),this.itemElem.nameElem.addEventListener("click",i,{signal:this.signal}),this.itemElem.enchantElem.addEventListener("click",a=>{a.preventDefault(),this.isEditable()&&t&&this.bulkUI.selectorModal.openTab(e,rg.Enchants,this.createGearData())},{signal:this.signal}),this.itemElem.reforgeElem.addEventListener("click",t=>{t.preventDefault(),this.isEditable()&&a.length&&this.bulkUI.selectorModal.openTab(e,rg.Reforging,this.createGearData())},{signal:this.signal}),this.itemElem.socketsElem.forEach((e,t)=>e.addEventListener("click",e=>s(e,t),{signal:this.signal}))}createGearData(){const e=new Se;return{equipItem:(t,a)=>{a&&(this.bulkUI.updateItem(this.index,a.asSpec()),e.emit(Se.nextEventID()))},getEquippedItem:()=>this.item,changeEvent:e}}addActions(){const a=t(),i=t();this.itemElem.rootElem.appendChild(e("div",{className:"item-picker-actions-container"},e("button",{className:"btn btn-link item-picker-actions-btn",ref:a},e("i",{className:"fas fa-copy"})),this.isEditable()&&e("button",{className:"btn btn-link link-danger item-picker-actions-btn",ref:i},e("i",{className:"fas fa-times"}))));const s=a.value;u(s,{content:"Make an editable copy of this item."});const n=()=>this.bulkUI.addItemToSlot(this.item.asSpec(),this.bulkSlot);if(s.addEventListener("click",n),this.addOnDisposeCallback(()=>s.removeEventListener("click",n)),i.value){const e=i.value;u(e,{content:"Remove this item from the batch."});const t=()=>this.bulkUI.removeItemByIndex(this.index);e.addEventListener("click",t),this.addOnDisposeCallback(()=>e.removeEventListener("click",t))}}}var al=(e=>(e[e.ItemSlotHead=0]="ItemSlotHead",e[e.ItemSlotNeck=1]="ItemSlotNeck",e[e.ItemSlotShoulder=2]="ItemSlotShoulder",e[e.ItemSlotBack=3]="ItemSlotBack",e[e.ItemSlotChest=4]="ItemSlotChest",e[e.ItemSlotWrist=5]="ItemSlotWrist",e[e.ItemSlotHands=6]="ItemSlotHands",e[e.ItemSlotWaist=7]="ItemSlotWaist",e[e.ItemSlotLegs=8]="ItemSlotLegs",e[e.ItemSlotFeet=9]="ItemSlotFeet",e[e.ItemSlotFinger=10]="ItemSlotFinger",e[e.ItemSlotTrinket=11]="ItemSlotTrinket",e[e.ItemSlotMainHand=12]="ItemSlotMainHand",e[e.ItemSlotOffHand=13]="ItemSlotOffHand",e[e.ItemSlotHandWeapon=14]="ItemSlotHandWeapon",e))(al||{});const il=new Map([[0,"Head"],[1,"Neck"],[2,"Shoulders"],[3,"Back"],[4,"Chest"],[5,"Wrist"],[6,"Hands"],[7,"Waist"],[8,"Legs"],[9,"Feet"],[10,"Rings"],[11,"Trinkets"],[12,"Main Hand"],[13,"Off Hand"],[14,"Weapons"]]),sl=new Map([[r.ItemSlotHead,0],[r.ItemSlotNeck,1],[r.ItemSlotShoulder,2],[r.ItemSlotBack,3],[r.ItemSlotChest,4],[r.ItemSlotWrist,5],[r.ItemSlotHands,6],[r.ItemSlotWaist,7],[r.ItemSlotLegs,8],[r.ItemSlotFeet,9],[r.ItemSlotFinger1,10],[r.ItemSlotFinger2,10],[r.ItemSlotTrinket1,11],[r.ItemSlotTrinket2,11],[r.ItemSlotMainHand,12],[r.ItemSlotOffHand,13]]),nl=(e,t)=>t&&[r.ItemSlotMainHand,r.ItemSlotOffHand].includes(e)?14:sl.get(e);class ol extends Go{constructor(e,t,a,i){const s=il.get(i);super(e,"bulk-item-picker-group-root",{header:{title:s}}),this.pickers=new Map,this.rootElem.classList.add(`gear-group-${s.split(" ").join("-")}`),this.simUI=t,this.bulkUI=a,this.bulkSlot=i,this.addEmptyElement()}has(e){return!!this.pickers.get(e)}add(e,t){if(this.pickers.size||this.bodyElement.replaceChildren(),this.pickers.has(e)){this.pickers.get(e).dispose(),this.pickers.delete(e)}this.pickers.set(e,new tl(this.bodyElement,this.simUI,this.bulkUI,t,this.bulkSlot,e))}update(e,t){const a=this.pickers.get(e);a?a.setItem(t):new No({variant:"error",body:"Failed to update item, please report this issue."})}remove(e){const t=this.pickers.get(e);t?(t.dispose(),this.pickers.delete(e),this.pickers.size||this.addEmptyElement()):new No({variant:"error",body:"Failed to remove item, please report this issue."})}addEmptyElement(){this.bodyElement.appendChild(e("span",null,"No items selected."))}}class ll extends Go{constructor(a,i,s){super(a,"bulk-item-search-root",{header:{title:"Item Search"}}),this.filtersChangeEmitter=new Se,this.allItems=[],this._searchString="",this.minIlvl=0,this.maxIlvl=0,this.simUI=i,this.bulkUI=s,this.abortController=new AbortController,this.signal=this.abortController.signal;const n=t(),o=t(),l=t(),r=t(),c=t();this.bodyElement.appendChild(e("div",{className:"bulk-gear-search-container",ref:n},e("div",{className:"d-flex flex-column"},e("label",{className:"form-label",htmlFor:"bulkGearSearch"},"Name"),e("div",{className:"input-group"},e("input",{id:"bulkGearSearch",className:"form-control",type:"text",placeholder:"Search...",ref:o}),e("button",{className:"btn btn-link cancel-bulk-gear-search-btn hide",ref:l,type:"button"},e("i",{className:"fas fa-times"}))),e("ul",{ref:r,className:"bulk-gear-search-results dropdown-menu no-hover"})),e("div",{className:"bulk-gear-search-ilvl-filters",ref:c}))),this.inputElem=o.value,this.cancelSearchElem=l.value,this.searchResultElem=r.value,u(this.cancelSearchElem,{content:"Clear search"}),this.cancelSearchElem.addEventListener("click",()=>{this.searchString=""}),new Co(c.value,this,{id:"bulkGearSearchMinIlvl",label:"Min ILvl",showZeroes:!1,changedEvent:e=>this.filtersChangeEmitter,getValue:e=>this.minIlvl,setValue:(e,t,a)=>{this.minIlvl=a,this.filtersChangeEmitter.emit(e)}}),c.value.appendChild(e("span",{className:"ilvl-filters-separator"},"-")),new Co(c.value,this,{id:"bulkGearSearchMaxIlvl",label:"Max ILvl",showZeroes:!1,changedEvent:e=>this.filtersChangeEmitter,getValue:e=>this.maxIlvl,setValue:(e,t,a)=>{this.maxIlvl=a,this.filtersChangeEmitter.emit(e)}}),this.simUI.sim.waitForInit().then(()=>{this.allItems=this.simUI.sim.db.getAllItems().filter(e=>Ue(e,this.simUI.player.getPlayerSpec(),void 0)).sort((e,t)=>{const a=e.scalingOptions?.[y.Base].ilvl||e.ilvl,i=t.scalingOptions?.[y.Base].ilvl||t.ilvl;return a<i?1:i<a?-1:0}),this.filtersChangeEmitter.on(()=>{this.performSearch()}),o.value.addEventListener("input",()=>{this.searchString=o.value.value})})}get searchString(){return this._searchString}set searchString(e){this._searchString=e,this.inputElem.value=e,this.filtersChangeEmitter.emit(Se.nextEventID())}performSearch(){if(!this.searchString.length)return this.cancelSearchElem.classList.add("hide"),void this.searchResultElem.classList.remove("show");const a=this.searchString.split(" "),i=e(l,null);let s=0;this.allItems.forEach(n=>{const o=n.scalingOptions?.[y.Base].ilvl||n.ilvl;if(0!=this.maxIlvl&&this.maxIlvl<o)return!1;if(0!=this.minIlvl&&this.minIlvl>o)return!1;let r=!0;const c=n.name.toLowerCase(),h=n.setName.toLowerCase();if(a.forEach(e=>{const t=e.toLowerCase();return!(!c.includes(t)&&!h.includes(t))||(r=!1,!1)}),r&&s++,r&&s<=21){const a=t(),s=t(),r=t();i.appendChild(e("li",null,e("a",{className:"dropdown-item bulk-item-search-item",dataset:{itemId:n.id.toString()},ref:a,target:"_blank"},e("div",{className:"bulk-item-search-item-icon-wrapper"},e("span",{className:"item-picker-ilvl"},o),e("div",{className:"bulk-item-search-item-icon",ref:s})),e("div",{className:"d-flex flex-column ps-2"},e("div",{className:"d-flex"},e("span",{ref:r},n.name),n.nameDescription&&Jo(n.nameDescription),n.factionRestriction===Oe.HORDE_ONLY&&e("span",{className:"faction-horde"},"(H)"),n.factionRestriction===Oe.ALLIANCE_ONLY&&e("span",{className:"faction-alliance"},"(A)")),e("small",null,il.get(sl.get(Ge(n)[0]))))))),xe.fromItem(n).fill().then(e=>{e.setBackground(s.value),e.setWowheadHref(a.value)}),ko(r.value,n.quality),a.value.addEventListener("click",t=>{t.preventDefault(),this.bulkUI.addItem(b.create({id:n.id})),new No({delay:1e3,variant:"success",body:e(l,null,e("strong",null,n.name)," was added to the batch.")})},{signal:this.signal})}}),this.searchResultElem.replaceChildren(e(l,null,i,s>21&&e("li",{className:"bulk-item-search-item bulk-item-search-results-note"},"Showing ",21," of ",s," total results."),0===s&&e("li",{className:"bulk-item-search-item bulk-item-search-results-note"},"No results found."))),this.searchResultElem.classList.add("show"),this.cancelSearchElem.classList.remove("hide")}}class rl extends we{constructor(a,i,s,n,o){super(a,"bulk-sim-result-root"),this.simUI=i,s.simTalents||this.rootElem.classList.add("bulk-sim-result-no-talents");const r=n.unitMetrics.dps.avg-o.unitMetrics.dps.avg,c=t(),h=t(),m=t();if(this.rootElem.appendChild(e(l,null,e("div",{className:"results-sim"},e("div",{className:"results-sim-dps damage-metrics"},e("span",{className:"topline-result-avg"},this.formatDps(n.unitMetrics.dps.avg)),e("div",{className:"results-reference"},e("span",{ref:h,className:_e("results-reference-diff",r>=0?"positive":"negative")})))),e("div",{ref:m,className:"bulk-gear-combo"}),s.simTalents&&e("div",{className:"bulk-talent-loadout"},e("span",null,n.talentLoadout&&"object"==typeof n.talentLoadout?`Talents: ${n.talentLoadout.name}`:"Current Talents")),e("div",{className:"bulk-results-actions"},e("button",{ref:c,className:_e("btn btn-primary bulk-equip-btn",!n.itemsAdded?.length&&"d-none")},"Equip")))),Ae(h.value,o.unitMetrics.dps.avg,n.unitMetrics.dps.avg,2,void 0,void 0,!0),n.itemsAdded?.length){c.value?.addEventListener("click",()=>{n.itemsAdded.forEach(e=>{if(e.item){const t=i.sim.db.lookupItemSpec(e.item);i.player.equipItem(Se.nextEventID(),e.slot,t),i.simHeader.activateTab("gear-tab")}}),new No({variant:"success",body:"Batch gear equipped!"})});const t=e(l,null);for(const a of n.itemsAdded){const s=e("div",{className:"bulk-result-item"}),n=new Xo(t,s,i.player);if(a.item&&0!=a.item.id){const e=i.sim.db.lookupItemSpec(a.item);n.update(e)}else n.clear(a.slot);t.appendChild(s)}m.value.appendChild(t)}else n.talentLoadout&&"object"==typeof n.talentLoadout||(h.value?.classList.add("hide"),m.value.appendChild(e("p",{className:"mb-0"},"Current Gear")))}formatDps(e){return(Math.round(100*e)/100).toFixed(2)}}class cl extends Io{constructor(a,i,s,n,o){super(a,"selector-modal",{disposeOnClose:!1,size:"xl"}),this.simUI=i,this.onSelect=n,this.onRemove=o,this.socketColor=s,this.ilist=null,window.scrollTo({top:0}),this.header.insertAdjacentElement("afterbegin",e("h6",{className:"selector-modal-title mb-3"},"Choose Default Gem"));const l=t();this.body.appendChild(e("div",{ref:l,className:"tab-content selector-modal-tab-content"})),this.contentElem=l.value}show(){if(!this.ilist){this.ilist=new lg("bulk-tab-gem-selector",this.contentElem,this.simUI,r.ItemSlotHead,rg.Gem1,this.simUI.player,rg.Gem1,{equipItem:(e,t)=>{},getEquippedItem:()=>null,changeEvent:new Se},this.simUI.player.getGems(this.socketColor).map(e=>({item:e,id:e.id,actionId:xe.fromItemId(e.id),name:e.name,quality:e.quality,phase:e.phase,nameDescription:"",baseEP:this.simUI.player.computeStatsEP(new ke(e.stats)),ignoreEPFilter:!0,onEquip:Le})),this.socketColor,e=>this.simUI.player.computeGemEP(e),()=>null,this.onRemove,this.onSelect),this.ilist.sizeRefresh();const e=()=>this.ilist?.applyFilters(),t=this.simUI.sim.phaseChangeEmitter.on(e),a=this.simUI.sim.filtersChangeEmitter.on(e);this.addOnDisposeCallback(()=>{t.dispose(),a.dispose(),this.ilist?.dispose()})}this.open()}}var hl=(e=>(e[e.Gear=0]="Gear",e[e.Talents=1]="Talents",e[e.Rotation=2]="Rotation",e[e.Consumes=3]="Consumes",e[e.Miscellaneous=4]="Miscellaneous",e[e.External=5]="External",e[e.Encounter=6]="Encounter",e[e.UISettings=7]="UISettings",e))(hl||{});const ml=(()=>{const e=new Map;return e.set(0,"g"),e.set(1,"t"),e.set(2,"r"),e.set(3,"c"),e.set(4,"m"),e.set(5,"x"),e.set(6,"e"),e.set(7,"u"),e})();class dl extends Io{constructor(a,i){super(a,"importer",{title:i.title,footer:!0,disposeOnClose:!1}),this.allowFileUpload=i.allowFileUpload||!1;const s="upload-input-"+i.title.toLowerCase().replaceAll(" ","-"),n=t(),o=t(),r=t(),c=t();this.body.replaceChildren(e(l,null,e("div",{ref:n,className:"import-description"}),e("textarea",{ref:o,className:"importer-textarea form-control",attributes:{spellcheck:!1}}))),this.footer.appendChild(e(l,null,this.allowFileUpload&&e(l,null,e("label",{htmlFor:s,className:"importer-button btn btn-primary upload-button me-2"},e("i",{className:"fas fa-file-arrow-up me-1"}),"Upload File"),e("input",{ref:c,type:"file",id:s,className:"importer-upload-input d-none",hidden:!0})),e("button",{ref:r,className:"importer-button btn btn-primary import-button"},e("i",{className:"fa fa-download me-1"}),"Import"))),this.descriptionElem=n.value,this.textElem=o.value,this.allowFileUpload&&c.value&&c.value.addEventListener("change",async e=>{this.textElem.textContent=await e.target.files[0].text()}),this.importButton=r.value,this.importButton.addEventListener("click",async e=>{try{await this.onImport(this.textElem.value||"")}catch(t){new No({variant:"error",body:`Import error: ${t?.message||t}`})}})}}const pl=class extends dl{constructor(e,t,a){super(e,a),this.simUI=t}async finishIndividualImport(e,{charClass:t,race:a,equipmentSpec:i,talentsStr:s,glyphs:n,professions:o,missingEnchants:l=[],missingItems:r=[]}){if(t!=e.player.getClass())throw new Error(`Wrong Class! Expected ${e.player.getPlayerClass().friendlyName} but found ${Fe.get(t)}!`);await We.loadLeftoversIfNecessary(i);const c=e.sim.db.lookupEquipmentSpec(i),h=Se.nextEventID();Se.freezeAllAndDo(()=>{e.player.setRace(h,a),e.player.setGear(h,c),s&&"--"!=s&&e.player.setTalentsString(h,s),n&&e.player.setGlyphs(h,n),o.length>0&&e.player.setProfessions(h,o)}),this.close(),0==r.length&&0==l.length?new No({variant:"success",body:"Import successful!"}):new No({variant:"info",body:"Import successful, but the following IDs were not found in the sim database:"+(0==r.length?"":"\n\nItems: "+r.join(", "))+(0==l.length?"":"\n\nEnchants: "+l.join(", "))})}};pl.DEFAULT_CATEGORIES=Ve(hl).filter(e=>e!=hl.UISettings),pl.CATEGORY_PARAM="i";let ul=pl;class gl extends ul{constructor(t,a,i){super(t,a,{title:"Bag Item Import",allowFileUpload:!0}),this.bulkUI=i,this.descriptionElem.appendChild(e(l,null,e("p",null,"Import bag items from a JSON file, which can be created by the WowSimsExporter in-game AddOn."),e("p",null,"To import, upload the file or paste the text below, then click, 'Import'.")))}async onImport(e){try{const t=S.fromJsonString(e,{ignoreUnknownFields:!0});if(t?.items?.length>0){const e=await We.loadLeftoversIfNecessary(t),a=t.items.filter(t=>t.id>0&&e.lookupItemSpec(t));a.length>0&&this.bulkUI.addItems(a)}this.close()}catch(t){console.warn(t),alert(t.toString())}}}class fl extends we{constructor(a,i){const s=t();super(a,"copy-button",e("button",{className:`btn ${i.extraCssClasses?.join(" ")??""}`,ref:s},e("i",{className:"fas fa-copy me-1"}),i.text??"Copy to Clipboard")),this.config=i;const n=s.value;let o=!1;n.addEventListener("click",()=>{if(o)return;const e=this.config.getContent();if(null==navigator.clipboard)alert(e);else{o=!0,navigator.clipboard.writeText(e);const t=n.innerHTML;n.innerHTML='<i class="fas fa-check me-1"></i>Copied',setTimeout(()=>{n.innerHTML=t,o=!1},1500)}}),i.tooltip&&u(n,{content:i.tooltip})}}const wl={id:0,name:"Empty",description:"",iconUrl:"https://wow.zamimg.com/images/wow/icons/medium/inventoryslot_empty.jpg",quality:null,spellId:0};class yl extends we{constructor(e,t,a){super(e,"glyphs-picker-root"),this.majorGlyphPickers=[],this.minorGlyphPickers=[],this.glyphsConfig=a,this.player=t;const i=Object.keys(a.majorGlyphs).map(e=>Number(e)),s=Object.keys(a.minorGlyphs).map(e=>Number(e)),n=new Go(this.rootElem,"major-glyphs",{header:{title:"Major Glyphs",extraCssClasses:["border-0"]}}),o=new Go(this.rootElem,"minor-glyphs",{header:{title:"Minor Glyphs",extraCssClasses:["border-0"]}});this.selectorModal=new Sl(this.rootElem.closest(".individual-sim-ui")),We.get().then(e=>{const a=i.map(t=>this.getGlyphData(t,e)),l=s.map(t=>this.getGlyphData(t,e));a.sort((e,t)=>Me(e.name,t.name)),l.sort((e,t)=>Me(e.name,t.name)),this.majorGlyphPickers=["major1","major2","major3"].map(e=>new bl(n.bodyElement,{label:"Major",player:t,selectorModal:this.selectorModal,glyphOptions:a,glyphField:e})),this.minorGlyphPickers=["minor1","minor2","minor3"].map(e=>new bl(o.bodyElement,{label:"Minor",player:t,selectorModal:this.selectorModal,glyphOptions:l,glyphField:e}))})}getGlyphData(e,t){const a=this.glyphsConfig.majorGlyphs[e]||this.glyphsConfig.minorGlyphs[e];return{id:e,name:a.name,description:a.description,iconUrl:a.iconUrl,quality:i.ItemQualityCommon,spellId:t.glyphItemToSpellId(e)}}}class bl extends ye{constructor(a,{player:i,selectorModal:s,glyphOptions:n,glyphField:o}){super(a,"glyph-picker-root",i,{id:`glyph-picker-glyph-${o}`,inline:!0,changedEvent:e=>e.glyphsChangeEmitter,getValue:e=>e.getGlyphs()[o],setValue:(e,t,a)=>{const i=t.getGlyphs();i[o]=a,t.setGlyphs(e,i)}}),this.rootElem.classList.add("item-picker-root"),this.player=i,this.glyphOptions=n,this.selectedGlyph=wl;const l=t(),r=t(),c=t();this.rootElem.appendChild(e("a",{ref:l,attributes:{role:"button"},className:"glyph-link"},e("img",{ref:r,className:"item-picker-icon"}),e("div",{className:"item-picker-labels-container"},e("span",{ref:c,className:"item-picker-name-container"})))),this.anchorElem=l.value,this.iconElem=r.value,this.nameElem=c.value,this.anchorElem.addEventListener("click",e=>{e.preventDefault(),s.openTab(this,n)},{signal:this.signal}),this.init()}getInputElem(){return this.iconElem}getInputValue(){return this.selectedGlyph?.id??0}setInputValue(e){this.selectedGlyph=this.glyphOptions.find(t=>t.id==e),this.selectedGlyph?(this.selectedGlyph.spellId?(this.anchorElem.href=xe.makeSpellUrl(this.selectedGlyph.spellId),xe.makeSpellTooltipData(this.selectedGlyph.spellId).then(e=>{this.anchorElem.dataset.wowhead=e,this.anchorElem.dataset.whtticon="false"})):(this.anchorElem.href=xe.makeItemUrl(this.selectedGlyph.id),xe.makeItemTooltipData(this.selectedGlyph.id).then(e=>{this.anchorElem.dataset.wowhead=e,this.anchorElem.dataset.whtticon="false"})),this.iconElem.src=this.selectedGlyph.iconUrl,this.nameElem.textContent=this.selectedGlyph.name.replace(/Glyph of /,"")):this.clear()}clear(){this.anchorElem.removeAttribute("data-wowhead"),this.anchorElem.removeAttribute("href"),this.iconElem.src=wl.iconUrl,this.nameElem.textContent=wl.name}}class Sl extends Io{constructor(a){super(a,"glyph-modal",{title:"Glyphs",disposeOnClose:!1}),this.listItems=[],this.glyphOptions=[],this.glyphPicker=null;const i=t(),s=t();this.body.appendChild(e(l,null,e("div",{className:"input-root"},e("input",{ref:s,className:"selector-modal-search form-control",type:"text",placeholder:"Search..."})),e("ul",{ref:i,className:"selector-modal-list"}))),this.list=i.value,this.search=s.value,this.search.addEventListener("input",()=>this.applyFilters())}openTab(e,t){this.setData(e,t),this.applyFilters(),this.open()}setData(a,i){this.glyphPicker=a,this.list.innerHTML="",this.listItems=[],this.glyphOptions=[wl,...i];const s=this.glyphOptions.map((a,i)=>{const s=t(),n=t(),o=t(),l=e("li",{className:"selector-modal-list-item",dataset:{idx:String(i)}},e("a",{ref:s,className:"selector-modal-list-item-link"},e("img",{ref:n,className:"selector-modal-list-item-icon"}),e("label",{ref:o,className:"selector-modal-list-item-name"},a.name),e("span",{className:"selector-modal-list-item-description"},a.description)));return s.value&&(a.spellId?s.value.href=xe.makeSpellUrl(a.spellId):s.value.href=xe.makeItemUrl(a.id),s.value.addEventListener("click",e=>{e.preventDefault(),this.glyphPicker?.setValue(Se.nextEventID(),a.id)})),n.value&&(n.value.src=a.iconUrl),o.value&&ko(o.value,a.quality),l});this.listItems=s,this.list.appendChild(e(l,null,this.listItems)),this.glyphPicker.player.glyphsChangeEmitter.on(()=>{this.applyFilters()})}applyFilters(){if(!this.glyphPicker)return;const e=this.glyphPicker.selectedGlyph?.id??0;this.listItems.forEach(t=>{const a=parseInt(t.dataset.idx),i=this.glyphOptions[a];t.classList[i.id==e?"add":"remove"]("active")}),this.listItems.map(e=>{const t=parseInt(e.dataset.idx),a=this.glyphOptions[t];let i="remove";if(this.search.value.length>0){const e=this.search.value.toLowerCase().split(" "),t=a.name.toLowerCase();e.forEach(e=>{t.includes(e)||"remove"!==i||(i="add")})}e.classList[i]("d-none")})}}class vl extends ye{constructor(a,i,s){super(a,"talents-picker-root",i,{...s}),this.modObject=i,this.config=s;const n=t(),o=t(),l=t();this.rootElem.appendChild(e("div",{className:"talents-picker-inner",ref:n},e("div",{className:"talents-picker-header"},e("div",{className:"talents-picker-actions",ref:o})),e("div",{id:"talents",className:"talents-picker-list",ref:l})));const r=l.value;new fl(o.value,{extraCssClasses:["btn-sm","btn-outline-primary","copy-talents"],getContent:()=>i.getTalentsString(),text:"Copy",tooltip:"Copy talent string"}),this.tree=new Il(r,this.config.tree,this,s.playerSpec),this.tree.rows.forEach(e=>e.forEach(e=>e.setSelected(!1))),this.isPlayer()&&new yl(this.rootElem,this.modObject,Kl[this.modObject.getClass()]),this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.tree.getTalentsString()}setInputValue(e){this.tree.setTalentsString(e)}isPlayer(){return!!this.modObject?.playerClass}}class Il extends we{constructor(a,i,s,n){super(a,"talent-tree-picker-root"),this.picker=s;const o=t();this.rows=i.talents.reduce((e,t)=>(e[t.location.rowIdx]||(e[t.location.rowIdx]=[]),e[t.location.rowIdx][t.location.colIdx]=new El(null,t,this),e),[]),this.rootElem.replaceChildren(e(l,null,e("div",{className:"talent-tree-header"},e("img",{src:this.getTreeIcon(n),className:"talent-tree-icon"}),e("span",{className:"talent-tree-title"},ze.fromProto(n).friendlyName),e("button",{ref:o,className:"talent-tree-reset btn link-danger"},e("i",{className:"fa fa-times"}))),e("div",{className:"talent-tree-background",style:{backgroundImage:`url('${i.backgroundUrl}')`}}),e("div",{className:"talent-tree-main"},this.rows.map((t,a)=>e("div",{className:"talent-tree-row"},e("div",{className:"talent-tree-level"},15*(a+1)),t.map(e=>e.rootElem))))));const r=o.value;u(r,{content:"Reset talent points"}),r.addEventListener("click",e=>this.resetPoints())}getTalent(e){const t=this.rows[e.rowIdx].find(t=>t.getCol()==e.colIdx);if(!t)throw new Error("No talent found with location: "+e);return t}getTalentsString(){return Array.from(Array(6),(e,t)=>{const a=this.rows[t].find(e=>e.getRow()==t&&e.isSelected());return a?a.getCol()+1:0}).join("")}setTalentsString(e){const t=e.split("").map(Number);this.rows.forEach((e,a)=>e.forEach(e=>{e.setSelected(e.getCol()+1===t[a])}))}resetPoints(){this.rows.forEach(e=>e.forEach(e=>e.setSelected(!1))),this.picker.inputChanged(Se.nextEventID())}getTreeIcon(e){return ze.fromProto(e).getIcon("medium")}}class El extends we{constructor(a,i,s){super(a,"talent-picker-root",document.createElement("a")),this.config=i,this.tree=s,this.zIdx=0;const n=t();this.rootElem.replaceChildren(e(l,null,e("div",{ref:n,className:"talent-picker-icon"}),e("div",{className:"talent-picker-label",dataset:{whtticon:!1}},i.fancyName))),this.icon=n.value,this.rootElem.addEventListener("click",e=>{e.preventDefault()}),this.rootElem.addEventListener("contextmenu",e=>{e.preventDefault()}),this.rootElem.addEventListener("touchmove",e=>{null!=this.longTouchTimer&&(clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0)}),this.rootElem.addEventListener("touchstart",e=>{e.preventDefault(),this.longTouchTimer=window.setTimeout(()=>{this.setSelected(!1),this.tree.picker.inputChanged(Se.nextEventID()),this.longTouchTimer=void 0},750)}),this.rootElem.addEventListener("touchend",e=>{e.preventDefault(),null!=this.longTouchTimer&&(clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0,this.setSelected(!0),this.tree.picker.inputChanged(Se.nextEventID()))}),this.rootElem.addEventListener("mousedown",e=>{const t=!je(e);this.setSelected(t),this.tree.picker.inputChanged(Se.nextEventID())})}get zIndex(){return this.zIdx}set zIndex(e){this.zIdx=e,this.rootElem.style.zIndex=String(this.zIdx)}getRow(){return this.config.location.rowIdx}getCol(){return this.config.location.colIdx}isSelected(){return"true"===this.rootElem.dataset.selected}setSelected(e){if(e){const e=this.tree.rows[this.getRow()].find(e=>e.getCol()!==this.getCol()&&e.isSelected());e?.isSelected()&&e.setSelected(!1)}this.rootElem.dataset.selected=String(e),xe.fromSpellId(this.config.spellId).fill().then(e=>{e.setWowheadHref(this.rootElem),this.icon.style.backgroundImage=`url('${e.iconUrl}')`})}}function kl(e){return e.talents.forEach((t,a)=>{if(0!=a){const i=e.talents[a-1];if(t.location.rowIdx<i.location.rowIdx||t.location.rowIdx==i.location.rowIdx&&t.location.colIdx<=i.location.colIdx)throw new Error(`Out-of-order talent: ${String(t.fancyName)}`)}}),e}const Cl=kl({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"roilingBlood",fancyName:"Roiling Blood",location:{rowIdx:0,colIdx:0},spellId:108170},{fieldName:"plagueLeech",fancyName:"Plague Leech",location:{rowIdx:0,colIdx:1},spellId:123693},{fieldName:"unholyBlight",fancyName:"Unholy Blight",location:{rowIdx:0,colIdx:2},spellId:115989},{fieldName:"lichborne",fancyName:"Lichborne",location:{rowIdx:1,colIdx:0},spellId:49039},{fieldName:"antimagicZone",fancyName:"Anti-Magic Zone",location:{rowIdx:1,colIdx:1},spellId:51052},{fieldName:"purgatory",fancyName:"Purgatory",location:{rowIdx:1,colIdx:2},spellId:114556},{fieldName:"deathsAdvance",fancyName:"Death's Advance",location:{rowIdx:2,colIdx:0},spellId:96268},{fieldName:"chilblains",fancyName:"Chilblains",location:{rowIdx:2,colIdx:1},spellId:50041},{fieldName:"asphyxiate",fancyName:"Asphyxiate",location:{rowIdx:2,colIdx:2},spellId:108194},{fieldName:"deathPact",fancyName:"Death Pact",location:{rowIdx:3,colIdx:0},spellId:48743},{fieldName:"deathSiphon",fancyName:"Death Siphon",location:{rowIdx:3,colIdx:1},spellId:108196},{fieldName:"conversion",fancyName:"Conversion",location:{rowIdx:3,colIdx:2},spellId:119975},{fieldName:"bloodTap",fancyName:"Blood Tap",location:{rowIdx:4,colIdx:0},spellId:45529},{fieldName:"runicEmpowerment",fancyName:"Runic Empowerment",location:{rowIdx:4,colIdx:1},spellId:81229},{fieldName:"runicCorruption",fancyName:"Runic Corruption",location:{rowIdx:4,colIdx:2},spellId:51462},{fieldName:"gorefiendsGrasp",fancyName:"Gorefiend's Grasp",location:{rowIdx:5,colIdx:0},spellId:108199},{fieldName:"remorselessWinter",fancyName:"Remorseless Winter",location:{rowIdx:5,colIdx:1},spellId:108200},{fieldName:"desecratedGround",fancyName:"Desecrated Ground",location:{rowIdx:5,colIdx:2},spellId:108201}]}),_l={majorGlyphs:{[He.GlyphOfAntiMagicShell]:{name:"Glyph of Anti-Magic Shell",description:"Causes your Anti-Magic Shell to absorb all incoming magical damage, up to the absorption limit.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_antimagicshell.jpg"},[He.GlyphOfUnholyFrenzy]:{name:"Glyph of Unholy Frenzy",description:"Causes your Unholy Frenzy to no longer deal damage to the affected target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_unholyfrenzy.jpg"},[He.GlyphOfIceboundFortitude]:{name:"Glyph of Icebound Fortitude",description:"Reduces the cooldown of your Icebound Fortitude by 50%, but also reduces its duration by 75%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_iceboundfortitude.jpg"},[He.GlyphOfChainsOfIce]:{name:"Glyph of Chains of Ice",description:"Your Chains of Ice also causes 143 Frost damage, with additional damage depending on your attack power.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_chainsofice.jpg"},[He.GlyphOfDeathGrip]:{name:"Glyph of Death Grip",description:"Increases the range of your Death Grip ability by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_strangulate.jpg"},[He.GlyphOfDeathAndDecay]:{name:"Glyph of Death and Decay",description:"Your Death and Decay also reduces the movement speed of enemies within its radius by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathanddecay.jpg"},[He.GlyphOfShiftingPresences]:{name:"Glyph of Shifting Presences",description:"You retain 70% of your Runic Power when switching Presences.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_bloodpresence.jpg"},[He.GlyphOfIcyTouch]:{name:"Glyph of Icy Touch",description:"Your Icy Touch dispels one helpful Magic effect from the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_icetouch.jpg"},[He.GlyphOfEnduringInfection]:{name:"Glyph of Enduring Infection",description:"Your diseases are undispellable, but their damage dealt is reduced by 15%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_creature_disease_05.jpg"},[He.GlyphOfPestilence]:{name:"Glyph of Pestilence",description:"Increases the radius of your Pestilence effect by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_plaguecloud.jpg"},[He.GlyphOfMindFreeze]:{name:"Glyph of Mind Freeze",description:"Reduces the cooldown of your Mind Freeze ability by 1 sec, but also raises its cost by 10 Runic Power.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_mindfreeze.jpg"},[He.GlyphOfStrangulate]:{name:"Glyph of Strangulate",description:"Increases the Silence duration of your Strangulate ability by 2 sec when used on a target who is casting a spell.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_soulleech_3.jpg"},[He.GlyphOfPillarOfFrost]:{name:"Glyph of Pillar of Frost",description:"Empowers your Pillar of Frost, making you immune to all effects that cause loss of control of your character, but also reduces your movement speed by 70% while the ability is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_deathknight_pillaroffrost.jpg"},[He.GlyphOfVampiricBlood]:{name:"Glyph of Vampiric Blood",description:"Increases the bonus healing received while your Vampiric Blood is active by an additional 15%, but your Vampiric Blood no longer grants you health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain.jpg"},[He.GlyphOfUnholyCommand]:{name:"Glyph of Unholy Command",description:"Immediately finishes the cooldown of your Death Grip upon dealing a killing blow to a target that grants experience or honor.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_skull.jpg"},[He.GlyphOfOutbreak]:{name:"Glyph of Outbreak",description:"Your Outbreak spell no longer has a cooldown, but now costs 30 Runic Power.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathvortex.jpg"},[He.GlyphOfDancingRuneWeapon]:{name:"Glyph of Dancing Rune Weapon",description:"Increases your threat generation by 100% while your Dancing Rune Weapon is active, but reduces its damage dealt by 25%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_sword_07.jpg"},[He.GlyphOfDarkSimulacrum]:{name:"Glyph of Dark Simulacrum",description:"Reduces the cooldown of Dark Simulacrum by 30 sec and increases its duration by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_consumemagic.jpg"},[He.GlyphOfDeathCoil]:{name:"Glyph of Death Coil",description:"Your Death Coil spell is now usable on all allies. When cast on a non-undead ally, Death Coil shrouds them with a protective barrier that absorbs up to 168 damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathcoil.jpg"},[He.GlyphOfDarkSuccor]:{name:"Glyph of Dark Succor",description:"When you kill an enemy that yields experience or honor, while in Frost or Unholy Presence, your next Death Strike within 15s is free and will restore at least 20% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_butcher2.jpg"},[He.GlyphOfSwiftDeath]:{name:"Glyph of Swift Death",description:"The haste effect granted by Soul Reaper now also increases your movement speed by 30% for the duration.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_deathknight_soulreaper.jpg"},[He.GlyphOfLoudHorn]:{name:"Glyph of Loud Horn",description:"Your Horn of Winter now generates an additional 10 Runic Power, but the cooldown is increased by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_horn_04.jpg"},[He.GlyphOfRegenerativeMagic]:{name:"Glyph of Regenerative Magic",description:"If Anti-Magic Shell expires after its full duration, the cooldown is reduced by up to 50%, based on the amount of damage absorbtion remaining.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_antimagicshell.jpg"},[He.GlyphOfFesteringBlood]:{name:"Glyph of Festering Blood",description:"Blood Boil will now treat all targets as though they have Blood Plague or Frost Fever applied.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_yorsahj_bloodboil_green.jpg"}},minorGlyphs:{[Be.GlyphOfTheGeist]:{name:"Glyph of the Geist",description:"Your Raise Dead spell summons a geist instead of a ghoul.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_animatedead.jpg"},[Be.GlyphOfDeathsEmbrace]:{name:"Glyph of Death's Embrace",description:"Your Death Coil refunds 20 Runic Power when used to heal an allied minion, but will no longer trigger Blood Tap when used this way.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_deathcoil.jpg"},[Be.GlyphOfHornOfWinter]:{name:"Glyph of Horn of Winter",description:"When used outside of combat, your Horn of Winter ability causes a brief, localized snow flurry.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_horn_02.jpg"},[Be.GlyphOfArmyOfTheDead]:{name:"Glyph of Army of the Dead",description:"The ghouls summoned by your Army of the Dead no longer taunt their target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_armyofthedead.jpg"},[Be.GlyphOfFoulMenagerie]:{name:"Glyph of Foul Menagerie",description:"Causes your Army of the Dead spell to summon an assortment of undead minions.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_armyofthedead.jpg"},[Be.GlyphOfPathOfFrost]:{name:"Glyph of Path of Frost",description:"Your Path of Frost ability allows you to fall from a greater distance without suffering damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_deathknight_pathoffrost.jpg"},[Be.GlyphOfResilientGrip]:{name:"Glyph of Resilient Grip",description:"When your Death Grip ability fails because its target is immune, its cooldown is reset.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/warlock_curse_shadow.jpg"},[Be.GlyphOfDeathGate]:{name:"Glyph of Death Gate",description:"Reduces the cast time of your Death Gate spell by 60%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_teleportundercity.jpg"},[Be.GlyphOfCorpseExplosion]:{name:"Glyph of Corpse Explosion",description:"Teaches you the ability Corpse Explosion.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_corpseexplode.jpg"},[Be.GlyphOfTranquilGrip]:{name:"Glyph of Tranquil Grip",description:"Your Death Grip spell no longer taunts the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_envelopingshadows.jpg"},[Be.GlyphOfTheSkeleton]:{name:"Glyph of the Skeleton",description:"Your Raise Dead spell summons a skeleton instead of a ghoul.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_bone_humanskull_01.jpg"},[Be.GlyphOfTheLongWinter]:{name:"Glyph of the Long Winter",description:"The effect of your Horn of Winter now lasts for 1 hour.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_deathknight_remorselesswinters.jpg"}}},xl=kl({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"felineSwiftness",fancyName:"Feline Swiftness",location:{rowIdx:0,colIdx:0},spellId:131768},{fieldName:"displacerBeast",fancyName:"Displacer Beast",location:{rowIdx:0,colIdx:1},spellId:102280},{fieldName:"wildCharge",fancyName:"Wild Charge",location:{rowIdx:0,colIdx:2},spellId:102401},{fieldName:"yserasGift",fancyName:"Ysera's Gift",location:{rowIdx:1,colIdx:0},spellId:145108},{fieldName:"renewal",fancyName:"Renewal",location:{rowIdx:1,colIdx:1},spellId:108238},{fieldName:"cenarionWard",fancyName:"Cenarion Ward",location:{rowIdx:1,colIdx:2},spellId:102351},{fieldName:"faerieSwarm",fancyName:"Faerie Swarm",location:{rowIdx:2,colIdx:0},spellId:106707},{fieldName:"massEntanglement",fancyName:"Mass Entanglement",location:{rowIdx:2,colIdx:1},spellId:102359},{fieldName:"typhoon",fancyName:"Typhoon",location:{rowIdx:2,colIdx:2},spellId:132469},{fieldName:"soulOfTheForest",fancyName:"Soul of the Forest",location:{rowIdx:3,colIdx:0},spellId:114107},{fieldName:"incarnation",fancyName:"Incarnation",location:{rowIdx:3,colIdx:1},spellId:106731},{fieldName:"forceOfNature",fancyName:"Force of Nature",location:{rowIdx:3,colIdx:2},spellId:106737},{fieldName:"disorientingRoar",fancyName:"Disorienting Roar",location:{rowIdx:4,colIdx:0},spellId:99},{fieldName:"ursolsVortex",fancyName:"Ursol's Vortex",location:{rowIdx:4,colIdx:1},spellId:102793},{fieldName:"mightyBash",fancyName:"Mighty Bash",location:{rowIdx:4,colIdx:2},spellId:5211},{fieldName:"heartOfTheWild",fancyName:"Heart of the Wild",location:{rowIdx:5,colIdx:0},spellId:108288},{fieldName:"dreamOfCenarius",fancyName:"Dream of Cenarius",location:{rowIdx:5,colIdx:1},spellId:108373},{fieldName:"naturesVigil",fancyName:"Nature's Vigil",location:{rowIdx:5,colIdx:2},spellId:124974}]}),Tl={majorGlyphs:{[Ye.GlyphOfFrenziedRegeneration]:{name:"Glyph of Frenzied Regeneration",description:"For 6s after activating Frenzied Regeneration, healing effects on you are 40% more powerful. However, your Frenzied Regeneration now always costs 50 Rage and no longer converts Rage into health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_bullrush.jpg"},[Ye.GlyphOfMaul]:{name:"Glyph of Maul",description:"Your Maul ability now hits 1 additional target for 50% damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_maul.jpg"},[Ye.GlyphOfOmens]:{name:"Glyph of Omens",description:"While you are not in an Eclipse, the following abilities now grant 10 Solar or Lunar Energy: Entangling Roots, Cyclone, Faerie Fire, Faerie Swarm, Mass Entanglement, Typhoon, Disorienting Roar, Ursol's Vortex, and Mighty Bash.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_vehicle_sonicshockwave.jpg"},[Ye.GlyphOfShred]:{name:"Glyph of Shred",description:"While Berserk or Tiger's Fury is active, Shred has no positional requirement.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_vampiricaura.jpg"},[Ye.GlyphOfProwl]:{name:"Glyph of Prowl",description:"Reduces the movement penalty of Prowl by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_prowl.jpg"},[Ye.GlyphOfPounce]:{name:"Glyph of Pounce",description:"Increases the range of your Pounce by 8 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_supriseattack.jpg"},[Ye.GlyphOfStampede]:{name:"Glyph of Stampede",description:"You can now cast Stampeding Roar without being in Bear Form or Cat Form.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_druid_stampedingroar_cat.jpg"},[Ye.GlyphOfInnervate]:{name:"Glyph of Innervate",description:"When Innervate is cast on a target other than the caster, both the caster and target will benefit, but at 40% reduced effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightning.jpg"},[Ye.GlyphOfRebirth]:{name:"Glyph of Rebirth",description:"Players resurrected by Rebirth are returned to life with 100% health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_reincarnation.jpg"},[Ye.GlyphOfRegrowth]:{name:"Glyph of Regrowth",description:"Increases the critical strike chance of your Regrowth by 40%, but removes the periodic component of the spell.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_resistnature.jpg"},[Ye.GlyphOfRejuvenation]:{name:"Glyph of Rejuvenation",description:"When you have Rejuvenation active on three or more targets, the cast time of your Nourish spell is reduced by 30%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_rejuvenation.jpg"},[Ye.GlyphOfHealingTouch]:{name:"Glyph of Healing Touch",description:"When you cast Healing Touch, the cooldown on your Nature's Swiftness is reduced by 3 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingtouch.jpg"},[Ye.GlyphOfEfflorescence]:{name:"Glyph of Efflorescence",description:"The Efflorescence effect is now caused by your Wild Mushroom instead of by Swiftmend, and lasts as long as the Wild Mushroom is active. Additionally, increases the healing done by Swiftmend by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingtouch.jpg"},[Ye.GlyphOfGuidedStars]:{name:"Glyph of Guided Stars",description:"Your Starfall only hits targets affected by your Moonfire or Sunfire.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_arcanebarrage.jpg"},[Ye.GlyphOfHurricane]:{name:"Glyph of Hurricane",description:"Your Hurricane and Astral Storm abilities now also slow the movement speed of their victims by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_cyclone.jpg"},[Ye.GlyphOfSkullBash]:{name:"Glyph of Skull Bash",description:"Increases the duration of your Skull Bash interrupt by 2 sec, but increases the cooldown by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_bone_taurenskull_01.jpg"},[Ye.GlyphOfNaturesGrasp]:{name:"Glyph of Nature's Grasp",description:"Reduces the cooldown of Nature's Grasp by 45 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_natureswrath.jpg"},[Ye.GlyphOfSavagery]:{name:"Glyph of Savagery",description:"Savage Roar can now be used with 0 combo points, resulting in a 12s duration.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_skinteeth.jpg"},[Ye.GlyphOfEntanglingRoots]:{name:"Glyph of Entangling Roots",description:"Reduces the cast time of your Entangling Roots by 0.2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_stranglevines.jpg"},[Ye.GlyphOfBlooming]:{name:"Glyph of Blooming",description:"Increases the bloom heal of your Lifebloom when it expires by 50%, but its duration is reduced by 5 sec and your Healing Touch, Nourish, and Regrowth abilities no longer refresh the duration.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_protectionformnature.jpg"},[Ye.GlyphOfDash]:{name:"Glyph of Dash",description:"Reduces the cooldown of your Dash ability by 60 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_dash.jpg"},[Ye.GlyphOfMasterShapeshifter]:{name:"Glyph of Master Shapeshifter",description:"Reduces the mana cost of all shapeshifts by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_mastershapeshifter.jpg"},[Ye.GlyphOfSurvivalInstincts]:{name:"Glyph of Survival Instincts",description:"Reduces the cooldown of Survival Instincts by 60 sec, but reduces its duration by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_tigersroar.jpg"},[Ye.GlyphOfWildGrowth]:{name:"Glyph of Wild Growth",description:"Wild Growth can affect 1 additional target, but its cooldown is increased by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_flourish.jpg"},[Ye.GlyphOfMightOfUrsoc]:{name:"Glyph of Might of Ursoc",description:"Increases the health gain from Might of Ursoc by 20%, but increases the cooldown by 2 min.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_druid_mightofursoc.jpg"},[Ye.GlyphOfStampedingRoar]:{name:"Glyph of Stampeding Roar",description:"Increases the radius of Stampeding Roar by 30 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_druid_stamedingroar.jpg"},[Ye.GlyphOfCyclone]:{name:"Glyph of Cyclone",description:"Increases the range of your Cyclone spell by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_earthbind.jpg"},[Ye.GlyphOfBarkskin]:{name:"Glyph of Barkskin",description:"Reduces the chance you'll be critically hit by 25% while Barkskin is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_stoneclawtotem.jpg"},[Ye.GlyphOfFerociousBite]:{name:"Glyph of Ferocious Bite",description:"Your Ferocious Bite ability heals you for 2% of your maximum health for each 10 Energy used.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_ferociousbite.jpg"},[Ye.GlyphOfFaeSilence]:{name:"Glyph of Fae Silence",description:"Faerie Fire used in Bear Form also silences the target for 3s, but triggers a 15 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_challangingroar.jpg"},[Ye.GlyphOfFaerieFire]:{name:"Glyph of Faerie Fire",description:"Increases the range of your Faerie Fire by 10 yds.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_faeriefire.jpg"},[Ye.GlyphOfCatForm]:{name:"Glyph of Cat Form",description:"Increases healing done to you by 20% while in Cat Form.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_catform.jpg"}},minorGlyphs:{[qe.GlyphOfTheStag]:{name:"Glyph of the Stag",description:"Your Travel Form can now be used as a mount by party members. This glyph is disabled while Glyph of the Cheetah is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/trade_archaeology_antleredcloakclasp.jpg"},[qe.GlyphOfTheOrca]:{name:"Glyph of the Orca",description:"Your Aquatic Form now appears as an Orca.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_aquaticform.jpg"},[qe.GlyphOfAquaticForm]:{name:"Glyph of Aquatic Form",description:"Increases your swim speed by 50% while in Aquatic Form.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_enchant_essencemagiclarge.jpg"},[qe.GlyphOfGrace]:{name:"Glyph of Grace",description:"Feline Grace reduces falling damage even while not in Cat Form.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_feather_01.jpg"},[qe.GlyphOfTheChameleon]:{name:"Glyph of the Chameleon",description:"Each time you shapeshift into Cat Form or Bear Form, your shapeshifted form will have a random hair color.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_mastershapeshifter.jpg"},[qe.GlyphOfCharmWoodlandCreature]:{name:"Glyph of Charm Woodland Creature",description:"Teaches you the ability Charm Woodland Creature.\r\n\r\n Allows the Druid to befriend an ambient creature, which will follow the Druid for 1hr.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_rabbit.jpg"},[qe.GlyphOfStars]:{name:"Glyph of Stars",description:"Your Moonkin Form now appears as Astral Form, conferring all the same benefits, but appearing as an astrally enhanced version of your normal humanoid form.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/achievement_boss_algalon_01.jpg"},[qe.GlyphOfThePredator]:{name:"Glyph of the Predator",description:"Your Track Humanoids ability now also tracks beasts.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_tracking.jpg"},[qe.GlyphOfTheTreant]:{name:"Glyph of the Treant",description:"Teaches you the ability Treant Form.\r\n\r\n Shapeshift into Treant Form.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_treeoflife.jpg"},[qe.GlyphOfTheCheetah]:{name:"Glyph of the Cheetah",description:"Your Travel Form appears as a Cheetah. This glyph will prevent Glyph of the Stag from functioning.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_catlikereflexes.jpg"},[qe.GlyphOfFocus]:{name:"Glyph of Focus",description:"Reduces Starfall's radius by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_arcanepotency.jpg"},[qe.GlyphOfTheSproutingMushroom]:{name:"Glyph of the Sprouting Mushroom",description:"Your Wild Mushroom spell can now be placed on the ground instead of underneath a target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_druid_wildmushroom.jpg"},[qe.GlyphOfOneWithNature]:{name:"Glyph of One with Nature",description:"Grants you the ability to teleport to a random natural location.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_manatree.jpg"}}},Pl=kl({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"posthaste",fancyName:"Posthaste",location:{rowIdx:0,colIdx:0},spellId:109215},{fieldName:"narrowEscape",fancyName:"Narrow Escape",location:{rowIdx:0,colIdx:1},spellId:109298},{fieldName:"crouchingTigerHiddenChimera",fancyName:"Crouching Tiger, Hidden Chimera",location:{rowIdx:0,colIdx:2},spellId:118675},{fieldName:"bindingShot",fancyName:"Binding Shot",location:{rowIdx:1,colIdx:0},spellId:109248},{fieldName:"wyvernSting",fancyName:"Wyvern Sting",location:{rowIdx:1,colIdx:1},spellId:19386},{fieldName:"intimidation",fancyName:"Intimidation",location:{rowIdx:1,colIdx:2},spellId:19577},{fieldName:"exhilaration",fancyName:"Exhilaration",location:{rowIdx:2,colIdx:0},spellId:109304},{fieldName:"aspectOfTheIronHawk",fancyName:"Aspect of the Iron Hawk",location:{rowIdx:2,colIdx:1},spellId:109260},{fieldName:"spiritBond",fancyName:"Spirit Bond",location:{rowIdx:2,colIdx:2},spellId:109212},{fieldName:"fervor",fancyName:"Fervor",location:{rowIdx:3,colIdx:0},spellId:82726},{fieldName:"direBeast",fancyName:"Dire Beast",location:{rowIdx:3,colIdx:1},spellId:120679},{fieldName:"thrillOfTheHunt",fancyName:"Thrill of the Hunt",location:{rowIdx:3,colIdx:2},spellId:109306},{fieldName:"aMurderOfCrows",fancyName:"A Murder of Crows",location:{rowIdx:4,colIdx:0},spellId:131894},{fieldName:"blinkStrikes",fancyName:"Blink Strikes",location:{rowIdx:4,colIdx:1},spellId:130392},{fieldName:"lynxRush",fancyName:"Lynx Rush",location:{rowIdx:4,colIdx:2},spellId:120697},{fieldName:"glaiveToss",fancyName:"Glaive Toss",location:{rowIdx:5,colIdx:0},spellId:117050},{fieldName:"powershot",fancyName:"Powershot",location:{rowIdx:5,colIdx:1},spellId:109259},{fieldName:"barrage",fancyName:"Barrage",location:{rowIdx:5,colIdx:2},spellId:120360}]}),Rl={majorGlyphs:{[$e.GlyphOfCamouflage]:{name:"Glyph of Camouflage",description:"Your Camouflage ability now provides stealth even while moving, but your movement speed while Camouflage is active is reduced by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_displacement.jpg"},[$e.GlyphOfLiberation]:{name:"Glyph of Liberation",description:"When you Disengage, you are healed for 5% of your total health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/achievement_bg_returnxflags_def_wsg.jpg"},[$e.GlyphOfMending]:{name:"Glyph of Mending",description:"Your Mend Pet now heals every 1 sec, and heals for an additional 25% of your pet's health over its duration.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_bandage_15.jpg"},[$e.GlyphOfDistractingShot]:{name:"Glyph of Distracting Shot",description:"Your Distracting Shot now distracts the target to attack your pet instead of you.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_blink.jpg"},[$e.GlyphOfEndlessWrath]:{name:"Glyph of Endless Wrath",description:"While Bestial Wrath is active, your pet cannot be killed, but can still be damaged.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_ferociousbite.jpg"},[$e.GlyphOfDeterrence]:{name:"Glyph of Deterrence",description:"Increases the damage reduction granted by Deterrence by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_whirlwind.jpg"},[$e.GlyphOfDisengage]:{name:"Glyph of Disengage",description:"Increases the distance you travel when you Disengage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_feint.jpg"},[$e.GlyphOfFreezingTrap]:{name:"Glyph of Freezing Trap",description:"When your Freezing Trap breaks, the victim's movement speed is reduced by 70% for 4s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_chainsofice.jpg"},[$e.GlyphOfIceTrap]:{name:"Glyph of Ice Trap",description:"Increases the radius of the effect from your Ice Trap by 2 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_hunter_icetrap.jpg"},[$e.GlyphOfMisdirection]:{name:"Glyph of Misdirection",description:"When you use Misdirection on your pet, the cooldown on your Misdirection is reset.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_misdirection.jpg"},[$e.GlyphOfExplosiveTrap]:{name:"Glyph of Explosive Trap",description:"Your Explosive Trap no longer deals damage, instead knocking enemies back from the trap when it explodes.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_selfdestruct.jpg"},[$e.GlyphOfAnimalBond]:{name:"Glyph of Animal Bond",description:"While your pet is active, all healing done to you and your pet is increased by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_demoralizingroar.jpg"},[$e.GlyphOfNoEscape]:{name:"Glyph of No Escape",description:"Increases the ranged critical strike chance of all of your attacks on targets affected by your Freezing Trap by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_pointofnoescape.jpg"},[$e.GlyphOfPathfinding]:{name:"Glyph of Pathfinding",description:"Increases the speed bonus of your Aspect of the Cheetah and Aspect of the Pack by 8%, and increases your speed while mounted by 10%. The mounted movement speed increase does not stack with other effects.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_pathfinding2.jpg"},[$e.GlyphOfSnakeTrap]:{name:"Glyph of Snake Trap",description:"Snakes from your Snake Trap take 90% reduced damage from area of effect attacks.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_snaketrap.jpg"},[$e.GlyphOfAimedShot]:{name:"Glyph of Aimed Shot",description:"Your Aimed Shot can now be used while moving.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_spear_07.jpg"},[$e.GlyphOfMendPet]:{name:"Glyph of Mend Pet",description:"Gives your Mend Pet ability a 100% chance of cleansing 1 Curse, Disease, Magic or Poison effect from your pet each tick.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_mendpet.jpg"},[$e.GlyphOfSolace]:{name:"Glyph of Solace",description:"Your Freezing Trap and Scatter Shot also remove all damage over time effects from their targets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostshock.jpg"},[$e.GlyphOfChimeraShot]:{name:"Glyph of Chimera Shot",description:"Increases the healing you receive from Chimera Shot by an additional 2% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_chimerashot2.jpg"},[$e.GlyphOfTranquilizingShot]:{name:"Glyph of Tranquilizing Shot",description:"Your Tranquilizing Shot no longer costs Focus, but has a 10 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_drowsy.jpg"},[$e.GlyphOfMastersCall]:{name:"Glyph of Master's Call",description:"Increases the duration of your Master's Call by 4.0 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_masterscall.jpg"},[$e.GlyphOfScatterShot]:{name:"Glyph of Scatter Shot",description:"Increases the range of Scatter Shot by 3 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_golemstormbolt.jpg"},[$e.GlyphOfMirroredBlades]:{name:"Glyph of Mirrored Blades",description:"When attacked by a spell while in Deterrence, you have a 100% chance to reflect it back at the attacker.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_weapon_shortblade_99.jpg"},[$e.GlyphOfBlackIce]:{name:"Glyph of Black Ice",description:"While you move through the area affected by your Ice Trap you gain 50% movement speed.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_hunter_blackicetrap.jpg"},[$e.GlyphOfTheLeanPack]:{name:"Glyph of the Lean Pack",description:"Reduces the radius of Aspect of the Pack by 33 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_aspectmastery.jpg"},[$e.GlyphOfEnduringDeceit]:{name:"Glyph of Enduring Deceit",description:"Camouflage also reduces spell damage taken by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_camouflage.jpg"}},minorGlyphs:{[Ke.GlyphOfAspects]:{name:"Glyph of Aspects",description:"Each time you activate a new Aspect, an animal companion representing that Aspect will follow you for 15s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_aspectmastery.jpg"},[Ke.GlyphOfTameBeast]:{name:"Glyph of Tame Beast",description:"Reduces the time required to complete Tame Beast by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_beasttaming.jpg"},[Ke.GlyphOfRevivePet]:{name:"Glyph of Revive Pet",description:"Reduces the pushback suffered from damaging attacks while casting Revive Pet by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_beastsoothe.jpg"},[Ke.GlyphOfLesserProportion]:{name:"Glyph of Lesser Proportion",description:"Slightly reduces the size of your pet.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_bestialdiscipline.jpg"},[Ke.GlyphOfFireworks]:{name:"Glyph of Fireworks",description:"Teaches you the ability Fireworks.\r\n\r\n Launch fireworks from your gun, bow or crossbow.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_missilelargecluster_red.jpg"},[Ke.GlyphOfAspectOfThePack]:{name:"Glyph of Aspect of the Pack",description:"Increases the range of your Aspect of the Pack ability by 15 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mount_whitetiger.jpg"},[Ke.GlyphOfStampedeHunter]:{name:"Glyph of Stampede",description:"Your Stampede no longer summons pets from your stable, and instead uses copies of your current pet.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_bestialdiscipline.jpg"},[Ke.GlyphOfAspectOfTheCheetah]:{name:"Glyph of Aspect of the Cheetah",description:"Your Aspect of the Cheetah no longer causes you to be dazed when struck. Instead, the effect is cancelled and all your Aspects are placed on a 4 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mount_jungletiger.jpg"},[Ke.GlyphOfAspectOfTheBeast]:{name:"Glyph of Aspect of the Beast",description:"Teaches you the ability Aspect of the Beast.\r\n\r\n The Hunter takes on the aspects of a beast, becoming untrackable. Only one Aspect can be active at a time.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mount_pinktiger.jpg"},[Ke.GlyphOfDirection]:{name:"Glyph of Direction",description:"Causes your Misdirection target to appear larger.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_markedfordeath.jpg"},[Ke.GlyphOfMarking]:{name:"Glyph of Marking",description:"Your Hunter's Mark ability now places a bullseye on your target instead of its usual visual.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_mastermarksman.jpg"},[Ke.GlyphOfFetch]:{name:"Glyph of Fetch",description:"Teaches you the ability Fetch.\r\n\r\n Command your pet to retrieve the loot from a nearby corpse within 40 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_bone_01.jpg"},[Ke.GlyphOfFocusedFire]:{name:"Glyph of Focused Fire",description:"Focus Fire charges apply a visual to you for each charge active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_aspectmastery.jpg"},[Ke.GlyphOfChameleon]:{name:"Glyph of Chameleon",description:"Focus Fire charges apply a visual to you for each charge active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_aspectmastery.jpg"}}},Dl=kl({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"presenceOfMind",fancyName:"Presence of Mind",location:{rowIdx:0,colIdx:0},spellId:12043},{fieldName:"blazingSpeed",fancyName:"Blazing Speed",location:{rowIdx:0,colIdx:1},spellId:108843},{fieldName:"iceFloes",fancyName:"Ice Floes",location:{rowIdx:0,colIdx:2},spellId:108839},{fieldName:"temporalShield",fancyName:"Temporal Shield",location:{rowIdx:1,colIdx:0},spellId:115610},{fieldName:"flameglow",fancyName:"Flameglow",location:{rowIdx:1,colIdx:1},spellId:140468},{fieldName:"iceBarrier",fancyName:"Ice Barrier",location:{rowIdx:1,colIdx:2},spellId:11426},{fieldName:"ringOfFrost",fancyName:"Ring of Frost",location:{rowIdx:2,colIdx:0},spellId:113724},{fieldName:"iceWard",fancyName:"Ice Ward",location:{rowIdx:2,colIdx:1},spellId:111264},{fieldName:"frostjaw",fancyName:"Frostjaw",location:{rowIdx:2,colIdx:2},spellId:102051},{fieldName:"greaterInvisibility",fancyName:"Greater Invisibility",location:{rowIdx:3,colIdx:0},spellId:110959},{fieldName:"cauterize",fancyName:"Cauterize",location:{rowIdx:3,colIdx:1},spellId:86949},{fieldName:"coldSnap",fancyName:"Cold Snap",location:{rowIdx:3,colIdx:2},spellId:11958},{fieldName:"netherTempest",fancyName:"Nether Tempest",location:{rowIdx:4,colIdx:0},spellId:114923},{fieldName:"livingBomb",fancyName:"Living Bomb",location:{rowIdx:4,colIdx:1},spellId:44457},{fieldName:"frostBomb",fancyName:"Frost Bomb",location:{rowIdx:4,colIdx:2},spellId:112948},{fieldName:"invocation",fancyName:"Invocation",location:{rowIdx:5,colIdx:0},spellId:114003},{fieldName:"runeOfPower",fancyName:"Rune of Power",location:{rowIdx:5,colIdx:1},spellId:116011},{fieldName:"incantersWard",fancyName:"Incanter's Ward",location:{rowIdx:5,colIdx:2},spellId:1463}]}),Nl={majorGlyphs:{[Ze.GlyphOfArcaneExplosion]:{name:"Glyph of Arcane Explosion",description:"Increases the radius of your Arcane Explosion by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_wispsplode.jpg"},[Ze.GlyphOfBlink]:{name:"Glyph of Blink",description:"Increases the distance you travel with the Blink spell by 8 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_blink.jpg"},[Ze.GlyphOfEvocation]:{name:"Glyph of Evocation",description:"Your Evocation ability also causes you to regain 60% of your health over its duration.\r\n\r\n With the Invocation talent, you instead gain 10% of your health upon completing an Evocation.\r\n\r\n With the Rune of Power talent, you gain 1% of your health per second while standing in your own Rune of Power.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_purge.jpg"},[Ze.GlyphOfCombustion]:{name:"Glyph of Combustion",description:"Increases the direct damage, the duration of the damage over time effect and the cooldown of Combustion by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_sealoffire.jpg"},[Ze.GlyphOfFrostNova]:{name:"Glyph of Frost Nova",description:"Reduces the cooldown of Frost Nova by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostnova.jpg"},[Ze.GlyphOfIceBlock]:{name:"Glyph of Ice Block",description:"When Ice Block terminates, it triggers an instant free Frost Nova and makes you immune to all spells for 3s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frost.jpg"},[Ze.GlyphOfSplittingIce]:{name:"Glyph of Splitting Ice",description:"Your Ice Lance and Icicles now hit 1 additional target for 50% damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostblast.jpg"},[Ze.GlyphOfConeOfCold]:{name:"Glyph of Cone of Cold",description:"Increases the damage done by Cone of Cold by 200%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_glacier.jpg"},[Ze.GlyphOfRapidDisplacement]:{name:"Glyph of Rapid Displacement",description:"Blink now has 2 charges, gaining a charge every 15 sec, but no longer frees the caster from stuns and bonds.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_blink.jpg"},[Ze.GlyphOfManaGem]:{name:"Glyph of Mana Gem",description:"Your Conjure Mana Gem spell now creates a Brilliant Mana Gem, which holds up to 10 charges.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_jewelcrafting_gem_05.jpg"},[Ze.GlyphOfPolymorph]:{name:"Glyph of Polymorph",description:"Your Polymorph spell also removes all damage over time effects from the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_polymorph.jpg"},[Ze.GlyphOfIcyVeins]:{name:"Glyph of Icy Veins",description:"Your Icy Veins causes your Frostbolt, Frostfire Bolt, Ice Lance, and your Water Elemental's Waterbolt spells to split into 3 smaller bolts that each do 40% damage, instead of increasing spell casting speed.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_coldhearted.jpg"},[Ze.GlyphOfSpellsteal]:{name:"Glyph of Spellsteal",description:"Spellsteal now also heals you for 5% of your maximum health when it successfully steals a spell.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_arcane02.jpg"},[Ze.GlyphOfFrostfireBolt]:{name:"Glyph of Frostfire Bolt",description:"Reduces the cast time of Frostfire Bolt by 0.5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_frostfirebolt.jpg"},[Ze.GlyphOfRemoveCurse]:{name:"Glyph of Remove Curse",description:"Increases the damage you deal by 5% for 10s after you successfully remove a curse.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_removecurse.jpg"},[Ze.GlyphOfArcanePower]:{name:"Glyph of Arcane Power",description:"Increases the duration and cooldown of Arcane Power by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightning.jpg"},[Ze.GlyphOfWaterElemental]:{name:"Glyph of Water Elemental",description:"Increases the health of your Water Elemental by 40%, and allows it to cast while moving. When in Assist mode and in combat, commanding your Water Elemental to Follow will cause it to stay near you and autocast Waterbolt when your target is in range.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_summonwaterelemental_2.jpg"},[Ze.GlyphOfSlow]:{name:"Glyph of Slow",description:"Your Arcane Blast spell applies the Slow spell to any target it damages if no target is currently affected by your Slow.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_slow.jpg"},[Ze.GlyphOfDeepFreeze]:{name:"Glyph of Deep Freeze",description:"Your Deep Freeze spell is no longer on the global cooldown, but its duration is reduced by 1 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_deepfreeze.jpg"},[Ze.GlyphOfCounterspell]:{name:"Glyph of Counterspell",description:"Your Counterspell can now be cast while casting or channeling other spells, but its cooldown is increased by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_iceshock.jpg"},[Ze.GlyphOfInfernoBlast]:{name:"Glyph of Inferno Blast",description:"Your Inferno Blast spell spreads Pyroblast, Ignite, and Combustion to 1 additional target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_mage_infernoblast.jpg"},[Ze.GlyphOfArmors]:{name:"Glyph of Armors",description:"Reduces the cast time of your Frost Armor, Mage Armor, and Molten Armor spells by 1.5 sec, and increases the defensive effect of each Armor by an additional 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostarmor02.jpg"}},minorGlyphs:{[Je.GlyphOfLooseMana]:{name:"Glyph of Loose Mana",description:"Your Mana Gem now restores mana over 6 sec, rather than instantly.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_gem_sapphire_02.jpg"},[Je.GlyphOfMomentum]:{name:"Glyph of Momentum",description:"Your Blink spell teleports you in the direction you are moving instead of the direction you are facing.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_blink.jpg"},[Je.GlyphOfCrittermorph]:{name:"Glyph of Crittermorph",description:"When cast on critters, your Polymorph spells now last 24hrs and can be cast on multiple targets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_doublepolymorph2.jpg"},[Je.GlyphOfThePorcupine]:{name:"Glyph of the Porcupine",description:"Your Polymorph spell polymorphs the target into a porcupine instead.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_magic_polymorphpig.jpg"},[Je.GlyphOfConjureFamiliar]:{name:"Glyph of Conjure Familiar",description:"Teaches you the ability Conjure Familiar.\r\n\r\n Conjures a familiar stone, containing either an Arcane, Fiery, or Icy Familiar.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_elementalabsorption.jpg"},[Je.GlyphOfTheMonkey]:{name:"Glyph of the Monkey",description:"Your Polymorph spell polymorphs the target into a monkey instead.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_aspectofthemonkey.jpg"},[Je.GlyphOfThePenguin]:{name:"Glyph of the Penguin",description:"Your Polymorph spell polymorphs the target into a penguin instead.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_penguinpet.jpg"},[Je.GlyphOfTheBearCub]:{name:"Glyph of the Bear Cub",description:"Your Polymorph spell polymorphs the target into a polar bear cub instead.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_pet_babyblizzardbear.jpg"},[Je.GlyphOfArcaneLanguage]:{name:"Glyph of Arcane Language",description:"Your Arcane Brilliance spell allows you to comprehend your allies' racial languages.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_fish_68.jpg"},[Je.GlyphOfIllusion]:{name:"Glyph of Illusion",description:"Teaches you the ability Illusion.\r\n\r\n Transforms the Mage to look like someone else for 2min.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_mask_01.jpg"},[Je.GlyphOfMirrorImage]:{name:"Glyph of Mirror Image",description:"Your Mirror Images cast Arcane Blast or Fireball instead of Frostbolt depending on your primary talent tree.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_magic_lesserinvisibilty.jpg"},[Je.GlyphOfRapidTeleportation]:{name:"Glyph of Rapid Teleportation",description:"After casting a Mage Teleport spell, or entering a Mage Portal, your movement speed is increased by 70% for 1min.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_portaldalaran.jpg"},[Je.GlyphOfDiscreetMagic]:{name:"Glyph of Discreet Magic",description:"Your Nether Tempest, Living Bomb, Frost Bomb, Arcane Barrage, and Inferno Blast no longer affect targets more than 5 yds away from their primary target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_enchant_essencemagicsmall.jpg"},[Je.GlyphOfTheUnboundElemental]:{name:"Glyph of the Unbound Elemental",description:"Your Water Elemental is replaced by an Unbound Water Elemental.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_summonwaterelemental.jpg"},[Je.GlyphOfEvaporation]:{name:"Glyph of Evaporation",description:"Reduces the size of your Water Elemental by 40%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_elemental_mote_water01.jpg"},[Je.GlyphOfCondensation]:{name:"Glyph of Condensation",description:"Increases the size of your Water Elemental by 40%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_volatilewater.jpg"}}},Gl=kl({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"celerity",fancyName:"Celerity",location:{rowIdx:0,colIdx:0},spellId:115173},{fieldName:"tigersLust",fancyName:"Tiger's Lust",location:{rowIdx:0,colIdx:1},spellId:116841},{fieldName:"momentum",fancyName:"Momentum",location:{rowIdx:0,colIdx:2},spellId:115174},{fieldName:"chiWave",fancyName:"Chi Wave",location:{rowIdx:1,colIdx:0},spellId:115098},{fieldName:"zenSphere",fancyName:"Zen Sphere",location:{rowIdx:1,colIdx:1},spellId:124081},{fieldName:"chiBurst",fancyName:"Chi Burst",location:{rowIdx:1,colIdx:2},spellId:123986},{fieldName:"powerStrikes",fancyName:"Power Strikes",location:{rowIdx:2,colIdx:0},spellId:121817},{fieldName:"ascension",fancyName:"Ascension",location:{rowIdx:2,colIdx:1},spellId:115396},{fieldName:"chiBrew",fancyName:"Chi Brew",location:{rowIdx:2,colIdx:2},spellId:115399},{fieldName:"ringOfPeace",fancyName:"Ring of Peace",location:{rowIdx:3,colIdx:0},spellId:116844},{fieldName:"chargingOxWave",fancyName:"Charging Ox Wave",location:{rowIdx:3,colIdx:1},spellId:119392},{fieldName:"legSweep",fancyName:"Leg Sweep",location:{rowIdx:3,colIdx:2},spellId:119381},{fieldName:"healingElixirs",fancyName:"Healing Elixirs",location:{rowIdx:4,colIdx:0},spellId:122280},{fieldName:"dampenHarm",fancyName:"Dampen Harm",location:{rowIdx:4,colIdx:1},spellId:122278},{fieldName:"diffuseMagic",fancyName:"Diffuse Magic",location:{rowIdx:4,colIdx:2},spellId:122783},{fieldName:"rushingJadeWind",fancyName:"Rushing Jade Wind",location:{rowIdx:5,colIdx:0},spellId:116847},{fieldName:"invokeXuenTheWhiteTiger",fancyName:"Invoke Xuen, the White Tiger",location:{rowIdx:5,colIdx:1},spellId:123904},{fieldName:"chiTorpedo",fancyName:"Chi Torpedo",location:{rowIdx:5,colIdx:2},spellId:115008}]}),Ul={majorGlyphs:{[Xe.GlyphOfRapidRolling]:{name:"Glyph of Rapid Rolling",description:"For 5s seconds after using Roll or Chi Torpedo, your next Roll or Chi Torpedo will go 30% farther.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_roll.jpg"},[Xe.GlyphOfTranscendence]:{name:"Glyph of Transcendence",description:"Reduces the cooldown of your Transcendence: Transfer spell by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/monk_ability_transcendence.jpg"},[Xe.GlyphOfBreathOfFire]:{name:"Glyph of Breath of Fire",description:"When you use Breath of Fire on targets afflicted with your Dizzying Haze, they become Disoriented for 3s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_breathoffire.jpg"},[Xe.GlyphOfClash]:{name:"Glyph of Clash",description:"Increases the range of your Clash ability by 10 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_clashingoxcharge.jpg"},[Xe.GlyphOfEnduringHealingSphere]:{name:"Glyph of Enduring Healing Sphere",description:"Increases the duration of your Healing Spheres by 3 minutes.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_healthsphere.jpg"},[Xe.GlyphOfGuard]:{name:"Glyph of Guard",description:"Increases the amount your Guard absorbs by 10%, but your Guard can only absorb magical damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_guard.jpg"},[Xe.GlyphOfManaTea]:{name:"Glyph of Mana Tea",description:"Your Mana Tea is instant instead of channeled and consumes two stacks when used, but causes a 10 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/monk_ability_cherrymanatea.jpg"},[Xe.GlyphOfZenMeditation]:{name:"Glyph of Zen Meditation",description:"You can now channel Zen Meditation while moving.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_zenmeditation.jpg"},[Xe.GlyphOfRenewingMists]:{name:"Glyph of Renewing Mists",description:"Your Renewing Mist travels to the furthest injured target within 40 yards rather than the closest injured target within 20 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_renewingmists.jpg"},[Xe.GlyphOfSpinningCraneKick]:{name:"Glyph of Spinning Crane Kick",description:"You move at full speed while channeling Spinning Crane Kick.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_cranekick_new.jpg"},[Xe.GlyphOfSurgingMist]:{name:"Glyph of Surging Mist",description:"Your Surging Mist no longer requires a target, and instead heals the lowest health target within 40 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_surgingmist.jpg"},[Xe.GlyphOfTouchOfDeath]:{name:"Glyph of Touch of Death",description:"Your Touch of Death no longer has a Chi cost, but the cooldown is increased by 2 minutes.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_touchofdeath.jpg"},[Xe.GlyphOfNimbleBrew]:{name:"Glyph of Nimble Brew",description:"Clearing an effect with Nimble Brew heals you for 10% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_monk_nimblebrew.jpg"},[Xe.GlyphOfAfterlife]:{name:"Glyph of Afterlife",description:"Increases the chance to summon a Healing Sphere when you kill an enemy while gaining experience or honor to 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_priest_finalprayer.jpg"},[Xe.GlyphOfFistsOfFury]:{name:"Glyph of Fists of Fury",description:"When channeling Fists of Fury, your parry chance is increased by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/monk_ability_fistoffury.jpg"},[Xe.GlyphOfFortifyingBrew]:{name:"Glyph of Fortifying Brew",description:"Your Fortifying Brew reduces damage taken by an additional 5%, but increases your health by 10% rather than 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_fortifyingale_new.jpg"},[Xe.GlyphOfLeerOfTheOx]:{name:"Glyph of Leer of the Ox",description:"Teaches you the spell Leer of the Ox.\r\n\r\n |CFFFFFFFFLeer of the Ox|R\r\n Your Ox Statue stirs hatred in the target, reducing their movement speed by 50% and causing them to attack your Black Ox Statue for 8s. The statue must be within 40 yards of the target.\r\n\r\n Requires Black Ox Statue to be active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_leeroftheox.jpg"},[Xe.GlyphOfLifeCocoon]:{name:"Glyph of Life Cocoon",description:"Life Cocoon can now be cast while stunned.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_chicocoon.jpg"},[Xe.GlyphOfFortuitousSpheres]:{name:"Glyph of Fortuitous Spheres",description:"Falling below 25% health will automatically summon a healing sphere near you at no cost. This effect cannot occur more often than once every 30 seconds.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_healthsphere.jpg"},[Xe.GlyphOfParalysis]:{name:"Glyph of Paralysis",description:"Your Paralysis ability also removes all damage over time effects from the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_paralysis.jpg"},[Xe.GlyphOfSparring]:{name:"Glyph of Sparring",description:"While Sparring, you also have a 5% chance to deflect spells from attackers in front of you, stacking up to 3 times.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_sparring.jpg"},[Xe.GlyphOfDetox]:{name:"Glyph of Detox",description:"Detox heals your target for 5% when it successfully removes a harmful effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_dispelmagic.jpg"},[Xe.GlyphOfTouchOfKarma]:{name:"Glyph of Touch of Karma",description:"Your Touch of Karma now has a 25 yard range.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_touchofkarma.jpg"},[Xe.GlyphOfTargetedExpulsion]:{name:"Glyph of Targeted Expulsion",description:"Outside of Battlegrounds and Arenas:\r\n Your Uplift no longer costs Chi, but instead costs 10% Mana.\r\n\r\n Inside of Battlegrounds and Arenas:\r\n Expel Harm can now be used on other allies, but the healing is reduced by 50% on them.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_expelharm.jpg"}},minorGlyphs:{[Qe.GlyphOfSpinningFireBlossom]:{name:"Glyph of Spinning Fire Blossom",description:"Your Spinning Fire Blossom requires an enemy target rather than traveling in front of you, but is no longer capable of rooting targets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_explodingjadeblossom.jpg"},[Qe.GlyphOfCracklingTigerLightning]:{name:"Glyph of Crackling Tiger Lightning",description:"Your Crackling Jade Lightning visual is altered to the color of the White Tiger celestial.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_cracklingjadelightning.jpg"},[Qe.GlyphOfFlyingSerpentKick]:{name:"Glyph of Flying Serpent Kick",description:"Your Flying Serpent Kick automatically ends when you fly into an enemy, triggering the area of effect damage and snare.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_flyingdragonkick.jpg"},[Qe.GlyphOfHonor]:{name:"Glyph of Honor",description:"You honorably bow after each successful Touch of Death.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/pandarenracial_innerpeace.jpg"},[Qe.GlyphOfJab]:{name:"Glyph of Jab",description:"You always will attack with hands and fist with Jab, even with non-fist weapons equipped.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_jab.jpg"},[Qe.GlyphOfRisingTigerKick]:{name:"Glyph of Rising Tiger Kick",description:"Your Rising Sun Kick's visual is altered to the color of the White Tiger.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_risingsunkick.jpg"},[Qe.GlyphOfSpiritRoll]:{name:"Glyph of Spirit Roll",description:"You can cast Roll or Chi Torpedo while dead as a spirit.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_guardianspirit.jpg"},[Qe.GlyphOfFightingPose]:{name:"Glyph of Fighting Pose",description:"Your spirit now appears in a fighting pose when using Transcendence.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_dpsstance.jpg"},[Qe.GlyphOfWaterRoll]:{name:"Glyph of Water Roll",description:"You can Roll or Chi Torpedo over water.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_roll.jpg"},[Qe.GlyphOfZenFlight]:{name:"Glyph of Zen Flight",description:"Teaches you the spell Zen Flight. Zen Flight requires a Flight Master's License in order to be cast.\r\n\r\n |CFFFFFFFFZen Flight|R\r\n You fly through the air at a quick speed on a meditative cloud.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_zenflight.jpg"},[Qe.GlyphOfBlackoutKick]:{name:"Glyph of Blackout Kick",description:"Your Blackout Kick always deals 20% additional damage over 4s regardless of positioning but you're unable to trigger the healing effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_monk_blackoutkick.jpg"}}},Ol=kl({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"speedOfLight",fancyName:"Speed of Light",location:{rowIdx:0,colIdx:0},spellId:85499},{fieldName:"longArmOfTheLaw",fancyName:"Long Arm of the Law",location:{rowIdx:0,colIdx:1},spellId:87172},{fieldName:"pursuitOfJustice",fancyName:"Pursuit of Justice",location:{rowIdx:0,colIdx:2},spellId:26023},{fieldName:"fistOfJustice",fancyName:"Fist of Justice",location:{rowIdx:1,colIdx:0},spellId:105593},{fieldName:"repentance",fancyName:"Repentance",location:{rowIdx:1,colIdx:1},spellId:20066},{fieldName:"evilIsAPointOfView",fancyName:"Evil is a Point of View",location:{rowIdx:1,colIdx:2},spellId:110301},{fieldName:"selflessHealer",fancyName:"Selfless Healer",location:{rowIdx:2,colIdx:0},spellId:85804},{fieldName:"eternalFlame",fancyName:"Eternal Flame",location:{rowIdx:2,colIdx:1},spellId:114163},{fieldName:"sacredShield",fancyName:"Sacred Shield",location:{rowIdx:2,colIdx:2},spellId:20925},{fieldName:"handOfPurity",fancyName:"Hand of Purity",location:{rowIdx:3,colIdx:0},spellId:114039},{fieldName:"unbreakableSpirit",fancyName:"Unbreakable Spirit",location:{rowIdx:3,colIdx:1},spellId:114154},{fieldName:"clemency",fancyName:"Clemency",location:{rowIdx:3,colIdx:2},spellId:105622},{fieldName:"holyAvenger",fancyName:"Holy Avenger",location:{rowIdx:4,colIdx:0},spellId:105809},{fieldName:"sanctifiedWrath",fancyName:"Sanctified Wrath",location:{rowIdx:4,colIdx:1},spellId:53376},{fieldName:"divinePurpose",fancyName:"Divine Purpose",location:{rowIdx:4,colIdx:2},spellId:86172},{fieldName:"holyPrism",fancyName:"Holy Prism",location:{rowIdx:5,colIdx:0},spellId:114165},{fieldName:"lightsHammer",fancyName:"Light's Hammer",location:{rowIdx:5,colIdx:1},spellId:114158},{fieldName:"executionSentence",fancyName:"Execution Sentence",location:{rowIdx:5,colIdx:2},spellId:114157}]}),Al={majorGlyphs:{[tt.GlyphOfDoubleJeopardy]:{name:"Glyph of Double Jeopardy",description:"Judging a target increases the damage of your next Judgment by 20%, but only if used on a different second target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_righteousfury.jpg"},[tt.GlyphOfDevotionAura]:{name:"Glyph of Devotion Aura",description:"Devotion Aura no longer affects party or raid members, but the cooldown is reduced by 60 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_auramastery.jpg"},[tt.GlyphOfHolyWrath]:{name:"Glyph of Holy Wrath",description:"Your Holy Wrath now also stuns Elementals, Dragonkin, and Aberrations.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_weaponmastery.jpg"},[tt.GlyphOfDivineProtection]:{name:"Glyph of Divine Protection",description:"Reduces the magical damage reduction of your Divine Protection to 20% but adds 20% physical damage reduction.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_divineprotection.jpg"},[tt.GlyphOfTemplarsVerdict]:{name:"Glyph of Templar's Verdict",description:"You take 10% less damage for 6s after dealing damage with Templar's Verdict or Exorcism.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_paladin_templarsverdict.jpg"},[tt.GlyphOfAvengingWrath]:{name:"Glyph of Avenging Wrath",description:"While Avenging Wrath is active, you are healed for 1% of your maximum health every 0.0 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_avenginewrath.jpg"},[tt.GlyphOfConsecration]:{name:"Glyph of Consecration",description:"You can now target Consecration anywhere within 25 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_innerfire.jpg"},[tt.GlyphOfFocusedShield]:{name:"Glyph of Focused Shield",description:"Your Avenger's Shield hits 2 fewer targets, but for 30% more damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_avengersshield.jpg"},[tt.GlyphOfBurdenOfGuilt]:{name:"Glyph of Burden of Guilt",description:"Your Judgment hits fill your target with doubt and remorse, reducing movement speed by 50% for 2s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/achievement_bg_topdps.jpg"},[tt.GlyphOfBlindingLight]:{name:"Glyph of Blinding Light",description:"Your Blinding Light now knocks down targets for 3s instead of Blinding them.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_paladin_blindinglight.jpg"},[tt.GlyphOfFinalWrath]:{name:"Glyph of Final Wrath",description:"Your Holy Wrath does an additional 50% damage to targets with less than 20% health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_blessedresillience.jpg"},[tt.GlyphOfWordOfGlory]:{name:"Glyph of Word of Glory",description:"Increases your damage by 3% per Holy Power spent after you cast Word of Glory or Eternal Flame on a friendly target. Lasts 6s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_helmet_96.jpg"},[tt.GlyphOfIllumination]:{name:"Glyph of Illumination",description:"Your Holy Shock criticals grant 1% mana return, but Holy Insight returns 10% less mana.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_pureofheart.jpg"},[tt.GlyphOfHarshWords]:{name:"Glyph of Harsh Words",description:"Your Word of Glory can now also be used on enemy targets, causing Holy damage approximately equal to the amount it would have healed.\r\n\r\n Does not work with Eternal Flame.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_helmet_96.jpg"},[tt.GlyphOfDivinity]:{name:"Glyph of Divinity",description:"Increases the cooldown of your Lay on Hands by 0 min but causes it to give you 10% of your maximum mana.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_layonhands.jpg"},[tt.GlyphOfLightOfDawn]:{name:"Glyph of Light of Dawn",description:"Light of Dawn affects 2 fewer targets, but heals each target for 25% more.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_paladin_lightofdawn.jpg"},[tt.GlyphOfBlessedLife]:{name:"Glyph of Blessed Life",description:"You have a 50% chance to gain a charge of Holy Power whenever you are affected by a Stun, Fear or Immobilize effect.\r\n\r\n This effect cannot occur more than once every 20 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_healingaura.jpg"},[tt.GlyphOfFlashOfLight]:{name:"Glyph of Flash of Light",description:"When you Flash of Light a target, it increases your next heal done to that target within 7s by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_flashheal.jpg"},[tt.GlyphOfDenounce]:{name:"Glyph of Denounce",description:"Your Holy Shocks reduce the cast time of your next Denounce by 0.5 sec. This effect stacks up to 3 times.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_purifyingpower.jpg"},[tt.GlyphOfDazingShield]:{name:"Glyph of Dazing Shield",description:"Your Avenger's Shield now also dazes targets for 10s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_avengersshield.jpg"},[tt.GlyphOfImmediateTruth]:{name:"Glyph of Immediate Truth",description:"Increases the instant damage done by Seal of Truth by 40%, but decreases the damage done by Censure by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofvengeance.jpg"},[tt.GlyphOfBeaconOfLight]:{name:"Glyph of Beacon of Light",description:"Removes the global cooldown on Beacon of Light.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_paladin_beaconoflight.jpg"},[tt.GlyphOfHammerOfTheRighteous]:{name:"Glyph of Hammer of the Righteous",description:"The physical damage reduction caused by Hammer of the Righteous now lasts 50% longer.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_paladin_hammeroftherighteous.jpg"},[tt.GlyphOfDivineStorm]:{name:"Glyph of Divine Storm",description:"Your Divine Storm also heals you for 5% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_paladin_divinestorm.jpg"},[tt.GlyphOfTheAlabasterShield]:{name:"Glyph of the Alabaster Shield",description:"Your successful blocks increase the damage of your next Shield of the Righteous by 10%. Stacks up to 1 times.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/trade_archaeology_stoneshield.jpg"},[tt.GlyphOfDivinePlea]:{name:"Glyph of Divine Plea",description:"Divine Plea returns 50% less mana but has a 50% shorter cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_aspiration.jpg"},[tt.GlyphOfHolyShock]:{name:"Glyph of Holy Shock",description:"Decreases the healing of Holy Shock by 50% but increases its damage by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_searinglight.jpg"},[tt.GlyphOfInquisition]:{name:"Glyph of Inquisition",description:"When you land a killing blow on an opponent that yields experience or honor, the duration of your Inquisition is increased by 30 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_paladin_inquisition.jpg"},[tt.GlyphOfProtectorOfTheInnocent]:{name:"Glyph of Protector of the Innocent",description:"When you use Word of Glory to heal another target, it also heals you for 20% of the amount.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_paladin_protectoroftheinnocent.jpg"},[tt.GlyphOfTheBattleHealer]:{name:"Glyph of the Battle Healer",description:"Melee attacks from Seal of Insight heal the most wounded member of your raid or party for 30% of the normal heal instead of you.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_vindication.jpg"},[tt.GlyphOfMassExorcism]:{name:"Glyph of Mass Exorcism",description:"Reduces the range of Exorcism to melee range, but causes 25% damage to all enemies within 8 yards of the primary target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism_02.jpg"},[tt.GlyphOfDivineShield]:{name:"Glyph of Divine Shield",description:"Removing harmful effects with Divine Shield heals you for 10% for each effect removed. This heal cannot exceed 50% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_divineshield.jpg"},[tt.GlyphOfHandOfSacrifice]:{name:"Glyph of Hand of Sacrifice",description:"Hand of Sacrifice no longer redirects damage to the Paladin.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofsacrifice.jpg"}},minorGlyphs:{[et.GlyphOfTheLuminousCharger]:{name:"Glyph of the Luminous Charger",description:"Your Paladin class mounts glow with holy light.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_crusaderaura.jpg"},[et.GlyphOfTheMountedKing]:{name:"Glyph of the Mounted King",description:"Mounting one of your Paladin class mounts automatically casts Blessing of Kings on you.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_magic_greaterblessingofkings.jpg"},[et.GlyphOfContemplation]:{name:"Glyph of Contemplation",description:"Teaches you the ability Contemplation.\r\n\r\n Allows you a moment of peace as you kneel in quiet contemplation to ponder the nature of the Light.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_relics_libramofhope.jpg"},[et.GlyphOfWingedVengeance]:{name:"Glyph of Winged Vengeance",description:"Your Avenging Wrath depicts 4 wings.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_revivechampion.jpg"},[et.GlyphOfSealOfBlood]:{name:"Glyph of Seal of Blood",description:"Your Seal of Truth now uses the Seal of Blood visual.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofvengeance.jpg"},[et.GlyphOfFireFromTheHeavens]:{name:"Glyph of Fire From the Heavens",description:"Your Judgment and Hammer of Wrath criticals call down fire from the sky.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mage_firestarter.jpg"},[et.GlyphOfFocusedWrath]:{name:"Glyph of Focused Wrath",description:"Holy Wrath only affects one target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_weaponmastery.jpg"},[et.GlyphOfTheFallingAvenger]:{name:"Glyph of the Falling Avenger",description:"You slow fall during Avenging Wrath.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_magic_featherfall.jpg"},[et.GlyphOfTheRighteousRetreat]:{name:"Glyph of the Righteous Retreat",description:"During Divine Shield, you can invoke your Hearthstone 50% faster.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/achievement_guildperk_hastyhearth.jpg"},[et.GlyphOfBladedJudgment]:{name:"Glyph of Bladed Judgment",description:"Your Judgment spell depicts an axe or sword instead of a hammer, if you have an axe or sword equipped.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_axe_1h_cataclysm_c_01.jpg"},[et.GlyphOfTheExorcist]:{name:"Glyph of the Exorcist",description:"Exorcism will now appear to remove the evil from its target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism.jpg"},[et.GlyphOfPillarOfLight]:{name:"Glyph of Pillar of Light",description:"Critical heals on other players display a small pillar of light at their location briefly.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_surgeoflight.jpg"}}},Ll=kl({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"voidTendrils",fancyName:"Void Tendrils",location:{rowIdx:0,colIdx:0},spellId:108920},{fieldName:"psyfiend",fancyName:"Psyfiend",location:{rowIdx:0,colIdx:1},spellId:108921},{fieldName:"dominateMind",fancyName:"Dominate Mind",location:{rowIdx:0,colIdx:2},spellId:605},{fieldName:"bodyAndSoul",fancyName:"Body and Soul",location:{rowIdx:1,colIdx:0},spellId:64129},{fieldName:"angelicFeather",fancyName:"Angelic Feather",location:{rowIdx:1,colIdx:1},spellId:121536},{fieldName:"phantasm",fancyName:"Phantasm",location:{rowIdx:1,colIdx:2},spellId:108942},{fieldName:"fromDarknessComesLight",fancyName:"From Darkness, Comes Light",location:{rowIdx:2,colIdx:0},spellId:109186},{fieldName:"mindbender",fancyName:"Mindbender",location:{rowIdx:2,colIdx:1},spellId:123040},{fieldName:"solaceAndInsanity",fancyName:"Solace and Insanity",location:{rowIdx:2,colIdx:2},spellId:139139},{fieldName:"desperatePrayer",fancyName:"Desperate Prayer",location:{rowIdx:3,colIdx:0},spellId:19236},{fieldName:"spectralGuise",fancyName:"Spectral Guise",location:{rowIdx:3,colIdx:1},spellId:112833},{fieldName:"angelicBulwark",fancyName:"Angelic Bulwark",location:{rowIdx:3,colIdx:2},spellId:108945},{fieldName:"twistOfFate",fancyName:"Twist of Fate",location:{rowIdx:4,colIdx:0},spellId:109142},{fieldName:"powerInfusion",fancyName:"Power Infusion",location:{rowIdx:4,colIdx:1},spellId:10060},{fieldName:"divineInsight",fancyName:"Divine Insight",location:{rowIdx:4,colIdx:2},spellId:109175},{fieldName:"cascade",fancyName:"Cascade",location:{rowIdx:5,colIdx:0},spellId:121135},{fieldName:"divineStar",fancyName:"Divine Star",location:{rowIdx:5,colIdx:1},spellId:110744},{fieldName:"halo",fancyName:"Halo",location:{rowIdx:5,colIdx:2},spellId:120517}]}),Vl={majorGlyphs:{[it.GlyphOfCircleOfHealing]:{name:"Glyph of Circle of Healing",description:"Your Circle of Healing spell heals 1 additional target, but its mana cost is increased by 35%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_circleofrenewal.jpg"},[it.GlyphOfPurify]:{name:"Glyph of Purify",description:"Your Purify spell also heals your target for 5% of maximum health when you successfully dispel a magical effect or disease.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_dispelmagic.jpg"},[it.GlyphOfFade]:{name:"Glyph of Fade",description:"Your Fade ability now also reduces all damage taken by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_magic_lesserinvisibilty.jpg"},[it.GlyphOfFearWard]:{name:"Glyph of Fear Ward",description:"Reduces the cooldown of Fear Ward by 60 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_excorcism.jpg"},[it.GlyphOfInnerSanctum]:{name:"Glyph of Inner Sanctum",description:"Spell damage taken is reduced by 6% while within Inner Fire, and the movement speed bonus of your Inner Will is increased by 6%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/priest_icon_innewill.jpg"},[it.GlyphOfHolyNova]:{name:"Glyph of Holy Nova",description:"Teaches you the ability Holy Nova.\r\n\r\n Causes an explosion of holy light around the caster, causing 2477 Holy damage to all enemy targets within 10 yards and healing up to 5 targets within 10 yards for 525.\r\n\r\n Healing is divided among the number of targets healed. These effects cause no threat.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_holynova.jpg"},[it.GlyphOfInnerFire]:{name:"Glyph of Inner Fire",description:"Increases the armor gained from your Inner Fire spell by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_innerfire.jpg"},[it.GlyphOfDeepWells]:{name:"Glyph of Deep Wells",description:"Increases the total amount of charges of your Lightwell by 2.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_summonlightwell.jpg"},[it.GlyphOfMassDispel]:{name:"Glyph of Mass Dispel",description:"Causes your Mass Dispel to be potent enough to remove Magic effects that are normally undispellable.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_arcane_massdispel.jpg"},[it.GlyphOfPsychicHorror]:{name:"Glyph of Psychic Horror",description:"Reduces the cooldown of your Psychic Horror by -10.0 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_psychichorrors.jpg"},[it.GlyphOfHolyFire]:{name:"Glyph of Holy Fire",description:"Increases the range of your Holy Fire, Smite, and Power Word: Solace spells by 10 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_searinglight.jpg"},[it.GlyphOfWeakenedSoul]:{name:"Glyph of Weakened Soul",description:"Reduces the duration of the Weakened Soul effect caused by Power Word: Shield by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_ashestoashes.jpg"},[it.GlyphOfPowerWordShield]:{name:"Glyph of Power Word: Shield",description:"20% of the absorb from your Power Word: Shield spell is converted into healing.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_powerwordshield.jpg"},[it.GlyphOfSpiritOfRedemption]:{name:"Glyph of Spirit of Redemption",description:"Increases the duration of Spirit of Redemption by 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_enchant_essenceeternallarge.jpg"},[it.GlyphOfPsychicScream]:{name:"Glyph of Psychic Scream",description:"Targets of your Psychic Scream and your Psyfiend's Psychic Terror now tremble in place instead of fleeing in fear.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_psychicscream.jpg"},[it.GlyphOfRenew]:{name:"Glyph of Renew",description:"Your Renew heals for 33% more each time it heals, but its duration is reduced by 3 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_renew.jpg"},[it.GlyphOfScourgeImprisonment]:{name:"Glyph of Scourge Imprisonment",description:"Reduces the cast time of your Shackle Undead by 1.0 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_crusade.jpg"},[it.GlyphOfMindBlast]:{name:"Glyph of Mind Blast",description:"When you critically hit with your Mind Blast, you cause the target to be unable to move for 4s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_unholyfrenzy.jpg"},[it.GlyphOfDispelMagic]:{name:"Glyph of Dispel Magic",description:"Your Dispel Magic spell also damages your target for 4937 Holy damage when you successfully dispel a magical effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_nullifydisease.jpg"},[it.GlyphOfSmite]:{name:"Glyph of Smite",description:"Your Smite spell inflicts an additional 20% damage against targets afflicted by Power Word: Solace, but that additional damage does not get transferred by Atonement.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_holysmite.jpg"},[it.GlyphOfPrayerOfMending]:{name:"Glyph of Prayer of Mending",description:"The first charge of your Prayer of Mending heals for an additional 60% but your Prayer of Mending has 1 fewer charge.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_prayerofmendingtga.jpg"},[it.GlyphOfLevitate]:{name:"Glyph of Levitate",description:"Increases your movement speed while Levitating and for 10 sec afterward by 15%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_priest_pathofdevout.jpg"},[it.GlyphOfReflectiveShield]:{name:"Glyph of Reflective Shield",description:"Causes 70% of the damage you absorb with Power Word: Shield to reflect back at the attacker. This damage causes no threat.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_priest_reflectiveshield.jpg"},[it.GlyphOfDispersion]:{name:"Glyph of Dispersion",description:"Reduces the cooldown on Dispersion by 15 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_dispersion.jpg"},[it.GlyphOfLeapOfFaith]:{name:"Glyph of Leap of Faith",description:"Your Leap of Faith spell now also clears all movement impairing effects from your target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/priest_spell_leapoffaith_a.jpg"},[it.GlyphOfPenance]:{name:"Glyph of Penance",description:"Increases the mana cost of Penance by 20% but allows Penance to be cast while moving.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_penance.jpg"},[it.GlyphOfFocusedMending]:{name:"Glyph of Focused Mending",description:"Causes your Prayer of Mending to only bounce between the target and the caster.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_healingfocus.jpg"},[it.GlyphOfMindSpike]:{name:"Glyph of Mind Spike",description:"Your successful non-instant Mind Spikes, reduce the cast time of your next Mind Blast within 9s by 50%. This effect can stack up to 2 times.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_priest_mindspike.jpg"},[it.GlyphOfBindingHeal]:{name:"Glyph of Binding Heal",description:"Your Binding Heal spell now heals a third friendly target within 20 yards, but costs 35% more mana.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_blindingheal.jpg"},[it.GlyphOfMindFlay]:{name:"Glyph of Mind Flay",description:"Your Mind Flay spell no longer slows your victim's movement speed. Instead, each time Mind Flay deals damage you will be granted 15% increased movement speed for 5s, stacking up to 3 times.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_siphonmana.jpg"},[it.GlyphOfShadowWordDeath]:{name:"Glyph of Shadow Word: Death",description:"Your Shadow Word: Death can now be cast at any time, but deals 25% damage against targets above 20% health and does not generate a Shadow Orb when used against them.\r\n\r\n Casting Shadow Word: Death now also does damage to you equivalent to the damage it would do to an enemy above 20% health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonicfortitude.jpg"},[it.GlyphOfVampiricEmbrace]:{name:"Glyph of Vampiric Embrace",description:"Your Vampiric Embrace converts an additional 50% of the damage you deal into healing, but the duration is reduced by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_unsummonbuilding.jpg"},[it.GlyphOfLightspring]:{name:"Glyph of Lightspring",description:"Your Lightwell no longer automatically heals nearby targets, but can be clicked by players to deal 50% more healing than normal.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_summonlightwell.jpg"},[it.GlyphOfLightwell]:{name:"Glyph of Lightwell",description:"Your Lightwell no longer automatically heals nearby targets, but can be clicked by players to deal 50% more healing than normal.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_summonlightwell.jpg"}},minorGlyphs:{[at.GlyphOfShadowRavens]:{name:"Glyph of Shadow Ravens",description:"Your Shadow Orbs now appear as Shadow Ravens.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_priest_shadoworbs.jpg"},[at.GlyphOfBorrowedTime]:{name:"Glyph of Borrowed Time",description:"Your Borrowed Time is now displayed visually.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_borrowedtime.jpg"},[at.GlyphOfShackleUndead]:{name:"Glyph of Shackle Undead",description:"Changes the appearance of your Shackle Undead.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_slow.jpg"},[at.GlyphOfDarkArchangel]:{name:"Glyph of Dark Archangel",description:"When you apply Devouring Plague to a target, you take on the form of a Dark Archangel for 8s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonvoidwalker.jpg"},[at.GlyphOfShadow]:{name:"Glyph of Shadow",description:"Alters the appearance of your Shadowform to be less transparent.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowform.jpg"},[at.GlyphOfTheHeavens]:{name:"Glyph of the Heavens",description:"Your Levitate targets will appear to be riding on a cloud for the duration of the spell.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_elemental_primal_air.jpg"},[at.GlyphOfConfession]:{name:"Glyph of Confession",description:"Teaches you the ability Confession.\r\n\r\n Compels a friendly target to confess a secret.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_soothingkiss.jpg"},[at.GlyphOfHolyResurrection]:{name:"Glyph of Holy Resurrection",description:"Your resurrection target appears bathed in holy light for the duration of the Resurrection cast.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_surgeoflight.jpg"},[at.GlyphOfTheValkyr]:{name:"Glyph of the Val'kyr",description:"While Spirit of Redemption is active, you now appear as a Val'kyr.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/achievement_boss_svalasorrowgrave.jpg"},[at.GlyphOfShadowyFriends]:{name:"Glyph of Shadowy Friends",description:"Your Shadowform extends to your non-combat pets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_antishadow.jpg"},[at.GlyphOfAngels]:{name:"Glyph of Angels",description:"Your heal spells momentarily grant you angelic wings.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_priest_archangel.jpg"},[at.GlyphOfTheSha]:{name:"Glyph of the Sha",description:"Transforms your Shadowfiend and Mindbender into a Sha Beast.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_hand_1h_shaclaw.jpg"},[at.GlyphOfShiftedAppearances]:{name:"Glyph of Shifted Appearances",description:"Void Shift causes you and your target to exchange appearances for several seconds.\r\n\r\n Does not affect mounted players.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_priest_voidshift.jpg"},[at.GlyphOfInspiredHymns]:{name:"Glyph of Inspired Hymns",description:"While channeling Hymns, a spirit appears above you.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_divinehymn.jpg"}}},Fl=kl({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"nightstalker",fancyName:"Nightstalker",location:{rowIdx:0,colIdx:0},spellId:14062},{fieldName:"subterfuge",fancyName:"Subterfuge",location:{rowIdx:0,colIdx:1},spellId:108208},{fieldName:"shadowFocus",fancyName:"Shadow Focus",location:{rowIdx:0,colIdx:2},spellId:108209},{fieldName:"deadlyThrow",fancyName:"Deadly Throw",location:{rowIdx:1,colIdx:0},spellId:26679},{fieldName:"nerveStrike",fancyName:"Nerve Strike",location:{rowIdx:1,colIdx:1},spellId:108210},{fieldName:"combatReadiness",fancyName:"Combat Readiness",location:{rowIdx:1,colIdx:2},spellId:74001},{fieldName:"cheatDeath",fancyName:"Cheat Death",location:{rowIdx:2,colIdx:0},spellId:31230},{fieldName:"leechingPoison",fancyName:"Leeching Poison",location:{rowIdx:2,colIdx:1},spellId:108211},{fieldName:"elusiveness",fancyName:"Elusiveness",location:{rowIdx:2,colIdx:2},spellId:79008},{fieldName:"cloakAndDagger",fancyName:"Cloak and Dagger",location:{rowIdx:3,colIdx:0},spellId:138106},{fieldName:"shadowstep",fancyName:"Shadowstep",location:{rowIdx:3,colIdx:1},spellId:36554},{fieldName:"burstOfSpeed",fancyName:"Burst of Speed",location:{rowIdx:3,colIdx:2},spellId:108212},{fieldName:"preyOnTheWeak",fancyName:"Prey on the Weak",location:{rowIdx:4,colIdx:0},spellId:131511},{fieldName:"paralyticPoison",fancyName:"Paralytic Poison",location:{rowIdx:4,colIdx:1},spellId:108215},{fieldName:"dirtyTricks",fancyName:"Dirty Tricks",location:{rowIdx:4,colIdx:2},spellId:108216},{fieldName:"shurikenToss",fancyName:"Shuriken Toss",location:{rowIdx:5,colIdx:0},spellId:114014},{fieldName:"markedForDeath",fancyName:"Marked for Death",location:{rowIdx:5,colIdx:1},spellId:137619},{fieldName:"anticipation",fancyName:"Anticipation",location:{rowIdx:5,colIdx:2},spellId:114015}]}),Wl={majorGlyphs:{[nt.GlyphOfShadowWalk]:{name:"Glyph of Shadow Walk",description:"Your Shadow Walk ability also increases your stealth detection while active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_envelopingshadows.jpg"},[nt.GlyphOfAmbush]:{name:"Glyph of Ambush",description:"Increases the range of Ambush by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_ambush.jpg"},[nt.GlyphOfBladeFlurry]:{name:"Glyph of Blade Flurry",description:"Your attacks have a 30% higher chance of applying Non-Lethal poisons while Blade Flurry is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_punishingblow.jpg"},[nt.GlyphOfSharpKnives]:{name:"Glyph of Sharp Knives",description:"Your Fan of Knives also damages the armor of its victims, applying 1 application of the Weakened Armor effect to each target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_stone_sharpeningstone_05.jpg"},[nt.GlyphOfRecuperate]:{name:"Glyph of Recuperate",description:"Increases the healing of your Recuperate ability by an additional 1.0% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_recuperate.jpg"},[nt.GlyphOfEvasion]:{name:"Glyph of Evasion",description:"Increases the duration of Evasion by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowward.jpg"},[nt.GlyphOfRecovery]:{name:"Glyph of Recovery",description:"While Recuperate is active, you receive 20% increased healing from other sources.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_sturdyrecuperate.jpg"},[nt.GlyphOfExposeArmor]:{name:"Glyph of Expose Armor",description:"Your Expose Armor ability causes three applications of Weakened Armor.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_riposte.jpg"},[nt.GlyphOfFeint]:{name:"Glyph of Feint",description:"Increases the duration of Feint by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_feint.jpg"},[nt.GlyphOfGarrote]:{name:"Glyph of Garrote",description:"Increases the duration of your Garrote ability's silence effect by 1.0 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_garrote.jpg"},[nt.GlyphOfGouge]:{name:"Glyph of Gouge",description:"Your Gouge ability no longer requires that the target be facing you.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_gouge.jpg"},[nt.GlyphOfSmokeBomb]:{name:"Glyph of Smoke Bomb",description:"Increases the duration of your Smoke Bomb by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_smoke.jpg"},[nt.GlyphOfCheapShot]:{name:"Glyph of Cheap Shot",description:"Increases the duration of your Cheap Shot by 0.5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_cheapshot.jpg"},[nt.GlyphOfHemorraghingVeins]:{name:"Glyph of Hemorraghing Veins",description:"Your Sanguinary Veins ability now also increases damage done to targets affected by your Hemorrhage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_holy_sealofsacrifice.jpg"},[nt.GlyphOfKick]:{name:"Glyph of Kick",description:"Increases the cooldown of your Kick ability by 4 sec, but this cooldown is reduced by 6 sec when your Kick successfully interrupts a spell.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_kick.jpg"},[nt.GlyphOfRedirect]:{name:"Glyph of Redirect",description:"Reduces the cooldown of Redirect by 50 seconds.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_redirect.jpg"},[nt.GlyphOfShiv]:{name:"Glyph of Shiv",description:"Reduces the cooldown of your Shiv ability by 3 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_throwingknife_04.jpg"},[nt.GlyphOfSprint]:{name:"Glyph of Sprint",description:"Increases the movement speed of your Sprint ability by an additional 30%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_sprint.jpg"},[nt.GlyphOfVendetta]:{name:"Glyph of Vendetta",description:"Reduces the damage bonus of your Vendetta ability by 5% but increases its duration by 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_deadliness.jpg"},[nt.GlyphOfStealth]:{name:"Glyph of Stealth",description:"Reduces the cooldown of your Stealth ability by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_stealth.jpg"},[nt.GlyphOfDeadlyMomentum]:{name:"Glyph of Deadly Momentum",description:"When you land a killing blow on an opponent that yields experience or honor, your Slice and Dice and Recuperate abilities are refreshed to their original duration.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_deadlymomentum.jpg"},[nt.GlyphOfCloakOfShadows]:{name:"Glyph of Cloak of Shadows",description:"While Cloak of Shadows is active, you take 40% less physical damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_nethercloak.jpg"},[nt.GlyphOfVanish]:{name:"Glyph of Vanish",description:"Increases the duration of your Vanish effect by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_vanish.jpg"},[nt.GlyphOfBlind]:{name:"Glyph of Blind",description:"Your Blind ability also removes all damage over time effects from the target that would cause Blind to break early.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_mindsteal.jpg"}},minorGlyphs:{[st.GlyphOfDecoy]:{name:"Glyph of Decoy",description:"When you Vanish, you leave behind a brief illusion that very closely resembles you.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_vanish.jpg"},[st.GlyphOfDetection]:{name:"Glyph of Detection",description:"Teaches you the ability Detection.\r\n\r\n Focus intently on trying to detect certain creatures.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_spy.jpg"},[st.GlyphOfHemorrhage]:{name:"Glyph of Hemorrhage",description:"Your Hemorrhage ability only causes lingering damage over time to targets that were already afflicted by a Bleed effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain.jpg"},[st.GlyphOfPickPocket]:{name:"Glyph of Pick Pocket",description:"Increases the range of your Pick Pocket ability by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_bag_11.jpg"},[st.GlyphOfDistract]:{name:"Glyph of Distract",description:"Increases the range of your Distract ability by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_distract.jpg"},[st.GlyphOfPickLock]:{name:"Glyph of Pick Lock",description:"Reduces the cast time of your Pick Lock ability by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_moonkey.jpg"},[st.GlyphOfSafeFall]:{name:"Glyph of Safe Fall",description:"Increases the distance your Safe Fall ability allows you to fall without taking damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_feather_01.jpg"},[st.GlyphOfBlurredSpeed]:{name:"Glyph of Blurred Speed",description:"Enables you to walk on water while your Sprint ability is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_sprint.jpg"},[st.GlyphOfPoisons]:{name:"Glyph of Poisons",description:"You apply poisons to your weapons 50% faster.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/trade_brewpoison.jpg"},[st.GlyphOfKillingSpree]:{name:"Glyph of Killing Spree",description:"Your Killing Spree returns you to your starting location when the effect ends.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_murderspree.jpg"},[st.GlyphOfTricksOfTheTrade]:{name:"Glyph of Tricks of the Trade",description:"Your Tricks of the Trade ability no longer costs Energy, but also no longer increases the damage dealt by the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_tricksofthetrade.jpg"},[st.GlyphOfDisguise]:{name:"Glyph of Disguise",description:"When you Pick Pocket a humanoid enemy, you also copy their appearance for 5min. Your disguise will unravel upon entering combat.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_disguise.jpg"},[st.GlyphOfHeadhunting]:{name:"Glyph of Headhunting",description:"Your Throw and Deadly Throw abilities will now throw axes regardless of your currently equipped weapon.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_throwingaxe_03.jpg"},[st.GlyphOfImprovedDistraction]:{name:"Glyph of Improved Distraction",description:"Distract now summons a decoy at the target location.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_distract.jpg"}}},Ml=kl({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"naturesGuardian",fancyName:"Nature's Guardian",location:{rowIdx:0,colIdx:0},spellId:30884},{fieldName:"stoneBulwarkTotem",fancyName:"Stone Bulwark Totem",location:{rowIdx:0,colIdx:1},spellId:108270},{fieldName:"astralShift",fancyName:"Astral Shift",location:{rowIdx:0,colIdx:2},spellId:108271},{fieldName:"frozenPower",fancyName:"Frozen Power",location:{rowIdx:1,colIdx:0},spellId:63374},{fieldName:"earthgrabTotem",fancyName:"Earthgrab Totem",location:{rowIdx:1,colIdx:1},spellId:51485},{fieldName:"windwalkTotem",fancyName:"Windwalk Totem",location:{rowIdx:1,colIdx:2},spellId:108273},{fieldName:"callOfTheElements",fancyName:"Call of the Elements",location:{rowIdx:2,colIdx:0},spellId:108285},{fieldName:"totemicPersistence",fancyName:"Totemic Persistence",location:{rowIdx:2,colIdx:1},spellId:108284},{fieldName:"totemicProjection",fancyName:"Totemic Projection",location:{rowIdx:2,colIdx:2},spellId:108287},{fieldName:"elementalMastery",fancyName:"Elemental Mastery",location:{rowIdx:3,colIdx:0},spellId:16166},{fieldName:"ancestralSwiftness",fancyName:"Ancestral Swiftness",location:{rowIdx:3,colIdx:1},spellId:16188},{fieldName:"echoOfTheElements",fancyName:"Echo of the Elements",location:{rowIdx:3,colIdx:2},spellId:108283},{fieldName:"rushingStreams",fancyName:"Rushing Streams",location:{rowIdx:4,colIdx:0},spellId:147074},{fieldName:"ancestralGuidance",fancyName:"Ancestral Guidance",location:{rowIdx:4,colIdx:1},spellId:108281},{fieldName:"conductivity",fancyName:"Conductivity",location:{rowIdx:4,colIdx:2},spellId:108282},{fieldName:"unleashedFury",fancyName:"Unleashed Fury",location:{rowIdx:5,colIdx:0},spellId:117012},{fieldName:"primalElementalist",fancyName:"Primal Elementalist",location:{rowIdx:5,colIdx:1},spellId:117013},{fieldName:"elementalBlast",fancyName:"Elemental Blast",location:{rowIdx:5,colIdx:2},spellId:117014}]}),zl={majorGlyphs:{[lt.GlyphOfUnstableEarth]:{name:"Glyph of Unstable Earth",description:"Causes your Earthquake spell to also reduce the movement speed of affected targets by 40% for 3s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_earthquake.jpg"},[lt.GlyphOfChainLightning]:{name:"Glyph of Chain Lightning",description:"Your Chain Lightning spell now strikes 2 additional targets, but deals 10% less damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_chainlightning.jpg"},[lt.GlyphOfSpiritWalk]:{name:"Glyph of Spirit Walk",description:"Reduces the cooldown of your Spirit Walk ability by 25%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_tracking.jpg"},[lt.GlyphOfCapacitorTotem]:{name:"Glyph of Capacitor Totem",description:"Reduces the charging time of your Capacitor Totem by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_brilliance.jpg"},[lt.GlyphOfPurge]:{name:"Glyph of Purge",description:"Your Purge dispels 1 additional Magic effect but has a 6 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_purge.jpg"},[lt.GlyphOfFireElementalTotem]:{name:"Glyph of Fire Elemental Totem",description:"Reduces the cooldown and duration of your Fire Elemental Totem by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_elemental_totem.jpg"},[lt.GlyphOfFireNova]:{name:"Glyph of Fire Nova",description:"Increases the radius of your Fire Nova spell by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_firenova.jpg"},[lt.GlyphOfFlameShock]:{name:"Glyph of Flame Shock",description:"When your Flame Shock deals damage, it heals you for 30% of the damage dealt.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_flameshock.jpg"},[lt.GlyphOfWindShear]:{name:"Glyph of Wind Shear",description:"Increases the school lockout duration of Wind Shear by 1 sec, but also increases the cooldown by 3 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_cyclone.jpg"},[lt.GlyphOfHealingStreamTotem]:{name:"Glyph of Healing Stream Totem",description:"When your Healing Stream Totem heals an ally, it also reduces their Fire, Frost, and Nature damage taken by 10% for 6s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_spear_04.jpg"},[lt.GlyphOfHealingWave]:{name:"Glyph of Healing Wave",description:"Your Healing Wave also heals you for 20% of the healing effect when you heal someone else.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingwavegreater.jpg"},[lt.GlyphOfTotemicRecall]:{name:"Glyph of Totemic Recall",description:"Causes your Totemic Recall ability to return the full mana cost of any recalled totems.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_totemrecall.jpg"},[lt.GlyphOfTelluricCurrents]:{name:"Glyph of Telluric Currents",description:"Causes your Lightning Bolt to restore 2% of your mana when it strikes an enemy.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_lightning_lightningbolt01.jpg"},[lt.GlyphOfGroundingTotem]:{name:"Glyph of Grounding Totem",description:"Instead of absorbing a spell, your Grounding Totem reflects the next harmful spell back at its caster, but the cooldown of your Grounding Totem is increased by 20 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_groundingtotem.jpg"},[lt.GlyphOfSpiritwalkersGrace]:{name:"Glyph of Spiritwalker's Grace",description:"Increases the duration of your Spiritwalker's Grace by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_spiritwalkersgrace.jpg"},[lt.GlyphOfWaterShield]:{name:"Glyph of Water Shield",description:"Increases the mana generated reactively by your Water Shield when you are attacked by 50%, but reduces the passive mana generation by 15%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_shaman_watershield.jpg"},[lt.GlyphOfCleansingWaters]:{name:"Glyph of Cleansing Waters",description:"When you dispel a harmful Magic or Curse effect from an ally, you also heal the target for 5% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_regeneration_02.jpg"},[lt.GlyphOfFrostShock]:{name:"Glyph of Frost Shock",description:"Decreases the cooldown incurred by your Frost Shock by 2 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_frostshock.jpg"},[lt.GlyphOfChaining]:{name:"Glyph of Chaining",description:"Increases the jump distance of your Chain Heal spell by 100%, but gives the spell a 2 sec cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_druid_empoweredtouch.jpg"},[lt.GlyphOfHealingStorm]:{name:"Glyph of Healing Storm",description:"Each application of Maelstrom Weapon also increases your direct healing done by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_maelstromweapon.jpg"},[lt.GlyphOfGhostWolf]:{name:"Glyph of Ghost Wolf",description:"While in Ghost Wolf form, you are less hindered by effects that would reduce movement speed.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_spiritwolf.jpg"},[lt.GlyphOfThunder]:{name:"Glyph of Thunder",description:"Reduces the cooldown on Thunderstorm by 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_thunderstorm.jpg"},[lt.GlyphOfFeralSpirit]:{name:"Glyph of Feral Spirit",description:"Increases the healing done by your Feral Spirits' Spirit Hunt by 40%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_feralspirit.jpg"},[lt.GlyphOfRiptide]:{name:"Glyph of Riptide",description:"Removes the cooldown of Riptide, but reduces the initial direct healing by 75%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_riptide.jpg"},[lt.GlyphOfShamanisticRage]:{name:"Glyph of Shamanistic Rage",description:"Activating your Shamanistic Rage ability also cleanses you of all dispellable harmful Magic effects.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_shamanrage.jpg"},[lt.GlyphOfHex]:{name:"Glyph of Hex",description:"Reduces the cooldown of your Hex spell by 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_hex.jpg"},[lt.GlyphOfTotemicVigor]:{name:"Glyph of Totemic Vigor",description:"Increases the health of your totems by 5% of your maximum health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_relics_totemofrebirth.jpg"},[lt.GlyphOfLightningShield]:{name:"Glyph of Lightning Shield",description:"When your Lightning Shield is triggered, you take 10% less damage for 6s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_lightningshield.jpg"},[lt.GlyphOfPurging]:{name:"Glyph of Purging",description:"Successfully Purging a target now grants a stack of Maelstrom Weapon.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_improvedreincarnation.jpg"},[lt.GlyphOfEternalEarth]:{name:"Glyph of Eternal Earth",description:"Your Lightning Bolt has a chance to add a charge to your currently active Earth Shield. This cannot cause Earth Shield to exceed 9 charges.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_improvedearthshield.jpg"}},minorGlyphs:{[ot.GlyphOfTheLakestrider]:{name:"Glyph of the Lakestrider",description:"You automatically gain Water Walking while you are in Ghost Wolf form.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_frost_windwalkon.jpg"},[ot.GlyphOfLavaLash]:{name:"Glyph of Lava Lash",description:"Your Lava Lash ability no longer spreads Flame Shock to nearby targets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_shaman_lavalash.jpg"},[ot.GlyphOfAstralRecall]:{name:"Glyph of Astral Recall",description:"Reduces the cooldown of your Astral Recall spell by 5 minutes.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_astralrecal.jpg"},[ot.GlyphOfFarSight]:{name:"Glyph of Far Sight",description:"Your Far Sight spell may be used indoors.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_farsight.jpg"},[ot.GlyphOfTheSpectralWolf]:{name:"Glyph of the Spectral Wolf",description:"Alters the appearance of your Ghost Wolf transformation, causing it to resemble a large, spectral wolf.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mount_whitedirewolf.jpg"},[ot.GlyphOfTotemicEncirclement]:{name:"Glyph of Totemic Encirclement",description:"When you cast a totem spell, you also place unempowered totems for any elements that are not currently active. These totems have 5 health and produce no other effects.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_shaman_totemrelocation.jpg"},[ot.GlyphOfThunderstorm]:{name:"Glyph of Thunderstorm",description:"Removes the knockback effect from your Thunderstorm spell.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_thunderstorm.jpg"},[ot.GlyphOfDeluge]:{name:"Glyph of Deluge",description:"Your Chain Heal now has a watery appearance.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_healingwavegreater.jpg"},[ot.GlyphOfSpiritRaptors]:{name:"Glyph of Spirit Raptors",description:"Your Spirit Wolves are replaced with Spirit Raptors.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/trade_archaeology_dinosaurskeleton.jpg"},[ot.GlyphOfLingeringAncestors]:{name:"Glyph of Lingering Ancestors",description:"Resurrecting someone with Ancestral Spirit causes a ghostly ancestor to follow them around for a short time.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shaman_ancestralawakening.jpg"},[ot.GlyphOfSpiritWolf]:{name:"Glyph of Spirit Wolf",description:"Ghost Wolf can be now be used while you are a ghost.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_spiritwolf.jpg"},[ot.GlyphOfFlamingSerpent]:{name:"Glyph of Flaming Serpent",description:"Your Searing Totem now resembles Vol'jin's Serpent Ward.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_guardianward.jpg"},[ot.GlyphOfTheCompy]:{name:"Glyph of the Compy",description:"Your Hex now transforms enemies into a Compy.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_pet_raptor.jpg"},[ot.GlyphOfElementalFamiliars]:{name:"Glyph of Elemental Familiars",description:"Summons a random Fire, Water, or Nature familiar. Familiars of different types have a tendency to fight each other.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_pet_pandarenelemental.jpg"},[ot.GlyphOfAstralFixation]:{name:"Glyph of Astral Fixation",description:"Astral Recall now takes you to your capital's Earthshrine.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_astralrecalgroup.jpg"},[ot.GlyphOfRainOfFrogs]:{name:"Glyph of Rain of Frogs",description:"You summon a rain storm of frogs at your targeted location.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_pet_toad_blue.jpg"}}},jl=kl({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"darkRegeneration",fancyName:"Dark Regeneration",location:{rowIdx:0,colIdx:0},spellId:108359},{fieldName:"soulLeech",fancyName:"Soul Leech",location:{rowIdx:0,colIdx:1},spellId:108370},{fieldName:"harvestLife",fancyName:"Harvest Life",location:{rowIdx:0,colIdx:2},spellId:108371},{fieldName:"demonicBreath",fancyName:"Demonic Breath",location:{rowIdx:1,colIdx:0},spellId:47897},{fieldName:"mortalCoil",fancyName:"Mortal Coil",location:{rowIdx:1,colIdx:1},spellId:6789},{fieldName:"shadowfury",fancyName:"Shadowfury",location:{rowIdx:1,colIdx:2},spellId:30283},{fieldName:"soulLink",fancyName:"Soul Link",location:{rowIdx:2,colIdx:0},spellId:108415},{fieldName:"sacrificialPact",fancyName:"Sacrificial Pact",location:{rowIdx:2,colIdx:1},spellId:108416},{fieldName:"darkBargain",fancyName:"Dark Bargain",location:{rowIdx:2,colIdx:2},spellId:110913},{fieldName:"bloodHorror",fancyName:"Blood Horror",location:{rowIdx:3,colIdx:0},spellId:111397},{fieldName:"burningRush",fancyName:"Burning Rush",location:{rowIdx:3,colIdx:1},spellId:111400},{fieldName:"unboundWill",fancyName:"Unbound Will",location:{rowIdx:3,colIdx:2},spellId:108482},{fieldName:"grimoireOfSupremacy",fancyName:"Grimoire of Supremacy",location:{rowIdx:4,colIdx:0},spellId:108499},{fieldName:"grimoireOfService",fancyName:"Grimoire of Service",location:{rowIdx:4,colIdx:1},spellId:108501},{fieldName:"grimoireOfSacrifice",fancyName:"Grimoire of Sacrifice",location:{rowIdx:4,colIdx:2},spellId:108503},{fieldName:"archimondesDarkness",fancyName:"Archimonde's Darkness",location:{rowIdx:5,colIdx:0},spellId:108505},{fieldName:"kiljaedensCunning",fancyName:"Kil'jaeden's Cunning",location:{rowIdx:5,colIdx:1},spellId:137587},{fieldName:"mannorothsFury",fancyName:"Mannoroth's Fury",location:{rowIdx:5,colIdx:2},spellId:108508}]}),Bl={majorGlyphs:{[ct.GlyphOfConflagrate]:{name:"Glyph of Conflagrate",description:"Conflagrate no longer requires Immolate to snare the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_fireball.jpg"},[ct.GlyphOfSiphonLife]:{name:"Glyph of Siphon Life",description:"Your Immolate spell will heal you for 0.5% of your maximum health when dealing periodic damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_requiem.jpg"},[ct.GlyphOfFear]:{name:"Glyph of Fear",description:"Your Fear causes the target to tremble in place instead of fleeing in fear.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_possession.jpg"},[ct.GlyphOfDemonTraining]:{name:"Glyph of Demon Training",description:"Improves your demon's special abilities:\r\n\r\n Your Fel Imp 's Firebolt cast time is reduced by 50% and fires in bursts of three.\r\n\r\n Increases your Voidlord 's total armor by 10%.\r\n\r\n Your Shivarra 's Mesmerizes ability also removes all damage over time effects from the target.\r\n\r\n When your Observer uses Clone Magic, you will also be healed for that amount.\r\n\r\n Increases your Wrathguard 's total health by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonfelhunter.jpg"},[ct.GlyphOfHealthstone]:{name:"Glyph of Healthstone",description:"You receive 100% more healing from using a healthstone, but the health is restored over 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_stone_04.jpg"},[ct.GlyphOfCurseOfTheElements]:{name:"Glyph of Curse of the Elements",description:"Curse of the Elements hits 2 additional nearby targets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/warlock_curse_shadow.jpg"},[ct.GlyphOfImpSwarm]:{name:"Glyph of Imp Swarm",description:"Teaches you the ability Imp Swarm.\r\n Requires Demonology.\r\n\r\n |Tinterface/icons/ability_warlock_impoweredimp.blp:24|t Imp Swarm\r\n Summons 4 Wild Imps from the Twisting Nether to attack the target.\r\n\r\n The Wild Imps passive effect is disabled while Imp Swarm is on cooldown. Imp Swarm's cooldown is reduced by spell haste. Also increases Wild Imp's cooldown by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warlock_impoweredimp.jpg"},[ct.GlyphOfHavoc]:{name:"Glyph of Havoc",description:"Havoc gains 3 additional charges, but the cooldown is increased by 35 seconds.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warlock_baneofhavoc.jpg"},[ct.GlyphOfSoulstone]:{name:"Glyph of Soulstone",description:"Players resurrected by Soulstone are returned to life with 100% health.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_orb_04.jpg"},[ct.GlyphOfUnstableAffliction]:{name:"Glyph of Unstable Affliction",description:"Reduces the cast time of Unstable Affliction by 25%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_unstableaffliction_3.jpg"},[ct.GlyphOfSoulConsumption]:{name:"Glyph of Soul Consumption",description:"Your Drain Soul restores 20% of your total health after you kill a target that yields experience or honor. You restore 20% of your total health after you kill a target in Demon Form that yields experience or honor. You restore 20% of your total health after you kill a target with Chaos Bolt that yields experience or honor.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warlock_soulsiphon.jpg"},[ct.GlyphOfCurseOfExhaustion]:{name:"Glyph of Curse of Exhaustion",description:"Curse of Exhaustion now reduces the targets movement speed by 30%, lasts half as long and has a 10 second cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_grimward.jpg"},[ct.GlyphOfDrainLife]:{name:"Glyph of Drain Life",description:"Increases the healing of your Drain Life by 30%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain02.jpg"},[ct.GlyphOfDemonHunting]:{name:"Glyph of Demon Hunting",description:"Requires Demonology.\r\n\r\n Teaches you the ability Dark Apotheosis.\r\n\r\n Dark Apotheosis\r\n You imbue yourself with demonic energies, reducing physical damage taken by 10.00%, reduces magic damage taken by 15%, and allows the use of various demonic abilities.\r\n\r\n In addition, Soulshatter becomes Provocation which taunts your target, Twilight Ward becomes Fury Ward which will absorb all schools of damage, Shadow Bolt becomes Demonic Slash, and Fear becomes Sleep.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_metamorphosis.jpg"},[ct.GlyphOfEmberTap]:{name:"Glyph of Ember Tap",description:"Ember Tap heals you for an additional 5% of your health, but the health is restored over 10 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_ember.jpg"},[ct.GlyphOfDemonicCircle]:{name:"Glyph of Demonic Circle",description:"Reduces the cooldown on Demonic Circle by 4 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demoniccircleteleport.jpg"},[ct.GlyphOfUnendingResolve]:{name:"Glyph of Unending Resolve",description:"The damage reduction of Unending Resolve is reduced by 20%, but the cooldown is reduced by 60 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonictactics.jpg"},[ct.GlyphOfLifeTap]:{name:"Glyph of Life Tap",description:"Your Life Tap no longer consumes health, but instead absorbs 0 healing received. This effect stacks.\r\n\r\n The absorb lasts 30 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_burningspirit.jpg"},[ct.GlyphOfEternalResolve]:{name:"Glyph of Eternal Resolve",description:"Outside of Battlegrounds and Arenas:\r\n Increases the duration of Unstable Affliction, Corruption, Doom, and Agony by 50%, and reduces their damage by 20%.\r\n\r\n Inside of Battlegrounds and Arenas:\r\n Unending Resolve can no longer be activated, but passively provides 10% damage reduction from all sources.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonictactics.jpg"},[ct.GlyphOfSupernova]:{name:"Glyph of Supernova",description:"When you are killed, all enemies within 8 yards take damage equal to 10% of your maximum health per Burning Ember held.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_ragnaros_supernova.jpg"}},minorGlyphs:{[rt.GlyphOfHandOfGuldan]:{name:"Glyph of Hand of Gul'dan",description:"Your Hand of Gul'dan can now be targeted at a location.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warlock_handofguldan.jpg"},[rt.GlyphOfVerdantSpheres]:{name:"Glyph of Verdant Spheres",description:"Your Soul Shards are transformed into Verdant Spheres.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_enchantedpearlb.jpg"},[rt.GlyphOfNightmares]:{name:"Glyph of Nightmares",description:"Your Felsteed and Dreadsteed can cross water while running and leave a trail of flames.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_mount_nightmarehorse.jpg"},[rt.GlyphOfFelguard]:{name:"Glyph of Felguard",description:"Your Felguard will equip a random two-handed axe, sword or polearm from your backpack.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_summonfelguard.jpg"},[rt.GlyphOfHealthFunnel]:{name:"Glyph of Health Funnel",description:"Your Health Funnel instantly restores 15% of your demon's health, but has a 10 sec. cooldown.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_lifedrain.jpg"},[rt.GlyphOfSubtlety]:{name:"Glyph of Subtlety",description:"Your Soul Shards no longer display while out of combat.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_masterofsubtlety.jpg"},[rt.GlyphOfShadowBolt]:{name:"Glyph of Shadow Bolt",description:"Splits your Shadow Bolt into three smaller attacks.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadowbolt.jpg"},[rt.GlyphOfCarrionSwarm]:{name:"Glyph of Carrion Swarm",description:"Your Carrion Swarm no longer knocks targets back.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warlock_demonicpower.jpg"},[rt.GlyphOfFallingMeteor]:{name:"Glyph of Falling Meteor",description:"If you use Demonic Leap while falling, you slam into the ground rapidly and will not die from falling damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_meteorstorm.jpg"},[rt.GlyphOfUnendingBreath]:{name:"Glyph of Unending Breath",description:"Increases the swim speed of targets affected by your Unending Breath spell by 20%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_demonbreath.jpg"},[rt.GlyphOfEyeOfKilrogg]:{name:"Glyph of Eye of Kilrogg",description:"Your Eye of Kilrogg is no longer stealthed and can now place your Demonic Circle. The casting Warlock must be within line of sight of the Eye of Kilrogg to place the Demonic Circle.\r\n\r\n In addition, the movement speed of your Eye of Kilrogg is increased by 50% and allows it to fly in areas where flying mounts are enabled.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_evileye.jpg"},[rt.GlyphOfSubjugateDemon]:{name:"Glyph of Subjugate Demon",description:"Reduces the cast time of your Subjugate Demon spell by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_enslavedemon.jpg"},[rt.GlyphOfSoulwell]:{name:"Glyph of Soulwell",description:"Your soulwell glows with an eerie light.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_shadesofdarkness.jpg"},[rt.GlyphOfCrimsonBanish]:{name:"Glyph of Crimson Banish",description:"Your Banish spell is now red.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_cripple.jpg"},[rt.GlyphOfGatewayAttunement]:{name:"Glyph of Gateway Attunement",description:"Demonic Gateways will automatically activate when you step near them.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_warlock_demonicportal_green.jpg"}}},Hl=kl({backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/cata/TODO.jpg",talents:[{fieldName:"juggernaut",fancyName:"Juggernaut",location:{rowIdx:0,colIdx:0},spellId:103826},{fieldName:"doubleTime",fancyName:"Double Time",location:{rowIdx:0,colIdx:1},spellId:103827},{fieldName:"warbringer",fancyName:"Warbringer",location:{rowIdx:0,colIdx:2},spellId:103828},{fieldName:"enragedRegeneration",fancyName:"Enraged Regeneration",location:{rowIdx:1,colIdx:0},spellId:55694},{fieldName:"secondWind",fancyName:"Second Wind",location:{rowIdx:1,colIdx:1},spellId:29838},{fieldName:"impendingVictory",fancyName:"Impending Victory",location:{rowIdx:1,colIdx:2},spellId:103840},{fieldName:"staggeringShout",fancyName:"Staggering Shout",location:{rowIdx:2,colIdx:0},spellId:107566},{fieldName:"piercingHowl",fancyName:"Piercing Howl",location:{rowIdx:2,colIdx:1},spellId:12323},{fieldName:"disruptingShout",fancyName:"Disrupting Shout",location:{rowIdx:2,colIdx:2},spellId:102060},{fieldName:"bladestorm",fancyName:"Bladestorm",location:{rowIdx:3,colIdx:0},spellId:46924},{fieldName:"shockwave",fancyName:"Shockwave",location:{rowIdx:3,colIdx:1},spellId:46968},{fieldName:"dragonRoar",fancyName:"Dragon Roar",location:{rowIdx:3,colIdx:2},spellId:118e3},{fieldName:"massSpellReflection",fancyName:"Mass Spell Reflection",location:{rowIdx:4,colIdx:0},spellId:114028},{fieldName:"safeguard",fancyName:"Safeguard",location:{rowIdx:4,colIdx:1},spellId:114029},{fieldName:"vigilance",fancyName:"Vigilance",location:{rowIdx:4,colIdx:2},spellId:114030},{fieldName:"avatar",fancyName:"Avatar",location:{rowIdx:5,colIdx:0},spellId:107574},{fieldName:"bloodbath",fancyName:"Bloodbath",location:{rowIdx:5,colIdx:1},spellId:12292},{fieldName:"stormBolt",fancyName:"Storm Bolt",location:{rowIdx:5,colIdx:2},spellId:107570}]}),ql={majorGlyphs:{[mt.GlyphOfLongCharge]:{name:"Glyph of Long Charge",description:"Increases the range of your Charge ability by 5 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_charge.jpg"},[mt.GlyphOfUnendingRage]:{name:"Glyph of Unending Rage",description:"Increases your maximum Rage by 20.0.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_intensifyrage.jpg"},[mt.GlyphOfEnragedSpeed]:{name:"Glyph of Enraged Speed",description:"While Enraged, you move 20% faster.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_racial_bloodrage.jpg"},[mt.GlyphOfHinderingStrikes]:{name:"Glyph of Hindering Strikes",description:"Your Heroic Strike and Cleave now also reduce the target's movement speed by 50% for 8s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_cleave.jpg"},[mt.GlyphOfHeavyRepercussions]:{name:"Glyph of Heavy Repercussions",description:"While your Shield Block is active, your Shield Slam hits for an additional 50% damage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_defend.jpg"},[mt.GlyphOfBloodthirst]:{name:"Glyph of Bloodthirst",description:"Increases the healing of Bloodthirst by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_bloodlust.jpg"},[mt.GlyphOfRudeInterruption]:{name:"Glyph of Rude Interruption",description:"Successfully interrupting a spell with Pummel increases your damage by 6% for 20s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_commandingshout.jpg"},[mt.GlyphOfGagOrder]:{name:"Glyph of Gag Order",description:"Your Pummel and Heroic Throw also silence the target for 3s. Does not work against players.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_axe_66.jpg"},[mt.GlyphOfBlitz]:{name:"Glyph of Blitz",description:"Your Charge also roots and snares an additional 2 nearby targets.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_victoryrush.jpg"},[mt.GlyphOfMortalStrike]:{name:"Glyph of Mortal Strike",description:"When your Mortal Strike is affecting a target, healing effects on you are increased by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_savageblow.jpg"},[mt.GlyphOfDieByTheSword]:{name:"Glyph of Die by the Sword",description:"While Die by the Sword is active, using Overpower increases its duration by 1 sec and using Wild Strike increases its duration by 0.5 sec per use.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_challange.jpg"},[mt.GlyphOfHamstring]:{name:"Glyph of Hamstring",description:"When you spend Rage to apply Hamstring, the Rage cost of your next Hamstring is reduced by 100%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_shockwave.jpg"},[mt.GlyphOfHoldTheLine]:{name:"Glyph of Hold the Line",description:"Improves the damage of your next Revenge by 50% following a successful parry.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_revenge.jpg"},[mt.GlyphOfShieldSlam]:{name:"Glyph of Shield Slam",description:"Your Shield Slam now dispels 1 magical effect.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_shield_05.jpg"},[mt.GlyphOfHoarseVoice]:{name:"Glyph of Hoarse Voice",description:"Reduces the cooldown and Rage generation of your Battle and Commanding Shout by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_battleshout.jpg"},[mt.GlyphOfSweepingStrikes]:{name:"Glyph of Sweeping Strikes",description:"When you hit a target with Sweeping Strikes, you gain 1.0 Rage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_slicedice.jpg"},[mt.GlyphOfResonatingPower]:{name:"Glyph of Resonating Power",description:"Increases the damage and cooldown of Thunder Clap by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_thunderclap.jpg"},[mt.GlyphOfVictoryRush]:{name:"Glyph of Victory Rush",description:"Increases the total healing provided by your Victory Rush by 50%.\r\n This glyph has no effect if combined with the Impending Victory talent.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_devastate.jpg"},[mt.GlyphOfRagingWind]:{name:"Glyph of Raging Wind",description:"Your Raging Blow hits increase the damage of your next Whirlwind by 10%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_hunter_swiftstrike.jpg"},[mt.GlyphOfWhirlwind]:{name:"Glyph of Whirlwind",description:"Increases the radius of Whirlwind by 4 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_whirlwind.jpg"},[mt.GlyphOfDeathFromAbove]:{name:"Glyph of Death From Above",description:"Reduces the cooldown on Heroic Leap by 15 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_heroicleap.jpg"},[mt.GlyphOfVictoriousThrow]:{name:"Glyph of Victorious Throw",description:"Increases the range of Victory Rush and Impending Victory by 15 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_warrior_wildstrike.jpg"},[mt.GlyphOfSpellReflection]:{name:"Glyph of Spell Reflection",description:"Reduces the cooldown on Spell Reflection by 5 sec.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shieldreflection.jpg"},[mt.GlyphOfShieldWall]:{name:"Glyph of Shield Wall",description:"Shield Wall now reduces damage taken by an additional 20%, but its cooldown is increased by 2 min.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shieldwall.jpg"},[mt.GlyphOfColossusSmash]:{name:"Glyph of Colossus Smash",description:"Your Colossus Smash also applies the Sunder Armor effect to your target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_colossussmash.jpg"},[mt.GlyphOfBullRush]:{name:"Glyph of Bull Rush",description:"Your Charge generates 15 additional Rage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/achievement_character_tauren_male.jpg"},[mt.GlyphOfRecklessness]:{name:"Glyph of Recklessness",description:"Decreases the critical chance of Recklessness by 12% but increases its duration by 50%.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_criticalstrike.jpg"},[mt.GlyphOfIncite]:{name:"Glyph of Incite",description:"Using Demoralizing Shout makes your next 3 Heroic Strike or Cleave abilities free.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_incite.jpg"},[mt.GlyphOfImpalingThrows]:{name:"Glyph of Impaling Throws",description:"Heroic Throw now leaves an axe in the target, which can be retrieved by moving within 5 yards of the target to finish the cooldown of Heroic Throw. This effect will only occur when Heroic Throw is cast from more than 10 yards away from the target.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_axe_05.jpg"},[mt.GlyphOfTheExecutor]:{name:"Glyph of the Executor",description:"Killing an enemy with Execute grants you 30 rage.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/warrior_talent_icon_lambstotheslaughter.jpg"}},minorGlyphs:{[ht.GlyphOfMysticShout]:{name:"Glyph of Mystic Shout",description:"Your Battle Shout and Commanding Shout cause you to hover in the air for 1s.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_battleshout.jpg"},[ht.GlyphOfBloodcurdlingShout]:{name:"Glyph of Bloodcurdling Shout",description:"Your Battle Shout and Commanding Shout terrify small animals.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_furiousresolve.jpg"},[ht.GlyphOfGushingWound]:{name:"Glyph of Gushing Wound",description:"Your Deep Wounds are even bloodier than normal.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_backstab.jpg"},[ht.GlyphOfMightyVictory]:{name:"Glyph of Mighty Victory",description:"When your Victory Rush or Impending Victory heal you, you grow slightly larger.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_devastate.jpg"},[ht.GlyphOfBloodyHealing]:{name:"Glyph of Bloody Healing",description:"Increases the healing you receive from bandages by 20% while your Deep Wounds is active.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_backstab.jpg"},[ht.GlyphOfIntimidatingShout]:{name:"Glyph of Intimidating Shout",description:"All targets of your Intimidating Shout now tremble in place instead of fleeing in fear.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_golemthunderclap.jpg"},[ht.GlyphOfThunderStrike]:{name:"Glyph of Thunder Strike",description:"Your Thunder Clap visual includes a lightning strike.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_thunderclap.jpg"},[ht.GlyphOfCrowFeast]:{name:"Glyph of Crow Feast",description:"Your Execute critical strikes summon a flock of carrion birds.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_sword_48.jpg"},[ht.GlyphOfBurningAnger]:{name:"Glyph of Burning Anger",description:"You get so angry when Enraged that you catch on fire.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_shadow_unholyfrenzy.jpg"},[ht.GlyphOfTheBlazingTrail]:{name:"Glyph of the Blazing Trail",description:"Your Charge leaves a trail of fire in its wake. If you're going to Charge why not do it with some style?",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_fire_burningspeed.jpg"},[ht.GlyphOfTheRagingWhirlwind]:{name:"Glyph of the Raging Whirlwind",description:"Whirlwind gives you 15 rage over 6s, but for that time you no longer generate rage from autoattacks.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/spell_nature_unleashedrage.jpg"},[ht.GlyphOfTheSubtleDefender]:{name:"Glyph of the Subtle Defender",description:"Removes the threat generation bonus from Defensive Stance.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_shieldguard.jpg"},[ht.GlyphOfTheWatchfulEye]:{name:"Glyph of the Watchful Eye",description:"Intervene will now target the party or raid member with the lowest health within 25 yards.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_rogue_bloodyeye.jpg"},[ht.GlyphOfTheWeaponmaster]:{name:"Glyph of the Weaponmaster",description:"Your Shout abilities cause the appearance of your weapon to change to that of a random weapon from your primary bag for 10min.",iconUrl:"https://wow.zamimg.com/images/wow/icons/large/ability_warrior_weaponmastery.jpg"}}},Yl={[v.ClassUnknown]:null,[v.ClassExtra1]:null,[v.ClassExtra2]:null,[v.ClassExtra3]:null,[v.ClassExtra4]:null,[v.ClassExtra5]:null,[v.ClassExtra6]:null,[v.ClassDeathKnight]:Cl,[v.ClassDruid]:xl,[v.ClassShaman]:Ml,[v.ClassHunter]:Pl,[v.ClassMage]:Dl,[v.ClassMonk]:Gl,[v.ClassRogue]:Fl,[v.ClassPaladin]:Ol,[v.ClassPriest]:Ll,[v.ClassWarlock]:jl,[v.ClassWarrior]:Hl},Kl={[v.ClassUnknown]:{majorGlyphs:[],minorGlyphs:[]},[v.ClassExtra1]:{majorGlyphs:[],minorGlyphs:[]},[v.ClassExtra2]:{majorGlyphs:[],minorGlyphs:[]},[v.ClassExtra3]:{majorGlyphs:[],minorGlyphs:[]},[v.ClassExtra4]:{majorGlyphs:[],minorGlyphs:[]},[v.ClassExtra5]:{majorGlyphs:[],minorGlyphs:[]},[v.ClassExtra6]:{majorGlyphs:[],minorGlyphs:[]},[v.ClassDeathKnight]:_l,[v.ClassDruid]:Tl,[v.ClassShaman]:zl,[v.ClassHunter]:Rl,[v.ClassMage]:Nl,[v.ClassMonk]:Ul,[v.ClassRogue]:Wl,[v.ClassPaladin]:Al,[v.ClassPriest]:Vl,[v.ClassWarlock]:Bl,[v.ClassWarrior]:ql};function $l(e,t){return function(e,t,a){const{talents:i}=a,s=t.split("").map(Number);return i.forEach(t=>{e[t.fieldName]=!1}),s.forEach((t,a)=>{const s=Number(t)-1,n=i.find(e=>e.location.rowIdx==a&&e.location.colIdx==s);n&&(e[n.fieldName]=!0)}),e}(dt[e.specID].talentsCreate(),t,Yl[e.classID])}class Jl extends ul{constructor(a,i){super(a,i,{title:"Addon Import",allowFileUpload:!0});const s=t();this.descriptionElem.appendChild(e(l,null,e("p",null,"Import settings from the"," ",e("a",{href:"https://www.curseforge.com/wow/addons/wowsimsexporter",target:"_blank"},"WoWSims Exporter In-Game Addon"),"."),e("p",null,"This feature imports gear, race, talents, glyphs, and professions. It does NOT import buffs, debuffs, consumes, rotation, or custom stats."),e("p",null,"To import, paste the output from the addon below and click, 'Import'."),e("div",{ref:s}))),s.value&&new No({title:"Reforging issues",body:e(l,null,"There are known issues with Reforging when using the WSE addon.",e("br",null),"Always make sure to double check your reforges after importing."),additionalClasses:["toast-import-warning"],container:s.value,variant:"warning",canClose:!1,autoShow:!0,autohide:!1})}async onImport(e){let t;try{t=JSON.parse(e)}catch{throw new Error("Please use a valid Addon export.")}const a=pt(t.class||"");if(a==v.ClassUnknown)throw new Error("Could not parse Class!");const i=ut(t.race||"");if(i==c.RaceUnknown)throw new Error("Could not parse Race!");const s=t.professions.map(e=>gt(e.name));s.forEach((e,a)=>{if(e==I.ProfessionUnknown)throw new Error(`Could not parse profession '${t.professions[a]}'`)});const n=t.talents||"",o=Kl[a],l=await We.get(),r=t.glyphs.major.map(e=>Zl(e,l,o.majorGlyphs)),h=t.glyphs.minor.map(e=>Zl(e,l,o.minorGlyphs)),m=E.create({major1:r[0]||0,major2:r[1]||0,major3:r[2]||0,minor1:h[0]||0,minor2:h[1]||0,minor3:h[2]||0}),d=t.gear;d.items=d.items.filter(e=>null!=e),delete d.version,d.items.forEach(e=>{e.gems&&(e.gems=e.gems.map(e=>e||0))});const p=S.fromJson(d);this.finishIndividualImport(this.simUI,{charClass:a,race:i,equipmentSpec:p,talentsStr:n,glyphs:m,professions:s})}}function Zl(e,t,a){return"string"==typeof e?function(e,t){if(!e)return 0;for(const a in t)if(t[a].name==e)return parseInt(a);throw new Error(`Unknown glyph name '${e}'`)}(e,a):t.glyphSpellToItemId(e.spellID)}class Ql extends ul{constructor(t,a){super(t,a,{title:"JSON Import",allowFileUpload:!0}),this.descriptionElem.appendChild(e(l,null,e("p",null,"Import settings from a JSON file, which can be created using the JSON Export feature."),e("p",null,"To import, upload the file or paste the text below, then click, 'Import'.")))}async onImport(e){let t=null;try{t=ft.fromJsonString(e,{ignoreUnknownFields:!0})}catch{throw new Error("Please use a valid JSON object.")}t.player?.equipment&&await We.loadLeftoversIfNecessary(t.player.equipment),this.simUI.isWithinRaidSim?t.player&&this.simUI.player.fromProto(Se.nextEventID(),t.player):this.simUI.fromProto(Se.nextEventID(),t),this.close()}}
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function Xl(e){let t=e.length;for(;--t>=0;)e[t]=0}const er=256,tr=286,ar=30,ir=15,sr=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),nr=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),or=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),lr=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),rr=new Array(576);Xl(rr);const cr=new Array(60);Xl(cr);const hr=new Array(512);Xl(hr);const mr=new Array(256);Xl(mr);const dr=new Array(29);Xl(dr);const pr=new Array(ar);function ur(e,t,a,i,s){this.static_tree=e,this.extra_bits=t,this.extra_base=a,this.elems=i,this.max_length=s,this.has_stree=e&&e.length}let gr,fr,wr;function yr(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Xl(pr);const br=e=>e<256?hr[e]:hr[256+(e>>>7)],Sr=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},vr=(e,t,a)=>{e.bi_valid>16-a?(e.bi_buf|=t<<e.bi_valid&65535,Sr(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=a-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=a)},Ir=(e,t,a)=>{vr(e,a[2*t],a[2*t+1])},Er=(e,t)=>{let a=0;do{a|=1&e,e>>>=1,a<<=1}while(--t>0);return a>>>1},kr=(e,t,a)=>{const i=new Array(16);let s,n,o=0;for(s=1;s<=ir;s++)o=o+a[s-1]<<1,i[s]=o;for(n=0;n<=t;n++){let t=e[2*n+1];0!==t&&(e[2*n]=Er(i[t]++,t))}},Cr=e=>{let t;for(t=0;t<tr;t++)e.dyn_ltree[2*t]=0;for(t=0;t<ar;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},_r=e=>{e.bi_valid>8?Sr(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},xr=(e,t,a,i)=>{const s=2*t,n=2*a;return e[s]<e[n]||e[s]===e[n]&&i[t]<=i[a]},Tr=(e,t,a)=>{const i=e.heap[a];let s=a<<1;for(;s<=e.heap_len&&(s<e.heap_len&&xr(t,e.heap[s+1],e.heap[s],e.depth)&&s++,!xr(t,i,e.heap[s],e.depth));)e.heap[a]=e.heap[s],a=s,s<<=1;e.heap[a]=i},Pr=(e,t,a)=>{let i,s,n,o,l=0;if(0!==e.sym_next)do{i=255&e.pending_buf[e.sym_buf+l++],i+=(255&e.pending_buf[e.sym_buf+l++])<<8,s=e.pending_buf[e.sym_buf+l++],0===i?Ir(e,s,t):(n=mr[s],Ir(e,n+er+1,t),o=sr[n],0!==o&&(s-=dr[n],vr(e,s,o)),i--,n=br(i),Ir(e,n,a),o=nr[n],0!==o&&(i-=pr[n],vr(e,i,o)))}while(l<e.sym_next);Ir(e,256,t)},Rr=(e,t)=>{const a=t.dyn_tree,i=t.stat_desc.static_tree,s=t.stat_desc.has_stree,n=t.stat_desc.elems;let o,l,r,c=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<n;o++)0!==a[2*o]?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):a[2*o+1]=0;for(;e.heap_len<2;)r=e.heap[++e.heap_len]=c<2?++c:0,a[2*r]=1,e.depth[r]=0,e.opt_len--,s&&(e.static_len-=i[2*r+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)Tr(e,a,o);r=n;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],Tr(e,a,1),l=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=l,a[2*r]=a[2*o]+a[2*l],e.depth[r]=(e.depth[o]>=e.depth[l]?e.depth[o]:e.depth[l])+1,a[2*o+1]=a[2*l+1]=r,e.heap[1]=r++,Tr(e,a,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const a=t.dyn_tree,i=t.max_code,s=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,r=t.stat_desc.max_length;let c,h,m,d,p,u,g=0;for(d=0;d<=ir;d++)e.bl_count[d]=0;for(a[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)h=e.heap[c],d=a[2*a[2*h+1]+1]+1,d>r&&(d=r,g++),a[2*h+1]=d,h>i||(e.bl_count[d]++,p=0,h>=l&&(p=o[h-l]),u=a[2*h],e.opt_len+=u*(d+p),n&&(e.static_len+=u*(s[2*h+1]+p)));if(0!==g){do{for(d=r-1;0===e.bl_count[d];)d--;e.bl_count[d]--,e.bl_count[d+1]+=2,e.bl_count[r]--,g-=2}while(g>0);for(d=r;0!==d;d--)for(h=e.bl_count[d];0!==h;)m=e.heap[--c],m>i||(a[2*m+1]!==d&&(e.opt_len+=(d-a[2*m+1])*a[2*m],a[2*m+1]=d),h--)}})(e,t),kr(a,c,e.bl_count)},Dr=(e,t,a)=>{let i,s,n=-1,o=t[1],l=0,r=7,c=4;for(0===o&&(r=138,c=3),t[2*(a+1)+1]=65535,i=0;i<=a;i++)s=o,o=t[2*(i+1)+1],++l<r&&s===o||(l<c?e.bl_tree[2*s]+=l:0!==s?(s!==n&&e.bl_tree[2*s]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,n=s,0===o?(r=138,c=3):s===o?(r=6,c=3):(r=7,c=4))},Nr=(e,t,a)=>{let i,s,n=-1,o=t[1],l=0,r=7,c=4;for(0===o&&(r=138,c=3),i=0;i<=a;i++)if(s=o,o=t[2*(i+1)+1],!(++l<r&&s===o)){if(l<c)do{Ir(e,s,e.bl_tree)}while(0!==--l);else 0!==s?(s!==n&&(Ir(e,s,e.bl_tree),l--),Ir(e,16,e.bl_tree),vr(e,l-3,2)):l<=10?(Ir(e,17,e.bl_tree),vr(e,l-3,3)):(Ir(e,18,e.bl_tree),vr(e,l-11,7));l=0,n=s,0===o?(r=138,c=3):s===o?(r=6,c=3):(r=7,c=4)}};let Gr=!1;const Ur=(e,t,a,i)=>{vr(e,0+(i?1:0),3),_r(e),Sr(e,a),Sr(e,~a),a&&e.pending_buf.set(e.window.subarray(t,t+a),e.pending),e.pending+=a};var Or={_tr_init:e=>{Gr||((()=>{let e,t,a,i,s;const n=new Array(16);for(a=0,i=0;i<28;i++)for(dr[i]=a,e=0;e<1<<sr[i];e++)mr[a++]=i;for(mr[a-1]=i,s=0,i=0;i<16;i++)for(pr[i]=s,e=0;e<1<<nr[i];e++)hr[s++]=i;for(s>>=7;i<ar;i++)for(pr[i]=s<<7,e=0;e<1<<nr[i]-7;e++)hr[256+s++]=i;for(t=0;t<=ir;t++)n[t]=0;for(e=0;e<=143;)rr[2*e+1]=8,e++,n[8]++;for(;e<=255;)rr[2*e+1]=9,e++,n[9]++;for(;e<=279;)rr[2*e+1]=7,e++,n[7]++;for(;e<=287;)rr[2*e+1]=8,e++,n[8]++;for(kr(rr,287,n),e=0;e<ar;e++)cr[2*e+1]=5,cr[2*e]=Er(e,5);gr=new ur(rr,sr,257,tr,ir),fr=new ur(cr,nr,0,ar,ir),wr=new ur(new Array(0),or,0,19,7)})(),Gr=!0),e.l_desc=new yr(e.dyn_ltree,gr),e.d_desc=new yr(e.dyn_dtree,fr),e.bl_desc=new yr(e.bl_tree,wr),e.bi_buf=0,e.bi_valid=0,Cr(e)},_tr_stored_block:Ur,_tr_flush_block:(e,t,a,i)=>{let s,n,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,a=4093624447;for(t=0;t<=31;t++,a>>>=1)if(1&a&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<er;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),Rr(e,e.l_desc),Rr(e,e.d_desc),o=(e=>{let t;for(Dr(e,e.dyn_ltree,e.l_desc.max_code),Dr(e,e.dyn_dtree,e.d_desc.max_code),Rr(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*lr[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),s=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=s&&(s=n)):s=n=a+5,a+4<=s&&-1!==t?Ur(e,t,a,i):4===e.strategy||n===s?(vr(e,2+(i?1:0),3),Pr(e,rr,cr)):(vr(e,4+(i?1:0),3),((e,t,a,i)=>{let s;for(vr(e,t-257,5),vr(e,a-1,5),vr(e,i-4,4),s=0;s<i;s++)vr(e,e.bl_tree[2*lr[s]+1],3);Nr(e,e.dyn_ltree,t-1),Nr(e,e.dyn_dtree,a-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),Pr(e,e.dyn_ltree,e.dyn_dtree)),Cr(e),i&&_r(e)},_tr_tally:(e,t,a)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=a,0===t?e.dyn_ltree[2*a]++:(e.matches++,t--,e.dyn_ltree[2*(mr[a]+er+1)]++,e.dyn_dtree[2*br(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{vr(e,2,3),Ir(e,256,rr),(e=>{16===e.bi_valid?(Sr(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var Ar=(e,t,a,i)=>{let s=65535&e,n=e>>>16&65535,o=0;for(;0!==a;){o=a>2e3?2e3:a,a-=o;do{s=s+t[i++]|0,n=n+s|0}while(--o);s%=65521,n%=65521}return s|n<<16};const Lr=new Uint32Array((()=>{let e,t=[];for(var a=0;a<256;a++){e=a;for(var i=0;i<8;i++)e=1&e?3988292384^e>>>1:e>>>1;t[a]=e}return t})());var Vr=(e,t,a,i)=>{const s=Lr,n=i+a;e^=-1;for(let o=i;o<n;o++)e=e>>>8^s[255&(e^t[o])];return-1^e},Fr={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Wr={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Mr,_tr_stored_block:zr,_tr_flush_block:jr,_tr_tally:Br,_tr_align:Hr}=Or,{Z_NO_FLUSH:qr,Z_PARTIAL_FLUSH:Yr,Z_FULL_FLUSH:Kr,Z_FINISH:$r,Z_BLOCK:Jr,Z_OK:Zr,Z_STREAM_END:Qr,Z_STREAM_ERROR:Xr,Z_DATA_ERROR:ec,Z_BUF_ERROR:tc,Z_DEFAULT_COMPRESSION:ac,Z_FILTERED:ic,Z_HUFFMAN_ONLY:sc,Z_RLE:nc,Z_FIXED:oc,Z_DEFAULT_STRATEGY:lc,Z_UNKNOWN:rc,Z_DEFLATED:cc}=Wr,hc=258,mc=262,dc=42,pc=113,uc=666,gc=(e,t)=>(e.msg=Fr[t],t),fc=e=>2*e-(e>4?9:0),wc=e=>{let t=e.length;for(;--t>=0;)e[t]=0},yc=e=>{let t,a,i,s=e.w_size;t=e.hash_size,i=t;do{a=e.head[--i],e.head[i]=a>=s?a-s:0}while(--t);t=s,i=t;do{a=e.prev[--i],e.prev[i]=a>=s?a-s:0}while(--t)};let bc=(e,t,a)=>(t<<e.hash_shift^a)&e.hash_mask;const Sc=e=>{const t=e.state;let a=t.pending;a>e.avail_out&&(a=e.avail_out),0!==a&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+a),e.next_out),e.next_out+=a,t.pending_out+=a,e.total_out+=a,e.avail_out-=a,t.pending-=a,0===t.pending&&(t.pending_out=0))},vc=(e,t)=>{jr(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Sc(e.strm)},Ic=(e,t)=>{e.pending_buf[e.pending++]=t},Ec=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},kc=(e,t,a,i)=>{let s=e.avail_in;return s>i&&(s=i),0===s?0:(e.avail_in-=s,t.set(e.input.subarray(e.next_in,e.next_in+s),a),1===e.state.wrap?e.adler=Ar(e.adler,t,s,a):2===e.state.wrap&&(e.adler=Vr(e.adler,t,s,a)),e.next_in+=s,e.total_in+=s,s)},Cc=(e,t)=>{let a,i,s=e.max_chain_length,n=e.strstart,o=e.prev_length,l=e.nice_match;const r=e.strstart>e.w_size-mc?e.strstart-(e.w_size-mc):0,c=e.window,h=e.w_mask,m=e.prev,d=e.strstart+hc;let p=c[n+o-1],u=c[n+o];e.prev_length>=e.good_match&&(s>>=2),l>e.lookahead&&(l=e.lookahead);do{if(a=t,c[a+o]===u&&c[a+o-1]===p&&c[a]===c[n]&&c[++a]===c[n+1]){n+=2,a++;do{}while(c[++n]===c[++a]&&c[++n]===c[++a]&&c[++n]===c[++a]&&c[++n]===c[++a]&&c[++n]===c[++a]&&c[++n]===c[++a]&&c[++n]===c[++a]&&c[++n]===c[++a]&&n<d);if(i=hc-(d-n),n=d-hc,i>o){if(e.match_start=t,o=i,i>=l)break;p=c[n+o-1],u=c[n+o]}}}while((t=m[t&h])>r&&0!==--s);return o<=e.lookahead?o:e.lookahead},_c=e=>{const t=e.w_size;let a,i,s;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-mc)&&(e.window.set(e.window.subarray(t,t+t-i),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),yc(e),i+=t),0===e.strm.avail_in)break;if(a=kc(e.strm,e.window,e.strstart+e.lookahead,i),e.lookahead+=a,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=bc(e,e.ins_h,e.window[s+1]);e.insert&&(e.ins_h=bc(e,e.ins_h,e.window[s+3-1]),e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<mc&&0!==e.strm.avail_in)},xc=(e,t)=>{let a,i,s,n=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,l=e.strm.avail_in;do{if(a=65535,s=e.bi_valid+42>>3,e.strm.avail_out<s)break;if(s=e.strm.avail_out-s,i=e.strstart-e.block_start,a>i+e.strm.avail_in&&(a=i+e.strm.avail_in),a>s&&(a=s),a<n&&(0===a&&t!==$r||t===qr||a!==i+e.strm.avail_in))break;o=t===$r&&a===i+e.strm.avail_in?1:0,zr(e,0,0,o),e.pending_buf[e.pending-4]=a,e.pending_buf[e.pending-3]=a>>8,e.pending_buf[e.pending-2]=~a,e.pending_buf[e.pending-1]=~a>>8,Sc(e.strm),i&&(i>a&&(i=a),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+i),e.strm.next_out),e.strm.next_out+=i,e.strm.avail_out-=i,e.strm.total_out+=i,e.block_start+=i,a-=i),a&&(kc(e.strm,e.strm.output,e.strm.next_out,a),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a)}while(0===o);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==qr&&t!==$r&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(s=e.window_size-e.strstart,e.strm.avail_in>s&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,s+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),s>e.strm.avail_in&&(s=e.strm.avail_in),s&&(kc(e.strm,e.window,e.strstart,s),e.strstart+=s,e.insert+=s>e.w_size-e.insert?e.w_size-e.insert:s),e.high_water<e.strstart&&(e.high_water=e.strstart),s=e.bi_valid+42>>3,s=e.pending_buf_size-s>65535?65535:e.pending_buf_size-s,n=s>e.w_size?e.w_size:s,i=e.strstart-e.block_start,(i>=n||(i||t===$r)&&t!==qr&&0===e.strm.avail_in&&i<=s)&&(a=i>s?s:i,o=t===$r&&0===e.strm.avail_in&&a===i?1:0,zr(e,e.block_start,a,o),e.block_start+=a,Sc(e.strm)),o?3:1)},Tc=(e,t)=>{let a,i;for(;;){if(e.lookahead<mc){if(_c(e),e.lookahead<mc&&t===qr)return 1;if(0===e.lookahead)break}if(a=0,e.lookahead>=3&&(e.ins_h=bc(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==a&&e.strstart-a<=e.w_size-mc&&(e.match_length=Cc(e,a)),e.match_length>=3)if(i=Br(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=bc(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!==--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=bc(e,e.ins_h,e.window[e.strstart+1]);else i=Br(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(i&&(vc(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===$r?(vc(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(vc(e,!1),0===e.strm.avail_out)?1:2},Pc=(e,t)=>{let a,i,s;for(;;){if(e.lookahead<mc){if(_c(e),e.lookahead<mc&&t===qr)return 1;if(0===e.lookahead)break}if(a=0,e.lookahead>=3&&(e.ins_h=bc(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==a&&e.prev_length<e.max_lazy_match&&e.strstart-a<=e.w_size-mc&&(e.match_length=Cc(e,a),e.match_length<=5&&(e.strategy===ic||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){s=e.strstart+e.lookahead-3,i=Br(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=s&&(e.ins_h=bc(e,e.ins_h,e.window[e.strstart+3-1]),a=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!==--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,i&&(vc(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(i=Br(e,0,e.window[e.strstart-1]),i&&vc(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(i=Br(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===$r?(vc(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(vc(e,!1),0===e.strm.avail_out)?1:2};function Rc(e,t,a,i,s){this.good_length=e,this.max_lazy=t,this.nice_length=a,this.max_chain=i,this.func=s}const Dc=[new Rc(0,0,0,0,xc),new Rc(4,4,8,4,Tc),new Rc(4,5,16,8,Tc),new Rc(4,6,32,32,Tc),new Rc(4,4,16,16,Pc),new Rc(8,16,32,32,Pc),new Rc(8,16,128,128,Pc),new Rc(8,32,128,256,Pc),new Rc(32,128,258,1024,Pc),new Rc(32,258,258,4096,Pc)];function Nc(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=cc,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),wc(this.dyn_ltree),wc(this.dyn_dtree),wc(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),wc(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),wc(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const Gc=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==dc&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==pc&&t.status!==uc?1:0},Uc=e=>{if(Gc(e))return gc(e,Xr);e.total_in=e.total_out=0,e.data_type=rc;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?dc:pc,e.adler=2===t.wrap?0:1,t.last_flush=-2,Mr(t),Zr},Oc=e=>{const t=Uc(e);var a;return t===Zr&&((a=e.state).window_size=2*a.w_size,wc(a.head),a.max_lazy_match=Dc[a.level].max_lazy,a.good_match=Dc[a.level].good_length,a.nice_match=Dc[a.level].nice_length,a.max_chain_length=Dc[a.level].max_chain,a.strstart=0,a.block_start=0,a.lookahead=0,a.insert=0,a.match_length=a.prev_length=2,a.match_available=0,a.ins_h=0),t},Ac=(e,t,a,i,s,n)=>{if(!e)return Xr;let o=1;if(t===ac&&(t=6),i<0?(o=0,i=-i):i>15&&(o=2,i-=16),s<1||s>9||a!==cc||i<8||i>15||t<0||t>9||n<0||n>oc||8===i&&1!==o)return gc(e,Xr);8===i&&(i=9);const l=new Nc;return e.state=l,l.strm=e,l.status=dc,l.wrap=o,l.gzhead=null,l.w_bits=i,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=s+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<s+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=t,l.strategy=n,l.method=a,Oc(e)};var Lc={deflateInit:(e,t)=>Ac(e,t,cc,15,8,lc),deflateInit2:Ac,deflateReset:Oc,deflateResetKeep:Uc,deflateSetHeader:(e,t)=>Gc(e)||2!==e.state.wrap?Xr:(e.state.gzhead=t,Zr),deflate:(e,t)=>{if(Gc(e)||t>Jr||t<0)return e?gc(e,Xr):Xr;const a=e.state;if(!e.output||0!==e.avail_in&&!e.input||a.status===uc&&t!==$r)return gc(e,0===e.avail_out?tc:Xr);const i=a.last_flush;if(a.last_flush=t,0!==a.pending){if(Sc(e),0===e.avail_out)return a.last_flush=-1,Zr}else if(0===e.avail_in&&fc(t)<=fc(i)&&t!==$r)return gc(e,tc);if(a.status===uc&&0!==e.avail_in)return gc(e,tc);if(a.status===dc&&0===a.wrap&&(a.status=pc),a.status===dc){let t=cc+(a.w_bits-8<<4)<<8,i=-1;if(i=a.strategy>=sc||a.level<2?0:a.level<6?1:6===a.level?2:3,t|=i<<6,0!==a.strstart&&(t|=32),t+=31-t%31,Ec(a,t),0!==a.strstart&&(Ec(a,e.adler>>>16),Ec(a,65535&e.adler)),e.adler=1,a.status=pc,Sc(e),0!==a.pending)return a.last_flush=-1,Zr}if(57===a.status)if(e.adler=0,Ic(a,31),Ic(a,139),Ic(a,8),a.gzhead)Ic(a,(a.gzhead.text?1:0)+(a.gzhead.hcrc?2:0)+(a.gzhead.extra?4:0)+(a.gzhead.name?8:0)+(a.gzhead.comment?16:0)),Ic(a,255&a.gzhead.time),Ic(a,a.gzhead.time>>8&255),Ic(a,a.gzhead.time>>16&255),Ic(a,a.gzhead.time>>24&255),Ic(a,9===a.level?2:a.strategy>=sc||a.level<2?4:0),Ic(a,255&a.gzhead.os),a.gzhead.extra&&a.gzhead.extra.length&&(Ic(a,255&a.gzhead.extra.length),Ic(a,a.gzhead.extra.length>>8&255)),a.gzhead.hcrc&&(e.adler=Vr(e.adler,a.pending_buf,a.pending,0)),a.gzindex=0,a.status=69;else if(Ic(a,0),Ic(a,0),Ic(a,0),Ic(a,0),Ic(a,0),Ic(a,9===a.level?2:a.strategy>=sc||a.level<2?4:0),Ic(a,3),a.status=pc,Sc(e),0!==a.pending)return a.last_flush=-1,Zr;if(69===a.status){if(a.gzhead.extra){let t=a.pending,i=(65535&a.gzhead.extra.length)-a.gzindex;for(;a.pending+i>a.pending_buf_size;){let s=a.pending_buf_size-a.pending;if(a.pending_buf.set(a.gzhead.extra.subarray(a.gzindex,a.gzindex+s),a.pending),a.pending=a.pending_buf_size,a.gzhead.hcrc&&a.pending>t&&(e.adler=Vr(e.adler,a.pending_buf,a.pending-t,t)),a.gzindex+=s,Sc(e),0!==a.pending)return a.last_flush=-1,Zr;t=0,i-=s}let s=new Uint8Array(a.gzhead.extra);a.pending_buf.set(s.subarray(a.gzindex,a.gzindex+i),a.pending),a.pending+=i,a.gzhead.hcrc&&a.pending>t&&(e.adler=Vr(e.adler,a.pending_buf,a.pending-t,t)),a.gzindex=0}a.status=73}if(73===a.status){if(a.gzhead.name){let t,i=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>i&&(e.adler=Vr(e.adler,a.pending_buf,a.pending-i,i)),Sc(e),0!==a.pending)return a.last_flush=-1,Zr;i=0}t=a.gzindex<a.gzhead.name.length?255&a.gzhead.name.charCodeAt(a.gzindex++):0,Ic(a,t)}while(0!==t);a.gzhead.hcrc&&a.pending>i&&(e.adler=Vr(e.adler,a.pending_buf,a.pending-i,i)),a.gzindex=0}a.status=91}if(91===a.status){if(a.gzhead.comment){let t,i=a.pending;do{if(a.pending===a.pending_buf_size){if(a.gzhead.hcrc&&a.pending>i&&(e.adler=Vr(e.adler,a.pending_buf,a.pending-i,i)),Sc(e),0!==a.pending)return a.last_flush=-1,Zr;i=0}t=a.gzindex<a.gzhead.comment.length?255&a.gzhead.comment.charCodeAt(a.gzindex++):0,Ic(a,t)}while(0!==t);a.gzhead.hcrc&&a.pending>i&&(e.adler=Vr(e.adler,a.pending_buf,a.pending-i,i))}a.status=103}if(103===a.status){if(a.gzhead.hcrc){if(a.pending+2>a.pending_buf_size&&(Sc(e),0!==a.pending))return a.last_flush=-1,Zr;Ic(a,255&e.adler),Ic(a,e.adler>>8&255),e.adler=0}if(a.status=pc,Sc(e),0!==a.pending)return a.last_flush=-1,Zr}if(0!==e.avail_in||0!==a.lookahead||t!==qr&&a.status!==uc){let i=0===a.level?xc(a,t):a.strategy===sc?((e,t)=>{let a;for(;;){if(0===e.lookahead&&(_c(e),0===e.lookahead)){if(t===qr)return 1;break}if(e.match_length=0,a=Br(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,a&&(vc(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===$r?(vc(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(vc(e,!1),0===e.strm.avail_out)?1:2})(a,t):a.strategy===nc?((e,t)=>{let a,i,s,n;const o=e.window;for(;;){if(e.lookahead<=hc){if(_c(e),e.lookahead<=hc&&t===qr)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(s=e.strstart-1,i=o[s],i===o[++s]&&i===o[++s]&&i===o[++s])){n=e.strstart+hc;do{}while(i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&i===o[++s]&&s<n);e.match_length=hc-(n-s),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(a=Br(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(a=Br(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),a&&(vc(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===$r?(vc(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(vc(e,!1),0===e.strm.avail_out)?1:2})(a,t):Dc[a.level].func(a,t);if(3!==i&&4!==i||(a.status=uc),1===i||3===i)return 0===e.avail_out&&(a.last_flush=-1),Zr;if(2===i&&(t===Yr?Hr(a):t!==Jr&&(zr(a,0,0,!1),t===Kr&&(wc(a.head),0===a.lookahead&&(a.strstart=0,a.block_start=0,a.insert=0))),Sc(e),0===e.avail_out))return a.last_flush=-1,Zr}return t!==$r?Zr:a.wrap<=0?Qr:(2===a.wrap?(Ic(a,255&e.adler),Ic(a,e.adler>>8&255),Ic(a,e.adler>>16&255),Ic(a,e.adler>>24&255),Ic(a,255&e.total_in),Ic(a,e.total_in>>8&255),Ic(a,e.total_in>>16&255),Ic(a,e.total_in>>24&255)):(Ec(a,e.adler>>>16),Ec(a,65535&e.adler)),Sc(e),a.wrap>0&&(a.wrap=-a.wrap),0!==a.pending?Zr:Qr)},deflateEnd:e=>{if(Gc(e))return Xr;const t=e.state.status;return e.state=null,t===pc?gc(e,ec):Zr},deflateSetDictionary:(e,t)=>{let a=t.length;if(Gc(e))return Xr;const i=e.state,s=i.wrap;if(2===s||1===s&&i.status!==dc||i.lookahead)return Xr;if(1===s&&(e.adler=Ar(e.adler,t,a,0)),i.wrap=0,a>=i.w_size){0===s&&(wc(i.head),i.strstart=0,i.block_start=0,i.insert=0);let e=new Uint8Array(i.w_size);e.set(t.subarray(a-i.w_size,a),0),t=e,a=i.w_size}const n=e.avail_in,o=e.next_in,l=e.input;for(e.avail_in=a,e.next_in=0,e.input=t,_c(i);i.lookahead>=3;){let e=i.strstart,t=i.lookahead-2;do{i.ins_h=bc(i,i.ins_h,i.window[e+3-1]),i.prev[e&i.w_mask]=i.head[i.ins_h],i.head[i.ins_h]=e,e++}while(--t);i.strstart=e,i.lookahead=2,_c(i)}return i.strstart+=i.lookahead,i.block_start=i.strstart,i.insert=i.lookahead,i.lookahead=0,i.match_length=i.prev_length=2,i.match_available=0,e.next_in=o,e.input=l,e.avail_in=n,i.wrap=s,Zr},deflateInfo:"pako deflate (from Nodeca project)"};const Vc=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Fc=function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const a=t.shift();if(a){if("object"!=typeof a)throw new TypeError(a+"must be non-object");for(const t in a)Vc(a,t)&&(e[t]=a[t])}}return e},Wc=e=>{let t=0;for(let i=0,s=e.length;i<s;i++)t+=e[i].length;const a=new Uint8Array(t);for(let i=0,s=0,n=e.length;i<n;i++){let t=e[i];a.set(t,s),s+=t.length}return a};let Mc=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(Ng){Mc=!1}const zc=new Uint8Array(256);for(let Gg=0;Gg<256;Gg++)zc[Gg]=Gg>=252?6:Gg>=248?5:Gg>=240?4:Gg>=224?3:Gg>=192?2:1;zc[254]=zc[254]=1;var jc=e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,a,i,s,n,o=e.length,l=0;for(s=0;s<o;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<o&&(i=e.charCodeAt(s+1),56320==(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),s++)),l+=a<128?1:a<2048?2:a<65536?3:4;for(t=new Uint8Array(l),n=0,s=0;n<l;s++)a=e.charCodeAt(s),55296==(64512&a)&&s+1<o&&(i=e.charCodeAt(s+1),56320==(64512&i)&&(a=65536+(a-55296<<10)+(i-56320),s++)),a<128?t[n++]=a:a<2048?(t[n++]=192|a>>>6,t[n++]=128|63&a):a<65536?(t[n++]=224|a>>>12,t[n++]=128|a>>>6&63,t[n++]=128|63&a):(t[n++]=240|a>>>18,t[n++]=128|a>>>12&63,t[n++]=128|a>>>6&63,t[n++]=128|63&a);return t},Bc=(e,t)=>{const a=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let i,s;const n=new Array(2*a);for(s=0,i=0;i<a;){let t=e[i++];if(t<128){n[s++]=t;continue}let o=zc[t];if(o>4)n[s++]=65533,i+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&i<a;)t=t<<6|63&e[i++],o--;o>1?n[s++]=65533:t<65536?n[s++]=t:(t-=65536,n[s++]=55296|t>>10&1023,n[s++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&Mc)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let a="";for(let i=0;i<t;i++)a+=String.fromCharCode(e[i]);return a})(n,s)},Hc=(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let a=t-1;for(;a>=0&&128==(192&e[a]);)a--;return a<0||0===a?t:a+zc[e[a]]>t?a:t};var qc=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Yc=Object.prototype.toString,{Z_NO_FLUSH:Kc,Z_SYNC_FLUSH:$c,Z_FULL_FLUSH:Jc,Z_FINISH:Zc,Z_OK:Qc,Z_STREAM_END:Xc,Z_DEFAULT_COMPRESSION:eh,Z_DEFAULT_STRATEGY:th,Z_DEFLATED:ah}=Wr;function ih(e){this.options=Fc({level:eh,method:ah,chunkSize:16384,windowBits:15,memLevel:8,strategy:th},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qc,this.strm.avail_out=0;let a=Lc.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(a!==Qc)throw new Error(Fr[a]);if(t.header&&Lc.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?jc(t.dictionary):"[object ArrayBuffer]"===Yc.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,a=Lc.deflateSetDictionary(this.strm,e),a!==Qc)throw new Error(Fr[a]);this._dict_set=!0}}function sh(e,t){const a=new ih(t);if(a.push(e,!0),a.err)throw a.msg||Fr[a.err];return a.result}ih.prototype.push=function(e,t){const a=this.strm,i=this.options.chunkSize;let s,n;if(this.ended)return!1;for(n=t===~~t?t:!0===t?Zc:Kc,"string"==typeof e?a.input=jc(e):"[object ArrayBuffer]"===Yc.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;)if(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),(n===$c||n===Jc)&&a.avail_out<=6)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else{if(s=Lc.deflate(a,n),s===Xc)return a.next_out>0&&this.onData(a.output.subarray(0,a.next_out)),s=Lc.deflateEnd(this.strm),this.onEnd(s),this.ended=!0,s===Qc;if(0!==a.avail_out){if(n>0&&a.next_out>0)this.onData(a.output.subarray(0,a.next_out)),a.avail_out=0;else if(0===a.avail_in)break}else this.onData(a.output)}return!0},ih.prototype.onData=function(e){this.chunks.push(e)},ih.prototype.onEnd=function(e){e===Qc&&(this.result=Wc(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var nh={Deflate:ih,deflate:sh,deflateRaw:function(e,t){return(t=t||{}).raw=!0,sh(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,sh(e,t)}};const oh=16209;var lh=function(e,t){let a,i,s,n,o,l,r,c,h,m,d,p,u,g,f,w,y,b,S,v,I,E,k,C;const _=e.state;a=e.next_in,k=e.input,i=a+(e.avail_in-5),s=e.next_out,C=e.output,n=s-(t-e.avail_out),o=s+(e.avail_out-257),l=_.dmax,r=_.wsize,c=_.whave,h=_.wnext,m=_.window,d=_.hold,p=_.bits,u=_.lencode,g=_.distcode,f=(1<<_.lenbits)-1,w=(1<<_.distbits)-1;e:do{p<15&&(d+=k[a++]<<p,p+=8,d+=k[a++]<<p,p+=8),y=u[d&f];t:for(;;){if(b=y>>>24,d>>>=b,p-=b,b=y>>>16&255,0===b)C[s++]=65535&y;else{if(!(16&b)){if(64&b){if(32&b){_.mode=16191;break e}e.msg="invalid literal/length code",_.mode=oh;break e}y=u[(65535&y)+(d&(1<<b)-1)];continue t}for(S=65535&y,b&=15,b&&(p<b&&(d+=k[a++]<<p,p+=8),S+=d&(1<<b)-1,d>>>=b,p-=b),p<15&&(d+=k[a++]<<p,p+=8,d+=k[a++]<<p,p+=8),y=g[d&w];;){if(b=y>>>24,d>>>=b,p-=b,b=y>>>16&255,16&b){if(v=65535&y,b&=15,p<b&&(d+=k[a++]<<p,p+=8,p<b&&(d+=k[a++]<<p,p+=8)),v+=d&(1<<b)-1,v>l){e.msg="invalid distance too far back",_.mode=oh;break e}if(d>>>=b,p-=b,b=s-n,v>b){if(b=v-b,b>c&&_.sane){e.msg="invalid distance too far back",_.mode=oh;break e}if(I=0,E=m,0===h){if(I+=r-b,b<S){S-=b;do{C[s++]=m[I++]}while(--b);I=s-v,E=C}}else if(h<b){if(I+=r+h-b,b-=h,b<S){S-=b;do{C[s++]=m[I++]}while(--b);if(I=0,h<S){b=h,S-=b;do{C[s++]=m[I++]}while(--b);I=s-v,E=C}}}else if(I+=h-b,b<S){S-=b;do{C[s++]=m[I++]}while(--b);I=s-v,E=C}for(;S>2;)C[s++]=E[I++],C[s++]=E[I++],C[s++]=E[I++],S-=3;S&&(C[s++]=E[I++],S>1&&(C[s++]=E[I++]))}else{I=s-v;do{C[s++]=C[I++],C[s++]=C[I++],C[s++]=C[I++],S-=3}while(S>2);S&&(C[s++]=C[I++],S>1&&(C[s++]=C[I++]))}break}if(64&b){e.msg="invalid distance code",_.mode=oh;break e}y=g[(65535&y)+(d&(1<<b)-1)]}}break}}while(a<i&&s<o);S=p>>3,a-=S,p-=S<<3,d&=(1<<p)-1,e.next_in=a,e.next_out=s,e.avail_in=a<i?i-a+5:5-(a-i),e.avail_out=s<o?o-s+257:257-(s-o),_.hold=d,_.bits=p};const rh=15,ch=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),hh=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),mh=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),dh=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var ph=(e,t,a,i,s,n,o,l)=>{const r=l.bits;let c,h,m,d,p,u,g=0,f=0,w=0,y=0,b=0,S=0,v=0,I=0,E=0,k=0,C=null;const _=new Uint16Array(16),x=new Uint16Array(16);let T,P,R,D=null;for(g=0;g<=rh;g++)_[g]=0;for(f=0;f<i;f++)_[t[a+f]]++;for(b=r,y=rh;y>=1&&0===_[y];y--);if(b>y&&(b=y),0===y)return s[n++]=20971520,s[n++]=20971520,l.bits=1,0;for(w=1;w<y&&0===_[w];w++);for(b<w&&(b=w),I=1,g=1;g<=rh;g++)if(I<<=1,I-=_[g],I<0)return-1;if(I>0&&(0===e||1!==y))return-1;for(x[1]=0,g=1;g<rh;g++)x[g+1]=x[g]+_[g];for(f=0;f<i;f++)0!==t[a+f]&&(o[x[t[a+f]]++]=f);if(0===e?(C=D=o,u=20):1===e?(C=ch,D=hh,u=257):(C=mh,D=dh,u=0),k=0,f=0,g=w,p=n,S=b,v=0,m=-1,E=1<<b,d=E-1,1===e&&E>852||2===e&&E>592)return 1;for(;;){T=g-v,o[f]+1<u?(P=0,R=o[f]):o[f]>=u?(P=D[o[f]-u],R=C[o[f]-u]):(P=96,R=0),c=1<<g-v,h=1<<S,w=h;do{h-=c,s[p+(k>>v)+h]=T<<24|P<<16|R}while(0!==h);for(c=1<<g-1;k&c;)c>>=1;if(0!==c?(k&=c-1,k+=c):k=0,f++,0===--_[g]){if(g===y)break;g=t[a+o[f]]}if(g>b&&(k&d)!==m){for(0===v&&(v=b),p+=w,S=g-v,I=1<<S;S+v<y&&(I-=_[S+v],!(I<=0));)S++,I<<=1;if(E+=1<<S,1===e&&E>852||2===e&&E>592)return 1;m=k&d,s[m]=b<<24|S<<16|p-n}}return 0!==k&&(s[p+k]=g-v<<24|64<<16),l.bits=b,0};const{Z_FINISH:uh,Z_BLOCK:gh,Z_TREES:fh,Z_OK:wh,Z_STREAM_END:yh,Z_NEED_DICT:bh,Z_STREAM_ERROR:Sh,Z_DATA_ERROR:vh,Z_MEM_ERROR:Ih,Z_BUF_ERROR:Eh,Z_DEFLATED:kh}=Wr,Ch=16180,_h=16190,xh=16191,Th=16192,Ph=16194,Rh=16199,Dh=16200,Nh=16206,Gh=16209,Uh=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Oh(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const Ah=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<Ch||t.mode>16211?1:0},Lh=e=>{if(Ah(e))return Sh;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=Ch,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,wh},Vh=e=>{if(Ah(e))return Sh;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,Lh(e)},Fh=(e,t)=>{let a;if(Ah(e))return Sh;const i=e.state;return t<0?(a=0,t=-t):(a=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?Sh:(null!==i.window&&i.wbits!==t&&(i.window=null),i.wrap=a,i.wbits=t,Vh(e))},Wh=(e,t)=>{if(!e)return Sh;const a=new Oh;e.state=a,a.strm=e,a.window=null,a.mode=Ch;const i=Fh(e,t);return i!==wh&&(e.state=null),i};let Mh,zh,jh=!0;const Bh=e=>{if(jh){Mh=new Int32Array(512),zh=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(ph(1,e.lens,0,288,Mh,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;ph(2,e.lens,0,32,zh,0,e.work,{bits:5}),jh=!1}e.lencode=Mh,e.lenbits=9,e.distcode=zh,e.distbits=5},Hh=(e,t,a,i)=>{let s;const n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),i>=n.wsize?(n.window.set(t.subarray(a-n.wsize,a),0),n.wnext=0,n.whave=n.wsize):(s=n.wsize-n.wnext,s>i&&(s=i),n.window.set(t.subarray(a-i,a-i+s),n.wnext),(i-=s)?(n.window.set(t.subarray(a-i,a),0),n.wnext=i,n.whave=n.wsize):(n.wnext+=s,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=s))),0};var qh={inflateReset:Vh,inflateReset2:Fh,inflateResetKeep:Lh,inflateInit:e=>Wh(e,15),inflateInit2:Wh,inflate:(e,t)=>{let a,i,s,n,o,l,r,c,h,m,d,p,u,g,f,w,y,b,S,v,I,E,k=0;const C=new Uint8Array(4);let _,x;const T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(Ah(e)||!e.output||!e.input&&0!==e.avail_in)return Sh;a=e.state,a.mode===xh&&(a.mode=Th),o=e.next_out,s=e.output,r=e.avail_out,n=e.next_in,i=e.input,l=e.avail_in,c=a.hold,h=a.bits,m=l,d=r,E=wh;e:for(;;)switch(a.mode){case Ch:if(0===a.wrap){a.mode=Th;break}for(;h<16;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(2&a.wrap&&35615===c){0===a.wbits&&(a.wbits=15),a.check=0,C[0]=255&c,C[1]=c>>>8&255,a.check=Vr(a.check,C,2,0),c=0,h=0,a.mode=16181;break}if(a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",a.mode=Gh;break}if((15&c)!==kh){e.msg="unknown compression method",a.mode=Gh;break}if(c>>>=4,h-=4,I=8+(15&c),0===a.wbits&&(a.wbits=I),I>15||I>a.wbits){e.msg="invalid window size",a.mode=Gh;break}a.dmax=1<<a.wbits,a.flags=0,e.adler=a.check=1,a.mode=512&c?16189:xh,c=0,h=0;break;case 16181:for(;h<16;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(a.flags=c,(255&a.flags)!==kh){e.msg="unknown compression method",a.mode=Gh;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=Gh;break}a.head&&(a.head.text=c>>8&1),512&a.flags&&4&a.wrap&&(C[0]=255&c,C[1]=c>>>8&255,a.check=Vr(a.check,C,2,0)),c=0,h=0,a.mode=16182;case 16182:for(;h<32;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}a.head&&(a.head.time=c),512&a.flags&&4&a.wrap&&(C[0]=255&c,C[1]=c>>>8&255,C[2]=c>>>16&255,C[3]=c>>>24&255,a.check=Vr(a.check,C,4,0)),c=0,h=0,a.mode=16183;case 16183:for(;h<16;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}a.head&&(a.head.xflags=255&c,a.head.os=c>>8),512&a.flags&&4&a.wrap&&(C[0]=255&c,C[1]=c>>>8&255,a.check=Vr(a.check,C,2,0)),c=0,h=0,a.mode=16184;case 16184:if(1024&a.flags){for(;h<16;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}a.length=c,a.head&&(a.head.extra_len=c),512&a.flags&&4&a.wrap&&(C[0]=255&c,C[1]=c>>>8&255,a.check=Vr(a.check,C,2,0)),c=0,h=0}else a.head&&(a.head.extra=null);a.mode=16185;case 16185:if(1024&a.flags&&(p=a.length,p>l&&(p=l),p&&(a.head&&(I=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Uint8Array(a.head.extra_len)),a.head.extra.set(i.subarray(n,n+p),I)),512&a.flags&&4&a.wrap&&(a.check=Vr(a.check,i,p,n)),l-=p,n+=p,a.length-=p),a.length))break e;a.length=0,a.mode=16186;case 16186:if(2048&a.flags){if(0===l)break e;p=0;do{I=i[n+p++],a.head&&I&&a.length<65536&&(a.head.name+=String.fromCharCode(I))}while(I&&p<l);if(512&a.flags&&4&a.wrap&&(a.check=Vr(a.check,i,p,n)),l-=p,n+=p,I)break e}else a.head&&(a.head.name=null);a.length=0,a.mode=16187;case 16187:if(4096&a.flags){if(0===l)break e;p=0;do{I=i[n+p++],a.head&&I&&a.length<65536&&(a.head.comment+=String.fromCharCode(I))}while(I&&p<l);if(512&a.flags&&4&a.wrap&&(a.check=Vr(a.check,i,p,n)),l-=p,n+=p,I)break e}else a.head&&(a.head.comment=null);a.mode=16188;case 16188:if(512&a.flags){for(;h<16;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(4&a.wrap&&c!==(65535&a.check)){e.msg="header crc mismatch",a.mode=Gh;break}c=0,h=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),e.adler=a.check=0,a.mode=xh;break;case 16189:for(;h<32;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}e.adler=a.check=Uh(c),c=0,h=0,a.mode=_h;case _h:if(0===a.havedict)return e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,a.hold=c,a.bits=h,bh;e.adler=a.check=1,a.mode=xh;case xh:if(t===gh||t===fh)break e;case Th:if(a.last){c>>>=7&h,h-=7&h,a.mode=Nh;break}for(;h<3;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}switch(a.last=1&c,c>>>=1,h-=1,3&c){case 0:a.mode=16193;break;case 1:if(Bh(a),a.mode=Rh,t===fh){c>>>=2,h-=2;break e}break;case 2:a.mode=16196;break;case 3:e.msg="invalid block type",a.mode=Gh}c>>>=2,h-=2;break;case 16193:for(c>>>=7&h,h-=7&h;h<32;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",a.mode=Gh;break}if(a.length=65535&c,c=0,h=0,a.mode=Ph,t===fh)break e;case Ph:a.mode=16195;case 16195:if(p=a.length,p){if(p>l&&(p=l),p>r&&(p=r),0===p)break e;s.set(i.subarray(n,n+p),o),l-=p,n+=p,r-=p,o+=p,a.length-=p;break}a.mode=xh;break;case 16196:for(;h<14;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(a.nlen=257+(31&c),c>>>=5,h-=5,a.ndist=1+(31&c),c>>>=5,h-=5,a.ncode=4+(15&c),c>>>=4,h-=4,a.nlen>286||a.ndist>30){e.msg="too many length or distance symbols",a.mode=Gh;break}a.have=0,a.mode=16197;case 16197:for(;a.have<a.ncode;){for(;h<3;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}a.lens[T[a.have++]]=7&c,c>>>=3,h-=3}for(;a.have<19;)a.lens[T[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,_={bits:a.lenbits},E=ph(0,a.lens,0,19,a.lencode,0,a.work,_),a.lenbits=_.bits,E){e.msg="invalid code lengths set",a.mode=Gh;break}a.have=0,a.mode=16198;case 16198:for(;a.have<a.nlen+a.ndist;){for(;k=a.lencode[c&(1<<a.lenbits)-1],f=k>>>24,w=k>>>16&255,y=65535&k,!(f<=h);){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(y<16)c>>>=f,h-=f,a.lens[a.have++]=y;else{if(16===y){for(x=f+2;h<x;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(c>>>=f,h-=f,0===a.have){e.msg="invalid bit length repeat",a.mode=Gh;break}I=a.lens[a.have-1],p=3+(3&c),c>>>=2,h-=2}else if(17===y){for(x=f+3;h<x;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}c>>>=f,h-=f,I=0,p=3+(7&c),c>>>=3,h-=3}else{for(x=f+7;h<x;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}c>>>=f,h-=f,I=0,p=11+(127&c),c>>>=7,h-=7}if(a.have+p>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=Gh;break}for(;p--;)a.lens[a.have++]=I}}if(a.mode===Gh)break;if(0===a.lens[256]){e.msg="invalid code -- missing end-of-block",a.mode=Gh;break}if(a.lenbits=9,_={bits:a.lenbits},E=ph(1,a.lens,0,a.nlen,a.lencode,0,a.work,_),a.lenbits=_.bits,E){e.msg="invalid literal/lengths set",a.mode=Gh;break}if(a.distbits=6,a.distcode=a.distdyn,_={bits:a.distbits},E=ph(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,_),a.distbits=_.bits,E){e.msg="invalid distances set",a.mode=Gh;break}if(a.mode=Rh,t===fh)break e;case Rh:a.mode=Dh;case Dh:if(l>=6&&r>=258){e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,a.hold=c,a.bits=h,lh(e,d),o=e.next_out,s=e.output,r=e.avail_out,n=e.next_in,i=e.input,l=e.avail_in,c=a.hold,h=a.bits,a.mode===xh&&(a.back=-1);break}for(a.back=0;k=a.lencode[c&(1<<a.lenbits)-1],f=k>>>24,w=k>>>16&255,y=65535&k,!(f<=h);){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(w&&!(240&w)){for(b=f,S=w,v=y;k=a.lencode[v+((c&(1<<b+S)-1)>>b)],f=k>>>24,w=k>>>16&255,y=65535&k,!(b+f<=h);){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}c>>>=b,h-=b,a.back+=b}if(c>>>=f,h-=f,a.back+=f,a.length=y,0===w){a.mode=16205;break}if(32&w){a.back=-1,a.mode=xh;break}if(64&w){e.msg="invalid literal/length code",a.mode=Gh;break}a.extra=15&w,a.mode=16201;case 16201:if(a.extra){for(x=a.extra;h<x;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}a.length+=c&(1<<a.extra)-1,c>>>=a.extra,h-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=16202;case 16202:for(;k=a.distcode[c&(1<<a.distbits)-1],f=k>>>24,w=k>>>16&255,y=65535&k,!(f<=h);){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(!(240&w)){for(b=f,S=w,v=y;k=a.distcode[v+((c&(1<<b+S)-1)>>b)],f=k>>>24,w=k>>>16&255,y=65535&k,!(b+f<=h);){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}c>>>=b,h-=b,a.back+=b}if(c>>>=f,h-=f,a.back+=f,64&w){e.msg="invalid distance code",a.mode=Gh;break}a.offset=y,a.extra=15&w,a.mode=16203;case 16203:if(a.extra){for(x=a.extra;h<x;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}a.offset+=c&(1<<a.extra)-1,c>>>=a.extra,h-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=Gh;break}a.mode=16204;case 16204:if(0===r)break e;if(p=d-r,a.offset>p){if(p=a.offset-p,p>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=Gh;break}p>a.wnext?(p-=a.wnext,u=a.wsize-p):u=a.wnext-p,p>a.length&&(p=a.length),g=a.window}else g=s,u=o-a.offset,p=a.length;p>r&&(p=r),r-=p,a.length-=p;do{s[o++]=g[u++]}while(--p);0===a.length&&(a.mode=Dh);break;case 16205:if(0===r)break e;s[o++]=a.length,r--,a.mode=Dh;break;case Nh:if(a.wrap){for(;h<32;){if(0===l)break e;l--,c|=i[n++]<<h,h+=8}if(d-=r,e.total_out+=d,a.total+=d,4&a.wrap&&d&&(e.adler=a.check=a.flags?Vr(a.check,s,d,o-d):Ar(a.check,s,d,o-d)),d=r,4&a.wrap&&(a.flags?c:Uh(c))!==a.check){e.msg="incorrect data check",a.mode=Gh;break}c=0,h=0}a.mode=16207;case 16207:if(a.wrap&&a.flags){for(;h<32;){if(0===l)break e;l--,c+=i[n++]<<h,h+=8}if(4&a.wrap&&c!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=Gh;break}c=0,h=0}a.mode=16208;case 16208:E=yh;break e;case Gh:E=vh;break e;case 16210:return Ih;default:return Sh}return e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,a.hold=c,a.bits=h,(a.wsize||d!==e.avail_out&&a.mode<Gh&&(a.mode<Nh||t!==uh))&&Hh(e,e.output,e.next_out,d-e.avail_out),m-=e.avail_in,d-=e.avail_out,e.total_in+=m,e.total_out+=d,a.total+=d,4&a.wrap&&d&&(e.adler=a.check=a.flags?Vr(a.check,s,d,e.next_out-d):Ar(a.check,s,d,e.next_out-d)),e.data_type=a.bits+(a.last?64:0)+(a.mode===xh?128:0)+(a.mode===Rh||a.mode===Ph?256:0),(0===m&&0===d||t===uh)&&E===wh&&(E=Eh),E},inflateEnd:e=>{if(Ah(e))return Sh;let t=e.state;return t.window&&(t.window=null),e.state=null,wh},inflateGetHeader:(e,t)=>{if(Ah(e))return Sh;const a=e.state;return 2&a.wrap?(a.head=t,t.done=!1,wh):Sh},inflateSetDictionary:(e,t)=>{const a=t.length;let i,s,n;return Ah(e)?Sh:(i=e.state,0!==i.wrap&&i.mode!==_h?Sh:i.mode===_h&&(s=1,s=Ar(s,t,a,0),s!==i.check)?vh:(n=Hh(e,t,a,a),n?(i.mode=16210,Ih):(i.havedict=1,wh)))},inflateInfo:"pako inflate (from Nodeca project)"};var Yh=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const Kh=Object.prototype.toString,{Z_NO_FLUSH:$h,Z_FINISH:Jh,Z_OK:Zh,Z_STREAM_END:Qh,Z_NEED_DICT:Xh,Z_STREAM_ERROR:em,Z_DATA_ERROR:tm,Z_MEM_ERROR:am}=Wr;function im(e){this.options=Fc({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new qc,this.strm.avail_out=0;let a=qh.inflateInit2(this.strm,t.windowBits);if(a!==Zh)throw new Error(Fr[a]);if(this.header=new Yh,qh.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=jc(t.dictionary):"[object ArrayBuffer]"===Kh.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(a=qh.inflateSetDictionary(this.strm,t.dictionary),a!==Zh)))throw new Error(Fr[a])}function sm(e,t){const a=new im(t);if(a.push(e),a.err)throw a.msg||Fr[a.err];return a.result}im.prototype.push=function(e,t){const a=this.strm,i=this.options.chunkSize,s=this.options.dictionary;let n,o,l;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Jh:$h,"[object ArrayBuffer]"===Kh.call(e)?a.input=new Uint8Array(e):a.input=e,a.next_in=0,a.avail_in=a.input.length;;){for(0===a.avail_out&&(a.output=new Uint8Array(i),a.next_out=0,a.avail_out=i),n=qh.inflate(a,o),n===Xh&&s&&(n=qh.inflateSetDictionary(a,s),n===Zh?n=qh.inflate(a,o):n===tm&&(n=Xh));a.avail_in>0&&n===Qh&&a.state.wrap>0&&0!==e[a.next_in];)qh.inflateReset(a),n=qh.inflate(a,o);switch(n){case em:case tm:case Xh:case am:return this.onEnd(n),this.ended=!0,!1}if(l=a.avail_out,a.next_out&&(0===a.avail_out||n===Qh))if("string"===this.options.to){let e=Hc(a.output,a.next_out),t=a.next_out-e,s=Bc(a.output,e);a.next_out=t,a.avail_out=i-t,t&&a.output.set(a.output.subarray(e,e+t),0),this.onData(s)}else this.onData(a.output.length===a.next_out?a.output:a.output.subarray(0,a.next_out));if(n!==Zh||0!==l){if(n===Qh)return n=qh.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===a.avail_in)break}}return!0},im.prototype.onData=function(e){this.chunks.push(e)},im.prototype.onEnd=function(e){e===Zh&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Wc(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var nm={Inflate:im,inflate:sm,inflateRaw:function(e,t){return(t=t||{}).raw=!0,sm(e,t)},ungzip:sm};const{Deflate:om,deflate:lm,deflateRaw:rm,gzip:cm}=nh,{Inflate:hm,inflate:mm,inflateRaw:dm,ungzip:pm}=nm;var um={Deflate:om,deflate:lm,deflateRaw:rm,gzip:cm,Inflate:hm,inflate:mm,inflateRaw:dm,ungzip:pm,constants:Wr};class gm{static tryParseUrlLocation(e){let t=e.hash;if(t.length<=1)return null;t=t.substring(1);const a=atob(t),i=new Uint8Array(a.length);for(let r=0;r<i.length;r++)i[r]=a.charCodeAt(r);const s=um.inflate(i),n=ft.fromBinary(s);let o=ul.DEFAULT_CATEGORIES;const l=new URLSearchParams(window.location.search);if(l.has(ul.CATEGORY_PARAM)){o=l.get(ul.CATEGORY_PARAM).split("").map(e=>[...ml.entries()].find(t=>t[1]==e)).filter(e=>e).map(e=>e[0])}return{settings:n,categories:o}}}const fm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function wm(e){if(!e.length)return 0;let t=0,a=1,i=e[0];for(;(32&i)>0;)a++,i<<=1;const s=63>>a;let n=e.shift()&s;a--;for(let o=1;o<=a;o++)t+=1<<5*o,n=n<<6|(e.shift()||0);return n+t}function ym(e){const t={classId:"",raceId:"",genderId:0,level:0,specIndex:0,talentString:"",glyphs:[],items:[]},a=/^([a-z-]+)\/([a-z-]+)(?:\/([a-zA-Z0-9_-]+))?$/.exec(e);if(!a)return t;t.classId=a[1],t.raceId=a[2];let i=a[3];if(!i)return t;const s=fm.indexOf(i.substring(0,1));if(i=i.substring(1),!i.length)return t;const n=[];for(let o=0;o<i.length;o++)n.push(fm.indexOf(i.substring(o,o+1)));if(s>4)return t;s>=2&&wm(n);{const e=wm(n)-1;e>=0&&(t.genderId=e)}{const e=wm(n);e&&(t.level=e)}{s>=4&&(t.specIndex=wm(n));const e=[bm(n)];let a=wm(n);for(;a-- >0;){const t=wm(n);e.push(n.splice(0,t).map(e=>fm[e]).join(""))}const[i,o]=e;t.talentString=i,t.glyphs=function(e){const t=Array(6).fill(0);if(!e)return t;const a=fm.indexOf(e.substring(0,1)),i=e.substring(1);if(!i.length)return t;if(0!==a)return t;const s=[];for(let o=0;o<i.length;o++)s.push(fm.indexOf(i.substring(o,o+1)));const n=191;for(;s.length>1;){const e=wm(s),a=wm(s);e>n||(t[e]=a)}return t}(o)}{let e=wm(n);for(;e--;){const e={};let a=!1,i=!1,o=!1,l=0,r=0;switch(s){case 0:{const e=n.shift();a=!!(e>>5&1),l=e>>2&7,r=3&e;break}case 1:case 2:{const e=wm(n);a=!!(e>>6&1),o=!!(e>>5&1),l=e>>2&7,r=3&e;break}default:{const e=wm(n);a=!!(e>>7&1),i=!!(e>>6&1),o=!!(e>>5&1),l=e>>2&7,r=3&e;break}}if(e.slotId=wm(n),e.itemId=wm(n),a){let t=wm(n);const a=1&t;t>>=1,a&&(t*=-1),e.randomEnchantId=t}for(i&&(e.upgradeRank=wm(n)),o&&(e.reforge=wm(n));l--;)(e.gemItemIds??(e.gemItemIds=[])).push(wm(n));for(;r--;)(e.enchantIds??(e.enchantIds=[])).push(wm(n));(t.items??(t.items=[])).push(e)}}return t}function bm(e){let t="",a=wm(e);for(;0!==a;)t+=""+(3&a),a>>=2;return t}const Sm=class a extends ul{constructor(a,i){super(a,i,{title:"Wowhead Import",allowFileUpload:!0});const s=t();this.descriptionElem.appendChild(e(l,null,e("p",null,"Import settings from"," ",e("a",{href:"https://www.wowhead.com/mop-classic/gear-planner",target:"_blank"},"Wowhead Gear Planner"),"."),e("p",null,"This feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats."),e("p",null,"To import, paste the gear planner link below and click, 'Import'."),e("div",{ref:s}))),s.value&&new No({title:"Tinker issues",body:e(l,null,"There are known issues importing tinkers from Wowhead.",e("br",null),"Always make sure to double check your tinkers after importing."),additionalClasses:["toast-import-warning"],container:s.value,variant:"warning",canClose:!1,autoShow:!0,autohide:!1})}async onImport(e){if(!e.match(/www\.wowhead\.com\/mop-classic\/gear-planner\/([a-z\-]+)\/([a-z\-]+)\/([a-zA-Z0-9_\-]+)/))throw new Error(`Invalid WCL URL ${e}, must look like "https://www.wowhead.com/mop-classic/gear-planner/CLASS/RACE/XXXX"`);const t=[],i=[],s=[],n=function(e){const t=e.match(/mop-classic\/gear-planner\/(.+)/);if(!t)throw new Error(`Invalid WCL URL ${e}, must look like "https://www.wowhead.com/mop-classic/gear-planner/CLASS/RACE/XXXX"`);return ym(t[1])}(e),o=n.glyphs,l=pt(n.classId.replaceAll("-",""));if(l==v.ClassUnknown)throw new Error("Could not parse Class: "+n.classId);const r=ut((e=>{const t=e.startsWith("alliance-")?" (A)":void 0,a=e.startsWith("horde-")?" (H)":void 0;return e.replaceAll("alliance","").replaceAll("horde","").replaceAll("-","")+(t??a??"")})(n.raceId));if(r==c.RaceUnknown)throw new Error("Could not parse Race: "+n.raceId);const h=S.create();n.items.forEach(e=>{const n=this.simUI.sim.db.getItemById(e.itemId);if(!n)return void t.push(e.itemId);const o=b.create();o.id=e.itemId;const l=e.slotId;e.enchantIds?.length&&e.enchantIds.forEach(e=>{const t=this.simUI.sim.db.enchantSpellIdToEnchant(e),a=t?.requiredProfession===I.Engineering;t?a?(o.tinker=t.effectId,s.includes(I.Engineering)||s.push(I.Engineering)):o.enchant=t.effectId:i.push(e)}),e.gemItemIds&&(o.gems=e.gemItemIds),e.randomEnchantId&&(o.randomSuffix=e.randomEnchantId),e.reforge&&(o.reforging=e.reforge),e.upgradeRank&&n&&(o.upgradeStep=n.scalingOptions[e.upgradeRank]?e.upgradeRank:Object.keys(n.scalingOptions).length-2);null!=Object.entries(a.slotIDs).find(e=>e[1]==l)&&h.items.push(o)});const m=E.create({major1:this.simUI.sim.db.glyphSpellToItemId(o[0]),major2:this.simUI.sim.db.glyphSpellToItemId(o[1]),major3:this.simUI.sim.db.glyphSpellToItemId(o[2]),minor1:this.simUI.sim.db.glyphSpellToItemId(o[3]),minor2:this.simUI.sim.db.glyphSpellToItemId(o[4]),minor3:this.simUI.sim.db.glyphSpellToItemId(o[5])});this.finishIndividualImport(this.simUI,{charClass:l,race:r,equipmentSpec:h,talentsStr:n.talentString??"",glyphs:m,professions:s,missingEnchants:i,missingItems:t})}};Sm.slotIDs={[r.ItemSlotHead]:1,[r.ItemSlotNeck]:2,[r.ItemSlotShoulder]:3,[r.ItemSlotBack]:15,[r.ItemSlotChest]:5,[r.ItemSlotWrist]:9,[r.ItemSlotHands]:10,[r.ItemSlotWaist]:6,[r.ItemSlotLegs]:7,[r.ItemSlotFeet]:8,[r.ItemSlotFinger1]:11,[r.ItemSlotFinger2]:12,[r.ItemSlotTrinket1]:13,[r.ItemSlotTrinket2]:14,[r.ItemSlotMainHand]:16,[r.ItemSlotOffHand]:17};let vm=Sm;class Im extends Do{constructor(a,i){super(a,i,{identifier:"bulk-tab",title:'Batch (<span class="text-success">New</span>)'}),this.itemsChangedEmitter=new Se,this.settingsChangedEmitter=new Se,this.items=new Array,this.pickerGroups=new Map,this.combinations=0,this.iterations=0,this.simUI=i,this.playerCanDualWield=this.simUI.player.getPlayerSpec().canDualWield,this.playerIsFuryWarrior=this.simUI.player.getSpec()===p.SpecFuryWarrior;const s=t(),n=t(),o=t(),r=t(),c=t(),h=t(),m=t(),d=t();this.contentContainer.appendChild(e(l,null,e("div",{className:"bulk-tab-left tab-panel-left"},e("div",{className:"bulk-tab-tabs"},e("ul",{className:"nav nav-tabs",attributes:{role:"tablist"}},e("li",{className:"nav-item",attributes:{role:"presentation"}},e("button",{className:"nav-link active",type:"button",attributes:{role:"tab","aria-controls":"bulkSetupTab","aria-selected":!0},dataset:{bsToggle:"tab",bsTarget:"#bulkSetupTab"},ref:s},"Setup")),e("li",{className:"nav-item",attributes:{role:"presentation"}},e("button",{className:"nav-link",type:"button",attributes:{role:"tab","aria-controls":"bulkResultsTab","aria-selected":!1},dataset:{bsToggle:"tab",bsTarget:"#bulkResultsTab"},ref:o},"Results"))),e("div",{className:"tab-content"},e("div",{id:"bulkSetupTab",className:"tab-pane fade active show",ref:n}),e("div",{id:"bulkResultsTab",className:"tab-pane fade show",ref:r},e("div",{className:"d-flex align-items-center justify-content-center p-gap"},"Run a simulation to view results"))))),e("div",{className:"bulk-tab-right tab-panel-right"},e("div",{className:"bulk-settings-outer-container"},e("div",{className:"bulk-settings-container",ref:c},e("div",{className:"bulk-combinations-count h4",ref:h}),e("button",{className:"btn btn-primary bulk-settings-btn",ref:m},"Simulate Batch"),e("div",{className:"bulk-boolean-settings-container",ref:d}))),","))),this.setupTabElem=n.value,this.resultsTabElem=r.value,this.pendingDiv=e("div",{className:"results-pending-overlay"}),this.combinationsElem=h.value,this.bulkSimButton=m.value,this.settingsContainer=c.value,this.booleanSettingsContainer=d.value,this.setupTab=new k(s.value),this.resultsTab=new k(o.value),this.pendingResults=new Ro(this.pendingDiv),this.pendingResults.hideAll(),this.selectorModal=new cg(this.simUI.rootElem,this.simUI,this.simUI.player,void 0,{id:"bulk-selector-modal"}),this.doCombos=!0,this.fastMode=!0,this.autoGem=!0,this.autoEnchant=!0,this.savedTalents=[],this.simTalents=!1,this.defaultGems=[wt.create(),wt.create(),wt.create(),wt.create()],this.gemIconElements=[],this.buildTabContent(),this.simUI.sim.waitForInit().then(()=>{this.loadSettings();const e=()=>{for(const e of this.pickerGroups.values())e.has(-1)&&e.remove(-1),e.has(-2)&&e.remove(-2);this.simUI.player.getEquippedItems().forEach((e,t)=>{const a=nl(t,this.playerCanDualWield),i=this.pickerGroups.get(a),s=this.isSecondaryItemSlot(t)?-2:-1;e&&i.add(s,e)})};e(),Se.onAny([this.simUI.player.challengeModeChangeEmitter,this.simUI.player.gearChangeEmitter]).on(()=>e()),this.itemsChangedEmitter.on(()=>this.storeSettings()),Se.onAny([this.itemsChangedEmitter,this.settingsChangedEmitter,this.simUI.sim.iterationsChangeEmitter]).on(()=>{this.getCombinationsCount().then(e=>this.combinationsElem.replaceChildren(e))}),this.getCombinationsCount().then(e=>this.combinationsElem.replaceChildren(e))})}getSettingsKey(){return this.simUI.getStorageKey("bulk-settings.v1")}loadSettings(){const e=window.localStorage.getItem(this.getSettingsKey());if(null!=e){const t=yt.fromJsonString(e,{ignoreUnknownFields:!0});this.addItems(t.items),this.doCombos=t.combinations,this.fastMode=t.fastMode,this.autoEnchant=t.autoEnchant,this.savedTalents=t.talentsToSim,this.autoGem=t.autoGem,this.simTalents=t.simTalents,this.defaultGems=new Array(bt.create({id:t.defaultRedGem}),bt.create({id:t.defaultYellowGem}),bt.create({id:t.defaultBlueGem}),bt.create({id:t.defaultMetaGem})),this.defaultGems.forEach((e,t)=>{xe.fromItemId(e.id).fill().then(a=>{e.id&&(this.gemIconElements[t].src=a.iconUrl,this.gemIconElements[t].classList.remove("hide"))})})}}storeSettings(){const e=this.createBulkSettings(),t=yt.toJsonString(e,{enumAsInteger:!0});window.localStorage.setItem(this.getSettingsKey(),t)}createBulkSettings(){return yt.create({items:this.getItems(),combinations:this.doCombos,fastMode:this.fastMode,autoEnchant:this.autoEnchant,autoGem:this.autoGem,simTalents:this.simTalents,talentsToSim:this.savedTalents,defaultRedGem:this.defaultGems[0].id,defaultYellowGem:this.defaultGems[1].id,defaultBlueGem:this.defaultGems[2].id,defaultMetaGem:this.defaultGems[3].id,iterationsPerCombo:this.getDefaultIterationsCount()})}getDefaultIterationsCount(){return St()?1e3:this.simUI.sim.getIterations()}createBulkItemsDatabase(){const e=vt.create();for(const t of this.items.values()){if(!t)continue;const a=this.simUI.sim.db.lookupItemSpec(t);if(!a)throw new Error(`item with ID ${t.id} not found in database`);e.items.push(It.fromJson(Et.toJson(a.item),{ignoreUnknownFields:!0}));this.simUI.sim.db.getItemEffectRandPropPoints(a.ilvl)&&e.itemEffectRandPropPoints.push(kt.create(this.simUI.sim.db.getItemEffectRandPropPoints(a.ilvl))),a.enchant&&e.enchants.push(Ct.fromJson(_t.toJson(a.enchant),{ignoreUnknownFields:!0})),a.randomSuffix&&e.randomSuffixes.push(C.fromJson(C.toJson(a.randomSuffix),{ignoreUnknownFields:!0})),a.reforge&&e.reforgeStats.push(_.fromJson(_.toJson(a.reforge),{ignoreUnknownFields:!0}));for(const t of a.gems)t&&e.gems.push(bt.fromJson(wt.toJson(t),{ignoreUnknownFields:!0}))}for(const t of this.defaultGems)t.id>0&&e.gems.push(t);return e}addItem(e){this.addItems([e])}addItems(e){e.forEach(e=>{const t=this.simUI.sim.db.lookupItemSpec(e)?.withChallengeMode(this.simUI.player.getChallengeModeEnabled()).withDynamicStats();t&&Ge(t.item,this.playerIsFuryWarrior).forEach(a=>{if(this.isSecondaryItemSlot(a))return;const i=this.items.push(e)-1,s=nl(a,this.playerCanDualWield);this.pickerGroups.get(s).add(i,t)})}),this.itemsChangedEmitter.emit(Se.nextEventID())}addItemToSlot(e,t){const a=this.simUI.sim.db.lookupItemSpec(e)?.withChallengeMode(this.simUI.player.getChallengeModeEnabled()).withDynamicStats();if(a){const i=Ge(a.item,this.playerIsFuryWarrior);if(!Ue(a.item,this.simUI.player.getPlayerSpec(),i[0]))return;const s=this.items.push(e)-1;this.pickerGroups.get(t).add(s,a),this.itemsChangedEmitter.emit(Se.nextEventID())}}updateItem(e,t){const a=this.simUI.sim.db.lookupItemSpec(t)?.withChallengeMode(this.simUI.player.getChallengeModeEnabled()).withDynamicStats();a&&(this.items[e]=t,Ge(a.item,this.playerIsFuryWarrior).forEach(t=>{if(this.isSecondaryItemSlot(t))return;const i=nl(t,this.playerCanDualWield);this.pickerGroups.get(i).update(e,a)})),this.itemsChangedEmitter.emit(Se.nextEventID())}removeItem(e){this.items.forEach((t,a)=>{t&&t.id===e.id&&this.removeItemByIndex(a)})}removeItemByIndex(e){if(e<0||this.items.length<e||!this.items[e])return void new No({variant:"error",body:"Failed to remove item, please report this issue."});const t=this.items[e],a=this.simUI.sim.db.lookupItemSpec(t);a&&(this.items[e]=null,Ge(a.item,this.playerIsFuryWarrior).forEach(t=>{const a=nl(t,this.playerCanDualWield);this.pickerGroups.get(a).remove(e)}),this.itemsChangedEmitter.emit(Se.nextEventID()))}clearItems(){for(let e=0;e<this.items.length;e++)this.removeItemByIndex(e);this.items=new Array,this.itemsChangedEmitter.emit(Se.nextEventID())}hasItem(e){return this.items.some(t=>!!t&&b.equals(t,e))}getItems(){const e=new Array;return this.items.forEach(t=>{t&&e.push(b.clone(t))}),e}setCombinations(e){this.doCombos=e,this.settingsChangedEmitter.emit(Se.nextEventID())}setFastMode(e){this.fastMode=e,this.settingsChangedEmitter.emit(Se.nextEventID())}async runBulkSim(e){this.pendingResults.setPending();try{const t=await this.simUI.sim.runBulkSim(this.createBulkSettings(),this.createBulkItemsDatabase(),e);t.error?.type==xt.ErrorOutcomeAborted&&new No({variant:"info",body:"Bulk sim cancelled."})}catch(t){this.isPending=!1,this.simUI.handleCrash(t)}}async calculateBulkCombinations(){try{const e=await this.simUI.sim.calculateBulkCombinations(this.createBulkSettings(),this.createBulkItemsDatabase());this.combinations=e?.numCombinations??0,this.iterations=e?.numIterations??0}catch(e){this.simUI.handleCrash(e)}}buildTabContent(){this.buildSetupTabContent(),this.buildResultsTabContent(),this.buildBatchSettings()}buildSetupTabContent(){const a=t(),i=t(),s=t();this.setupTabElem.appendChild(e(l,null,e("p",{className:"mb-0"},e("span",{className:"bold"},"Batch Simming")," is a new feature akin to the ",e("span",{className:"bold"},"Top Gear")," sim on"," ",e("a",{href:"https://raidbots.com",target:"_blank"},"Raidbots.com")," ","that allows you to select multiple items and sim them find the best combinations.",e("br",null),"This is an ",e("span",{className:"text-brand"},"Alpha")," feature, so if you have feedback or find a bug, please report it!"),St()&&e("p",{className:"mb-0"},e("a",{href:x,target:"_blank"},e("i",{className:"fas fa-gauge-high me-1"}),"Download the local sim for faster results.")),e("div",{className:"bulk-gear-actions"},e("button",{className:"btn btn-secondary",ref:a},e("i",{className:"fa fa-download me-1"})," Import From Bags"),e("button",{className:"btn btn-secondary",ref:i},e("i",{className:"fa fa-download me-1"})," Import Favorites"),e("button",{className:"btn btn-danger ms-auto",ref:s},e("i",{className:"fas fa-times me-1"}),"Clear Items"))));const n=a.value,o=i.value,r=s.value;n.addEventListener("click",()=>new gl(this.simUI.rootElem,this.simUI,this).open()),o.addEventListener("click",()=>{const e=this.simUI.player.sim.getFilters().favoriteItems.map(e=>b.create({id:e}));this.addItems(e)}),r.addEventListener("click",()=>this.clearItems()),new ll(this.setupTabElem,this.simUI,this);const c=e("div",{className:"bulk-gear-combo"});this.setupTabElem.appendChild(c),Ve(al).forEach(e=>{this.playerCanDualWield&&[al.ItemSlotMainHand,al.ItemSlotOffHand].includes(e)||(this.playerCanDualWield||e!==al.ItemSlotHandWeapon)&&this.pickerGroups.set(e,new ol(c,this.simUI,this,e))})}buildResultsTabContent(){this.simUI.sim.bulkSimStartEmitter.on(()=>this.resultsTabElem.replaceChildren()),this.simUI.sim.bulkSimResultEmitter.on((e,t)=>{for(const a of t.results)new rl(this.resultsTabElem,this.simUI,this,a,t.equippedGearResult);this.isPending=!1,this.resultsTab.show()})}isSecondaryItemSlot(e){return Tt(e)||this.playerCanDualWield&&e===r.ItemSlotOffHand}set isPending(e){e?(this.simUI.rootElem.classList.add("blurred"),this.simUI.rootElem.insertAdjacentElement("afterend",this.pendingDiv)):(this.simUI.rootElem.classList.remove("blurred"),this.pendingDiv.remove(),this.pendingResults.hideAll())}buildBatchSettings(){let a=!1;this.bulkSimButton.addEventListener("click",async()=>{if(a)return;a=!0,this.bulkSimButton.disabled=!0,this.isPending=!0;let e=!1;try{await this.simUI.sim.signalManager.abortType(Pt.All),this.pendingResults.addAbortButton(async()=>{if(!e)try{e=!0,await this.simUI.sim.signalManager.abortType(Pt.BulkSim)}catch(t){console.error("Error on bulk sim abort!"),console.error(t)}finally{e=!1,a||(this.bulkSimButton.disabled=!1)}});let t=(new Date).getTime(),i=0,s=0,n=0,o=0;await this.runBulkSim(e=>{const a=(new Date).getTime()-t,l=e.completedIterations/(a/1e3);0===o&&(o=e.totalSims),this.fastMode&&(0===s&&e.totalSims>0&&(s=Math.ceil(Math.log(e.totalSims/20)/Math.log(2))+1,n=1),e.totalSims<i&&(n+=1,t=(new Date).getTime())),this.setSimProgress(e,l,n,s,o),i=e.totalSims})}catch(t){console.error(t)}finally{a=!1,e||(this.bulkSimButton.disabled=!1),this.isPending=!1}}),St()||new Rt(this.booleanSettingsContainer,this,{id:"bulk-fast-mode",label:"Fast Mode",labelTooltip:"Fast mode reduces accuracy but will run faster.",changedEvent:e=>this.settingsChangedEmitter,getValue:e=>this.fastMode,setValue:(e,t,a)=>{this.setFastMode(a)}}),new Rt(this.booleanSettingsContainer,this,{id:"bulk-combinations",label:"Combinations",labelTooltip:"When checked bulk simulator will create all possible combinations of the items. When disabled trinkets and rings will still run all combinations because they each have two slots to fill.",changedEvent:e=>this.settingsChangedEmitter,getValue:e=>this.doCombos,setValue:(e,t,a)=>{this.setCombinations(a)}}),new Rt(this.booleanSettingsContainer,this,{id:"bulk-auto-enchant",label:"Auto Enchant",labelTooltip:"When checked bulk simulator apply the current enchant for a slot to each replacement item it can.",changedEvent:e=>this.settingsChangedEmitter,getValue:e=>this.autoEnchant,setValue:(e,t,a)=>{t.autoEnchant=a}});const i=t(),s=e("div",{className:_e("default-gem-container",!this.autoGem&&"hide")},e("h6",null,"Default Gems"),e("div",{ref:i,className:"sockets-container"})),n=t(),o=e("div",{className:_e("talents-picker-container",!this.simTalents&&"hide")},e("h6",null,"Talents to Sim"),e("div",{ref:n,className:"talents-container"}));new Rt(this.booleanSettingsContainer,this,{id:"bulk-auto-gem",label:"Auto Gem",labelTooltip:"When checked bulk simulator will fill any un-filled gem sockets with default gems.",changedEvent:e=>this.settingsChangedEmitter,getValue:e=>this.autoGem,setValue:(e,t,a)=>{t.autoGem=a,s.classList[a?"remove":"add"]("hide")}}),new Rt(this.booleanSettingsContainer,this,{id:"bulk-sim-talents",label:"Sim Talents",labelTooltip:"When checked bulk simulator will sim chosen talent setups. Warning, it might cause the bulk sim to run for a lot longer",changedEvent:e=>this.settingsChangedEmitter,getValue:e=>this.simTalents,setValue:(e,t,a)=>{t.simTalents=a,o.classList[a?"remove":"add"]("hide")}}),this.settingsContainer.appendChild(e(l,null,s,o)),Array(T.GemColorRed,T.GemColorYellow,T.GemColorBlue,T.GemColorMeta).forEach((a,s)=>{const n=t(),o=t(),l=t();let r;i.value.appendChild(e("div",{ref:n,className:"gem-socket-container"},e("img",{ref:o,className:"gem-icon hide"}),e("img",{ref:l,className:"socket-icon"}))),this.gemIconElements.push(o.value),l.value.src=Re(a);const c=e=>{this.defaultGems[s]=e.item,this.storeSettings(),xe.fromItemId(e.id).fill().then(t=>{e.id&&(this.gemIconElements[s].src=t.iconUrl,this.gemIconElements[s].classList.remove("hide"))}),r.close()},h=()=>{this.defaultGems[s]=wt.create(),this.storeSettings(),this.gemIconElements[s].classList.add("hide"),this.gemIconElements[s].src="",r.close()},m=()=>{r||(r=new cl(this.simUI.rootElem,this.simUI,a,c,h)),r.show()};this.gemIconElements[s].addEventListener("click",m),n.value?.addEventListener("click",m)});const r=window.localStorage.getItem(this.simUI.getSavedTalentsStorageKey());let c;try{null!==r&&(c=JSON.parse(r))}catch(d){console.warn("Invalid json for local storage value: "+r)}const h=(e,t)=>{if(this.savedTalents.some(e=>e.name===t.name)){const a=this.savedTalents.findIndex(e=>e.name===t.name);this.savedTalents.splice(a,1),e?.classList.remove("active")}else this.savedTalents.push(t),e?.classList.add("active");this.settingsChangedEmitter.emit(Se.nextEventID())},m=this.simUI.individualConfig.presets.talents.map(e=>({talentsString:e.data.talentsString,glyphs:e.data.glyphs,name:e.name}));for(const e in c)try{const t=Dt.fromJson(c[e]);m.push({talentsString:t.talentsString,glyphs:t.glyphs,name:e})}catch(d){console.log(d),console.warn("Failed parsing saved data: "+c[e])}m.forEach(a=>{const i=this.savedTalents.findIndex(e=>JSON.stringify(e)===JSON.stringify(a)),s=t(),o=t();n.value.appendChild(e("div",{ref:s,className:_e("saved-data-set-chip badge rounded-pill",-1!==i&&"active")},e("button",{ref:o,className:"saved-data-set-name"},a.name))),o.value.addEventListener("click",()=>h(s.value,a))})}async getCombinationsCount(){await this.calculateBulkCombinations();const a=t(),i=e(l,null,e("span",{className:_e(this.showIterationsWarning()&&"text-danger")},1===this.combinations?"1 Combination":`${this.combinations} Combinations`,e("br",null),e("small",null,this.iterations," Iterations")),this.showIterationsWarning()&&e("button",{className:"warning link-warning",ref:a},e("i",{className:"fas fa-exclamation-triangle fa-2x"})));return a.value&&u(a.value,{content:"Simming over 50000 iterations in the web sim will take a long time or may not run at all.\n\t\t\t\t\tFor larger batch sims we recommend using Fast Mode or downloading the executable and running on your machine.",placement:"left",popperOptions:{modifiers:[{name:"flip",options:{fallbackPlacements:["auto"]}}]}}),i}showIterationsWarning(){return this.iterations>this.getIterationsLimit()}getIterationsLimit(){return St()?5e4:1e6}setSimProgress(t,a,i,s,n){const o=((t.totalIterations-t.completedIterations)/a).toFixed();isNaN(Number(o))||this.pendingResults.setContent(e("div",{className:"results-sim"},e("div",null,n," total combinations."),e("div",null,s>0&&e(l,null,i," / ",s," refining rounds")),e("div",null,t.completedSims," / ",t.totalSims,e("br",null),"simulations complete"),e("div",null,t.completedIterations," / ",t.totalIterations,e("br",null),"iterations complete"),e("div",null,o," seconds remaining.")))}}class Em extends Io{constructor(a,i){if(super(a,"exporter",{title:i.title,header:!0,footer:!0}),this.changedEvent=new Se,this.textElem=e("textarea",{spellcheck:!1,className:"exporter-textarea form-control"}),this.body.append(this.textElem),new fl(this.footer,{extraCssClasses:["btn-primary","me-2"],getContent:()=>this.textElem.innerHTML,text:"Copy",tooltip:"Copy to clipboard"}),i.allowDownload){const a=t();this.footer.appendChild(e("button",{className:"exporter-button btn btn-primary download-button",ref:a},e("i",{className:"fa fa-download me-1"}),"Download"));a.value.addEventListener("click",e=>{const t=this.textElem.textContent;Nt(t,"wowsims.json")})}}open(){super.open(),this.init()}init(){this.changedEvent.on(()=>this.updateContent()),this.updateContent()}updateContent(){this.textElem.textContent=this.getData()}}const km=class t extends Em{constructor(a,i,s){super(a,s),this.simUI=i;const n={};if(Ve(hl).forEach(e=>n[e]=ul.DEFAULT_CATEGORIES.includes(e)),this.exportCategories=n,s.selectCategories){const a=e("div",{className:"exporter-category-pickers"});this.body.prepend(a),t.exportPickerConfigs.forEach(e=>{const t=e.category;new Rt(a,this,{id:`link-exporter-${t}`,label:e.label,labelTooltip:e.labelTooltip,inline:!0,getValue:()=>this.exportCategories[t],setValue:(e,a,i)=>{this.exportCategories[t]=i,this.changedEvent.emit(e)},changedEvent:()=>this.changedEvent})})}}};km.exportPickerConfigs=[{category:hl.Gear,label:"Gear",labelTooltip:"Also includes bonus stats and weapon swaps."},{category:hl.Talents,label:"Talents",labelTooltip:"Talents and Glyphs."},{category:hl.Rotation,label:"Rotation",labelTooltip:"Includes everything found in the Rotation tab."},{category:hl.Consumes,label:"Consumes",labelTooltip:"Flask, pots, food, etc."},{category:hl.External,label:"Buffs & Debuffs",labelTooltip:"All settings which are applied by other raid members."},{category:hl.Miscellaneous,label:"Misc",labelTooltip:"Spec-specific settings, front/back of target, distance from target, etc."},{category:hl.Encounter,label:"Encounter",labelTooltip:"Fight-related settings."}];let Cm=km;const _m=class e extends Cm{constructor(e,t){super(e,t,{title:"Sixty Upgrades Cataclysm EP Export",allowDownload:!0})}getData(){const t=this.simUI.player,a=t.getEpWeights(),i=ve.getAll(),s={};return i.forEach(t=>{const i=e.getName(t),n=a.getUnitStat(t);0!=n&&""!=i&&(s[i]?s[i]+=n:s[i]=n)}),`https://sixtyupgrades.com/mop/ep/import?name=${encodeURIComponent(`${t.getPlayerSpec().friendlyName} WoWSims Weights`)}`+Object.keys(s).map(e=>`&${e}=${s[e].toFixed(3)}`).join("")}static getName(t){return t.isStat()?e.statNames[t.getStat()]:e.pseudoStatNames[t.getPseudoStat()]||""}};_m.statNames={[n.StatStrength]:"strength",[n.StatAgility]:"agility",[n.StatStamina]:"stamina",[n.StatIntellect]:"intellect",[n.StatSpirit]:"spirit",[n.StatSpellPower]:"spellDamage",[n.StatMP5]:"mp5",[n.StatHitRating]:"hitRating",[n.StatCritRating]:"critRating",[n.StatHasteRating]:"hasteRating",[n.StatAttackPower]:"attackPower",[n.StatMasteryRating]:"masteryRating",[n.StatExpertiseRating]:"expertiseRating",[n.StatPvpResilienceRating]:"pvpResilienceRating",[n.StatPvpPowerRating]:"pvpPowerRating",[n.StatMana]:"mana",[n.StatArmor]:"armor",[n.StatRangedAttackPower]:"attackPower",[n.StatDodgeRating]:"dodgeRating",[n.StatParryRating]:"parryRating",[n.StatHealth]:"health",[n.StatBonusArmor]:"armorBonus"},_m.pseudoStatNames={[o.PseudoStatMainHandDps]:"dps",[o.PseudoStatRangedDps]:"rangedDps"};class xm extends Cm{constructor(e,t){super(e,t,{title:"CLI Export",allowDownload:!0})}getData(){const e=Gt.toJson(this.simUI.sim.makeRaidSimRequest(!1));return delete e.raid?.parties[0]?.players[0]?.database,JSON.stringify(e,null,2)}}class Tm extends Cm{constructor(e,t){super(e,t,{title:"JSON Export",allowDownload:!0,selectCategories:!0})}getData(){return Tm.getData(this.simUI,Ve(hl).filter(e=>this.exportCategories[e]))}static getData(e,t){return t||(t=ul.DEFAULT_CATEGORIES),Ut(ft.toJson(e.toProto(t)),2,(e,t)=>!!["stats","pseudoStats"].includes(t[t.length-1])||(["player","equipment","items"].every((e,a)=>t[a]==e)||!("player"!=t[0]||"rotation"!=t[1]||!["prepullActions","priorityList"].includes(t[2])))&&t.length>3)}}class Pm extends Cm{constructor(e,t){super(e,t,{title:"Shareable Link",selectCategories:!0})}getData(){return Pm.createLink(this.simUI,Ve(hl).filter(e=>this.exportCategories[e]))}static createLink(e,t){t||(t=ul.DEFAULT_CATEGORIES);const a=e.toProto(t),i=ft.toBinary(a),s=um.deflate(i,{to:"string"}),n=btoa(String.fromCharCode(...s)),o=new URL(window.location.href);if(o.hash=n,Ot(t,ul.DEFAULT_CATEGORIES))o.searchParams.delete(ul.CATEGORY_PARAM);else{const e=t.map(e=>ml.get(e)).join("");o.searchParams.set(ul.CATEGORY_PARAM,e)}return o.toString()}}const Rm=class e extends Cm{constructor(e,t){super(e,t,{title:"Pawn EP Export",allowDownload:!0})}getData(){const t=this.simUI.player,a=t.getEpWeights(),i=ve.getAll(),s={};return i.forEach(t=>{const i=e.getName(t),n=a.getUnitStat(t);0!=n&&""!=i&&(s[i]?s[i]+=n:s[i]=n)}),`( Pawn: v1: "${t.getPlayerSpec().friendlyName} WoWSims Weights": Class=${t.getPlayerClass().friendlyName},`+Object.keys(s).map(e=>`${e}=${s[e].toFixed(3)}`).join(",")+" )"}static getName(t){return t.isStat()?e.statNames[t.getStat()]:e.pseudoStatNames[t.getPseudoStat()]||""}};Rm.statNames={[n.StatStrength]:"Strength",[n.StatAgility]:"Agility",[n.StatStamina]:"Stamina",[n.StatIntellect]:"Intellect",[n.StatSpirit]:"Spirit",[n.StatSpellPower]:"SpellDamage",[n.StatMP5]:"Mp5",[n.StatHitRating]:"HitRating",[n.StatCritRating]:"CritRating",[n.StatHasteRating]:"HasteRating",[n.StatAttackPower]:"Ap",[n.StatMasteryRating]:"MasteryRating",[n.StatExpertiseRating]:"ExpertiseRating",[n.StatMana]:"Mana",[n.StatArmor]:"Armor",[n.StatRangedAttackPower]:"Ap",[n.StatDodgeRating]:"DodgeRating",[n.StatParryRating]:"ParryRating",[n.StatPvpResilienceRating]:"ResilienceRating",[n.StatPvpPowerRating]:"PVPPowerRating",[n.StatHealth]:"Health",[n.StatBonusArmor]:"Armor2"},Rm.pseudoStatNames={[o.PseudoStatMainHandDps]:"MeleeDps",[o.PseudoStatRangedDps]:"RangedDps"};let Dm=Rm;const Nm="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_";function Gm(e){let t=e,a=0;const i=[];for(let s=1;s<=5;s++){const e=5*s;if(t<1<<e){const e=[];for(;e.length<s;){const a=63&t;t>>=6,e.unshift(a)}return e[0]=e[0]|a,i.push(...e),i}t-=1<<e,a=(64|a)>>1}throw new Error("Value too large to encode.")}function Um(e){const t=[0];Object.keys(e).sort((e,t)=>Number(e)-Number(t)).forEach(a=>{const i=e[Number(a)];i&&(t.push(...Gm(parseInt(a))),t.push(...Gm(i)))});let a="";for(let i=0;i<t.length;i++)a+=Nm.charAt(t[i]);return a}function Om(e){let t="";const a=[4];a.push(...Gm(Lt)),a.push(1),a.push(...Gm(e.level??0)),a.push(e.specIndex??0);const i=function(e){let t=0;for(let a=e.length-1;a>=0;a--)t<<=2,t|=3&Math.min(4,parseInt(e.substring(a,a+1)));return Gm(t)}(e.talents);a.push(...i);const s=[Um(e.glyphs??[])];a.push(...Gm(s.length)),s.forEach(e=>{a.push(...Gm(e.length)),a.push(...e.split("").map(e=>Nm.indexOf(e)))});const n=e.items??[];a.push(...Gm(n.length)),n.forEach(e=>{let t=0;const i=[];if(i.push(...Gm(e.slotId??0)),i.push(...Gm(e.itemId??0)),t<<=1,e.randomEnchantId){t|=1;let a=e.randomEnchantId;const s=a<0?1:0;s&&(a*=-1),a<<=1,a|=s,i.push(...Gm(a))}t<<=1,e.upgradeRank&&(t|=1,i.push(...Gm(e.upgradeRank))),t<<=1,e.reforge&&(t|=1,i.push(...Gm(e.reforge)));const s=Am((e.gemItemIds??[]).slice(0,8));t<<=3,t|=s.length,s.forEach(e=>i.push(...Gm(e)));const n=Am((e.enchantIds??[]).slice(0,4));t<<=2,t|=n.length,n.forEach(e=>i.push(...Gm(e))),a.push(...Gm(t)),a.push(...i)});let o="";for(let l=0;l<a.length;l++)o+=Nm.charAt(a[l]);return o&&(t+=o),t}function Am(e){for(;e.length>0&&0===e[e.length-1];)e.pop();return e}class Lm extends Cm{constructor(e,t){super(e,t,{title:"Wowhead Export",allowDownload:!0}),this.getData()}getData(){const e=this.simUI.player,t=`https://www.wowhead.com/mop-classic/gear-planner/${e.getPlayerClass().friendlyName.replaceAll(/\s/g,"-").toLowerCase()}/${(e=>{const t=e.endsWith("(A)")?"alliance-":void 0,a=e.endsWith("(H)")?"horde-":void 0;return(t??a??"")+e.replaceAll(" (A)","").replaceAll(" (H)","").replaceAll(/\s/g,"-").toLowerCase()})(At.get(e.getRace()))}/`,a=e=>{const t=this.simUI.sim.db.glyphItemToSpellId(e);return t||0},i=e.getGlyphs(),s={level:Vt,specIndex:e.getPlayerSpec().specIndex,talents:e.getTalentsString(),glyphs:[a(i.major1),a(i.major2),a(i.major3),a(i.minor1),a(i.minor2),a(i.minor3)],items:[]},n=e.getGear();n.getItemSlots().sort((e,t)=>vm.slotIDs[e]-vm.slotIDs[t]).forEach(e=>{const t=n.getEquippedItem(e);if(!t)return;const a={slotId:vm.slotIDs[e],itemId:t.id};t._randomSuffix?.id&&(a.randomEnchantId=t._randomSuffix.id),a.enchantIds=[],t._enchant?.spellId&&a.enchantIds.push(t._enchant.spellId),t._tinker?.spellId&&a.enchantIds.push(t._tinker.spellId),r.ItemSlotHands,t._gems&&(a.gemItemIds=t._gems.map(e=>e?.id??0)),t._reforge&&(a.reforge=t._reforge.id),t._upgrade>0&&(a.upgradeRank=t._upgrade),s.items.push(a)});const o=function(e){return""+Om(e)}(s);return t+o}}class Vm extends we{constructor(a,i,s){super(a,"saved-data-manager-root"),this.modObject=i,this.config=s,this.userData=[],this.presets=[],this.frozen=!1,s.extraCssClasses&&this.rootElem.classList.add(...s.extraCssClasses);const n=new Go(this.rootElem,"saved-data",{header:s.header}),o=t(),l=t(),r=t();n.bodyElement.replaceChildren(e("div",{ref:o,className:"saved-data-container"},e("div",{ref:l,className:"saved-data-presets hide"}),e("div",{ref:r,className:"saved-data-custom hide"}))),this.savedDataDiv=o.value,this.presetDataDiv=l.value,this.customDataDiv=r.value,s.presetsOnly||this.config.loadOnly||n.bodyElement.appendChild(this.buildCreateContainer())}addSavedData(e){const t=this.makeSavedData(e),a=e.isPreset?this.presets:this.userData,i=a.findIndex(t=>t.name===e.name);-1===i?(e.isPreset?(this.presetDataDiv.classList.remove("hide"),this.presetDataDiv.appendChild(t.elem)):(this.customDataDiv.classList.remove("hide"),this.customDataDiv.appendChild(t.elem)),a.push(t)):(a[i].elem.replaceWith(t.elem),a[i]=t)}makeSavedData(a){const i=t(),s=e("div",{className:"saved-data-set-chip badge rounded-pill"},e("button",{className:"saved-data-set-name"},a.name),!this.config.loadOnly&&!a.isPreset&&e("button",{ref:i,className:"saved-data-set-delete"},e("i",{className:"fa fa-times fa-lg"})));if(s?.addEventListener("click",()=>{this.config.setData(Se.nextEventID(),this.modObject,a.data),a.onLoad?.(this.modObject),this.saveInput&&(this.saveInput.value=a.name)}),!this.config.loadOnly&&!a.isPreset&&i.value){const e=u(i.value,{content:`Delete saved ${this.config.label}`});i.value.addEventListener("click",t=>{t.stopPropagation();if(!confirm(`Delete saved ${this.config.label} '${a.name}'?`))return;e.destroy();const i=this.userData.findIndex(e=>e.name===a.name);this.userData[i].elem.remove(),this.userData.splice(i,1),this.saveUserData()})}a.tooltip&&u(s,{content:a.tooltip,placement:"bottom"});const n=()=>{this.config.equals(a.data,this.config.getData(this.modObject))?(s.classList.add("active"),this.saveInput&&(this.saveInput.value=a.name)):s.classList.remove("active"),a.enableWhen&&!a.enableWhen(this.modObject)?s.classList.add("disabled"):s.classList.remove("disabled")};n();const o=this.config.changeEmitters.map(e=>e.on(n));return this.addOnDisposeCallback(()=>o.map(e=>e.dispose())),{name:a.name,data:a.data,elem:s,enableWhen:a.enableWhen,onLoad:a.onLoad}}saveUserData(){const e={};this.userData.forEach(t=>{e[t.name]=this.config.toJson(t.data)}),this.presets.length||this.presetDataDiv.classList.add("hide"),this.userData.length||this.customDataDiv.classList.add("hide"),window.localStorage.setItem(this.config.storageKey,JSON.stringify(e))}loadUserData(){const e=window.localStorage.getItem(this.config.storageKey);if(!e)return;let t;try{t=JSON.parse(e)}catch(a){console.warn("Invalid json for local storage value: ",e,a)}for(const i in t)try{this.addSavedData({name:i,data:this.config.fromJson(t[i])})}catch(a){console.warn("Failed parsing saved data: ",t[i],a)}}freeze(){this.frozen=!0,this.rootElem.classList.add("frozen")}buildCreateContainer(){const a=t(),i=t(),s=e("div",{className:"saved-data-create-container"},e("label",{className:"form-label"},this.config.label," Name"),e("input",{ref:i,className:"saved-data-save-input form-control",type:"text",placeholder:"Name"}),e("button",{ref:a,className:"saved-data-save-button btn btn-primary"},"Save ",this.config.label));return this.saveInput=i.value,a.value?.addEventListener("click",()=>{if(this.frozen)return;const e=this.saveInput?.value;e?e in this.presets?alert(`${this.config.label} with name ${e} already exists.`):(this.addSavedData({name:e,data:this.config.getData(this.modObject)}),this.saveUserData()):alert(`Choose a label for your saved ${this.config.label}!`)}),s}}class Fm extends we{constructor(e,t,a){super(e,"summary-table-root"),this.rootElem.classList.add("hide"),this.simUI=t,this.player=a,this.container=new Go(this.rootElem,"summary-table-container",{header:{title:"Gem Summary",extraCssClasses:["summary-table--gems"]},extraCssClasses:["summary-table--gems"]}),a.gearChangeEmitter.on(()=>this.updateTable())}updateTable(){const a=e(l,null),i=this.player.getGear().getAllGems(this.player.isBlacksmithing()),s=!!i.length;if(this.rootElem.classList[s?"remove":"add"]("hide"),s){const s={};for(const e of i)s[e.name]?s[e.name].count+=1:s[e.name]={gem:e,count:1};for(const i of Object.keys(s)){const n=s[i],o=t(),l=t(),r=e("div",{className:"summary-table-row d-flex align-items-center"},e("a",{ref:o,className:"summary-table-link","data-whtticon":"false",target:"_blank"},e("img",{ref:l,className:"gem-icon"}),e("div",null,i)),e("div",null,n.count.toFixed(0)));a.appendChild(r);const c=o.value,h=l.value;ko(c,n.gem.quality),xe.fromItemId(n.gem.id).fill().then(e=>{h.src=e.iconUrl,e.setWowheadHref(c)})}if(this.container.bodyElement.replaceChildren(a),!this.container.headerElement)return;const n=this.container.headerElement.querySelector(".summary-table-reset-button"),o=e("button",{className:"btn btn-sm btn-link btn-reset summary-table-reset-button",onclick:()=>{this.player.setGear(Se.nextEventID(),this.player.getGear().withoutGems(this.player.canDualWield2H()))}},e("i",{className:"fas fa-times me-1"}),"Reset gems");n?this.container.headerElement.replaceChild(o,n):this.container.headerElement.appendChild(o)}}}const Wm=(e,t,a)=>{if(!!t!=!!a)return!1;const i=t?Ft.clone(t):void 0,s=a?Ft.clone(a):void 0;return i?.type===Wt.TypeAuto&&(i.type=Wt.TypeAPL),s?.type===Wt.TypeAuto&&(s.type=Wt.TypeAPL),s?.type===Wt.TypeSimple&&s?.simple?.specRotationJson?!!i?.simple&&e.specTypeFunctions.rotationEquals(e.specTypeFunctions.rotationFromJson(JSON.parse(s.simple.specRotationJson)),e.specTypeFunctions.rotationFromJson(JSON.parse(i.simple.specRotationJson))):Ft.equals(s,i)};function Mm(e){return e.cooldowns.filter(e=>e.id).map(e=>function(e,t){return zt.fromJsonString(`{"schedule":{"schedule":"${e}","innerAction":{"castSpell":{"spellId":${P.toJsonString(t)}}}}}`)}(e.timings.map(e=>e.toFixed(1)+"s").join(", "),e.id))}function zm(e,t,a){return[[Mt.fromJsonString('{"action":{"castSpell":{"spellId":{"otherId":"OtherActionPotion"}}},"doAtValue":{"const":{"val":"-1s"}}}')],[zt.fromJsonString('{"autocastOtherCooldowns":{}}'),Mm(e)].flat()]}var jm=(e=>(e.EPWeights="epWeights",e.Gear="gear",e.Talents="talents",e.Rotation="rotation",e.Encounter="encounter",e.Settings="settings",e))(jm||{});class Bm extends we{constructor(a,i,s){if(super(a,"preset-configuration-picker-root"),this.rootElem.classList.add("saved-data-manager-root"),this.simUI=i,this.builds=(this.simUI.individualConfig.presets.builds??[]).filter(e=>Object.keys(e).some(t=>s?.includes(t)&&!!e[t])),!this.builds.length)return void this.rootElem.classList.add("hide");const n=new Go(this.rootElem,"saved-data",{header:{title:"Preset Configurations",tooltip:"Preset configurations can apply an optimal combination of gear, talents, rotation and encounter settings."}}),o=t(),r=e("div",{className:"saved-data-container"},e("div",{className:"saved-data-presets",ref:o}));this.simUI.sim.waitForInit().then(()=>{this.builds.forEach(a=>{const i=t();o.value.appendChild(e("button",{className:"saved-data-set-chip badge rounded-pill",ref:i},e("span",{className:"saved-data-set-name",attributes:{role:"button"},onclick:()=>{const e=Se.nextEventID();Bm.applyBuild(e,a,this.simUI)}},a.name)));let s=Object.keys(a).filter(e=>!["name","encounter","settings"].includes(e)&&a[e]);a.encounter?.encounter&&s.push("encounter"),a.epWeights&&s.push("stat weights"),a.settings&&Object.keys(a.settings).forEach(e=>{["name","buffs","raidBuffs"].includes(e)||("options"===e?s.push("Class/Spec Options"):"consumes"===e?s.push("Consumables"):s.push("Other Settings"))}),(a.settings?.buffs||a.settings?.raidBuffs)&&s.push("buffs"),s=[...new Set(s)].sort(),u(i.value,{content:e(l,null,e("p",{className:"mb-1"},"This preset affects the following settings:"),e("ul",{className:"mb-0 text-capitalize"},s.map(t=>e("li",null,t))))});const n=()=>i.value.classList[this.isBuildActive(a)?"add":"remove"]("active");n(),Se.onAny([this.simUI.player.changeEmitter,this.simUI.sim.settingsChangeEmitter,this.simUI.sim.raid.changeEmitter,this.simUI.sim.encounter.changeEmitter]).on(n)}),n.bodyElement.replaceChildren(r)})}static applyBuild(e,{gear:t,itemSwap:a,rotation:i,rotationType:s,talents:n,epWeights:o,encounter:l,settings:r},c){Se.freezeAllAndDo(()=>{t&&c.player.setGear(e,c.sim.db.lookupEquipmentSpec(t.gear)),a?c.player.itemSwapSettings.setItemSwapSettings(e,!0,c.sim.db.lookupItemSwap(a.itemSwap),ke.fromProto(a.itemSwap.prepullBonusStats)):c.player.itemSwapSettings.setEnableItemSwap(e,!1),n&&(c.player.setTalentsString(e,n.data.talentsString),n.data.glyphs&&c.player.setGlyphs(e,n.data.glyphs)),s?(c.player.aplRotation.type=s,c.player.rotationChangeEmitter.emit(e)):i?.rotation.rotation&&c.player.setAplRotation(e,i.rotation.rotation),o&&c.player.setEpWeights(e,o.epWeights),r&&(r.race&&c.player.setRace(e,r.race),r.consumables&&c.player.setConsumes(e,r.consumables),r.playerOptions?.profession1&&c.player.setProfession1(e,r.playerOptions.profession1),r.playerOptions?.profession2&&c.player.setProfession2(e,r.playerOptions.profession2),"number"==typeof r.playerOptions?.distanceFromTarget&&c.player.setDistanceFromTarget(e,r.playerOptions.distanceFromTarget),"number"==typeof r.playerOptions?.reactionTimeMs&&c.player.setReactionTime(e,r.playerOptions.reactionTimeMs),"number"==typeof r.playerOptions?.channelClipDelayMs&&c.player.setChannelClipDelay(e,r.playerOptions.channelClipDelayMs),"boolean"==typeof r.playerOptions?.inFrontOfTarget&&c.player.setInFrontOfTarget(e,r.playerOptions.inFrontOfTarget),void 0!==r.playerOptions?.enableItemSwap&&r.playerOptions?.itemSwap&&c.player.itemSwapSettings.setItemSwapSettings(e,r.playerOptions.enableItemSwap,c.sim.db.lookupItemSwap(r.playerOptions.itemSwap),ke.fromProto(r.playerOptions.itemSwap.prepullBonusStats)),r.specOptions&&c.player.setSpecOptions(e,{...c.player.getSpecOptions(),...r.specOptions}),r.raidBuffs&&c.sim.raid.setBuffs(e,r.raidBuffs),r.buffs&&c.player.setBuffs(e,r.buffs),r.debuffs&&c.sim.raid.setDebuffs(e,r.debuffs)),l&&(l.encounter&&c.sim.encounter.fromProto(e,l.encounter),l.healingModel&&c.player.setHealingModel(e,l.healingModel),l.tanks&&c.sim.raid.setTanks(e,l.tanks),void 0!==l.targetDummies&&c.sim.raid.setTargetDummies(e,l.targetDummies))})}isBuildActive({gear:e,rotation:t,rotationType:a,talents:i,epWeights:s,encounter:n,settings:o}){const l=!e||S.equals(e.gear,this.simUI.player.getGear().asSpec()),r=!i||Dt.equals(i.data,Dt.create({talentsString:this.simUI.player.getTalentsString(),glyphs:this.simUI.player.getGlyphs()}));let c=!0;if(a)c=a===this.simUI.player.getRotationType();else if(t?.rotation.rotation){const e=this.simUI.player.getResolvedAplRotation();c=Wm(this.simUI.player,e,t.rotation.rotation)}const h=!s||this.simUI.player.getEpWeights().equals(s.epWeights),m=!n?.encounter||R.equals(n.encounter,this.simUI.sim.encounter.toProto()),d=!n?.healingModel||D.equals(n.healingModel,this.simUI.player.getHealingModel()),p=!o?.race||this.simUI.player.getRace()===o.race,u=void 0===o?.playerOptions?.profession1||this.simUI.player.getProfession1()===o.playerOptions.profession1,g=void 0===o?.playerOptions?.profession2||this.simUI.player.getProfession2()===o.playerOptions.profession2,f=void 0===o?.playerOptions?.distanceFromTarget||this.simUI.player.getDistanceFromTarget()===o.playerOptions.distanceFromTarget,w=void 0===o?.playerOptions?.enableItemSwap||this.simUI.player.itemSwapSettings.getEnableItemSwap()===o.playerOptions.enableItemSwap,y=void 0===o?.playerOptions?.itemSwap||N.equals(this.simUI.player.itemSwapSettings?.toProto(),o?.playerOptions?.itemSwap),b=!o?.specOptions||JSON.stringify(this.simUI.player.getSpecOptions())==JSON.stringify(o.specOptions),v=!o?.consumables||G.equals(this.simUI.player.getConsumes(),o.consumables),I=!o?.raidBuffs||U.equals(this.simUI.sim.raid.getBuffs(),o.raidBuffs),E=!o?.buffs||O.equals(this.simUI.player.getBuffs(),o.buffs),k=!o?.debuffs||A.equals(this.simUI.sim.raid.getDebuffs(),o.debuffs);return l&&r&&c&&h&&m&&d&&p&&u&&g&&f&&w&&y&&b&&v&&I&&E&&k}}class Hm extends we{constructor(e,t,a){super(e,"summary-table-root"),this.rootElem.classList.add("hide"),this.simUI=t,this.player=a,this.container=new Go(this.rootElem,"summary-table-container",{header:{title:"Reforge Summary"},extraCssClasses:["summary-table--reforge"]}),a.gearChangeEmitter.on(()=>this.updateTable())}updateTable(){const t=e(l,null),a=this.player.getGear().getAllReforges(),i={};for(const[e,n]of a){const{fromStat:e,toStat:t,fromAmount:a,toAmount:s}=n;"number"!=typeof i[e]&&(i[e]=0),"number"!=typeof i[t]&&(i[t]=0),a&&(i[e]+=a),s&&(i[t]+=s)}const s=!!Object.keys(i).length;if(this.rootElem.classList[s?"remove":"add"]("hide"),s){Object.keys(i).forEach(a=>{const s=Number(a),n=i[s];n&&t.appendChild(e("div",{className:"summary-table-row d-flex align-items-center"},e("div",null,Ne.get(s)),e("div",{className:""+(0===n?"":n>0?"positive":"negative")},n)))}),this.container.bodyElement.replaceChildren(t);const a=this.container.bodyElement.querySelector(".reforge-summary-footer");a&&a.remove();const s=e("div",{className:"reforge-summary-footer mt-2"}),n=e("div",{className:"d-flex w-100 justify-content-end"});if(s.appendChild(n),new fl(n,{extraCssClasses:["btn-outline-primary"],getContent:()=>{try{const e=this.simUI.toProto(),t=e?ft.toJson(e):{};return JSON.stringify(t)}catch(e){return""}},text:"Copy to Reforge Lite"}),this.container.bodyElement.appendChild(s),!this.container.headerElement)return;const o=this.container.headerElement.querySelector(".summary-table-reset-button"),l=e("button",{className:"btn btn-sm btn-link btn-reset summary-table-reset-button",onclick:()=>{const e=this.player.getGear().withoutReforges(this.player.canDualWield2H());this.player.setGear(Se.nextEventID(),e)}},e("i",{className:"fas fa-times me-1"}),"Reset Reforges");o?this.container.headerElement.replaceChild(l,o):this.container.headerElement.appendChild(l)}}}class qm extends Do{constructor(e,t){super(e,t,{identifier:"gear-tab",title:s.t("gear.title")}),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("gear-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("gear-tab-right","tab-panel-right"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildGearPickers(),this.buildSummaryTablesContainer(),this.buildPresetConfigurationPicker(),this.buildSavedGearsetPicker()}buildSummaryTablesContainer(){const e=document.createElement("div");e.classList.add("summary-tables-container"),this.leftPanel.appendChild(e),new Fm(e,this.simUI,this.simUI.player),new Hm(e,this.simUI,this.simUI.player)}buildGearPickers(){new Qo(this.leftPanel,this.simUI,this.simUI.player)}buildPresetConfigurationPicker(){new Bm(this.rightPanel,this.simUI,[jm.Gear])}buildSavedGearsetPicker(){const e=new Vm(this.rightPanel,this.simUI.player,{header:{title:"Gear Sets"},label:"Gear Set",storageKey:this.simUI.getSavedGearStorageKey(),getData:e=>jt.create({gear:e.getGear().asSpec(),bonusStatsStats:e.getBonusStats().toProto()}),setData:(e,t,a)=>{Se.freezeAllAndDo(()=>{t.setGear(e,this.simUI.sim.db.lookupEquipmentSpec(a.gear||S.create())),t.setBonusStats(e,ke.fromProto(a.bonusStatsStats||L.create()))})},changeEmitters:[this.simUI.player.changeEmitter],equals:(e,t)=>jt.equals(e,t),toJson:e=>jt.toJson(e),fromJson:e=>jt.fromJson(e)});this.simUI.sim.waitForInit().then(()=>{e.loadUserData(),this.simUI.individualConfig.presets.gear.forEach(t=>{e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:jt.create({gear:this.simUI.sim.db.lookupEquipmentSpec(t.gear).asSpec(),bonusStatsStats:(new ke).toProto()}),enableWhen:t.enableWhen,onLoad:t.onLoad})})})}}function Ym(e,t,a){return{inputs:e,label:t,categoryId:a,showWhen:t=>e.filter(e=>!e.showWhen||e.showWhen(t)).length>0}}function Km(e){const t=e.getModObject;return{id:e.id,type:"boolean",label:e.label,labelTooltip:e.labelTooltip,description:e.description,changedEvent:a=>e.changedEvent(t(a)),getValue:a=>e.getValue(t(a)),setValue:(a,i,s)=>e.setValue(a,t(i),s),enableWhen:e.enableWhen?a=>e.enableWhen(t(a)):void 0,showWhen:e.showWhen?a=>e.showWhen(t(a)):void 0,extraCssClasses:e.extraCssClasses}}function $m(e){return Km({id:`${String(e.fieldName)||Bt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,getModObject:e=>e,getValue:e.getValue||(t=>t.getClassOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getClassOptions();s[e.fieldName]=i,a.setClassOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function Jm(e){return Km({id:`${String(e.fieldName)||Bt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSpecOptions();s[e.fieldName]=i,a.setSpecOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function Zm(e){return Km({id:`${String(e.fieldName)||Bt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSimpleRotation();s[e.fieldName]=i,a.setSimpleRotation(t,s)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function Qm(e){const t=e.getModObject;return{id:e.id,type:"number",label:e.label,labelTooltip:e.labelTooltip,description:e.description,float:e.float,showZeroes:e.showZeroes,maxDecimalDigits:e.maxDecimalDigits,positive:e.positive,changedEvent:a=>e.changedEvent(t(a)),getValue:a=>e.getValue(t(a)),setValue:(a,i,s)=>e.setValue(a,t(i),s),enableWhen:e.enableWhen?a=>e.enableWhen(t(a)):void 0,showWhen:e.showWhen?a=>e.showWhen(t(a)):void 0,extraCssClasses:e.extraCssClasses}}const Xm=(e,t)=>Number(be(e/100,{maximumFractionDigits:t.maxDecimalDigits,useGrouping:!1})),ed=(e,t)=>Number(be(100*e,{maximumFractionDigits:t.maxDecimalDigits,useGrouping:!1}));function td(e){const t={id:`${String(e.fieldName)||Bt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,float:e.float,showZeroes:e.showZeroes,maxDecimalDigits:e.maxDecimalDigits,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getClassOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getClassOptions();e?.max&&i>e.max&&(i=e.max),s[e.fieldName]=i,a.setClassOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const a=t.getValue;t.getValue=t=>ed(a(t),e);const i=t.setValue;t.setValue=(t,a,s)=>i(t,a,Xm(s,e))}return Qm(t)}function ad(e){const t={id:`${String(e.fieldName)||Bt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,float:e.float,showZeroes:e.showZeroes,maxDecimalDigits:e.maxDecimalDigits,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSpecOptions();e?.max&&i>e.max&&(i=e.max),s[e.fieldName]=i,a.setSpecOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const a=t.getValue;t.getValue=t=>ed(a(t),e);const i=t.setValue;t.setValue=(t,a,s)=>i(t,a,Xm(s,e))}return Qm(t)}function id(e){const t={id:`${String(e.fieldName)||Bt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,float:e.float,showZeroes:e.showZeroes,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSimpleRotation();e?.max&&i>e.max&&(i=e.max),s[e.fieldName]=i,a.setSimpleRotation(t,s)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const a=t.getValue;t.getValue=t=>ed(a(t),e);const i=t.setValue;t.setValue=(t,a,s)=>i(t,a,Xm(s,e))}return Qm(t)}function sd(e){const t=e.getModObject;return{id:e.id,type:"enum",label:e.label,labelTooltip:e.labelTooltip,description:e.description,values:e.values,changedEvent:a=>e.changedEvent(t(a)),getValue:a=>e.getValue(t(a)),setValue:(a,i,s)=>e.setValue(a,t(i),s),enableWhen:e.enableWhen?a=>e.enableWhen(t(a)):void 0,showWhen:e.showWhen?a=>e.showWhen(t(a)):void 0}}function nd(e){return sd({id:`${String(e.fieldName)||Bt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSpecOptions();s[e.fieldName]=i,a.setSpecOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function od(e){return sd({id:`${String(e.fieldName)||Bt()}`,label:e.label,labelTooltip:e.labelTooltip,description:e.description,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSimpleRotation();s[e.fieldName]=i,a.setSimpleRotation(t,s)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function ld(e){const t=e.getModObject;return{type:"icon",actionId:e.actionId,label:e.label,states:e.states,changedEvent:a=>e.changedEvent(t(a)),showWhen:a=>!e.showWhen||e.showWhen(t(a)),getValue:a=>e.getValue(t(a)),setValue:(a,i,s)=>e.setValue(a,t(i),s),extraCssClasses:e.extraCssClasses}}function rd(e,t,a,i,s){return ld({getModObject:e.getModObject,actionId:t,label:s,states:2,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:e.getFieldValue||(t=>i?e.getValue(t)[a]==i:e.getValue(t)[a]),setValue:e.setFieldValue||((t,s,n)=>{const o=e.getValue(s);i?n?o[a]=i:o[a]==i&&(o[a]=0):o[a]=n,e.setValue(t,s,o)}),extraCssClasses:e.extraCssClasses})}function cd(e){return rd({getModObject:e=>e,getValue:e=>e.getClassOptions(),setValue:(e,t,a)=>t.setClassOptions(e,a),changeEmitter:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses,getFieldValue:e.getValue,setFieldValue:e.setValue,showWhen:e.showWhen},e.id,e.fieldName,e.value)}function hd(e,t,a,i,s,n){const o=function(e,t,a,i,s){return ld({getModObject:e.getModObject,actionId:t,label:s,states:0,changedEvent:e.changeEmitter,getValue:t=>e.getValue(t)[a],setValue:(t,s,n)=>{const o=e.getValue(s);if(i){const e=n-o[a];n+=(i-1)*e}n<0&&(n=0),o[a]=n,e.setValue(t,s,o)}})}(e,t,i,s,n);return o.states=a,o}function md(e){const t=e.getModObject;return{type:"iconEnum",numColumns:e.numColumns,values:e.values.map(e=>{if(e.showWhen){const a=e.showWhen;e.showWhen=e=>a(t(e))}return e}),equals:e.equals,showWhen:a=>!e.showWhen||e.showWhen(t(a)),zeroValue:e.zeroValue,changedEvent:a=>e.changedEvent(t(a)),getValue:a=>e.getValue(t(a)),setValue:(a,i,s)=>e.setValue(a,t(i),s),extraCssClasses:e.extraCssClasses}}function dd(e){return md({numColumns:e.numColumns||1,values:e.values,equals:(e,t)=>e==t,showWhen:e.showWhen,zeroValue:0,getModObject:e=>e,getValue:e.getValue||(t=>t.getClassOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getClassOptions();s[e.fieldName]=i,a.setClassOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses})}function pd(e){return md({numColumns:e.numColumns||1,values:e.values,equals:(e,t)=>e==t,showWhen:e.showWhen,zeroValue:0,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,a,i)=>{const s=a.getSpecOptions();s[e.fieldName]=i,a.setSpecOptions(t,s)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses})}class ud extends ye{constructor(a,i,s){super(a,"icon-enum-picker-root",i,s),this.rootElem.classList.add("icon-picker","vertical"===(s.direction??"vertical")?"dropdown":"dropend"),this.config=s,this.currentValue=this.config.zeroValue;const n=this.config.changedEvent(this.modObject).on(()=>{this.showWhen()?(this.restoreValue(),this.rootElem.classList.remove("hide")):(this.storeValue(),this.rootElem.classList.add("hide"))});if(this.addOnDisposeCallback(()=>n.dispose()),s.tooltip){const e=u(this.rootElem,{content:s.tooltip});this.addOnDisposeCallback(()=>e.destroy())}const o=t(),r=t(),c=t();this.rootElem.appendChild(e(l,null,e("a",{ref:o,href:"javascript:void(0)",className:"icon-picker-button",attributes:{"aria-expanded":"false",role:"button"},dataset:{bsToggle:"dropdown",whtticon:"false",disableWowheadTouchTooltip:"true"}}),e("ul",{ref:r,className:"dropdown-menu",style:{gridTemplateColumns:this.config.numColumns?`repeat(${this.config.numColumns}, 1fr)`:void 0,gridAutoFlow:"Horizontal"==this.config.direction?"column":void 0}}),e("label",{ref:c,className:"form-label"}))),this.buttonElem=o.value,this.buttonText=c.value;const h=r.value;this.config.values.forEach(e=>{const t=document.createElement("li");t.classList.add("icon-dropdown-option","dropdown-option"),h.appendChild(t);const a=document.createElement("a");a.classList.add("icon-picker-button"),a.dataset.whtticon="false",a.dataset.disableWowheadTouchTooltip="true",t.appendChild(a);const i=()=>{this.setImage(a,e),this.showValueWhen(e)?t.classList.remove("hide"):(t.classList.add("hide"),this.currentValue==e.value&&(this.setInputValue(this.config.zeroValue),this.inputChanged(Se.nextEventID())))},s=this.config.changedEvent(this.modObject).on(i);if(i(),a.addEventListener("click",t=>{t.preventDefault(),this.currentValue=e.value,this.storedValue=void 0,this.inputChanged(Se.nextEventID())},{signal:this.signal}),this.addOnDisposeCallback(()=>s.dispose()),e.tooltip){const t=u(a,{content:e.tooltip});this.addOnDisposeCallback(()=>t.destroy())}}),this.init()}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(this.config.zeroValue),this.inputChanged(Se.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(Se.nextEventID()),this.storedValue=void 0)}setActionImage(e,t){t.fillAndSet(e,!0,!0)}setImage(e,t){if(t.showWhen&&!t.showWhen(this.modObject))return void e.removeAttribute("href");const a=t.actionId;a?(this.setActionImage(e,a),e.style.filter=""):t.iconUrl?(e.style.backgroundImage=`url(${t.iconUrl})`,e.style.filter="grayscale(1)"):(e.style.backgroundImage="",e.style.filter="",e.style.backgroundColor=t.color)}update(){super.update(),this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue))}getInputElem(){return this.buttonElem}getInputValue(){return this.currentValue}setInputValue(e){this.currentValue=e,this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue)),this.buttonText.textContent="",this.buttonText.style.display="none";const t=this.config.values.find(e=>this.config.equals(e.value,this.currentValue));if(t)this.setImage(this.buttonElem,t),null!=t.text&&(this.buttonText.style.display="block",this.buttonText.textContent=t.text);else if(this.config.backupIconUrl){const e=this.config.backupIconUrl(this.currentValue);this.setActionImage(this.buttonElem,e),this.setActive(!1)}}setActive(e){e?this.buttonElem.classList.add("active"):this.buttonElem.classList.remove("active")}showWhen(){return(!this.config.showWhen||this.config.showWhen(this.modObject))&&!!this.config.values.find(e=>e.actionId&&null!=e.actionId&&(!e.showWhen||e.showWhen(this.modObject)))}showValueWhen(e){return(!e.actionId||null!=e.actionId)&&(!e.showWhen||e.showWhen(this.modObject))}}class gd extends ye{constructor(a,i,s){super(a,"icon-picker-root",i,s),this.rootElem.classList.add("icon-picker"),this.active=!1,this.config=s,this.currentValue=0,this.rootAnchor=document.createElement("a"),this.rootAnchor.classList.add("icon-picker-button"),this.rootAnchor.dataset.whtticon="false",this.rootAnchor.dataset.disableWowheadTouchTooltip="true",this.rootAnchor.target="_blank",this.rootElem.prepend(this.rootAnchor);const n=Boolean(this.config.improvedId);n&&this.rootAnchor.classList.add("use-improved-icons"),this.config.improvedId2&&this.rootAnchor.classList.add("use-improved-icons2"),!n&&this.config.states>2&&this.rootAnchor.classList.add("use-counter");const o=t(),l=t(),r=t();this.rootAnchor.appendChild(e("div",{className:"icon-input-level-container"},e("a",{ref:o,className:"icon-picker-button icon-input-improved icon-input-improved1",dataset:{whtticon:"false",disableWowheadTouchTooltip:"true"}}),e("a",{ref:l,className:"icon-picker-button icon-input-improved icon-input-improved2",dataset:{whtticon:"false",disableWowheadTouchTooltip:"true"}}),e("span",{ref:r,className:"icon-picker-label "+(this.config.states>2?"":"hide")}))),this.improvedAnchor=o.value,this.improvedAnchor2=l.value,this.counterElem=r.value,this.updateButtonImage();const c=this.config.changedEvent(this.modObject).on(()=>{this.updateButtonImage(),this.showWhen()?(this.rootElem.classList.remove("hide"),this.restoreValue()):(this.storeValue(),this.rootElem.classList.add("hide"))});this.init(),this.rootAnchor.addEventListener("click",e=>{e.preventDefault(),this.handleLeftClick()},{signal:this.signal}),this.rootAnchor.addEventListener("contextmenu",e=>{e.preventDefault()},{signal:this.signal}),this.rootAnchor.addEventListener("mousedown",e=>{je(e)&&(e.preventDefault(),this.handleRightClick())},{signal:this.signal}),this.addOnDisposeCallback(()=>c.dispose())}updateButtonImage(){this.config.actionId.fillAndSet(this.rootAnchor,!0,!0),this.config.states>=3&&this.config.improvedId&&this.config.improvedId.fillAndSet(this.improvedAnchor,!0,!0,{signal:this.signal}),this.config.states>=4&&this.config.improvedId2&&this.config.improvedId2.fillAndSet(this.improvedAnchor2,!0,!0,{signal:this.signal})}handleLeftClick(){0==this.config.states||this.currentValue+1<this.config.states?(this.currentValue++,this.inputChanged(Se.nextEventID())):this.currentValue>0&&(this.currentValue=0,this.inputChanged(Se.nextEventID()))}handleRightClick(){this.currentValue>0?this.currentValue--:0===this.config.states?this.currentValue=1:this.currentValue=this.config.states-1,this.inputChanged(Se.nextEventID())}getInputElem(){return this.rootAnchor}getInputValue(){return 2==this.config.states?Boolean(this.currentValue):this.currentValue}getActionId(){const e=Number(this.config.getValue(this.modObject));return 0==e?null:1==e?this.config.actionId:2==e&&this.config.improvedId?this.config.improvedId:3==e&&this.config.improvedId2?this.config.improvedId2:this.config.actionId}setInputValue(e){this.currentValue=Number(e),this.currentValue>0?(this.active=!0,this.rootAnchor.classList.add("active"),this.counterElem.classList.add("active")):(this.active=!1,this.rootAnchor.classList.remove("active"),this.counterElem.classList.remove("active")),this.config.states>=3&&this.config.improvedId&&(this.currentValue>1?this.improvedAnchor.classList.add("active"):this.improvedAnchor.classList.remove("active")),this.config.states>=4&&this.config.improvedId2&&(this.currentValue>2?(this.improvedAnchor2.classList.add("active"),this.improvedAnchor.hidden=!0,this.improvedAnchor2.hidden=!1):(this.improvedAnchor2.classList.remove("active"),this.improvedAnchor.hidden=!1,this.improvedAnchor2.hidden=!0)),!this.config.improvedId&&(this.config.states>3||0==this.config.states)&&(this.counterElem.textContent=String(this.currentValue))}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(0),this.inputChanged(Se.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(Se.nextEventID()),this.storedValue=void 0)}showWhen(){return null!=this.config.actionId&&(!this.config.showWhen||this.config.showWhen(this.modObject))}}const fd=(e,t,a)=>{if("icon"==a.type)return new gd(e,t,a);if("iconEnum"==a.type)return new ud(e,t,a);throw new Error("Unsupported input type")};function wd(e){return rd({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,a)=>t.getRaid().setBuffs(e,a),changeEmitter:e=>Se.onAny([e.getRaid().buffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value,e.label)}function yd(e){return rd({getModObject:e=>e,getValue:e=>e.getRaid().getDebuffs(),setValue:(e,t,a)=>t.getRaid().setDebuffs(e,a),changeEmitter:e=>Se.onAny([e.getRaid().debuffsChangeEmitter])},e.actionId,e.fieldName,e.value,e.label)}function bd(e){return hd({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,a)=>t.getRaid().setBuffs(e,a),changeEmitter:e=>Se.onAny([e.getRaid().buffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.numStates,e.fieldName,e.multiplier,e.label)}function Sd(e){return hd({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getBuffs(),setValue:(e,t,a)=>t.setBuffs(e,a),changeEmitter:e=>Se.onAny([e.buffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.numStates,e.fieldName,e.multiplier,e.label)}class vd extends ye{constructor(e,t,a){super(e,"enum-picker-root",t,a),this.selectElem=document.createElement("select"),this.selectElem.id=a.id,this.selectElem.classList.add("enum-picker-selector","form-select"),a.values.forEach(e=>{const t=document.createElement("option");t.value=String(e.value),t.textContent=e.name,this.selectElem.appendChild(t),e.tooltip&&(t.title=e.tooltip)}),this.rootElem.appendChild(this.selectElem),this.init(),this.selectElem.addEventListener("change",()=>{this.inputChanged(Se.nextEventID())},{signal:this.signal})}getInputElem(){return this.selectElem}getInputValue(){return Number(this.selectElem.value)}setInputValue(e){this.selectElem.value=String(e)}}const Id={actions:{create:{useIcon:!1}}};let Ed=null;const kd=class t extends ye{constructor(a,i,s){if(s.isCompact&&(s.extraCssClasses=[...s.extraCssClasses||[],"list-picker-compact"]),super(a,"list-picker-root",i,s),this.config={...Id,...s},this.itemPickerPairs=[],this.rootElem.appendChild(e(l,null,s.title&&e("label",{className:"list-picker-title form-label"},s.title),e("div",{className:"list-picker-items"}))),this.config.hideUi&&this.rootElem.classList.add("d-none"),this.config.horizontalLayout&&(this.config.inlineMenuBar=!0,this.rootElem.classList.add("horizontal")),this.config.titleTooltip){const e=u(this.rootElem.querySelector(".list-picker-title"),{content:this.config.titleTooltip});this.addOnDisposeCallback(()=>e?.destroy())}if(this.itemsDiv=this.rootElem.getElementsByClassName("list-picker-items")[0],this.actionEnabled("create")){let a=null,i=null;this.config.actions?.create?.useIcon?(a=t.makeActionElem("link-success","fa-plus"),i=u(a,{allowHTML:!1,content:`New ${s.itemLabel}`}),this.addOnDisposeCallback(()=>i?.destroy())):a=e("button",{className:"btn btn-primary"},"New ",s.itemLabel),a.classList.add("list-picker-new-button"),a.addEventListener("click",()=>{const e=this.config.newItem(),t=this.config.getValue(this.modObject).concat([e]);this.config.setValue(Se.nextEventID(),this.modObject,t),i&&i.hide()},{signal:this.signal}),this.rootElem.appendChild(a)}this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.itemPickerPairs.map(e=>e.picker.getInputValue())}setInputValue(e){if(e.length<this.itemPickerPairs.length)this.itemPickerPairs.slice(e.length).forEach(e=>e.elem.remove()),this.itemPickerPairs=this.itemPickerPairs.slice(0,e.length);else if(e.length>this.itemPickerPairs.length){const t=e.length-this.itemPickerPairs.length;for(let e=0;e<t;e++)this.addNewPicker()}e.forEach((e,t)=>this.itemPickerPairs[t].picker.setInputValue(e))}actionEnabled(e){return!this.config.allowedActions||this.config.allowedActions.includes(e)}addHoverListeners(e){e.addEventListener("mouseenter",()=>{e.classList.add("hover")},{signal:this.signal}),e.addEventListener("mouseleave",()=>{e.classList.remove("hover")},{signal:this.signal})}addNewPicker(){const e=this.itemPickerPairs.length,a=document.createElement("div");a.classList.add("list-picker-item-container"),this.config.inlineMenuBar&&a.classList.add("inline"),this.itemsDiv.appendChild(a);const i=document.createElement("div");i.classList.add("list-picker-item");const s=document.createElement("div");s.classList.add("list-picker-item-header");const n=document.createElement("div");n.classList.add("list-picker-item-popover"),n.setAttribute("popover","auto"),s.appendChild(n);let o=!1;if(this.config.inlineMenuBar)a.appendChild(i),a.appendChild(s);else if(a.appendChild(s),a.appendChild(i),this.config.itemLabel){const e=document.createElement("h6");e.classList.add("list-picker-item-title"),e.textContent=`${this.config.itemLabel} ${this.itemPickerPairs.length+1}`,s.appendChild(e)}const l=this.config.newItemPicker(i,this,e,{changedEvent:this.config.changedEvent,getValue:()=>this.getSourceValue()[e],setValue:(t,a,i)=>{const s=this.getSourceValue();s[e]=i,this.config.setValue(t,a,s)}}),r={elem:a,picker:l,idx:e};if(this.actionEnabled("delete")&&(!this.config.minimumItems||e+1>this.config.minimumItems)){o=!0;const a=t.makeActionElem("list-picker-item-delete","fa-times");a.classList.add("link-danger"),n.appendChild(a);const i=u(a,{allowHTML:!1,content:`Delete ${this.config.itemLabel}`});a.addEventListener("click",()=>{const t=this.config.getValue(this.modObject);t.splice(e,1),this.config.setValue(Se.nextEventID(),this.modObject,t),i.hide()},{signal:this.signal}),this.addOnDisposeCallback(()=>i?.destroy()),this.addHoverListeners(a)}if(this.actionEnabled("copy")){o=!0;const a=t.makeActionElem("list-picker-item-copy","fa-copy");n.appendChild(a);const i=u(a,{allowHTML:!1,content:`Copy to New ${this.config.itemLabel}`});a.addEventListener("click",()=>{const t=this.config.getValue(this.modObject).slice();t.splice(e,0,this.config.copyItem(t[e])),this.config.setValue(Se.nextEventID(),this.modObject,t),i.hide()},{signal:this.signal}),this.addOnDisposeCallback(()=>i?.destroy()),this.addHoverListeners(a)}if(this.actionEnabled("move")){o=!0,a.classList.add("draggable"),this.config.itemLabel&&a.classList.add(this.config.itemLabel.toLowerCase().replace(" ","-"));const i=t.makeActionElem("list-picker-item-move","fa-arrows-up-down");n.appendChild(i);const s=u(i,{allowHTML:!1,content:"Move (Drag+Drop)"});i.addEventListener("click",()=>{s.hide()},{signal:this.signal}),this.addOnDisposeCallback(()=>{s?.destroy()}),this.addHoverListeners(i),i.addEventListener("mousedown",()=>{i.setAttribute("draggable","true"),a.setAttribute("draggable","true")},{signal:this.signal}),i.addEventListener("mouseup",()=>{i.removeAttribute("draggable"),a.removeAttribute("draggable")},{signal:this.signal}),i.addEventListener("dragstart",e=>{if(e.target==i){const t=n.getBoundingClientRect();e.dataTransfer.setDragImage(a,0,t.height/2),e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",a.classList.add("dragfrom"),Ed={listPicker:this,item:r}}},{signal:this.signal});const l=()=>Ed&&"Action"===this.config.itemLabel&&Ed.listPicker!==this,c=()=>Ed&&Ed.listPicker===this&&Ed.item.idx===e,h=()=>Ed&&Ed.item.elem.contains(a),m=(e=!0)=>!Ed||Ed.listPicker.config.itemLabel!==this.config.itemLabel||(!!l()||(!(!e||!c())||!(!e||!h())));let d=0;a.addEventListener("dragenter",e=>{m()||(e.stopPropagation(),d++,a.classList.add("dragto"))},{signal:this.signal}),a.addEventListener("dragleave",e=>{m()||(e.preventDefault(),d--,d<=0&&a.classList.remove("dragto"))},{signal:this.signal}),a.addEventListener("dragover",e=>{m()?(l()||c())&&(e.dataTransfer.dropEffect="none"):(e.dataTransfer.dropEffect="move",e.stopPropagation(),e.preventDefault())},{signal:this.signal});const p=()=>{Ed&&(i.removeAttribute("draggable"),a.removeAttribute("draggable"),Ed.item.elem.removeAttribute("draggable"),[...document.querySelectorAll(".dragfrom,.dragto")].forEach(e=>{e.classList.remove("dragfrom"),e.classList.remove("dragto")}))};a.addEventListener("dragend",e=>{m(!1)||(e.stopPropagation(),p(),Ed=null)},{signal:this.signal}),a.addEventListener("drop",t=>{if(!Ed||m())return void(c()&&(t.stopPropagation(),p()));t.stopPropagation(),p();const i=Ed.item.idx;let s=e;const n=a.getBoundingClientRect();t.clientY>n.top+n.height/2&&s++;const o=this.config.getValue(this.modObject);let l;if(Ed.listPicker!==this){const e=Ed.listPicker.config.getValue(Ed.listPicker.modObject);l=e[i],e.splice(i,1),Ed.listPicker.config.setValue(Se.nextEventID(),Ed.listPicker.modObject,e)}else l=o[i],o.splice(i,1);o.splice(s,0,l),this.config.setValue(Se.nextEventID(),this.modObject,o),Ed=null},{signal:this.signal})}if(o){const e=t.makeActionElem("list-picker-item-actions","fa-ellipsis");s.appendChild(e),e.addEventListener("mouseover",()=>{n.showPopover();const t=e.getBoundingClientRect(),a=n.getBoundingClientRect(),i=(a.height-t.height)/2;n.style.top=t.top-i+"px",n.style.left=t.right-a.width+10+"px",n.classList.add("hover")},{signal:this.signal}),n.addEventListener("mouseleave",()=>{n.classList.remove("hover"),n.hidePopover()},{signal:this.signal})}this.itemPickerPairs.push(r)}static makeActionElem(t,a){return e("button",{type:"button",className:_e("list-picker-item-action",t)},e("i",{className:_e("fa","fa-xl",a)}))}static getItemHeaderElem(e){const t=e.rootElem.parentElement,a=t.nextElementSibling||t.previousElementSibling;if(!a?.classList.contains("list-picker-item-header"))throw new Error("Could not find list item header");return a}static makeListItemValidations(e,a,i){const s=t.makeActionElem("apl-validations","fa-exclamation-triangle");s.setAttribute("data-bs-html","true");const n=u(s,{theme:"dropdown-tooltip",content:"Warnings"});e.appendChild(s);const o=s.querySelector("i"),l=async()=>{if(!Ht(s))return n?.destroy(),s?.remove(),void a.currentStatsEmitter.off(l);n.setContent("");const e=i(a);if(e.length){s.style.removeProperty("display");const t=await Promise.all(e.map(async e=>({...e,validation:await xe.replaceAllInString(e.validation)})));let a=V.Undefined;const i=t.reduce((e,t)=>{const i=t.logLevel;a=Math.max(i,a);const s=e.get(i);return s?s.push(t.validation):e.set(i,[t.validation]),e},new Map);for(const[e,s]of this.logLevelDisplayData)o.classList.remove(s.icon);const l=this.logLevelDisplayData.get(a)?.icon;l&&o.classList.add(l);for(const[e,n]of Object.entries(V))s.classList[n===a?"add":"remove"](`apl-validation-${e.toLowerCase()}`);let r="";for(const[e,s]of i)r+=`\n\t\t\t\t\t\t<p>${this.logLevelDisplayData.get(e)?.header}</p>\n\t\t\t\t\t\t<ul>\n\t\t\t\t\t\t\t${s.map(e=>`<li>${e}</li>`).join("")}\n\t\t\t\t\t\t</ul>\n\t\t\t\t\t`;n.setContent(r)}else s.style.display="none"};l(),a.currentStatsEmitter.on(l)}};kd.logLevelDisplayData=new Map([[V.Information,{icon:"fa-info-circle",header:"Additional Information&#58;"}],[V.Warning,{icon:"fa-exclamation-triangle",header:"This action has warnings, and might not behave as expected."}],[V.Error,{icon:"fa-exclamation-triangle",header:"This action has errors, and will not behave as expected."}]]);let Cd=kd;class _d extends ye{constructor(e,t,a){super(e,"adaptive-string-picker-root",t,a),this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.id=a.id,this.inputElem.classList.add("form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",()=>{this.inputChanged(Se.nextEventID())},{signal:this.signal}),this.inputElem.addEventListener("input",()=>{this.updateSize()},{signal:this.signal}),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.inputElem.value}setInputValue(e){this.inputElem.value=e,this.updateSize()}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}const xd={auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().map(e=>({value:e.id}))},stackable_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter(e=>e.data.maxStacks>0).map(e=>({value:e.id}))},icd_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter(e=>e.data.hasIcd).map(e=>({value:e.id}))},exclusive_effect_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter(e=>e.data.hasExclusiveEffect).map(e=>({value:e.id}))},spells:{defaultLabel:"Spell",getActionIDs:async e=>e.getSpells().filter(e=>e.data.isCastable).map(e=>({value:e.id}))},castable_spells:{defaultLabel:"Spell",getActionIDs:async e=>{const t=e.getSpells().filter(e=>e.data.isCastable),{spells:a,cooldowns:i}=ea(t,e=>e.data.isMajorCooldown?"cooldowns":"spells"),s=[xe.fromOtherId(M.OtherActionPotion)];return[[{value:xe.fromEmpty(),headerText:"Spells",submenu:["Spells"]}],(a||[]).map(e=>({value:e.id,submenu:["Spells"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]})),[{value:xe.fromEmpty(),headerText:"Cooldowns",submenu:["Cooldowns"]}],(i||[]).map(e=>({value:e.id,submenu:["Cooldowns"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]})),[{value:xe.fromEmpty(),headerText:"Placeholders",submenu:["Placeholders"]}],s.map(e=>({value:e,submenu:["Placeholders"],tooltip:"The Prepull Potion if CurrentTime < 0, or the Combat Potion if combat has started."}))].flat()}},non_instant_spells:{defaultLabel:"Non-instant Spell",getActionIDs:async e=>e.getSpells().filter(e=>e.data.isCastable&&e.data.hasCastTime).map(e=>({value:e.id}))},friendly_spells:{defaultLabel:"Friendly Spell",getActionIDs:async e=>e.getSpells().filter(e=>e.data.isCastable&&e.data.isFriendly).map(e=>({value:e.id}))},channel_spells:{defaultLabel:"Channeled Spell",getActionIDs:async e=>e.getSpells().filter(e=>e.data.isCastable&&e.data.isChanneled).map(e=>({value:e.id}))},dot_spells:{defaultLabel:"DoT Spell",getActionIDs:async e=>e.getSpells().filter(e=>e.data.hasDot).filter((e,t,a)=>a.findIndex(t=>t.id.anyId()===e.id.anyId())===t).map(e=>({value:e.id}))},castable_dot_spells:{defaultLabel:"DoT Spell",getActionIDs:async e=>e.getSpells().filter(e=>e.data.isCastable&&e.data.hasDot).map(e=>({value:e.id}))},expected_dot_spells:{defaultLabel:"DoT Spell",getActionIDs:async e=>e.getSpells().filter(e=>e.data.hasExpectedTick).filter((e,t,a)=>a.findIndex(t=>t.id.anyId()===e.id.anyId())===t).map(e=>({value:e.id}))},shield_spells:{defaultLabel:"Shield Spell",getActionIDs:async e=>e.getSpells().filter(e=>e.data.hasShield).map(e=>({value:e.id}))}},Td=new qt;class Pd extends Qt{constructor(a,i,s){const n=xd[s.actionIdSet];super(a,i,{...s,sourceToValue:e=>e?xe.fromProto(e):xe.fromEmpty(),valueToSource:e=>e.toProto(),defaultLabel:n.defaultLabel,equals:(e,t)=>null==e==(null==t)&&(!e||e.equals(t)),setOptionContent:(a,i)=>{const n=i.value,o=["auras","stackable_auras","icd_auras","exclusive_effect_auras"].includes(s.actionIdSet),r=`${n.toString()}${o}`,c=Td.get(r)?.cloneNode(!0);c&&a.appendChild(c);const h=t(),m=e(l,null,e("a",{ref:h,className:"apl-actionid-item-icon",dataset:{whtticon:!1}}),n.name);a.appendChild(m),n.setBackgroundAndHref(h.value),n.setWowheadDataset(h.value,{useBuffAura:o}),Td.set(r,m)},createMissingValue:e=>0==e.anyId()?new Promise(()=>{n.defaultLabel}):e.fill().then(e=>({value:e})),values:[]});const o=s.getUnitRef,r="self"==s.defaultUnitRef?F.create({type:W.Self}):F.create({type:W.CurrentTarget}),c=n.getActionIDs,h=async()=>{const e=o(i),t=i.sim.getUnitMetadata(e,i,r);if(t){const e=await c(t);this.setOptions(e)}};h();const m=i.sim.unitMetadataEmitter.on(h),d=i.rotationChangeEmitter.on(h);this.addOnDisposeCallback(()=>{m.dispose(),d.dispose()})}}const Rd={aura_sources:{getUnits:e=>[void 0,e.getPetMetadatas().asList().map((e,t)=>F.create({type:W.Pet,index:t,owner:F.create({type:W.Self})})),F.create({type:W.CurrentTarget}),F.create({type:W.PreviousTarget}),F.create({type:W.NextTarget}),e.sim.raid.getActivePlayers().filter(t=>t!=e).map(e=>F.create({type:W.Player,index:e.getRaidIndex()})),e.sim.encounter.targetsMetadata.asList().map((e,t)=>F.create({type:W.Target,index:t}))].flat()},aura_sources_targets_first:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map((e,t)=>F.create({type:W.Target,index:t})),F.create({type:W.Self}),e.getPetMetadatas().asList().map((e,t)=>F.create({type:W.Pet,index:t,owner:F.create({type:W.Self})}))].flat()},targets:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map((e,t)=>F.create({type:W.Target,index:t})),F.create({type:W.PreviousTarget}),F.create({type:W.NextTarget})].flat()},players:{targetUI:!0,getUnits:e=>[void 0,e.sim.raid.getActivePlayers().map(e=>F.create({type:W.Player,index:e.getRaidIndex()}))].flat()}};class Dd extends Jt{constructor(e,t,a){const i=!!Rd[a.unitSet].targetUI;super(e,t,{...a,sourceToValue:e=>Dd.refToValue(e,t,i),valueToSource:e=>e.value,values:[],hideLabelWhenDefaultSelected:!0}),this.unitSet=a.unitSet,this.rootElem.classList.add("apl-unit-picker"),this.updateValues();const s=t.sim.unitMetadataEmitter.on(()=>this.updateValues());this.addOnDisposeCallback(()=>{s.dispose()})}static refToValue(e,t,a){if(!e||e.type==W.Unknown)return{value:e,iconUrl:a?"fa-bullseye":"fa-user",text:a?"Current Target":"Self"};if(e.type==W.Self)return{value:e,iconUrl:"fa-user",text:"Self"};if(e.type==W.CurrentTarget)return{value:e,iconUrl:"fa-bullseye",text:"Current Target"};if(e.type==W.PreviousTarget)return{value:e,iconUrl:"fa-arrow-left",text:"Previous Target"};if(e.type==W.NextTarget)return{value:e,iconUrl:"fa-arrow-right",text:"Next Target"};if(e.type==W.Player){const a=t.sim.raid.getPlayer(e.index);if(a)return{value:e,iconUrl:a.getSpecIcon(),text:`Player ${e.index+1}`}}else if(e.type==W.Target){if(t.sim.encounter.targetsMetadata.asList()[e.index])return{value:e,iconUrl:Zt,text:`Target ${e.index+1}`}}else if(e.type==W.Pet){const a=t.sim.getUnitMetadata(e,t,F.create({type:W.Self}));let i=`Pet ${e.index+1}`,s="fa-paw";if(a){const e=a.getName();if(e){const t=e.indexOf(" - ");i=e.substring(t+3),s=Xt(i)||s}}return{value:e,iconUrl:s,text:i}}return{value:e}}updateValues(){const e=Rd[this.unitSet],t=e.getUnits(this.modObject);this.setOptions(t.map(t=>{const a={value:Dd.refToValue(t,this.modObject,e.targetUI)};return t&&t.type==W.Pet&&(e.targetUI?a.submenu=[Dd.refToValue(t.owner,this.modObject,e.targetUI)]:a.submenu=[Dd.refToValue(void 0,this.modObject,e.targetUI)]),a}))}}class Nd extends ye{constructor(e,t,a){super(e,"apl-picker-builder-root",t,a),this.config=a,this.fieldPickers=a.fields.map(e=>Nd.makeFieldPicker(this,e)),this.init()}static makeFieldPicker(e,t){const a=t.field,i=t.factory(e.rootElem,e.modObject,{label:t.label,labelTooltip:t.labelTooltip,id:Bt(),changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const i=e.getSourceValue();return i[a]||(i[a]=t.newValue()),i[a]},setValue:(t,i,s)=>{e.getSourceValue()[a]=s,i.rotationChangeEmitter.emit(t)}},()=>e.getSourceValue());return"vals"!==a&&"actions"!==a||i.rootElem.classList.add("apl-picker-builder-multi"),{...t,picker:i}}getInputElem(){return this.rootElem}getInputValue(){const e=this.config.newValue();return this.fieldPickers.forEach(t=>{e[t.field]=t.picker.getInputValue()}),e}setInputValue(e){this.fieldPickers.forEach(t=>{t.picker.setInputValue(e[t.field])})}}function Gd(e,t,a,i,s){return{field:e,newValue:()=>P.create(),factory:(e,s,n,o)=>new Pd(e,s,{id:Bt(),...n,actionIdSet:t,getUnitRef:()=>a?o()[a]:F.create(),defaultUnitRef:i||"self"})}}function Ud(e,t,a){return{field:e,newValue:()=>{},factory:(e,a,i)=>new Dd(e,a,{id:Bt(),...i,unitSet:t})}}function Od(e,t,a){return{field:e,newValue:()=>!1,factory:(e,t,a)=>(a.extraCssClasses=["input-inline"].concat(a.extraCssClasses||[]),new Rt(e,t,{id:Bt(),...a})),...a||{},label:t}}function Ad(e,t,a){return{field:e,newValue:()=>0,factory:(e,a,i)=>{const s=i;return s.float=t,s.extraCssClasses=["input-inline"].concat(i.extraCssClasses||[]),new Co(e,a,s)},...a||{}}}function Ld(e,t){return{field:e,newValue:()=>"",factory:(e,t,a)=>(a.extraCssClasses=["input-inline"].concat(a.extraCssClasses||[]),new _d(e,t,{id:Bt(),...a})),...t||{}}}function Vd(e,t){const a=[{value:Kt.RuneBlood,label:"Blood"},{value:Kt.RuneFrost,label:"Frost"},{value:Kt.RuneUnholy,label:"Unholy"}];return t&&a.push({value:Kt.RuneDeath,label:"Death"}),{field:e,newValue:()=>Kt.RuneBlood,factory:(e,t,i)=>new Yt(e,t,{id:Bt(),...i,defaultLabel:"None",equals:(e,t)=>e==t,values:a})}}function Fd(e){return{field:e,newValue:()=>ta.SlotLeftBlood,factory:(e,t,a)=>new Yt(e,t,{id:Bt(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:ta.SlotLeftBlood,label:"Blood Left"},{value:ta.SlotRightBlood,label:"Blood Right"},{value:ta.SlotLeftFrost,label:"Frost Left"},{value:ta.SlotRightFrost,label:"Frost Right"},{value:ta.SlotLeftUnholy,label:"Unholy Left"},{value:ta.SlotRightUnholy,label:"Unholy Right"}]})}}function Wd(e){const t=Ve(n),a=[{value:-1,label:"None"}].concat(t.map(e=>({value:e,label:Pe(e)})));return{field:e,label:"Buff Type",newValue:()=>0,factory:(e,t,i)=>new Yt(e,t,{id:Bt(),...i,defaultLabel:"None",equals:(e,t)=>e==t,values:a})}}const Md=Ad("minIcdSeconds",!1,{label:"Min ICD",labelTooltip:"If non-zero, filter out any procs that either lack an ICD or for which the ICD is smaller than the specified value (in seconds). This can be useful for certain snapshotting checks, since procs with low ICDs are often too weak to snapshot."});function zd(e,t){return(a,i,s)=>new Nd(a,i,{...s,newValue:e,fields:t})}function jd(){return Od("includeReactionTime","Include Reaction Time",{labelTooltip:"If checked, will use the configured reaction time."})}class Bd extends ye{constructor(e,t,a){super(e,"apl-value-picker-root",t,a);const i=null!=this.rootElem.closest(".apl-prepull-action-picker"),s=Object.keys(Kd).filter(e=>(!!e&&Kd[e].includeIf?.(t,i))??!0);if(this.rootElem.parentElement.classList.contains("list-picker-item")){const e=Cd.getItemHeaderElem(this)||this.rootElem;Cd.makeListItemValidations(e,t,e=>e.getCurrentStats().rotationStats?.uuidValidations?.find(e=>e.uuid?.value===this.rootElem.id)?.validations||[])}this.kindPicker=new Yt(this.rootElem,t,{defaultLabel:"No Condition",id:Bt(),values:[{value:void 0,label:"<None>"}].concat(s.map(e=>{const a=Kd[e],i=a.dynamicStringResolver||(e=>e);return{value:e,label:i(a.label,t),submenu:a.submenu,tooltip:a.fullDescription?`<p>${i(a.shortDescription,t)}</p> ${i(a.fullDescription,t)}`:i(a.shortDescription,t)}})),equals:(e,t)=>e==t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.value.oneofKind,setValue:(e,t,a)=>{const i=this.getSourceValue(),s=i?.value.oneofKind;if(s!=a){if(a){const t=Kd[a];let n=this.makeAPLValue(a,t.newValue());i&&s&&this.valuePicker&&("not"==a?n.value.not.val=this.makeAPLValue(s,this.valuePicker.getInputValue()):"not"==i.value.oneofKind&&i.value.not.val?.value.oneofKind==a?n=i.value.not.val:"and"==a?"or"==i.value.oneofKind?n.value.and.vals=i.value.or.vals:n.value.and.vals=[this.makeAPLValue(s,this.valuePicker.getInputValue())]:"or"==a?"and"==i.value.oneofKind?n.value.or.vals=i.value.and.vals:n.value.or.vals=[this.makeAPLValue(s,this.valuePicker.getInputValue())]:"min"==a?"max"==i.value.oneofKind?n.value.min.vals=i.value.max.vals:n.value.min.vals=[this.makeAPLValue(s,this.valuePicker.getInputValue())]:"max"==a?"min"==i.value.oneofKind?n.value.max.vals=i.value.min.vals:n.value.max.vals=[this.makeAPLValue(s,this.valuePicker.getInputValue())]:"and"==i.value.oneofKind&&i.value.and.vals?.[0]?.value.oneofKind==a?n=i.value.and.vals[0]:"or"==i.value.oneofKind&&i.value.or.vals?.[0]?.value.oneofKind==a?n=i.value.or.vals[0]:"min"==i.value.oneofKind&&i.value.min.vals?.[0]?.value.oneofKind==a?n=i.value.min.vals[0]:"max"==i.value.oneofKind&&i.value.max.vals?.[0]?.value.oneofKind==a?n=i.value.max.vals[0]:"cmp"==a&&(n.value.cmp.lhs=this.makeAPLValue(s,this.valuePicker.getInputValue()))),i?i.value=n.value:this.setSourceValue(e,n)}else this.setSourceValue(e,void 0);t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.valuePicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return e?Vi.create({value:{oneofKind:e,...(()=>{const t={};return e&&this.valuePicker&&(t[e]=this.valuePicker.getInputValue()),t})()},uuid:{value:Bt()}}):void 0}setInputValue(e){const t=e?.value.oneofKind;this.updateValuePicker(t),t&&e&&this.valuePicker.setInputValue(e.value[t]),e&&(e.uuid&&""!=e.uuid.value||(e.uuid={value:Bt()}),this.rootElem.id=e.uuid.value)}makeAPLValue(e,t){if(!e)return Vi.create({uuid:{value:Bt()}});const a={oneofKind:e};return a[e]=t,Vi.create({value:a,uuid:{value:Bt()}})}updateValuePicker(e){const t=this.currentKind;if(e==t)return;if(this.currentKind=e,this.valuePicker&&(this.valuePicker.rootElem.remove(),this.valuePicker=null),!e)return;this.kindPicker.setInputValue(e);const a=Kd[e];this.valuePicker=a.factory(this.rootElem,this.modObject,{id:Bt(),changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const t=this.getSourceValue();return t&&t.value[e]||a.newValue()},setValue:(t,a,i)=>{const s=this.getSourceValue();s&&(s.value[e]=i),a.rotationChangeEmitter.emit(t)}})}}function Hd(e,t){return{field:e,newValue:()=>Vi.create({uuid:{value:Bt()}}),factory:(e,t,a)=>new Bd(e,t,a),...t||{}}}function qd(e){return{field:e,newValue:()=>[],factory:(e,t,a)=>new Cd(e,t,{...a,setValue:(e,t,i)=>{a.setValue(e,t,i.map(e=>e||Vi.create({uuid:{value:Bt()}})))},itemLabel:"Value",newItem:()=>Vi.create({uuid:{value:Bt()}}),copyItem:e=>e?Vi.clone(e):e,newItemPicker:(e,a,i,s)=>new Bd(e,t,s),allowedActions:["copy","create","delete","move"],actions:{create:{useIcon:!0}}})}}function Yd(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,newValue:e.newValue,includeIf:e.includeIf,factory:zd(e.newValue,e.fields),dynamicStringResolver:e.dynamicStringResolver}}const Kd={const:Yd({label:"Const",shortDescription:"A fixed value.",fullDescription:"\n\t\t<p>\n\t\t\tExamples:\n\t\t\t<ul>\n\t\t\t\t<li><b>Number:</b> '123', '0.5', '-10'</li>\n\t\t\t\t<li><b>Time:</b> '100ms', '5s', '3m'</li>\n\t\t\t\t<li><b>Percentage:</b> '30%'</li>\n\t\t\t</ul>\n\t\t</p>\n\t\t",newValue:Li.create,fields:[Ld("val")]}),cmp:Yd({label:"Compare",submenu:["Logic"],shortDescription:"Compares two values.",newValue:Ai.create,fields:[Hd("lhs"),($d="op",{field:$d,newValue:()=>Wi.OpEq,factory:(e,t,a)=>new Yt(e,t,{id:Bt(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Wi.OpEq,label:"=="},{value:Wi.OpNe,label:"!="},{value:Wi.OpGe,label:">="},{value:Wi.OpGt,label:">"},{value:Wi.OpLe,label:"<="},{value:Wi.OpLt,label:"<"}]})}),Hd("rhs")]}),math:Yd({label:"Math",submenu:["Logic"],shortDescription:"Do basic math on two values.",newValue:Oi.create,fields:[Hd("lhs"),function(e){return{field:e,newValue:()=>Fi.OpAdd,factory:(e,t,a)=>new Yt(e,t,{id:Bt(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Fi.OpAdd,label:"+"},{value:Fi.OpSub,label:"-"},{value:Fi.OpMul,label:"*"},{value:Fi.OpDiv,label:"/"}]})}}("op"),Hd("rhs")]}),max:Yd({label:"Max",submenu:["Logic"],shortDescription:"Returns the largest value among the subvalues.",newValue:Ui.create,fields:[qd("vals")]}),min:Yd({label:"Min",submenu:["Logic"],shortDescription:"Returns the smallest value among the subvalues.",newValue:Gi.create,fields:[qd("vals")]}),and:Yd({label:"All of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if all of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:Ni.create,fields:[qd("vals")]}),or:Yd({label:"Any of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if any of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:Di.create,fields:[qd("vals")]}),not:Yd({label:"Not",submenu:["Logic"],shortDescription:"Returns the opposite of the inner value, i.e. <b>True</b> if the value is <b>False</b> and vice-versa.",newValue:Ri.create,fields:[Hd("val")]}),currentTime:Yd({label:"Current Time",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration.",newValue:Pi.create,fields:[]}),currentTimePercent:Yd({label:"Current Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration, as a percentage.",newValue:Ti.create,fields:[]}),remainingTime:Yd({label:"Remaining Time",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration.",newValue:xi.create,fields:[]}),remainingTimePercent:Yd({label:"Remaining Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration, as a percentage.",newValue:_i.create,fields:[]}),isExecutePhase:Yd({label:"Is Execute Phase",submenu:["Encounter"],shortDescription:"<b>True</b> if the encounter is in Execute Phase, meaning the target's health is less than the given threshold, otherwise <b>False</b>.",newValue:Ci.create,fields:[function(e){return{field:e,newValue:()=>ts.E20,factory:(e,t,a)=>new Yt(e,t,{id:Bt(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:ts.E20,label:"20%"},{value:ts.E25,label:"25%"},{value:ts.E35,label:"35%"},{value:ts.E45,label:"45%"},{value:ts.E90,label:"90%"}]})}}("threshold")]}),numberTargets:Yd({label:"Number of Targets",submenu:["Encounter"],shortDescription:"Count of targets in the current encounter",newValue:ki.create,fields:[]}),frontOfTarget:Yd({label:"Front of Target",submenu:["Encounter"],shortDescription:"<b>True</b> if facing from of target",newValue:Ei.create,fields:[]}),bossSpellIsCasting:Yd({label:"Spell is Casting",submenu:["Boss"],shortDescription:"",newValue:Ii.create,fields:[Ud("targetUnit","targets"),Gd("spellId","non_instant_spells","targetUnit","currentTarget")]}),bossSpellTimeToReady:Yd({label:"Spell Time to Ready",submenu:["Boss"],shortDescription:"",newValue:vi.create,fields:[Ud("targetUnit","targets"),Gd("spellId","spells","targetUnit","currentTarget")]}),unitIsMoving:Yd({label:"Is moving",submenu:["Unit"],shortDescription:"",newValue:Si.create,fields:[Ud("sourceUnit","aura_sources")]}),unitDistance:Yd({label:"Distance",submenu:["Unit"],shortDescription:"Returns the distance to the specified unit.",newValue:bi.create,fields:[Ud("sourceUnit","aura_sources")]}),currentHealth:Yd({label:"Current Health",submenu:["Resources","Health"],shortDescription:"Amount of currently available Health.",newValue:yi.create,fields:[Ud("sourceUnit","aura_sources")]}),currentHealthPercent:Yd({label:"Current Health (%)",submenu:["Resources","Health"],shortDescription:"Amount of currently available Health, as a percentage.",newValue:wi.create,fields:[Ud("sourceUnit","aura_sources")]}),maxHealth:Yd({label:"Max Health",submenu:["Resources","Health"],shortDescription:"Amount of currently available maximum Health.",newValue:fi.create,fields:[]}),currentMana:Yd({label:"Current Mana",submenu:["Resources","Mana"],shortDescription:"Amount of currently available Mana.",newValue:gi.create,includeIf(e,t){const a=e.getClass();return a!==v.ClassDeathKnight&&a!==v.ClassHunter&&a!==v.ClassRogue&&a!==v.ClassWarrior},fields:[]}),currentManaPercent:Yd({label:"Current Mana (%)",submenu:["Resources","Mana"],shortDescription:"Amount of currently available Mana, as a percentage.",newValue:ui.create,includeIf(e,t){const a=e.getClass();return a!==v.ClassDeathKnight&&a!==v.ClassHunter&&a!==v.ClassRogue&&a!==v.ClassWarrior},fields:[]}),currentRage:Yd({label:"Current Rage",submenu:["Resources","Rage"],shortDescription:"Amount of currently available Rage.",newValue:pi.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===p.SpecFeralDruid||i===p.SpecGuardianDruid||a===v.ClassWarrior},fields:[]}),maxRage:Yd({label:"Max Rage",submenu:["Resources","Rage"],shortDescription:"Amount of maximum available Rage.",newValue:di.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===p.SpecFeralDruid||i===p.SpecGuardianDruid||a===v.ClassWarrior},fields:[]}),currentFocus:Yd({label:"Current Focus",submenu:["Resources","Focus"],shortDescription:"Amount of currently available Focus.",newValue:mi.create,includeIf:(e,t)=>e.getClass()==v.ClassHunter,fields:[]}),maxFocus:Yd({label:"Max Focus",submenu:["Resources","Focus"],shortDescription:"Amount of maximum available Focus.",newValue:hi.create,includeIf:(e,t)=>e.getClass()==v.ClassHunter,fields:[]}),focusRegenPerSecond:Yd({label:"Focus Regen Per Second",submenu:["Resources","Focus"],shortDescription:"Focus regen per second.",newValue:ci.create,includeIf:(e,t)=>e.getClass()==v.ClassHunter,fields:[]}),focusTimeToTarget:Yd({label:"Estimated Time To Target Focus",submenu:["Resources","Focus"],shortDescription:"Estimated time until target Focus is reached, will return 0 if at or above target.",newValue:ri.create,includeIf:(e,t)=>e.getClass()==v.ClassHunter,fields:[Hd("targetFocus")]}),currentEnergy:Yd({label:"Current Energy",submenu:["Resources","Energy"],shortDescription:"Amount of currently available Energy.",newValue:li.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===p.SpecFeralDruid||i===p.SpecGuardianDruid||a===v.ClassRogue||a===v.ClassMonk},fields:[]}),maxEnergy:Yd({label:"Max Energy",submenu:["Resources","Energy"],shortDescription:"Amount of maximum available Energy.",newValue:oi.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===p.SpecFeralDruid||i===p.SpecGuardianDruid||a===v.ClassRogue||a===v.ClassMonk},fields:[]}),energyRegenPerSecond:Yd({label:"Energy Regen Per Second",submenu:["Resources","Energy"],shortDescription:"Energy regen per second.",newValue:ni.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===p.SpecFeralDruid||i===p.SpecGuardianDruid||a===v.ClassRogue||a===v.ClassMonk},fields:[]}),energyTimeToTarget:Yd({label:"Estimated Time To Target Energy",submenu:["Resources","Energy"],shortDescription:"Estimated time until target Energy is reached, will return 0 if at or above target.",newValue:si.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===p.SpecFeralDruid||i===p.SpecGuardianDruid||a===v.ClassRogue||a===v.ClassMonk},fields:[Hd("targetEnergy")]}),currentComboPoints:Yd({label:"Current Combo Points",submenu:["Resources","Combo Points"],shortDescription:"Amount of currently available Combo Points.",newValue:ii.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===p.SpecFeralDruid||i===p.SpecGuardianDruid||a===v.ClassRogue},fields:[]}),maxComboPoints:Yd({label:"Max Combo Points",submenu:["Resources","Combo Points"],shortDescription:"Amount of maximum available Combo Points.",newValue:ai.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return i===p.SpecFeralDruid||i===p.SpecGuardianDruid||a===v.ClassRogue},fields:[]}),monkCurrentChi:Yd({label:"Current Chi",submenu:["Resources","Chi"],shortDescription:"Amount of currently available Chi.",newValue:na.create,includeIf:(e,t)=>e.getClass()===v.ClassMonk,fields:[]}),monkMaxChi:Yd({label:"Max Chi",submenu:["Resources","Chi"],shortDescription:"Amount of maximum available Chi.",newValue:ti.create,includeIf:(e,t)=>e.getClass()===v.ClassMonk,fields:[]}),currentRunicPower:Yd({label:"Current Runic Power",submenu:["Resources","Runic Power"],shortDescription:"Amount of currently available Runic Power.",newValue:ei.create,includeIf:(e,t)=>e.getClass()==v.ClassDeathKnight,fields:[]}),maxRunicPower:Yd({label:"Max Runic Power",submenu:["Resources","Runic Power"],shortDescription:"Amount of maximum available Runic Power.",newValue:Xa.create,includeIf:(e,t)=>e.getClass()==v.ClassDeathKnight,fields:[]}),currentSolarEnergy:Yd({label:"Solar Energy",submenu:["Resources","Eclipse"],shortDescription:"Amount of currently available Solar Energy.",newValue:Qa.create,includeIf:(e,t)=>e.getSpec()==p.SpecBalanceDruid,fields:[]}),currentLunarEnergy:Yd({label:"Lunar Energy",submenu:["Resources","Eclipse"],shortDescription:"Amount of currently available Lunar Energy",newValue:Za.create,includeIf:(e,t)=>e.getSpec()==p.SpecBalanceDruid,fields:[]}),druidCurrentEclipsePhase:Yd({label:"Current Eclipse Phase",submenu:["Resources","Eclipse"],shortDescription:"The eclipse phase the druid currently is in.",newValue:Ja.create,includeIf:(e,t)=>e.getSpec()==p.SpecBalanceDruid,fields:[function(e){const t=[{value:$t.LunarPhase,label:"Lunar"},{value:$t.SolarPhase,label:"Solar"},{value:$t.NeutralPhase,label:"Neutral"}];return{field:e,newValue:()=>Kt.RuneBlood,factory:(e,a,i)=>new Yt(e,a,{id:Bt(),...i,defaultLabel:"Lunar",equals:(e,t)=>e==t,values:t})}}("eclipsePhase")]}),currentGenericResource:Yd({label:"{GENERIC_RESOURCE}",submenu:["Resources"],shortDescription:"Amount of currently available {GENERIC_RESOURCE}.",newValue:$a.create,includeIf:(e,t)=>Xi.hasSecondaryResource(e.getSpec()),fields:[],dynamicStringResolver:(e,t)=>t.secondaryResource?.replaceResourceName(e)||""}),currentRuneCount:Yd({label:"Num Runes",submenu:["Resources","Runes"],shortDescription:"Amount of currently available Runes of certain type including Death.",newValue:Ka.create,includeIf:(e,t)=>e.getClass()==v.ClassDeathKnight,fields:[Vd("runeType",!0)]}),currentNonDeathRuneCount:Yd({label:"Num Non Death Runes",submenu:["Resources","Runes"],shortDescription:"Amount of currently available Runes of certain type ignoring Death",newValue:Ya.create,includeIf:(e,t)=>e.getClass()==v.ClassDeathKnight,fields:[Vd("runeType",!1)]}),currentRuneActive:Yd({label:"Rune Is Ready",submenu:["Resources","Runes"],shortDescription:"Is the rune of a certain slot currently available.",newValue:qa.create,includeIf:(e,t)=>e.getClass()==v.ClassDeathKnight,fields:[Fd("runeSlot")]}),currentRuneDeath:Yd({label:"Rune Is Death",submenu:["Resources","Runes"],shortDescription:"Is the rune of a certain slot currently converted to Death.",newValue:Ha.create,includeIf:(e,t)=>e.getClass()==v.ClassDeathKnight,fields:[Fd("runeSlot")]}),runeCooldown:Yd({label:"Rune Cooldown",submenu:["Resources","Runes"],shortDescription:"Amount of time until a rune of certain type is ready to use.<br><b>NOTE:</b> Returns 0 if there is a rune available",newValue:Ba.create,includeIf:(e,t)=>e.getClass()==v.ClassDeathKnight,fields:[Vd("runeType",!1)]}),nextRuneCooldown:Yd({label:"Next Rune Cooldown",submenu:["Resources","Runes"],shortDescription:"Amount of time until a 2nd rune of certain type is ready to use.<br><b>NOTE:</b> Returns 0 if there are 2 runes available",newValue:ja.create,includeIf:(e,t)=>e.getClass()==v.ClassDeathKnight,fields:[Vd("runeType",!1)]}),runeSlotCooldown:Yd({label:"Rune Slot Cooldown",submenu:["Resources","Runes"],shortDescription:"Amount of time until a rune of certain slot is ready to use.<br><b>NOTE:</b> Returns 0 if rune is ready",newValue:za.create,includeIf:(e,t)=>e.getClass()==v.ClassDeathKnight,fields:[Fd("runeSlot")]}),gcdIsReady:Yd({label:"GCD Is Ready",submenu:["GCD"],shortDescription:"<b>True</b> if the GCD is not on cooldown, otherwise <b>False</b>.",newValue:Ma.create,fields:[]}),gcdTimeToReady:Yd({label:"GCD Time To Ready",submenu:["GCD"],shortDescription:"Amount of time remaining before the GCD comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:Wa.create,fields:[]}),autoTimeToNext:Yd({label:"Time To Next Auto",submenu:["Auto"],shortDescription:"Amount of time remaining before the next Main-hand or Off-hand melee attack, or <b>0</b> if autoattacks are not engaged.",newValue:Fa.create,includeIf(e,t){const a=e.getClass(),i=e.getSpec();return a!==v.ClassHunter&&a!==v.ClassMage&&a!==v.ClassPriest&&a!==v.ClassWarlock&&i!==p.SpecBalanceDruid&&i!==p.SpecElementalShaman},fields:[]}),spellIsKnown:Yd({label:"Spell Known",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is currently known, otherwise <b>False</b>.",newValue:Va.create,fields:[Gd("spellId","castable_spells","")]}),spellCurrentCost:Yd({label:"Current Cost",submenu:["Spell"],shortDescription:"Returns current resource cost of spell",newValue:La.create,fields:[Gd("spellId","castable_spells","")]}),spellCanCast:Yd({label:"Can Cast",submenu:["Spell"],shortDescription:"<b>True</b> if all requirements for casting the spell are currently met, otherwise <b>False</b>.",fullDescription:"\n\t\t\t<p>The <b>Cast Spell</b> action does not need to be conditioned on this, because it applies this check automatically.</p>\n\t\t",newValue:Aa.create,fields:[Gd("spellId","castable_spells","")]}),spellIsReady:Yd({label:"Is Ready",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is not on cooldown, otherwise <b>False</b>.",newValue:Oa.create,fields:[Gd("spellId","castable_spells","")]}),spellTimeToReady:Yd({label:"Time To Ready",submenu:["Spell"],shortDescription:"Amount of time remaining before the spell comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:Ua.create,fields:[Gd("spellId","castable_spells","")]}),spellCastTime:Yd({label:"Cast Time",submenu:["Spell"],shortDescription:"Amount of time to cast the spell including any haste and spell cast time adjustments.",newValue:Ga.create,fields:[Gd("spellId","castable_spells","")]}),spellTravelTime:Yd({label:"Travel Time",submenu:["Spell"],shortDescription:"Amount of time for the spell to travel to the target.",newValue:Na.create,fields:[Gd("spellId","castable_spells","")]}),spellCpm:Yd({label:"CPM",submenu:["Spell"],shortDescription:"Casts Per Minute for the spell so far in the current iteration.",newValue:Da.create,fields:[Gd("spellId","castable_spells","")]}),spellIsChanneling:Yd({label:"Is Channeling",submenu:["Spell"],shortDescription:"<b>True</b> if this spell is currently being channeled, otherwise <b>False</b>.",newValue:Ra.create,fields:[Gd("spellId","channel_spells","")]}),spellChanneledTicks:Yd({label:"Channeled Ticks",submenu:["Spell"],shortDescription:"The number of completed ticks in the current channel of this spell, or <b>0</b> if the spell is not being channeled.",newValue:Pa.create,fields:[Gd("spellId","channel_spells","")]}),spellNumCharges:Yd({label:"Number of Charges",submenu:["Spell"],shortDescription:"The number of charges that are currently available for the spell.",newValue:Ta.create,fields:[Gd("spellId","castable_spells","")]}),spellTimeToCharge:Yd({label:"Time to next Charge",submenu:["Spell"],shortDescription:"The time until the next charge is available. 0 if spell has all charges avaialable.",newValue:xa.create,fields:[Gd("spellId","castable_spells","")]}),channelClipDelay:Yd({label:"Channel Clip Delay",submenu:["Spell"],shortDescription:"The amount of time specified by the <b>Channel Clip Delay</b> setting.",newValue:_a.create,fields:[]}),inputDelay:Yd({label:"Input Delay",submenu:["Spell"],shortDescription:"The amount of time specified by the <b>Input Dleay</b> setting.",newValue:Ca.create,fields:[]}),auraIsKnown:Yd({label:"Aura Known",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently known, otherwise <b>False</b>.",newValue:ka.create,fields:[Ud("sourceUnit","aura_sources"),Gd("auraId","auras","sourceUnit")]}),auraIsActive:Yd({label:"Aura Active",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active AND it has been active for at least as long as the player reaction time (configured in Settings), otherwise <b>False</b>.",newValue:()=>Qi.create({includeReactionTime:!0}),fields:[Ud("sourceUnit","aura_sources"),Gd("auraId","auras","sourceUnit"),jd()]}),auraIsActiveWithReactionTime:Yd({label:"[DEPRECATED] Aura Active (With Reaction Time)",submenu:["Aura"],shortDescription:"All Aura checks now contain Reaction Time logic, so this is no longer needed. Use <b Aura Active</b> instead.",newValue:()=>Qi.create({includeReactionTime:!0}),fields:[Ud("sourceUnit","aura_sources"),Gd("auraId","auras","sourceUnit")]}),auraIsInactive:Yd({label:"Aura Inactive",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is not currently active AND it has been inactive for at least as long as the player reaction time (configured in Settings), otherwise <b>False</b>.",newValue:()=>Zi.create({includeReactionTime:!0}),fields:[Ud("sourceUnit","aura_sources"),Gd("auraId","auras","sourceUnit"),jd()]}),auraIsInactiveWithReactionTime:Yd({label:"[DEPRECATED] Aura Inactive (With Reaction Time)",submenu:["Aura"],shortDescription:"All Aura checks now contain Reaction Time logic, so this is no longer needed. Use <b Aura Inactive</b> instead.",newValue:()=>Zi.create({includeReactionTime:!0}),fields:[Ud("sourceUnit","aura_sources"),Gd("auraId","auras","sourceUnit")]}),auraRemainingTime:Yd({label:"Aura Remaining Time",submenu:["Aura"],shortDescription:"Time remaining before this aura will expire, or 0 if the aura is not currently active.",newValue:Ea.create,fields:[Ud("sourceUnit","aura_sources"),Gd("auraId","auras","sourceUnit")]}),auraNumStacks:Yd({label:"Aura Num Stacks",submenu:["Aura"],shortDescription:"Number of stacks of the aura.",newValue:()=>Ji.create({includeReactionTime:!0}),fields:[Ud("sourceUnit","aura_sources"),Gd("auraId","stackable_auras","sourceUnit"),jd()]}),auraInternalCooldown:Yd({label:"Aura Remaining ICD",submenu:["Aura"],shortDescription:"Time remaining before this aura's internal cooldown will be ready, or <b>0</b> if the ICD is ready now.",newValue:Ia.create,fields:[Ud("sourceUnit","aura_sources"),Gd("auraId","icd_auras","sourceUnit")]}),auraIcdIsReady:Yd({label:"Aura ICD Is Ready",submenu:["Aura"],shortDescription:"<b>True</b> if the aura's ICD is currently ready OR it was put on CD recently, within the player's reaction time (configured in Settings), otherwise <b>False</b>.",newValue:()=>$i.create({includeReactionTime:!0}),fields:[Ud("sourceUnit","aura_sources"),Gd("auraId","icd_auras","sourceUnit"),jd()]}),auraIcdIsReadyWithReactionTime:Yd({label:"[DEPRECATED] Aura ICD Is Ready (With Reaction Time)",submenu:["Aura"],shortDescription:"All Aura checks now contain Reaction Time logic, so this is no longer needed. Use <b>Aura ICD Is Ready</b> instead.',",newValue:()=>$i.create({includeReactionTime:!0}),fields:[Ud("sourceUnit","aura_sources"),Gd("auraId","icd_auras","sourceUnit")]}),auraShouldRefresh:Yd({label:"Should Refresh Aura",submenu:["Aura"],shortDescription:"Whether this aura should be refreshed, e.g. for the purpose of maintaining a debuff.",fullDescription:"\n\t\t<p>This condition checks not only the specified aura but also any other auras on the same unit, including auras applied by other raid members, which apply the same debuff category.</p>\n\t\t<p>For example, 'Should Refresh Debuff(Sunder Armor)' will return <b>False</b> if the unit has an active Expose Armor aura.</p>\n\t\t",newValue:()=>Ki.create({maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[Ud("sourceUnit","aura_sources_targets_first"),Gd("auraId","exclusive_effect_auras","sourceUnit","currentTarget"),Hd("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before the aura expires when it may be refreshed."})]}),allTrinketStatProcsActive:Yd({label:"All Item Proc Buffs Active",submenu:["Aura Sets"],shortDescription:"<b>True</b> if all item/enchant procs that buff the specified stat type(s) are currently active, otherwise <b>False</b>.",fullDescription:"\n\t\t<p>For stacking proc buffs, this condition also checks that the buff has been stacked to its maximum possible strength.</p>\n\t\t",newValue:()=>Yi.create({statType1:-1,statType2:-1,statType3:-1}),fields:[Wd("statType1"),Wd("statType2"),Wd("statType3"),Md]}),anyTrinketStatProcsActive:Yd({label:"Any Item Proc Buff Active",submenu:["Aura Sets"],shortDescription:"<b>True</b> if any item/enchant procs that buff the specified stat type(s) are currently active, otherwise <b>False</b>.",fullDescription:"\n\t\t<p>For stacking proc buffs, this condition also checks that the buff has been stacked to its maximum possible strength.</p>\n\t\t",newValue:()=>qi.create({statType1:-1,statType2:-1,statType3:-1}),fields:[Wd("statType1"),Wd("statType2"),Wd("statType3"),Md]}),trinketProcsMinRemainingTime:Yd({label:"Item Procs Min Remaining Time",submenu:["Aura Sets"],shortDescription:"Shortest remaining duration on any active item/enchant procs that buff the specified stat type(s), or infinity if none are currently active.",newValue:()=>Hi.create({statType1:-1,statType2:-1,statType3:-1}),fields:[Wd("statType1"),Wd("statType2"),Wd("statType3"),Md]}),trinketProcsMaxRemainingIcd:Yd({label:"Item Procs Max Remaining ICD",submenu:["Aura Sets"],shortDescription:"Longest remaining ICD on any inactive item/enchant procs that buff the specified stat type(s), or 0 if all are currently active.",newValue:()=>Bi.create({statType1:-1,statType2:-1,statType3:-1}),fields:[Wd("statType1"),Wd("statType2"),Wd("statType3"),Md]}),numEquippedStatProcTrinkets:Yd({label:"Num Equipped Stat Proc Effects",submenu:["Aura Sets"],shortDescription:"Number of equipped passive item/enchant effects that buff the specified stat type(s) when they proc.",newValue:()=>ji.create({statType1:-1,statType2:-1,statType3:-1}),fields:[Wd("statType1"),Wd("statType2"),Wd("statType3"),Md]}),numStatBuffCooldowns:Yd({label:"Num Stat Buff Cooldowns",submenu:["Aura Sets"],shortDescription:"Number of registered Major Cooldowns that buff the specified stat type(s) when they are cast.",fullDescription:'\n\t\t<p>Both manually casted cooldowns as well as cooldowns controlled by "Cast All Stat Buff Cooldowns" and "Autocast Other Cooldowns" actions are included in the total count returned by this value.</p>\n\t\t',newValue:()=>zi.create({statType1:-1,statType2:-1,statType3:-1}),fields:[Wd("statType1"),Wd("statType2"),Wd("statType3")]}),anyStatBuffCooldownsActive:Yd({label:"Any Stat Buff Cooldowns Active",submenu:["Aura Sets"],shortDescription:"<b>True</b> if any registered Major Cooldowns that buff the specified stat type(s) are currently active, otherwise <b>False</b>.",fullDescription:'\n\t\t<p>For stacking buffs, this condition also checks that the buff has been stacked to its maximum possible strength after the cooldown is activated.</p>\n\t\t<p>Both manually casted cooldowns as well as cooldowns controlled by "Cast All Stat Buff Cooldowns" and "Autocast Other Cooldowns" actions are checked.</p>\n\t\t',newValue:()=>Mi.create({statType1:-1,statType2:-1,statType3:-1}),fields:[Wd("statType1"),Wd("statType2"),Wd("statType3")]}),dotIsActive:Yd({label:"Dot Is Active",submenu:["DoT"],shortDescription:"<b>True</b> if the specified dot is currently ticking, otherwise <b>False</b>.",newValue:va.create,fields:[Ud("targetUnit","targets"),Gd("spellId","dot_spells","")]}),dotIsActiveOnAllTargets:Yd({label:"Dot Is Active On All Targets",submenu:["DoT"],shortDescription:"<b>True</b> if the specified dot is currently ticking on all targets, otherwise <b>False</b>.",newValue:Sa.create,fields:[Gd("spellId","dot_spells")]}),dotRemainingTime:Yd({label:"Dot Remaining Time",submenu:["DoT"],shortDescription:"Time remaining before the last tick of this DoT will occur, or 0 if the DoT is not currently ticking.",newValue:ba.create,fields:[Ud("targetUnit","targets"),Gd("spellId","dot_spells","")]}),dotLowestRemainingTime:Yd({label:"Dot Lowest Remaining Time",submenu:["DoT"],shortDescription:"Time remaining before the last tick of this DoT on any target will occur, or 0 if the DoT is not currently ticking.",newValue:ya.create,fields:[Gd("spellId","dot_spells","")]}),dotTickFrequency:Yd({label:"Dot Tick Frequency",submenu:["DoT"],shortDescription:"The time between each tick.",newValue:wa.create,fields:[Ud("targetUnit","targets"),Gd("spellId","dot_spells","")]}),dotPercentIncrease:Yd({label:"Dot Damage Increase %",submenu:["DoT"],shortDescription:"How much stronger a new DoT would be compared to the old.",newValue:fa.create,fields:[Ud("targetUnit","targets"),Gd("spellId","expected_dot_spells","")]}),sequenceIsComplete:Yd({label:"Sequence Is Complete",submenu:["Sequence"],shortDescription:"<b>True</b> if there are no more subactions left to execute in the sequence, otherwise <b>False</b>.",newValue:ga.create,fields:[Ld("sequenceName")]}),sequenceIsReady:Yd({label:"Sequence Is Ready",submenu:["Sequence"],shortDescription:"<b>True</b> if the next subaction in the sequence is ready to be executed, otherwise <b>False</b>.",newValue:ua.create,fields:[Ld("sequenceName")]}),sequenceTimeToReady:Yd({label:"Sequence Time To Ready",submenu:["Sequence"],shortDescription:"Returns the amount of time remaining until the next subaction in the sequence will be ready.",newValue:pa.create,fields:[Ld("sequenceName")]}),totemRemainingTime:Yd({label:"Totem Remaining Time",submenu:["Shaman"],shortDescription:"Returns the amount of time remaining until the totem will expire.",newValue:da.create,includeIf:(e,t)=>e.getClass()==v.ClassShaman,fields:[function(e){return{field:e,newValue:()=>es.Water,factory:(e,t,a)=>new Yt(e,t,{id:Bt(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:es.Earth,label:"Earth"},{value:es.Air,label:"Air"},{value:es.Fire,label:"Fire"},{value:es.Water,label:"Water"}]})}}("totemType")]}),shamanFireElementalDuration:Yd({label:"Fire Elemental Total Duration",submenu:["Shaman"],shortDescription:"Returns the total duration of Fire Elemental Totem",newValue:ma.create,includeIf:(e,t)=>e.getClass()==v.ClassShaman,fields:[]}),catExcessEnergy:Yd({label:"Excess Energy",submenu:["Feral Druid"],shortDescription:"Returns the amount of excess energy available, after subtracting energy that will be needed to maintain DoTs.",newValue:ha.create,includeIf:(e,t)=>e.getSpec()==p.SpecFeralDruid,fields:[]}),catNewSavageRoarDuration:Yd({label:"New Savage Roar Duration",submenu:["Feral Druid"],shortDescription:"Returns duration of savage roar based on current combo points",newValue:ca.create,includeIf:(e,t)=>e.getSpec()==p.SpecFeralDruid,fields:[]}),warlockHandOfGuldanInFlight:Yd({label:"Hand of Guldan in Flight",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the impact of Hand of Guldan currenty is in flight.",newValue:ra.create,includeIf:(e,t)=>e.getSpec()==p.SpecDemonologyWarlock,fields:[]}),warlockHauntInFlight:Yd({label:"Haunt In Flight",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if Haunt currently is in flight.",newValue:la.create,includeIf:(e,t)=>e.getSpec()==p.SpecAfflictionWarlock,fields:[]}),mageCurrentCombustionDotEstimate:Yd({label:"Combustion Dot Value",submenu:["Mage"],shortDescription:"Returns the current estimated size of your Combustion Dot.",newValue:oa.create,includeIf:(e,t)=>e.getSpec()==p.SpecFireMage,fields:[]}),brewmasterMonkCurrentStaggerPercent:Yd({label:"Current Stagger (%)",submenu:["Tank"],shortDescription:"Amount of current Stagger, as a percentage.",newValue:na.create,includeIf:(e,t)=>e.getSpec()===p.SpecBrewmasterMonk,fields:[]}),protectionPaladinDamageTakenLastGlobal:Yd({label:"Damage Taken Last Global",submenu:["Tank"],shortDescription:"Amount of damage taken in the last 1.5s.",newValue:sa.create,includeIf:(e,t)=>e.getSpec()===p.SpecProtectionPaladin,fields:[]})};var $d;class Jd extends ye{constructor(e,t,a){super(e,"apl-action-picker-root",t,a),this.conditionPicker=new Bd(this.rootElem,this.modObject,{label:"If:",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.condition,setValue:(e,t,a)=>{const i=this.getSourceValue();i?(i.condition=a,t.rotationChangeEmitter.emit(e)):this.setSourceValue(e,zt.create({condition:a}))}}),this.conditionPicker.rootElem.classList.add("apl-action-condition","apl-priority-list-only"),this.actionDiv=document.createElement("div"),this.actionDiv.classList.add("apl-action-picker-action"),this.rootElem.appendChild(this.actionDiv);const i=null!=this.rootElem.closest(".apl-prepull-action-picker"),s=Object.keys(ep).filter(e=>ep[e].includeIf?.(t,i)??!0);this.kindPicker=new Yt(this.actionDiv,t,{id:Bt(),defaultLabel:"Action",values:s.map(e=>{const t=ep[e];return{value:e,label:t.label,submenu:t.submenu,tooltip:t.fullDescription?`<p>${t.shortDescription}</p> ${t.fullDescription}`:t.shortDescription}}),equals:(e,t)=>e==t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.action.oneofKind,setValue:(e,t,a)=>{const i=this.getSourceValue(),s=i?.action.oneofKind;if(s!=a){if(a){const t=ep[a];let n=this.makeAPLAction(a,t.newValue());i&&s&&this.actionPicker&&("sequence"==a?"strictSequence"==i.action.oneofKind?n.action.sequence.actions=i.action.strictSequence.actions:n.action.sequence.actions=[this.makeAPLAction(s,this.actionPicker.getInputValue())]:"strictSequence"==a?"sequence"==i.action.oneofKind?n.action.strictSequence.actions=i.action.sequence.actions:n.action.strictSequence.actions=[this.makeAPLAction(s,this.actionPicker.getInputValue())]:"sequence"==i.action.oneofKind&&i.action.sequence.actions?.[0]?.action.oneofKind==a?n=i.action.sequence.actions[0]:"strictSequence"==i.action.oneofKind&&i.action.strictSequence.actions?.[0]?.action.oneofKind==a&&(n=i.action.strictSequence.actions[0])),i?i.action=n.action:this.setSourceValue(e,n)}else i.action={oneofKind:a};t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.actionPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return zt.create({condition:this.conditionPicker.getInputValue(),action:{oneofKind:e,...(()=>{const t={};return e&&this.actionPicker&&(t[e]=this.actionPicker.getInputValue()),t})()}})}setInputValue(e){if(!e)return;this.conditionPicker.setInputValue(e.condition||Vi.create({uuid:{value:Bt()}}));const t=e.action.oneofKind;this.updateActionPicker(t),t&&this.actionPicker.setInputValue(e.action[t])}makeAPLAction(e,t){if(!e)return zt.create();const a={oneofKind:e};return a[e]=t,zt.create({action:a})}updateActionPicker(e){const t=this.currentKind;if(e==t)return;if(this.currentKind=e,this.actionPicker&&(this.actionPicker.rootElem.remove(),this.actionPicker=null),!e)return;this.kindPicker.setInputValue(e);const a=ep[e];this.actionPicker=a.factory(this.actionDiv,this.modObject,{changedEvent:e=>e.rotationChangeEmitter,getValue:()=>this.getSourceValue()?.action?.[e]||a.newValue(),setValue:(t,a,i)=>{const s=this.getSourceValue();s&&((s?.action)[e]=i),a.rotationChangeEmitter.emit(t)}}),this.actionPicker.rootElem.classList.add("apl-action-"+e)}}function Zd(e){return{field:e,newValue:()=>rs.Swap1,factory:(e,t,a)=>new Yt(e,t,{id:Bt(),...a,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:rs.Main,label:"Main"},{value:rs.Swap1,label:"Swapped"}]})}}function Qd(e){return{field:e,newValue:()=>[],factory:(e,t,a)=>new Cd(e,t,{...a,setValue:(e,t,i)=>{a.setValue(e,t,i.map(e=>e||zt.create()))},itemLabel:"Action",newItem:zt.create,copyItem:e=>e?zt.clone(e):e,newItemPicker:(e,a,i,s)=>new Jd(e,t,s),allowedActions:["create","delete","move"],actions:{create:{useIcon:!0}}})}}function Xd(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,includeIf:e.includeIf,newValue:e.newValue,factory:zd(e.newValue,e.fields)}}const ep={castSpell:Xd({label:"Cast",shortDescription:"Casts the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",newValue:ls.create,fields:[Gd("spellId","castable_spells",""),Ud("target","targets")]}),castFriendlySpell:Xd({label:"Cast at Player",shortDescription:"Casts a friendly spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",newValue:os.create,fields:[Gd("spellId","friendly_spells",""),Ud("target","players")],includeIf:(e,t)=>e.getRaid().size()>1||e.shouldEnableTargetDummies()}),multidot:Xd({label:"Multi Dot",submenu:["Casting"],shortDescription:"Keeps a DoT active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t,newValue:()=>Ts.create({maxDots:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[Gd("spellId","castable_dot_spells",""),Ad("maxDots",!1,{label:"Max Dots",labelTooltip:"Maximum number of DoTs to simultaneously apply."}),Hd("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a DoT expires when it may be refreshed."})]}),strictMultidot:Xd({label:"Strict Multi Dot",submenu:["Casting"],shortDescription:"Like a regular <b>Multi Dot</b>, except all Dots are applied immediately after each other. Keeps a DoT active on multiple targets by casting the specified spell. Will take Cast Time/GCD into account when refreshing subsequent DoTs.",includeIf:(e,t)=>!t,newValue:()=>xs.create({maxDots:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[Gd("spellId","castable_dot_spells",""),Ad("maxDots",!1,{label:"Max Dots",labelTooltip:"Maximum number of DoTs to simultaneously apply."}),Hd("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a DoT expires when it may be refreshed."})]}),multishield:Xd({label:"Multi Shield",submenu:["Casting"],shortDescription:"Keeps a Shield active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t&&e.getSpec().isHealingSpec,newValue:()=>_s.create({maxShields:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[Gd("spellId","shield_spells",""),Ad("maxShields",!1,{label:"Max Shields",labelTooltip:"Maximum number of Shields to simultaneously apply."}),Hd("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a Shield expires when it may be refreshed."})]}),channelSpell:Xd({label:"Channel",submenu:["Casting"],shortDescription:"Channels the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",fullDescription:"\n\t\t\t<p>The difference between channeling a spell vs casting the spell is that channels can be interrupted. If the <b>Interrupt If</b> parameter is empty, this action is equivalent to <b>Cast</b>.</p>\n\t\t\t<p>The channel will be interrupted only if all of the following are true:</p>\n\t\t\t<ul>\n\t\t\t\t<li>Immediately following a tick of the channel</li>\n\t\t\t\t<li>The <b>Interrupt If</b> condition evaluates to <b>True</b></li>\n\t\t\t\t<li>Another action in the APL list is available</li>\n\t\t\t</ul>\n\t\t\t<p>Note that if you simply want to allow other actions to interrupt the channel, set <b>Interrupt If</b> to <b>True</b>.</p>\n\t\t",newValue:()=>Cs.create({interruptIf:{value:{oneofKind:"gcdIsReady",gcdIsReady:{}}}}),fields:[Gd("spellId","channel_spells",""),Ud("target","targets"),Hd("interruptIf",{label:"Interrupt If",labelTooltip:"Condition which must be true to allow the channel to be interrupted."}),Od("allowRecast","Recast",{labelTooltip:"If checked, interrupts of this channel will recast the spell."})]}),castAllStatBuffCooldowns:Xd({label:"Cast All Stat Buff Cooldowns",submenu:["Casting"],shortDescription:"Casts all cooldowns that buff the specified stat type(s).",fullDescription:"\n\t\t\t<ul>\n\t\t\t\t<li>Does not cast cooldowns which are already controlled by other actions in the priority list.</li>\n\t\t\t\t<li>By default, this action will cast such cooldowns greedily as they become available. However, when embedded in a sequence, the action will only fire when ALL cooldowns matching the specified buff type(s) are ready.</li>\n\t\t\t</ul>\n\t\t",newValue:()=>ks.create({statType1:-1,statType2:-1,statType3:-1}),fields:[Wd("statType1"),Wd("statType2"),Wd("statType3")]}),autocastOtherCooldowns:Xd({label:"Autocast Other Cooldowns",submenu:["Casting"],shortDescription:"Auto-casts cooldowns as soon as they are ready.",fullDescription:"\n\t\t\t<ul>\n\t\t\t\t<li>Does not auto-cast cooldowns which are already controlled by other actions in the priority list.</li>\n\t\t\t\t<li>Cooldowns are usually cast immediately upon becoming ready, but there are some basic smart checks in place, e.g. don't use Mana CDs when near full mana.</li>\n\t\t\t</ul>\n\t\t",includeIf:(e,t)=>!t,newValue:ns.create,fields:[]}),wait:Xd({label:"Wait",submenu:["Timing"],shortDescription:"Pauses all APL actions for a specified amount of time.",includeIf:(e,t)=>!t,newValue:()=>Es.create({duration:{value:{oneofKind:"const",const:{val:"1000ms"}}}}),fields:[Hd("duration")]}),waitUntil:Xd({label:"Wait Until",submenu:["Timing"],shortDescription:"Pauses all APL actions until the specified condition is <b>True</b>.",includeIf:(e,t)=>!t,newValue:()=>Is.create(),fields:[Hd("condition")]}),schedule:Xd({label:"Scheduled Action",submenu:["Timing"],shortDescription:"Executes the inner action once at each specified timing.",includeIf:(e,t)=>!t,newValue:()=>vs.create({schedule:"0s, 60s",innerAction:{action:{oneofKind:"castSpell",castSpell:{}}}}),fields:[Ld("schedule",{label:"Do At",labelTooltip:"Comma-separated list of timings. The inner action will be performed once at each timing."}),function(e){return{field:e,newValue:()=>Vi.create({uuid:{value:Bt()}}),factory:(e,t,a)=>new Jd(e,t,a)}}("innerAction")]}),sequence:Xd({label:"Sequence",submenu:["Sequences"],shortDescription:"A list of sub-actions to execute in the specified order.",fullDescription:"\n\t\t\t<p>Once one of the sub-actions has been performed, the next sub-action will not necessarily be immediately executed next. The system will restart at the beginning of the whole actions list (not the sequence). If the sequence is executed again, it will perform the next sub-action.</p>\n\t\t\t<p>When all actions have been performed, the sequence does NOT automatically reset; instead, it will be skipped from now on. Use the <b>Reset Sequence</b> action to reset it, if desired.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:ss.create,fields:[Ld("name"),Qd("actions")]}),resetSequence:Xd({label:"Reset Sequence",submenu:["Sequences"],shortDescription:"Restarts a sequence, so that the next time it executes it will perform its first sub-action.",fullDescription:"\n\t\t\t<p>Use the <b>name</b> field to refer to the sequence to be reset. The desired sequence must have the same (non-empty) value for its <b>name</b>.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:is.create,fields:[Ld("sequenceName")]}),strictSequence:Xd({label:"Strict Sequence",submenu:["Sequences"],shortDescription:"Like a regular <b>Sequence</b>, except all sub-actions are executed immediately after each other and the sequence resets automatically upon completion.",fullDescription:"\n\t\t\t<p>Strict Sequences do not begin unless ALL sub-actions are ready.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:as.create,fields:[Qd("actions")]}),changeTarget:Xd({label:"Change Target",submenu:["Misc"],shortDescription:"Sets the current target, which is the target of auto attacks and most casts by default.",newValue:()=>Ss.create(),fields:[Ud("newTarget","targets")]}),activateAura:Xd({label:"Activate Aura",submenu:["Misc"],shortDescription:"Activates an aura",includeIf:(e,t)=>t,newValue:()=>bs.create(),fields:[Gd("auraId","auras")]}),activateAuraWithStacks:Xd({label:"Activate Aura With Stacks",submenu:["Misc"],shortDescription:"Activates an aura with the specified number of stacks",includeIf:(e,t)=>t,newValue:()=>ys.create({numStacks:1}),fields:[Gd("auraId","stackable_auras"),Ad("numStacks",!1,{label:"stacks",labelTooltip:"Desired number of initial aura stacks."})]}),activateAllStatBuffProcAuras:Xd({label:"Activate All Stat Buff Proc Auras",submenu:["Misc"],shortDescription:"Activates all item/enchant proc auras that buff the specified stat type(s) using the specified item set.",includeIf:(e,t)=>t,newValue:()=>ws.create({swapSet:rs.Main,statType1:-1,statType2:-1,statType3:-1}),fields:[Zd("swapSet"),Wd("statType1"),Wd("statType2"),Wd("statType3")]}),cancelAura:Xd({label:"Cancel Aura",submenu:["Misc"],shortDescription:"Deactivates an aura, equivalent to /cancelaura.",newValue:()=>fs.create(),fields:[Gd("auraId","auras")]}),triggerIcd:Xd({label:"Trigger ICD",submenu:["Misc"],shortDescription:"Triggers an aura's ICD, putting it on cooldown. Example usage would be to desync an ICD cooldown before combat starts.",includeIf:(e,t)=>t,newValue:()=>gs.create(),fields:[Gd("auraId","icd_auras")]}),itemSwap:Xd({label:"Item Swap",submenu:["Misc"],shortDescription:"Swaps items, using the swap set specified in Settings.",includeIf:(e,t)=>eg.includes(e.getSpec()),newValue:()=>us.create(),fields:[Zd("swapSet")]}),move:Xd({label:"Move",submenu:["Misc"],shortDescription:"Starts a move to the desired range from target.",newValue:()=>ps.create(),fields:[Hd("rangeFromTarget",{label:"to Range",labelTooltip:"Desired range from target."})]}),moveDuration:Xd({label:"Move duration",submenu:["Misc"],shortDescription:"The characters moves for the given duration.",newValue:()=>ds.create(),fields:[Hd("duration",{label:"Duration",labelTooltip:"Amount of time the character should move."})]}),customRotation:Xd({label:"Custom Rotation",shortDescription:"INTERNAL ONLY",includeIf:(e,t)=>!1,newValue:()=>ms.create(),fields:[]}),catOptimalRotationAction:Xd({label:"Optimal Rotation Action",submenu:["Feral Druid"],shortDescription:"Executes optimized Feral DPS rotation using hardcoded algorithm.",includeIf:(e,t)=>e.getSpec()==p.SpecFeralDruid,newValue:()=>hs.create({rotationType:ia.SingleTarget,manualParams:!0,minRoarOffset:40,ripLeeway:4,useBite:!0,biteTime:11,berserkBiteTime:7,allowAoeBerserk:!1,bearWeave:!0,snekWeave:!0,useNs:!0,wrathWeave:!1}),fields:[function(e){const t=[{value:ia.SingleTarget,label:"Single Target"},{value:ia.Aoe,label:"AOE"}];return{field:e,label:"Type",newValue:()=>ia.SingleTarget,factory:(e,a,i)=>new Yt(e,a,{id:Bt(),...i,defaultLabel:"Single Target",equals:(e,t)=>e==t,values:t})}}("rotationType"),Od("bearWeave","Enable bear-weaving",{labelTooltip:"Weave into Bear Form while pooling Energy. Ignored for AoE rotation."}),Od("snekWeave","Use Albino Snake",{labelTooltip:"Reset swing timer at the end of bear-weaves using Albino Snake pet. Ignored if not bear-weaving."}),Od("useNs","Use Nature's Swiftness",{labelTooltip:"Use Nature's Swiftness to fill gaps in Predatory Swiftness uptime. Ignored if Dream of Cenarius is not talented."}),Od("wrathWeave","Enable Wrath-weaving",{labelTooltip:"Cast Wrath when possible during the Heart of the Wild DPS window. Ignored if HotW is not talented."}),Od("allowAoeBerserk","Allow AoE Berserk",{labelTooltip:"Allow Berserk usage in AoE rotation. Ignored for single target rotation."}),Od("manualParams","Manual Advanced Parameters",{labelTooltip:"Manually specify advanced parameters, otherwise will use preset defaults."}),Ad("minRoarOffset",!0,{label:"Roar Offset",labelTooltip:"Targeted offset in Rip/Roar timings. Ignored for AOE rotation or if not using manual advanced parameters."}),Ad("ripLeeway",!1,{label:"Rip Leeway",labelTooltip:"Rip leeway when optimizing Roar clips. Ignored for AOE rotation or if not using manual advanced parameters."}),Od("useBite","Bite during rotation",{labelTooltip:"Use Bite during rotation rather than exclusively at end of fight. Ignored for AOE rotation or if not using manual advanced parameters."}),Ad("biteTime",!0,{label:"Bite Time",labelTooltip:"Min seconds remaining on Rip/Roar to allow a Bite. Ignored if not Biting during rotation."}),Ad("berserkBiteTime",!0,{label:"Bite Time during Berserk",labelTooltip:"More aggressive threshold when Berserk is active."})]}),guardianHotwDpsRotation:Xd({label:"HotW DPS Rotation",submenu:["Guardian Druid"],shortDescription:"Executes optimized HotW DPS rotation using hardcoded algorithm.",includeIf:(e,t)=>e.getSpec()==p.SpecGuardianDruid,newValue:()=>cs.create({strategy:aa.Caster}),fields:[function(e){const t=[{value:aa.Caster,label:"Caster"},{value:aa.Cat,label:"Cat"},{value:aa.Hybrid,label:"Hybrid"}];return{field:e,label:"Strategy",newValue:()=>aa.Caster,factory:(e,a,i)=>new Yt(e,a,{id:Bt(),...i,defaultLabel:"Caster",equals:(e,t)=>e==t,values:t})}}("strategy")]})};class tp extends we{constructor(e,t,a){super(e,"apl-rotation-picker-root"),new Cd(this.rootElem,a,{extraCssClasses:["apl-prepull-action-picker"],title:"Prepull Actions",titleTooltip:"Actions to perform before the pull.",itemLabel:"Prepull Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.prepullActions,setValue:(e,t,a)=>{t.aplRotation.prepullActions=a,t.rotationChangeEmitter.emit(e)},newItem:()=>Mt.create({action:{},doAtValue:{value:{oneofKind:"const",const:{val:"-1s"}}}}),copyItem:e=>Mt.clone(e),newItemPicker:(e,t,i,s)=>new ap(e,a,s,i),inlineMenuBar:!0}),new Cd(this.rootElem,a,{extraCssClasses:["apl-list-item-picker"],title:"Priority List",titleTooltip:"At each decision point, the simulation will perform the first valid action from this list.",itemLabel:"Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.priorityList,setValue:(e,t,a)=>{t.aplRotation.priorityList=a,t.rotationChangeEmitter.emit(e)},newItem:()=>Ps.create({action:{}}),copyItem:e=>Ps.clone(e),newItemPicker:(e,t,i,s)=>new ip(e,a,s,i),inlineMenuBar:!0})}}class ap extends ye{getItem(){return this.getSourceValue()||Mt.create({action:{}})}constructor(e,t,a,i){a.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",t,a),this.player=t;const s=Cd.getItemHeaderElem(this);Cd.makeListItemValidations(s,t,e=>e.getCurrentStats().rotationStats?.prepullActions[i]?.validations||[]),this.hidePicker=new sp(s,t,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,a)=>{this.getItem().hide=a,this.player.rotationChangeEmitter.emit(e)}}),this.doAtPicker=new _d(this.rootElem,this.player,{id:Bt(),label:"Do At",labelTooltip:"Time before pull to do the action. Should be negative, and formatted like, '-1s' or '-2500ms'.",extraCssClasses:["apl-prepull-actions-doat"],changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().doAtValue?.value?.const.val||"",setValue:(e,t,a)=>{this.getItem().doAtValue=a?Vi.create({value:{oneofKind:"const",const:{val:a}},uuid:{value:Bt()}}):void 0,this.player.rotationChangeEmitter.emit(e)},inline:!0}),this.actionPicker=new Jd(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,a)=>{this.getItem().action=a,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getInputElem(){return this.rootElem}getInputValue(){return Mt.create({hide:this.hidePicker.getInputValue(),doAtValue:{value:{oneofKind:"const",const:{val:this.doAtPicker.getInputValue()}}},action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.doAtPicker.setInputValue(e.doAtValue?.value?.const.val||""),this.actionPicker.setInputValue(e.action||zt.create()))}}class ip extends ye{getItem(){return this.getSourceValue()||Ps.create({action:{}})}constructor(e,t,a,i){a.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",t,a),this.player=t;const s=Cd.getItemHeaderElem(this);Cd.makeListItemValidations(s,t,e=>e.getCurrentStats().rotationStats?.priorityList[i]?.validations||[]),this.hidePicker=new sp(s,t,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,a)=>{this.getItem().hide=a,this.player.rotationChangeEmitter.emit(e)}}),this.actionPicker=new Jd(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,a)=>{this.getItem().action=a,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getInputElem(){return this.rootElem}getInputValue(){return Ps.create({hide:this.hidePicker.getInputValue(),action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.actionPicker.setInputValue(e.action||zt.create()))}}class sp extends ye{constructor(e,t,a){super(e,"hide-picker-root",t,a),this.inputElem=Cd.makeActionElem("hide-picker-button","fa-eye"),this.iconElem=this.inputElem.childNodes[0],this.inputElem.addEventListener("click",()=>{this.setInputValue(!this.getInputValue()),this.inputChanged(Se.nextEventID())},{signal:this.signal}),this.rootElem.appendChild(this.inputElem),this.tooltip=u(this.inputElem,{content:"Enable/Disable"}),this.addOnDisposeCallback(()=>this.tooltip.destroy()),this.init()}getInputElem(){return this.inputElem}getInputValue(){return this.iconElem.classList.contains("fa-eye-slash")}setInputValue(e){e?(this.iconElem.classList.add("fa-eye-slash"),this.iconElem.classList.remove("fa-eye"),this.tooltip.setContent("Enable Action")):(this.iconElem.classList.add("fa-eye"),this.iconElem.classList.remove("fa-eye-slash"),this.tooltip.setContent("Disable Action"))}}class np extends ye{constructor(e,t,a){super(e,"number-list-picker-root",t,a),this.inputElem=document.createElement("input"),this.inputElem.id=a.id,this.inputElem.type="text",this.inputElem.placeholder=a.placeholder||"",this.inputElem.classList.add("number-list-picker-input","form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",()=>{this.inputChanged(Se.nextEventID())},{signal:this.signal})}getInputElem(){return this.inputElem}getInputValue(){const e=this.inputElem.value;return e?e.split(",").map(parseFloat).filter(e=>!isNaN(e)):[]}setInputValue(e){Ot(this.getInputValue(),e)||(this.inputElem.value=e.map(e=>String(e)).join(","))}}class op extends we{constructor(e,t){super(e,"cooldowns-picker-root"),this.player=t,this.cooldownPickers=[];const a=Se.onAny([this.player.rotationChangeEmitter,this.player.sim.unitMetadataEmitter]).on(()=>{Ht(this.rootElem)?this.update():this.dispose()});this.addOnDisposeCallback(()=>{this.rootElem.remove(),this.cooldownPickers.forEach(e=>e.remove()),a.dispose()}),this.update()}update(){this.rootElem.innerHTML="";const e=this.player.getSimpleCooldowns().cooldowns;this.cooldownPickers=[];for(let t=0;t<e.length+1;t++){const a=e[t],i=document.createElement("div");i.classList.add("cooldown-picker"),t==e.length&&i.classList.add("add-cooldown-picker"),this.rootElem.appendChild(i),this.makeActionPicker(i,t);const s=document.createElement("label");s.classList.add("cooldown-picker-label","form-label"),a&&a.id&&xe.fromProto(a.id).fill(this.player.getRaidIndex()).then(e=>s.textContent=e.name),i.appendChild(s),this.makeTimingsPicker(i,t);const n=document.createElement("fragment");n.innerHTML='\n\t\t\t\t<button class="delete-cooldown link-danger">\n\t\t\t\t\t<i class="fa fa-times fa-xl"></i>\n\t\t\t\t</button>\n\t\t\t';const o=n.children[0],l=u(o,{content:"Delete Cooldown"});o.addEventListener("click",()=>{const e=this.player.getSimpleCooldowns();e.cooldowns.splice(t,1),this.player.setSimpleCooldowns(Se.nextEventID(),e),l.hide()}),i.appendChild(o),this.cooldownPickers.push(i)}}makeActionPicker(e,t){const a=this.player.getMetadata().getSpells().filter(e=>e.data.isMajorCooldown).map(e=>e.id).filter(e=>{const t=0!==e.spellId?e.spellId:e.itemId;return!this.player.hiddenMCDs.includes(t)});this.rootElem.closest(".cooldown-settings")?.classList[a.length?"remove":"add"]("hide");return new ud(e,this.player,{extraCssClasses:["cooldown-action-picker"],numColumns:3,values:[{color:"#grey",value:P.create()}].concat(a.map(e=>({actionId:e,value:e.toProto()}))),equals:(e,t)=>P.equals(e,t),zeroValue:P.create(),backupIconUrl:e=>xe.fromProto(e),changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.id||P.create(),setValue:(e,a,i)=>{if(!i.rawId.oneofKind)return;const s=a.getSimpleCooldowns();for(;s.cooldowns.length<t;)s.cooldowns.push(z.create());s.cooldowns[t]=z.create({id:i,timings:[]}),a.setSimpleCooldowns(e,s)}})}makeTimingsPicker(e,t){return new np(e,this.player,{id:`cooldown-timings-${t}`,extraCssClasses:["cooldown-timings-picker"],placeholder:"20, 40, ...",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.timings||[],setValue:(e,a,i)=>{const s=a.getSimpleCooldowns();s.cooldowns[t].timings=i,a.setSimpleCooldowns(e,s)},enableWhen:e=>{const a=e.getSimpleCooldowns().cooldowns[t];return a&&!P.equals(a.id,P.create())}})}}class lp extends Do{constructor(t,a){super(t,a,{identifier:"rotation-tab",title:s.t("rotation.title")}),this.leftCol=this.buildColumn(1,"rotation-tab-col"),this.simUI=a,this.leftPanel=e("div",{className:"rotation-tab-left tab-panel-left"}),this.rightPanel=e("div",{className:"rotation-tab-right tab-panel-right"}),this.leftPanel.appendChild(this.leftCol),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent(),this.updateSections(),this.simUI.player.rotationChangeEmitter.on(()=>this.updateSections())}buildTabContent(){this.buildHeader(),this.buildAutoContent(),this.buildAplContent(),this.buildSimpleContent(),this.buildPresetConfigurationPicker(),this.buildSavedDataPickers()}updateSections(){this.rootElem.classList.remove("rotation-type-auto","rotation-type-simple","rotation-type-apl","rotation-type-legacy");let e="";switch(this.simUI.player.getRotationType()){case Wt.TypeAuto:e="rotation-type-auto";break;case Wt.TypeSimple:e="rotation-type-simple";break;case Wt.TypeAPL:e="rotation-type-apl"}this.rootElem.classList.add(e)}buildHeader(){const a=t(),i=t(),s=t();this.leftCol.appendChild(e("div",{ref:a,className:"rotation-tab-header d-flex justify-content-between align-items-baseline"},e("div",{ref:s}),e("button",{ref:i,className:"btn btn-sm btn-link btn-reset summary-table-reset-button"},e("i",{className:"fas fa-times me-1"}),"Reset APL"))),i.value.addEventListener("click",()=>{this.simUI.applyEmptyAplRotation(Se.nextEventID())}),this.simUI.player.rotationChangeEmitter.on(()=>{const e=this.simUI.player.getRotationType();i.value?.classList[e===Wt.TypeAPL?"remove":"add"]("hide")}),new vd(s.value,this.simUI.player,{extraCssClasses:["w-auto"],id:"rotation-tab-rotation-type",label:"Rotation Type",labelTooltip:"Which set of options to use for specifying the rotation.",inline:!0,values:this.simUI.player.hasSimpleRotationGenerator()?[{value:Wt.TypeAuto,name:"Auto"},{value:Wt.TypeSimple,name:"Simple"},{value:Wt.TypeAPL,name:"APL"}]:[{value:Wt.TypeAuto,name:"Auto"},{value:Wt.TypeAPL,name:"APL"}],changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getRotationType(),setValue:(e,t,a)=>{t.aplRotation.type=a,t.rotationChangeEmitter.emit(e)}})}buildAutoContent(){this.leftCol.appendChild(e("div",{className:"rotation-tab-auto"}))}buildAplContent(){const a=t();this.leftCol.appendChild(e("div",{ref:a,className:"rotation-tab-apl"})),new tp(a.value,this.simUI,this.simUI.player)}buildSimpleContent(){if(!this.simUI.player.hasSimpleRotationGenerator()||!this.simUI.individualConfig.rotationInputs)return;const e="rotation-tab-simple",t=new Go(this.leftCol,"rotation-settings",{header:{title:"Rotation"}});t.rootElem.classList.add(e);const a=ye.newGroupContainer();a.classList.add("rotation-icon-group","icon-group"),t.bodyElement.appendChild(a),this.simUI.individualConfig.rotationIconInputs?.length&&this.configureIconSection(a,this.simUI.individualConfig.rotationIconInputs.map(e=>fd(a,this.simUI.player,e)),!0),this.configureInputSection(t.bodyElement,this.simUI.individualConfig.rotationInputs);const i=new Go(this.leftCol,"cooldown-settings",{header:{title:"Cooldowns",tooltip:Rs}});i.rootElem.classList.add(e),new op(i.bodyElement,this.simUI.player)}configureInputSection(e,t){t.inputs.forEach(t=>{t.extraCssClasses=[...t.extraCssClasses||[],"input-inline"],"number"==t.type?new Co(e,this.simUI.player,{...t,inline:!0}):"boolean"==t.type?new Rt(e,this.simUI.player,{...t,inline:!0}):"enum"==t.type&&new vd(e,this.simUI.player,{...t,inline:!0})})}configureIconSection(e,t,a){t.length?a&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`)):e.classList.add("hide")}buildPresetConfigurationPicker(){new Bm(this.rightPanel,this.simUI,[jm.Rotation])}buildSavedDataPickers(){const e=new Vm(this.rightPanel,this.simUI.player,{label:"Rotation",header:{title:"Saved Rotations"},storageKey:this.simUI.getSavedRotationStorageKey(),getData:e=>Ns.create({rotation:e.getResolvedAplRotation()}),setData:(e,t,a)=>Se.freezeAllAndDo(()=>{t.setAplRotation(e,a.rotation||Ft.create())}),changeEmitters:[this.simUI.player.rotationChangeEmitter,this.simUI.player.talentsChangeEmitter],equals:(e,t)=>Wm(this.simUI.player,e.rotation,t.rotation),toJson:e=>Ns.toJson(e),fromJson:e=>Ds(Ns.fromJson(e),["uuid"])});this.simUI.sim.waitForInit().then(()=>{e.loadUserData(),(this.simUI.individualConfig.presets.rotations||[]).forEach(t=>{const a=t.rotation;a.rotation||(a.rotation=Ft.create()),e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:a,enableWhen:t.enableWhen,onLoad:t.onLoad})})})}}class rp{constructor(e){this.duration=300,this.durationVariation=60,this.executeProportion20=.2,this.executeProportion25=.25,this.executeProportion35=.35,this.executeProportion45=.45,this.executeProportion90=.9,this.useHealth=!1,this.targetsChangeEmitter=new Se,this.durationChangeEmitter=new Se,this.executeProportionChangeEmitter=new Se,this.changeEmitter=new Se,this.sim=e,this.targets=[rp.defaultTargetProto()],this.targetsMetadata=new ug,[this.targetsChangeEmitter,this.durationChangeEmitter,this.executeProportionChangeEmitter].forEach(e=>e.on(e=>this.changeEmitter.emit(e)))}get primaryTarget(){return this.targets[0]}getDurationVariation(){return this.durationVariation}setDurationVariation(e,t){t!=this.durationVariation&&(this.durationVariation=t,this.durationChangeEmitter.emit(e))}getDuration(){return this.duration}setDuration(e,t){t!=this.duration&&(this.duration=t,this.durationChangeEmitter.emit(e))}getExecuteProportion20(){return this.executeProportion20}setExecuteProportion20(e,t){t!=this.executeProportion20&&(this.executeProportion20=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion25(){return this.executeProportion25}setExecuteProportion25(e,t){t!=this.executeProportion25&&(this.executeProportion25=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion35(){return this.executeProportion35}setExecuteProportion35(e,t){t!=this.executeProportion35&&(this.executeProportion35=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion45(){return this.executeProportion45}setExecuteProportion45(e,t){t!=this.executeProportion45&&(this.executeProportion45=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion90(){return this.executeProportion90}setExecuteProportion90(e,t){t!=this.executeProportion90&&(this.executeProportion90=t,this.executeProportionChangeEmitter.emit(e))}getUseHealth(){return this.useHealth}setUseHealth(e,t){t!=this.useHealth&&(this.useHealth=t,this.durationChangeEmitter.emit(e),this.executeProportionChangeEmitter.emit(e))}matchesPreset(e){return e.targets.length==this.targets.length&&this.targets.every((t,a)=>j.equals(t,e.targets[a].target))}applyPreset(e,t){this.targets=t.targets.map(e=>e.target||j.create()),this.targetsChangeEmitter.emit(e)}applyPresetTarget(e,t,a){this.targets[a]=t.target||j.create(),this.targetsChangeEmitter.emit(e)}toProto(){return R.create({duration:this.duration,durationVariation:this.durationVariation,executeProportion20:this.executeProportion20,executeProportion25:this.executeProportion25,executeProportion35:this.executeProportion35,executeProportion45:this.executeProportion45,executeProportion90:this.executeProportion90,useHealth:this.useHealth,targets:this.targets,apiVersion:B})}fromProto(e,t){rp.updateProtoVersion(t),Se.freezeAllAndDo(()=>{this.setDuration(e,t.duration),this.setDurationVariation(e,t.durationVariation),this.setExecuteProportion20(e,t.executeProportion20),this.setExecuteProportion25(e,t.executeProportion25),this.setExecuteProportion35(e,t.executeProportion35),this.setExecuteProportion45(e,t.executeProportion45),this.setExecuteProportion90(e,t.executeProportion90),this.setUseHealth(e,t.useHealth),this.targets=t.targets,this.targetsChangeEmitter.emit(e)})}applyDefaults(e){this.fromProto(e,rp.defaultEncounterProto())}static defaultEncounterProto(e=1){return R.create({duration:300,durationVariation:60,executeProportion20:.2,executeProportion25:.25,executeProportion35:.35,executeProportion45:.45,executeProportion90:.9,targets:Array.from({length:e},()=>rp.defaultTargetProto()),apiVersion:B})}static defaultTargetProto(){return j.create({id:31146,name:"Raid Target",level:Gs,mobType:q.MobTypeMechanical,stats:ke.fromMap({[n.StatArmor]:24835,[n.StatAttackPower]:650,[n.StatHealth]:120016403}).asProtoArray(),minBaseDamage:55e4,damageSpread:.4,tankIndex:0,swingSpeed:2,suppressDodge:!1,parryHaste:!1,dualWield:!1,dualWieldPenalty:!1,spellSchool:H.SpellSchoolPhysical,targetInputs:new Array(0)})}static updateProtoVersion(e){e.apiVersion}}class cp extends we{constructor(e,t,a,i){super(e,"encounter-picker-root"),pp(this.rootElem,t,a.showExecuteProportion),t.sim.waitForInit().then(()=>{const e=t.sim.db.getAllPresetTargets(),a=t.sim.db.getAllPresetEncounters();if(new vd(this.rootElem,t,{id:"encounter-preset-encouter",label:"Encounter",extraCssClasses:["damage-metrics","npc-picker"],values:[{name:"Custom",value:-1}].concat(a.map((e,t)=>({name:e.path,value:t}))),changedEvent:e=>e.changeEmitter,getValue:e=>a.findIndex(t=>e.matchesPreset(t)),setValue:(e,t,i)=>{-1!=i&&t.applyPreset(e,a[i])}}),i.isIndividualSim()&&i.player.canEnableTargetDummies()){const e=i.player;new Co(this.rootElem,i.sim.raid,{id:"encounter-num-allies",label:"Num Allies",labelTooltip:"Number of allied players in the raid.",changedEvent:t=>Se.onAny([t.targetDummiesChangeEmitter,e.itemSwapSettings.changeEmitter]),getValue:e=>e.getTargetDummies(),setValue:(e,t,a)=>{t.setTargetDummies(e,a)},showWhen:t=>{const a=e.shouldEnableTargetDummies();return![p.SpecBrewmasterMonk,p.SpecWindwalkerMonk].includes(e.getSpec())&&(a||t.setTargetDummies(Se.nextEventID(),0),a)}})}i.isIndividualSim()&&i.player.getPlayerSpec().isTankSpec&&new Co(this.rootElem,t,{id:"encounter-min-base-damage",label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:e=>e.changeEmitter,getValue:e=>e.primaryTarget.minBaseDamage,setValue:(e,t,a)=>{t.primaryTarget.minBaseDamage=a,t.targetsChangeEmitter.emit(e)}});const s=e.findIndex(e=>t.primaryTarget.id==e.target?.id),n=e[s]?.target?.targetInputs||[];(n.length!=t.primaryTarget.targetInputs.length||t.primaryTarget.targetInputs.some((e,t)=>e.label!=n[t].label))&&(t.primaryTarget.targetInputs=n,t.targetsChangeEmitter.emit(Se.nextEventID())),up(this.rootElem,t,0);const o=new hp(i.rootElem,i,t),l=document.createElement("button");l.classList.add("advanced-button","btn","btn-primary"),l.textContent="Advanced",l.addEventListener("click",()=>o.open()),this.rootElem.appendChild(l)})}}class hp extends Io{constructor(e,t,a){super(e,"advanced-encounter-picker-modal",{disposeOnClose:!1}),this.encounter=a,this.addHeader(),this.body.innerHTML='\n\t\t\t<div class="encounter-header"></div>\n\t\t\t<div class="encounter-targets"></div>\n\t\t';const i=this.rootElem.getElementsByClassName("encounter-header")[0],s=this.rootElem.getElementsByClassName("encounter-targets")[0];pp(i,this.encounter,!0),t.isIndividualSim()||new Rt(i,a,{id:"aem-use-health",label:"Use Health",labelTooltip:"Uses a damage limit in place of a duration limit. Damage limit is equal to sum of all targets health.",inline:!0,changedEvent:e=>e.changeEmitter,getValue:e=>e.getUseHealth(),setValue:(e,t,a)=>{t.setUseHealth(e,a)}}),new Cd(s,this.encounter,{extraCssClasses:["targets-picker","mb-0"],itemLabel:"Target",changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets,setValue:(e,t,a)=>{t.targets=a,t.targetsChangeEmitter.emit(e)},newItem:()=>rp.defaultTargetProto(),copyItem:e=>j.clone(e),newItemPicker:(e,t,i,s)=>new mp(e,a,i,s),minimumItems:1})}addHeader(){const e=this.encounter.sim.db.getAllPresetEncounters();new vd(this.header,this.encounter,{id:"aem-encounter-picker",label:"Encounter",extraCssClasses:["encounter-picker","mb-0","pe-2","order-first"],values:[{name:"Custom",value:-1}].concat(e.map((e,t)=>({name:e.path,value:t}))),changedEvent:e=>e.changeEmitter,getValue:t=>e.findIndex(e=>t.matchesPreset(e)),setValue:(t,a,i)=>{-1!=i&&a.applyPreset(t,e[i])}})}}class mp extends ye{getTarget(){return this.encounter.targets[this.targetIndex]||j.create()}constructor(e,t,a,i){super(e,"target-picker-root",t,i),this.encounter=t,this.targetIndex=a,this.rootElem.innerHTML='\n\t\t\t<div class="picker-group target-picker-section target-picker-section1"></div>\n\t\t\t<div class="picker-group target-picker-section target-picker-section2"></div>\n\t\t\t<div class="picker-group target-picker-section target-picker-section3 threat-metrics"></div>\n\t\t';const s=this.rootElem.querySelector(".target-picker-section1"),n=this.rootElem.querySelector(".target-picker-section2"),o=this.rootElem.querySelector(".target-picker-section3"),l=t.sim.db.getAllPresetTargets();new vd(s,null,{id:"target-picker-npc",extraCssClasses:["npc-picker"],label:"NPC",labelTooltip:"Selects a preset NPC configuration.",values:[{name:"Custom",value:-1}].concat(l.map((e,t)=>({name:e.path,value:t}))),changedEvent:()=>t.targetsChangeEmitter,getValue:()=>l.findIndex(e=>function(e,t){if(!!e!=!!t)return!1;if(!e)return!0;const a=j.clone(t);return a.targetInputs=e.targetInputs,j.equals(e,a)}(this.getTarget(),e.target)),setValue:(e,a,i)=>{-1!=i&&(t.applyPresetTarget(e,l[i],this.targetIndex),t.targetsChangeEmitter.emit(e))}}),this.aiPicker=new vd(s,null,{id:"target-picker-ai",extraCssClasses:["ai-picker"],label:"AI",labelTooltip:"\n\t\t\t\t<p>Determines the target's ability rotation.</p>\n\t\t\t\t<p>Note that most rotations are not yet implemented.</p>\n\t\t\t",values:[{name:"None",value:0}].concat(l.map(e=>({name:e.path,value:e.target.id}))),changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().id,setValue:(e,a,i)=>{const s=this.getTarget();s.id=i,s.targetInputs=(l.find(e=>s.id==e.target?.id)?.target?.targetInputs||[]).map(e=>Y.clone(e)),t.targetsChangeEmitter.emit(e)}}),this.levelPicker=new vd(s,null,{id:"target-picker-level",label:"Level",values:[{name:"93",value:93},{name:"92",value:92},{name:"91",value:91},{name:"90",value:90},{name:"88",value:88}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().level,setValue:(e,a,i)=>{this.getTarget().level=i,t.targetsChangeEmitter.emit(e)}}),this.mobTypePicker=new vd(s,null,{id:"target-picker-mob-type",label:"Mob Type",values:fp,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().mobType,setValue:(e,a,i)=>{this.getTarget().mobType=i,t.targetsChangeEmitter.emit(e)}}),this.tankIndexPicker=new vd(s,null,{id:"target-picker-tanked-by",extraCssClasses:["threat-metrics"],label:"Tanked By",labelTooltip:"Determines which player in the raid this enemy will attack. If no player is assigned to the specified tank slot, this enemy will not attack.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().tankIndex,setValue:(e,a,i)=>{this.getTarget().tankIndex=i,t.targetsChangeEmitter.emit(e)}}),this.targetInputPickers=up(s,t,this.targetIndex),this.statPickers=gp.map(e=>{const a=e.stat;return new Co(n,null,{id:`target-${this.targetIndex}-picker-stats-${e.stat}`,inline:!0,extraCssClasses:e.extraCssClasses,label:Pe(a),labelTooltip:e.tooltip,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().stats[a],setValue:(e,i,s)=>{this.getTarget().stats[a]=s,t.targetsChangeEmitter.emit(e)}})}),this.swingSpeedPicker=new Co(o,null,{id:`target-${this.targetIndex}-picker-swing-speed`,label:"Swing Speed",labelTooltip:"Time in seconds between auto attacks. Set to 0 to disable auto attacks.",float:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().swingSpeed,setValue:(e,a,i)=>{this.getTarget().swingSpeed=i,t.targetsChangeEmitter.emit(e)}}),this.minBaseDamagePicker=new Co(o,null,{id:`target-${this.targetIndex}-picker-min-base-damage`,label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().minBaseDamage,setValue:(e,a,i)=>{this.getTarget().minBaseDamage=i,t.targetsChangeEmitter.emit(e)}}),this.damageSpreadPicker=new Co(o,null,{id:`target-${this.targetIndex}-picker-damage-spread`,label:"Damage Spread",labelTooltip:"Fractional spread between the minimum and maximum auto-attack damage from this enemy at 0 Attack Power.",float:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().damageSpread,setValue:(e,a,i)=>{this.getTarget().damageSpread=i,t.targetsChangeEmitter.emit(e)}}),this.dualWieldPicker=new Rt(o,null,{id:`target-${this.targetIndex}-picker-dual-wield`,label:"Dual Wield",labelTooltip:"Uses 2 separate weapons to attack.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().dualWield,setValue:(e,a,i)=>{this.getTarget().dualWield=i,t.targetsChangeEmitter.emit(e)}}),this.dwMissPenaltyPicker=new Rt(o,null,{id:`target-${this.targetIndex}-picker-dw-miss-penalty`,label:"DW Miss Penalty",labelTooltip:"Enables the Dual Wield Miss Penalty (+19% chance to miss) if dual wielding. Bosses in Hyjal/BT/SWP usually have this disabled to stop tanks from avoidance stacking.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().dualWieldPenalty,setValue:(e,a,i)=>{this.getTarget().dualWieldPenalty=i,t.targetsChangeEmitter.emit(e)},enableWhen:()=>this.getTarget().dualWield}),this.parryHastePicker=new Rt(o,null,{id:`target-${this.targetIndex}-picker-parry-haste`,label:"Parry Haste",labelTooltip:"Whether this enemy will gain parry haste when parrying attacks.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().parryHaste,setValue:(e,a,i)=>{this.getTarget().parryHaste=i,t.targetsChangeEmitter.emit(e)}}),this.spellSchoolPicker=new vd(o,null,{id:`target-${this.targetIndex}-picker-spell-school`,label:"Spell School",labelTooltip:"Type of damage caused by auto attacks. This is usually Physical, but some enemies have elemental attacks.",values:[{name:"Physical",value:H.SpellSchoolPhysical},{name:"Arcane",value:H.SpellSchoolArcane},{name:"Fire",value:H.SpellSchoolFire},{name:"Frost",value:H.SpellSchoolFrost},{name:"Holy",value:H.SpellSchoolHoly},{name:"Nature",value:H.SpellSchoolNature},{name:"Shadow",value:H.SpellSchoolShadow}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().spellSchool,setValue:(e,a,i)=>{this.getTarget().spellSchool=i,t.targetsChangeEmitter.emit(e)}}),this.init()}getInputElem(){return null}getInputValue(){return j.create({id:this.aiPicker.getInputValue(),level:this.levelPicker.getInputValue(),mobType:this.mobTypePicker.getInputValue(),tankIndex:this.tankIndexPicker.getInputValue(),swingSpeed:this.swingSpeedPicker.getInputValue(),minBaseDamage:this.minBaseDamagePicker.getInputValue(),dualWield:this.dualWieldPicker.getInputValue(),dualWieldPenalty:this.dwMissPenaltyPicker.getInputValue(),parryHaste:this.parryHastePicker.getInputValue(),spellSchool:this.spellSchoolPicker.getInputValue(),damageSpread:this.damageSpreadPicker.getInputValue(),stats:this.statPickers.map(e=>e.getInputValue()).map((e,t)=>(new ke).withStat(gp[t].stat,e)).reduce((e,t)=>e.add(t)).asProtoArray(),targetInputs:this.targetInputPickers.getInputValue()})}setInputValue(e){e&&(this.aiPicker.setInputValue(e.id),this.levelPicker.setInputValue(e.level),this.mobTypePicker.setInputValue(e.mobType),this.tankIndexPicker.setInputValue(e.tankIndex),this.swingSpeedPicker.setInputValue(e.swingSpeed),this.minBaseDamagePicker.setInputValue(e.minBaseDamage),this.dualWieldPicker.setInputValue(e.dualWield),this.dwMissPenaltyPicker.setInputValue(e.dualWieldPenalty),this.parryHastePicker.setInputValue(e.parryHaste),this.spellSchoolPicker.setInputValue(e.spellSchool),this.damageSpreadPicker.setInputValue(e.damageSpread),gp.forEach((t,a)=>this.statPickers[a].setInputValue(e.stats[t.stat])),this.targetInputPickers.setInputValue(e.targetInputs))}}class dp extends ye{getTargetInput(){return this.encounter.targets[this.targetIndex].targetInputs[this.targetInputIndex]||Y.create()}clearPickers(){this.boolPicker&&(this.boolPicker.rootElem.remove(),this.boolPicker=null),this.numberPicker&&(this.numberPicker.rootElem.remove(),this.numberPicker=null),this.enumPicker&&(this.enumPicker.rootElem.remove(),this.enumPicker=null)}constructor(e,t,a,i,s){super(e,"target-input-picker-root",t,s),this.encounter=t,this.targetIndex=a,this.targetInputIndex=i,this.boolPicker=null,this.numberPicker=null,this.enumPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){return Y.create({boolValue:this.boolPicker?this.boolPicker.getInputValue():void 0,numberValue:this.numberPicker?this.numberPicker.getInputValue():void 0,enumValue:this.enumPicker?this.enumPicker.getInputValue():void 0})}setInputValue(e){if(e)if(e.inputType==K.Number){if(this.numberPicker&&this.numberPicker.inputConfig.label===e.label)return;this.clearPickers(),this.numberPicker=new Co(this.rootElem,null,{id:Bt(),float:!0,label:e.label,labelTooltip:e.tooltip,changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().numberValue,setValue:(e,t,a)=>{this.getTargetInput().numberValue=a,this.encounter.targetsChangeEmitter.emit(e)}})}else if(e.inputType==K.Bool){if(this.boolPicker&&this.boolPicker.inputConfig.label===e.label)return;this.clearPickers(),this.boolPicker=new Rt(this.rootElem,null,{id:Bt(),label:e.label,labelTooltip:e.tooltip,extraCssClasses:["input-inline"],changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().boolValue,setValue:(e,t,a)=>{this.getTargetInput().boolValue=a,this.encounter.targetsChangeEmitter.emit(e)}})}else e.inputType==K.Enum&&(this.clearPickers(),this.enumPicker=new vd(this.rootElem,null,{id:Bt(),label:e.label,values:e.enumOptions.map((e,t)=>({value:t,name:e})),changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().enumValue,setValue:(e,t,a)=>{this.getTargetInput().enumValue=a,this.encounter.targetsChangeEmitter.emit(e)}}))}}function pp(e,t,a){const i=ye.newGroupContainer();if(e.appendChild(i),new Co(i,t,{id:"encounter-duration",label:"Duration",labelTooltip:"The fight length for each sim iteration, in seconds.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDuration(),setValue:(e,t,a)=>{t.setDuration(e,a)},enableWhen:e=>!t.getUseHealth()}),new Co(i,t,{id:"encounter-duration-variation",label:"Duration +/-",labelTooltip:"Adds a random amount of time, in seconds, between [value, -1 * value] to each sim iteration. For example, setting Duration to 180 and Duration +/- to 10 will result in random durations between 170s and 190s.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDurationVariation(),setValue:(e,t,a)=>{t.setDurationVariation(e,a)},enableWhen:e=>!t.getUseHealth()}),a){const a=ye.newGroupContainer();a.classList.add("execute-group"),e.appendChild(a),new Co(a,t,{id:"encounter-execute-proportion",label:"Execute Duration 20 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 20% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion20(),setValue:(e,t,a)=>{t.setExecuteProportion20(e,a/100)},enableWhen:e=>!t.getUseHealth()}),new Co(a,t,{id:"encounter-execute-proportion-25",label:"Execute Duration 25 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 25% HP) for the purpose of effects like Warlock's Drain Soul.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion25(),setValue:(e,t,a)=>{t.setExecuteProportion25(e,a/100)},enableWhen:e=>!t.getUseHealth()}),new Co(a,t,{id:"encounter-execute-proportion-35",label:"Execute Duration 35 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 35% HP) for the purpose of effects like Death Knight Soul Reaper.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion35(),setValue:(e,t,a)=>{t.setExecuteProportion35(e,a/100)},enableWhen:e=>!t.getUseHealth()}),new Co(a,t,{id:"encounter-execute-proportion-45",label:"Execute Duration 45 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 45% HP) for the purpose of effects like Death Knight Soul Reaper with T15 DPS 4pc.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion45(),setValue:(e,t,a)=>{t.setExecuteProportion45(e,a/100)},enableWhen:e=>!t.getUseHealth()}),new Co(a,t,{id:"encounter-execute-proportion-90",label:"Duration spent below high-HP regime (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets are considered out of range for effects like Hunter Careful Aim (<90% HP) or Druid Predatory Strikes (<80% HP).",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion90(),setValue:(e,t,a)=>{t.setExecuteProportion90(e,a/100)},enableWhen:e=>!t.getUseHealth()})}}function up(e,t,a){return new Cd(e,t,{allowedActions:[],itemLabel:"Target Input",extraCssClasses:["mt-2"],isCompact:!0,changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets[a].targetInputs,setValue:(e,t,i)=>{t.targets[a].targetInputs=i,t.targetsChangeEmitter.emit(e)},newItem:()=>Y.create(),copyItem:e=>Y.clone(e),newItemPicker:(e,i,s,n)=>new dp(e,t,a,s,n)})}const gp=[{stat:n.StatHealth,tooltip:"",extraCssClasses:[]},{stat:n.StatArmor,tooltip:"",extraCssClasses:[]},{stat:n.StatAttackPower,tooltip:"",extraCssClasses:["threat-metrics"]}],fp=[{name:"None",value:q.MobTypeUnknown},{name:"Beast",value:q.MobTypeBeast},{name:"Demon",value:q.MobTypeDemon},{name:"Dragonkin",value:q.MobTypeDragonkin},{name:"Elemental",value:q.MobTypeElemental},{name:"Giant",value:q.MobTypeGiant},{name:"Humanoid",value:q.MobTypeHumanoid},{name:"Mechanical",value:q.MobTypeMechanical},{name:"Undead",value:q.MobTypeUndead}];class wp extends we{constructor(a,i,s,n){super(a,"multi-icon-picker-root"),this.rootElem.classList.add("icon-picker"),this.abortController=new AbortController,this.signal=this.abortController.signal,this.config=s,this.currentValue=null;const o=t(),r=t(),c=t();this.rootElem.replaceChildren(e(l,null,e("div",{className:"dropend"},e("a",{ref:o,className:"icon-picker-button",attributes:{role:"button","aria-expanded":!1},dataset:{bsToggle:"dropdown",disableWowheadTouchTtooltip:!0}}),e("ul",{ref:r,className:"dropdown-menu"})),e("label",{ref:c,className:"multi-icon-picker-label form-label"})));const h=c.value;s.label?h.textContent=s.label:h.remove(),this.buttonElem=o.value,this.dropdownMenu=r.value,this.buttonElem.addEventListener("hide.bs.dropdown",e=>{e.hasOwnProperty("clickEvent")&&e.preventDefault()},{signal:this.signal}),this.buttonElem.addEventListener("contextmenu",e=>{e.preventDefault()},{signal:this.signal}),this.buttonElem.addEventListener("mousedown",e=>{je(e)&&this.clearPicker()},{signal:this.signal}),this.buildBlankOption(),this.pickers=s.inputs.map((e,t)=>{const a=document.createElement("li");return a.classList.add("icon-picker-option","dropdown-option"),this.dropdownMenu.appendChild(a),new gd(a,i,e)}),n.sim.waitForInit().then(()=>this.updateButtonImage());const m=n.changeEmitter.on(()=>{if(!Ht(this.rootElem)||!Ht(this.dropdownMenu)||!Ht(this.buttonElem))return void this.dispose();this.updateButtonImage();!this.config.showWhen||this.config.showWhen(n.sim.raid.getPlayer(0))?this.rootElem.classList.remove("hide"):this.rootElem.classList.add("hide")});this.addOnDisposeCallback(()=>m.dispose())}buildBlankOption(){const e=document.createElement("li");this.dropdownMenu.appendChild(e);const t=document.createElement("a");t.classList.add("icon-dropdown-option","dropdown-option"),e.appendChild(t);t.addEventListener("click",()=>this.clearPicker(),{signal:this.signal})}clearPicker(){Se.freezeAllAndDo(()=>{this.pickers.forEach(e=>{e.setInputValue(null),e.inputChanged(Se.nextEventID())}),this.updateButtonImage()})}updateButtonImage(){this.currentValue=this.getMaxValue(),this.currentValue?(this.buttonElem.classList.add("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0,{signal:this.signal}):this.currentValue.fillAndSet(this.buttonElem,!1,!0,{signal:this.signal})):(this.buttonElem.classList.remove("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0,{signal:this.signal}):this.buttonElem.style.backgroundImage="",this.buttonElem.removeAttribute("href"))}getMaxValue(){return this.pickers.map(e=>e.getActionId()).filter(e=>null!=e)[0]||null}}const yp=Ym([wd({actionId:xe.fromSpellId(20217),fieldName:"blessingOfKings"}),wd({actionId:xe.fromSpellId(1126),fieldName:"markOfTheWild"}),wd({actionId:xe.fromSpellId(90363),fieldName:"embraceOfTheShaleSpider"}),wd({actionId:xe.fromSpellId(115921),fieldName:"legacyOfTheEmperor"})],"Stats"),bp=Ym([wd({actionId:xe.fromSpellId(19506),fieldName:"trueshotAura"}),wd({actionId:xe.fromSpellId(57330),fieldName:"hornOfWinter"}),wd({actionId:xe.fromSpellId(6673),fieldName:"battleShout"})],"Attack Power"),Sp=Ym([wd({actionId:xe.fromSpellId(55610),fieldName:"unholyAura"}),wd({actionId:xe.fromSpellId(128433),fieldName:"serpentsSwiftness"}),wd({actionId:xe.fromSpellId(113742),fieldName:"swiftbladesCunning"}),wd({actionId:xe.fromSpellId(30809),fieldName:"unleashedRage"}),wd({actionId:xe.fromSpellId(128432),fieldName:"cacklingHowl"})],"Attack Speed"),vp=Ym([wd({actionId:xe.fromSpellId(1459),fieldName:"arcaneBrilliance"}),wd({actionId:xe.fromSpellId(126309),fieldName:"stillWater"}),wd({actionId:xe.fromSpellId(77747),fieldName:"burningWrath"}),wd({actionId:xe.fromSpellId(109773),fieldName:"darkIntent"})],"Spell Power"),Ip=Ym([wd({actionId:xe.fromSpellId(24907),fieldName:"moonkinAura"}),wd({actionId:xe.fromSpellId(49868),fieldName:"mindQuickening"}),wd({actionId:xe.fromSpellId(51470),fieldName:"elementalOath"})],"Spell Haste"),Ep=Ym([wd({actionId:xe.fromSpellId(17007),fieldName:"leaderOfThePack"}),wd({actionId:xe.fromSpellId(24604),fieldName:"furiousHowl"}),wd({actionId:xe.fromSpellId(90309),fieldName:"terrifyingRoar"}),wd({actionId:xe.fromSpellId(116781),fieldName:"legacyOfTheWhiteTiger"}),wd({actionId:xe.fromSpellId(1459),fieldName:"arcaneBrilliance"}),wd({actionId:xe.fromSpellId(126309),fieldName:"stillWater"})],"Crit %"),kp=Ym([wd({actionId:xe.fromSpellId(19740),fieldName:"blessingOfMight"}),wd({actionId:xe.fromSpellId(93435),fieldName:"roarOfCourage"}),wd({actionId:xe.fromSpellId(128997),fieldName:"spiritBeastBlessing"}),wd({actionId:xe.fromSpellId(116956),fieldName:"graceOfAir"})],"Mastery"),Cp=Ym([wd({actionId:xe.fromSpellId(469),fieldName:"commandingShout"}),wd({actionId:xe.fromSpellId(109773),fieldName:"darkIntent"}),wd({actionId:xe.fromSpellId(21562),fieldName:"powerWordFortitude"}),wd({actionId:xe.fromSpellId(90364),fieldName:"qirajiFortitude"})],"Stamina"),_p=bd({actionId:xe.fromSpellId(16190),numStates:5,fieldName:"manaTideTotemCount"}),xp=wd({actionId:xe.fromSpellId(2825),fieldName:"bloodlust",label:"Bloodlust"}),Tp=bd({actionId:xe.fromSpellId(114207),numStates:11,fieldName:"skullBannerCount",label:"Skull Banner"}),Pp=bd({actionId:xe.fromSpellId(120668),numStates:11,fieldName:"stormlashTotemCount",label:"Stormlash Totem"}),Rp=rd({getModObject:e=>e,showWhen:e=>!Dp.faction||Dp.faction==e.getFaction(),getValue:e=>e.getBuffs(),setValue:(e,t,a)=>t.setBuffs(e,a),changeEmitter:e=>Se.onAny([e.buffsChangeEmitter,e.raceChangeEmitter])},(Dp={actionId:xe.fromSpellId(57933),fieldName:"tricksOfTheTrade",label:"Tricks of the Trade"}).actionId,Dp.fieldName,Dp.value,Dp.label);var Dp;const Np=Sd({actionId:xe.fromSpellId(49016),numStates:11,fieldName:"unholyFrenzyCount",label:"Unholy Frenzy"}),Gp=Sd({actionId:xe.fromSpellId(1249459),numStates:11,fieldName:"shatteringThrowCount",label:"Shattering Throw"}),Up=Sd({actionId:xe.fromSpellId(114030),numStates:11,fieldName:"vigilanceCount",label:"Vigilance"}),Op=Sd({actionId:xe.fromSpellId(31821),numStates:11,fieldName:"devotionAuraCount",label:"Devotion Aura"}),Ap=Sd({actionId:xe.fromSpellId(33206),numStates:11,fieldName:"painSuppressionCount",label:"Pain Suppression"}),Lp=Sd({actionId:xe.fromSpellId(97462),numStates:11,fieldName:"rallyingCryCount",label:"Rallying Cry"}),Vp=yd({actionId:xe.fromSpellId(113746),fieldName:"weakenedArmor",label:"Armor Reduction"}),Fp=yd({actionId:xe.fromSpellId(115798),fieldName:"weakenedBlows",label:"Phys Dmg Reduction"}),Wp=Ym([yd({actionId:xe.fromSpellId(73975),fieldName:"necroticStrike"}),yd({actionId:xe.fromSpellId(58604),fieldName:"lavaBreath"}),yd({actionId:xe.fromSpellId(50274),fieldName:"sporeCloud"}),yd({actionId:xe.fromSpellId(5761),fieldName:"mindNumbingPoison"}),yd({actionId:xe.fromSpellId(31589),fieldName:"slow"}),yd({actionId:xe.fromSpellId(109466),fieldName:"curseOfEnfeeblement"})],"Cast Speed"),Mp=yd({actionId:xe.fromSpellId(81326),fieldName:"physicalVulnerability",label:"Phys Dmg"}),zp=Ym([yd({actionId:xe.fromSpellId(24844),fieldName:"lightningBreath"}),yd({actionId:xe.fromSpellId(1490),fieldName:"curseOfElements"}),yd({actionId:xe.fromSpellId(58410),fieldName:"masterPoisoner"}),yd({actionId:xe.fromSpellId(34889),fieldName:"fireBreath"})],"Spell Dmg"),jp=[{config:yp,picker:wp,stats:[n.StatStrength,n.StatAgility,n.StatIntellect]},{config:bp,picker:wp,stats:[n.StatAttackPower,n.StatRangedAttackPower]},{config:Sp,picker:wp,stats:[n.StatAttackPower,n.StatRangedAttackPower]},{config:vp,picker:wp,stats:[n.StatSpellPower]},{config:Ip,picker:wp,stats:[n.StatSpellPower]},{config:Ep,picker:wp,stats:[n.StatCritRating]},{config:kp,picker:wp,stats:[n.StatMasteryRating]},{config:Cp,picker:wp,stats:[n.StatStamina]}],Bp=[{config:_p,picker:gd,stats:[n.StatSpirit]}],Hp=[{config:xp,picker:gd,stats:[n.StatHasteRating]},{config:Tp,picker:gd,stats:[n.StatAttackPower,n.StatRangedAttackPower,n.StatSpellPower]},{config:Pp,picker:gd,stats:[n.StatAttackPower,n.StatRangedAttackPower,n.StatSpellPower]},{config:Rp,picker:gd,stats:[n.StatAttackPower,n.StatRangedAttackPower,n.StatSpellPower]},{config:Np,picker:gd,stats:[n.StatAttackPower,n.StatRangedAttackPower]},{config:Gp,picker:gd,stats:[n.StatAttackPower,n.StatRangedAttackPower]}],qp=[{config:Up,picker:gd,stats:[n.StatStamina]},{config:Op,picker:gd,stats:[n.StatStamina]},{config:Ap,picker:gd,stats:[n.StatStamina]},{config:Lp,picker:gd,stats:[n.StatStamina]}],Yp=[{config:Vp,picker:gd,stats:[n.StatAttackPower,n.StatRangedAttackPower]},{config:Mp,picker:gd,stats:[n.StatAttackPower,n.StatRangedAttackPower]},{config:zp,picker:wp,stats:[n.StatAttackPower,n.StatRangedAttackPower,n.StatSpellPower]},{config:Fp,picker:gd,stats:[n.StatStamina]},{config:Wp,picker:wp,stats:[n.StatStamina]}],Kp=[];function $p(e,t){return e.filter(e=>0==e.stats.length||e.stats.some(e=>t.individualConfig.epStats.includes(e))||t.individualConfig.includeBuffDebuffInputs.includes(e.config)).filter(e=>!t.individualConfig.excludeBuffDebuffInputs.includes(e.config))}function Jp(e){return(t,a)=>{const i=t.map(e=>({actionId:e.config.actionId,value:e.config.value,showWhen:t=>(!e.config.showWhen||e.config.showWhen(t))&&(e.config.faction||t.getFaction())==t.getFaction()}));return{type:"iconEnum",tooltip:a,numColumns:t.length>5?2:1,values:[{value:0,iconUrl:"",tooltip:"None"}].concat(i),equals:(e,t)=>e==t,zeroValue:0,changedEvent:e=>Se.onAny([e.consumesChangeEmitter,e.gearChangeEmitter,e.professionChangeEmitter]),showWhen:t=>(!e.showWhen||e.showWhen(t))&&i.some(e=>e.showWhen?.(t)),getValue:t=>t.getConsumes()[e.consumesFieldName],setValue:(t,a,i)=>{const s=a.getConsumes();s[e.consumesFieldName]!==i&&(s[e.consumesFieldName]=i,Se.freezeAllAndDo(()=>{a.setConsumes(t,s),e.onSet&&e.onSet(t,a,i)}))}}}}const Zp={actionId:xe.fromItemId(12662),value:12662},Qp={actionId:xe.fromItemId(5512),value:5512},Xp=[{config:{actionId:xe.fromItemId(7676),value:7676,showWhen:e=>e.getClass()==v.ClassRogue},stats:[]},{config:Qp,stats:[n.StatStamina]},{config:Zp,stats:[n.StatIntellect]}],eu=Jp({consumesFieldName:"conjuredId"}),tu=[{config:{actionId:xe.fromItemId(63396),value:89637,showWhen:e=>e.hasProfession(I.Engineering)},stats:[]},{config:{actionId:xe.fromItemId(60223),value:82207,showWhen:e=>e.hasProfession(I.Engineering)},stats:[]}],au=Jp({consumesFieldName:"explosiveId"});function iu(e,t,a){const i=e.map(e=>({value:e.id,iconUrl:e.icon,actionId:xe.fromItemId(e.id),tooltip:e.name}));return{type:"iconEnum",tooltip:a,numColumns:e.length>5?2:1,values:[{value:0,iconUrl:"",tooltip:"None"}].concat(i),equals:(e,t)=>e===t,zeroValue:0,changedEvent:e=>e.consumesChangeEmitter,getValue:e=>e.getConsumes()[t.consumesFieldName],showWhen:e=>!!i.length,setValue:(e,a,i)=>{t.setValue&&t.setValue(e,a,i);const s={...a.getConsumes(),[t.consumesFieldName]:i};"flaskId"===t.consumesFieldName&&(s.guardianElixirId=0,s.battleElixirId=0),"battleElixirId"!==t.consumesFieldName&&"guardianElixirId"!==t.consumesFieldName||(s.flaskId=0),a.setConsumes(e,s)}}}class su extends we{constructor(e,t,a,i){super(e,"consumes-picker-root"),this.settingsTab=t,this.simUI=a,this.db=i}getConsumables(e){return this.db.getConsumablesByTypeAndStats(e,this.simUI.individualConfig.consumableStats??this.simUI.individualConfig.epStats)}static create(e,t,a){const i=new su(e,t,a,We.getSync());return i.init(),i}init(){this.buildPotionsPicker(),this.buildElixirsPicker(),this.buildFoodPicker(),this.buildEngPicker(),this.buildPetPicker()}buildPotionsPicker(){const a=t(),i=this.rootElem.appendChild(e(nu,{label:"Potions"},e("div",{ref:a,className:"picker-group icon-group consumes-row-inputs consumes-potions"}))),s=a.value;let n=this.getConsumables($.ConsumableTypePotion);this.simUI.player.getClass()!==v.ClassWarrior&&this.simUI.player.getSpec()!==p.SpecGuardianDruid&&(n=n.filter(e=>13442!==e.id));const o=iu(n,{consumesFieldName:"prepotId"},"Prepop Potion"),l=iu(n,{consumesFieldName:"potId"},"Combat Potion"),r=fd(s,this.simUI.player,o),c=fd(s,this.simUI.player,l),h=eu($p(Xp,this.simUI)),m=fd(s,this.simUI.player,h),d=Se.onAny([this.simUI.player.professionChangeEmitter]).on(()=>this.updateRow(i,[c,m,r]));this.addOnDisposeCallback(()=>d.dispose()),this.updateRow(i,[c,m,r])}buildElixirsPicker(){const a=t(),i=t(),s=t();this.rootElem.appendChild(e(nu,{label:"Elixirs"},e("div",{className:"picker-group icon-group consumes-row-inputs"},e("div",{ref:a,className:"consumes-flasks"}),e("span",{className:"elixir-space"},"or"),e("div",{ref:i,className:"consumes-battle-elixirs"}),e("div",{ref:s,className:"consumes-guardian-elixirs"}))));const n=a.value,o=i.value,l=s.value,r=iu(this.getConsumables($.ConsumableTypeFlask),{consumesFieldName:"flaskId"},"");fd(n,this.simUI.player,r);const c=iu(this.getConsumables($.ConsumableTypeBattleElixir),{consumesFieldName:"battleElixirId"},""),h=iu(this.getConsumables($.ConsumableTypeGuardianElixir),{consumesFieldName:"guardianElixirId"},"");fd(o,this.simUI.player,c),fd(l,this.simUI.player,h)}buildFoodPicker(){const a=t();this.rootElem.appendChild(e(nu,{label:"Food"},e("div",{ref:a,className:"picker-group icon-group consumes-row-inputs consumes-food"})));const i=a.value,s=iu(this.getConsumables($.ConsumableTypeFood),{consumesFieldName:"foodId"},"");fd(i,this.simUI.player,s)}buildEngPicker(){const a=t(),i=this.rootElem.appendChild(e(nu,{label:"Engineering"},e("div",{ref:a,className:"picker-group icon-group consumes-row-inputs consumes-engi"}))),s=a.value,n=au($p(tu,this.simUI),"Explosives"),o=fd(s,this.simUI.player,n),l=this.simUI.player.professionChangeEmitter.on(()=>this.updateRow(i,[o]));this.addOnDisposeCallback(()=>l.dispose()),this.updateRow(i,[o])}buildPetPicker(){if(this.simUI.individualConfig.petConsumeInputs?.length){const a=t();this.rootElem.appendChild(e(nu,{label:"Pet"},e("div",{ref:a,className:"picker-group icon-group consumes-row-inputs consumes-pet"})));const i=a.value;this.simUI.individualConfig.petConsumeInputs.forEach(e=>fd(i,this.simUI.player,e))}}updateRow(e,t){e.classList[t.find(e=>e?.showWhen())?"remove":"add"]("hide")}}const nu=({label:t,children:a})=>e("div",{className:"consumes-row input-root input-inline"},e("label",{className:"form-label"},t),a);class ou extends Do{constructor(e,t){super(e,t,{identifier:"settings-tab",title:s.t("settings.title")}),this.column1=this.buildColumn(1,"settings-left-col"),this.column2=this.buildColumn(2,"settings-left-col"),this.column3=this.buildColumn(3,"settings-left-col"),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("settings-tab-left","tab-panel-left"),this.leftPanel.appendChild(this.column1),this.leftPanel.appendChild(this.column2),this.leftPanel.appendChild(this.column3),this.simUI.isWithinRaidSim&&(this.column4=this.buildColumn(4,"settings-left-col"),this.leftPanel.appendChild(this.column4)),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("settings-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.simUI.sim.waitForInit().then(()=>{this.buildTabContent()})}buildTabContent(){this.simUI.isWithinRaidSim||this.buildEncounterSettings(),this.buildPlayerSettings(),this.buildCustomSettingsSections(),this.buildConsumesSection(),this.buildOtherSettings(),this.simUI.isWithinRaidSim||(this.buildBuffsSettings(),this.raidExternalDamageCooldowns(),this.raidExternalDefensiveCooldowns(),this.buildDebuffsSettings()),this.simUI.isWithinRaidSim||(this.buildPresetConfigurationPicker(),this.buildSavedDataPickers())}buildEncounterSettings(){const e=new Go(this.column1,"encounter-settings",{header:{title:"Encounter"}});new cp(e.bodyElement,this.simUI.sim.encounter,this.simUI.individualConfig.encounterPicker,this.simUI)}buildPlayerSettings(){const e=this.column1,t=new Go(e,"player-settings",{header:{title:"Player"}}),a=ye.newGroupContainer();a.classList.add("player-icon-group","icon-group"),t.bodyElement.appendChild(a),this.configureIconSection(a,this.simUI.individualConfig.playerIconInputs.map(e=>fd(a,this.simUI.player,e)),!0);const i=this.simUI.player.getPlayerClass().races;new vd(t.bodyElement,this.simUI.player,{id:"simui-race",label:"Race",values:i.map(e=>({name:At.get(e),value:e})),changedEvent:e=>e.raceChangeEmitter,getValue:e=>e.getRace(),setValue:(e,t,a)=>t.setRace(e,a)}),this.simUI.individualConfig.playerInputs?.inputs.length&&this.configureInputSection(t.bodyElement,this.simUI.individualConfig.playerInputs);const s=ye.newGroupContainer();t.bodyElement.appendChild(s);const n=Ve(I).filter(e=>e!=I.Archeology);new vd(s,this.simUI.player,{id:"simui-profession1",label:"Profession 1",values:n.map(e=>({name:Us.get(e),value:e})),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession1(),setValue:(e,t,a)=>t.setProfession1(e,a)}),new vd(s,this.simUI.player,{id:"simui-profession2",label:"Profession 2",values:n.map(e=>({name:Us.get(e),value:e})),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession2(),setValue:(e,t,a)=>t.setProfession2(e,a)})}buildCustomSettingsSections(){(this.simUI.individualConfig.customSections||[]).forEach(e=>{e(this.column2,this.simUI).rootElem.classList.add("custom-section")})}buildConsumesSection(){const e=this.simUI.isWithinRaidSim?this.column3:this.column2,t=new Go(e,"consumes-settings",{header:{title:"Consumables"}});su.create(t.bodyElement,this,this.simUI)}buildOtherSettings(){const e=this.simUI.individualConfig.otherInputs?.inputs.filter(e=>!e.extraCssClasses?.includes("within-raid-sim-hide")||!0),t=this.simUI.individualConfig.itemSwapSlots||[];if(e.length>0||t.length>0){const a=new Go(this.column2,"other-settings",{header:{title:"Other"}});e.length>0&&(this.configureInputSection(a.bodyElement,this.simUI.individualConfig.otherInputs),a.bodyElement.querySelectorAll(".input-root").forEach(e=>{e.classList.add("input-inline")})),t.length>0&&new dg(a.bodyElement,this.simUI,this.simUI.player,{itemSlots:t})}}buildBuffsSettings(){const t=new Go(this.column3,"buffs-settings",{header:{title:"Raid Buffs",tooltip:Os}});t.headerElement?.appendChild(e("p",{className:"fs-body"},"All raid buffs/debuffs selected are assumed to be provided by ",e("strong",null,"other")," raid members than the simulated player."));const a=$p(jp,this.simUI);this.configureIconSection(t.bodyElement,a.map(e=>e.picker&&new e.picker(t.bodyElement,this.simUI.player,e.config,this.simUI)));const i=$p(Bp,this.simUI);i.length>0&&new wp(t.bodyElement,this.simUI.player,{inputs:i.map(e=>e.config),label:"Misc"},this.simUI)}raidExternalDamageCooldowns(){const e=$p(Hp,this.simUI);if(e.length>0){const t=new Go(this.column3,"buffs-settings",{header:{title:"External Damage Cooldowns",tooltip:As}});this.configureIconSection(t.bodyElement,e.map(e=>e.picker&&new e.picker(t.bodyElement,this.simUI.player,e.config)))}}raidExternalDefensiveCooldowns(){const e=$p(qp,this.simUI);if(e.length>0){const t=new Go(this.column3,"buffs-settings",{header:{title:"External Defensive Cooldowns",tooltip:Ls}});this.configureIconSection(t.bodyElement,e.map(e=>e.picker&&new e.picker(t.bodyElement,this.simUI.player,e.config)))}}buildDebuffsSettings(){const e=new Go(this.column3,"debuffs-settings",{header:{title:"Debuffs",tooltip:Vs}}),t=$p(Yp,this.simUI);this.configureIconSection(e.bodyElement,t.map(t=>t.picker&&new t.picker(e.bodyElement,this.simUI.player,t.config,this.simUI)));const a=$p(Kp,this.simUI);a.length&&new wp(e.bodyElement,this.simUI.player,{inputs:a.map(e=>e.config),label:"Misc"},this.simUI)}buildPresetConfigurationPicker(){new Bm(this.rightPanel,this.simUI,[jm.Encounter,jm.Settings])}buildSavedDataPickers(){const e=new Vm(this.rightPanel,this.simUI.sim.encounter,{label:"Encounter",header:{title:"Saved Encounters"},storageKey:this.simUI.getSavedEncounterStorageKey(),getData:e=>Fs.create({encounter:e.toProto()}),setData:(e,t,a)=>t.fromProto(e,a.encounter),changeEmitters:[this.simUI.sim.encounter.changeEmitter],equals:(e,t)=>Fs.equals(e,t),toJson:e=>Fs.toJson(e),fromJson:e=>Fs.fromJson(e)}),t=new Vm(this.rightPanel,this.simUI,{label:"Settings",header:{title:"Saved Settings"},storageKey:this.simUI.getSavedSettingsStorageKey(),getData:()=>this.getCurrentSavedSettings(),setData:(e,t,a)=>{Se.freezeAllAndDo(()=>{t.sim.raid.setBuffs(e,a.raidBuffs||U.create()),t.sim.raid.setDebuffs(e,a.debuffs||A.create());const i=t.player.getParty();i&&i.setBuffs(e,a.partyBuffs||J.create()),t.player.setBuffs(e,a.playerBuffs||O.create()),t.player.setConsumes(e,a.consumables||G.create()),t.player.setRace(e,a.race),t.player.setProfessions(e,a.professions),t.player.itemSwapSettings.setItemSwapSettings(e,a.enableItemSwap,t.sim.db.lookupItemSwap(a.itemSwap||N.create()),ke.fromProto(a.itemSwap?.prepullBonusStats)),t.player.setReactionTime(e,a.reactionTimeMs),t.player.setChannelClipDelay(e,a.channelClipDelayMs),t.player.setInFrontOfTarget(e,a.inFrontOfTarget),t.player.setDistanceFromTarget(e,a.distanceFromTarget),t.player.setHealingModel(e,a.healingModel||D.create()),t.player.setChallengeModeEnabled(e,a.challengeMode)})},changeEmitters:[this.simUI.sim.raid.buffsChangeEmitter,this.simUI.sim.raid.debuffsChangeEmitter,this.simUI.player.getParty().buffsChangeEmitter,this.simUI.player.buffsChangeEmitter,this.simUI.player.consumesChangeEmitter,this.simUI.player.raceChangeEmitter,this.simUI.player.professionChangeEmitter,this.simUI.player.itemSwapSettings.changeEmitter,this.simUI.player.miscOptionsChangeEmitter,this.simUI.player.inFrontOfTargetChangeEmitter,this.simUI.player.distanceFromTargetChangeEmitter,this.simUI.player.healingModelChangeEmitter],equals:(e,t)=>Ws.equals(e,t),toJson:e=>Ws.toJson(e),fromJson:e=>Ws.fromJson(e)});this.simUI.sim.waitForInit().then(()=>{e.loadUserData(),t.loadUserData(),this.simUI.individualConfig.presets.settings?.forEach(e=>{t.addSavedData({name:e.name,tooltip:e.tooltip,isPreset:!0,data:Ws.create({race:e.race,raidBuffs:e.raidBuffs,playerBuffs:e.buffs,debuffs:e.debuffs,consumables:e.consumables})})}),this.simUI.individualConfig.presets.itemSwaps?.forEach(e=>{this.simUI.player,t.addSavedData({name:e.name,tooltip:e.tooltip,isPreset:!0,data:Ws.create({...this.getCurrentSavedSettings(),enableItemSwap:!0,itemSwap:e.itemSwap})})})})}getCurrentSavedSettings(){return Ws.create({raidBuffs:this.simUI.sim.raid.getBuffs(),partyBuffs:this.simUI.player.getParty()?.getBuffs()||J.create(),playerBuffs:this.simUI.player.getBuffs(),debuffs:this.simUI.sim.raid.getDebuffs(),consumables:this.simUI.player.getConsumes(),race:this.simUI.player.getRace(),professions:this.simUI.player.getProfessions(),enableItemSwap:this.simUI.player.itemSwapSettings.getEnableItemSwap(),itemSwap:this.simUI.player.itemSwapSettings.toProto(),reactionTimeMs:this.simUI.player.getReactionTime(),channelClipDelayMs:this.simUI.player.getChannelClipDelay(),inFrontOfTarget:this.simUI.player.getInFrontOfTarget(),distanceFromTarget:this.simUI.player.getDistanceFromTarget(),healingModel:this.simUI.player.getHealingModel(),challengeMode:this.simUI.player.getChallengeModeEnabled()})}configureInputSection(e,t){t.inputs.forEach(t=>{"number"==t.type?new Co(e,this.simUI.player,t):"boolean"==t.type?new Rt(e,this.simUI.player,{...t,reverse:!0}):"enum"==t.type&&new vd(e,this.simUI.player,t)})}configureIconSection(e,t,a){0==t.length?e.classList.add("hide"):a&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`))}}const lu=[{spec:Ms.Ferocity,label:"Ferocity",iconKey:"ability_druid_kingofthejungle"},{spec:Ms.Tenacity,label:"Tenacity",iconKey:"ability_druid_demoralizingroar"},{spec:Ms.Cunning,label:"Cunning",iconKey:"ability_eyeoftheowl"}];class ru extends we{constructor(a,i){super(a,"pet-spec-picker"),this.player=i;const s=t();this.rootElem.replaceChildren(e(l,null,e("div",{className:"talent-tree-header"},e("span",{className:"talent-tree-title"},"Pet Spec")),e("div",{ref:s,className:"talent-tree-main pet-spec-list"},lu.map(({spec:t,label:a,iconKey:i})=>{const s=e("div",{className:"talent-picker-root pet-spec-item",onclick:()=>this.onClickSpec(t)},e("div",{className:"talent-picker-icon",style:{backgroundImage:`url('https://wow.zamimg.com/images/wow/icons/large/${i}.jpg')`}}),e("div",{className:"talent-picker-label"},a)),n=u(s,{content:a});return this.addOnDisposeCallback(()=>n.destroy()),s})))),this.container=s.value,i.specOptionsChangeEmitter.on(()=>this.renderActive()),this.renderActive()}onClickSpec(e){if(e===this.player.getClassOptions().petSpec)return;const t=this.player.getClassOptions();t.petSpec=e,this.player.setClassOptions(Se.nextEventID(),t)}renderActive(){const e=this.player.getClassOptions().petSpec,t=[Ms.Ferocity,Ms.Tenacity,Ms.Cunning];console.log(this.container.children,[...this.container.children]),[...this.container.children].forEach((a,i)=>{const s=t[i];a.classList.toggle("selected",s===e)})}}class cu extends Do{constructor(t,a){super(t,a,{identifier:"talents-tab",title:s.t("talents.title")}),this.simUI=a,this.leftPanel=e("div",{className:"talents-tab-left tab-panel-left"}),this.rightPanel=e("div",{className:"talents-tab-right tab-panel-right within-raid-sim-hide"}),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildTalentsPicker(this.leftPanel),this.buildPresetConfigurationPicker(),this.buildSavedTalentsPicker(),this.buildHunterPetPicker(this.leftPanel)}buildHunterPetPicker(e){this.simUI.player.isClass(v.ClassHunter)&&new ru(e,this.simUI.player)}buildTalentsPicker(e){new vl(e,this.simUI.player,{playerClass:this.simUI.player.getClass(),playerSpec:this.simUI.player.getSpec(),tree:Yl[this.simUI.player.getClass()],changedEvent:e=>e.talentsChangeEmitter,getValue:e=>e.getTalentsString(),setValue:(e,t,a)=>{t.setTalentsString(e,a)}})}buildPresetConfigurationPicker(){new Bm(this.rightPanel,this.simUI,[jm.Talents])}buildSavedTalentsPicker(){const e=new Vm(this.rightPanel,this.simUI.player,{label:"Talents",header:{title:"Saved Talents"},storageKey:this.simUI.getSavedTalentsStorageKey(),getData:e=>Dt.create({talentsString:e.getTalentsString(),glyphs:e.getGlyphs()}),setData:(e,t,a)=>{Se.freezeAllAndDo(()=>{t.setTalentsString(e,a.talentsString),t.setGlyphs(e,a.glyphs||E.create())})},changeEmitters:[this.simUI.player.talentsChangeEmitter,this.simUI.player.glyphsChangeEmitter],equals:(e,t)=>Dt.equals(e,t),toJson:e=>Dt.toJson(e),fromJson:e=>Dt.fromJson(e)});this.simUI.sim.waitForInit().then(()=>{e.loadUserData(),this.simUI.individualConfig.presets.talents.forEach(t=>{t.isPreset=!0,e.addSavedData({name:t.name,isPreset:!0,data:t.data,onLoad:t.onLoad})})})}}const hu={id:"input-delay",type:"number",label:"Input Delay",labelTooltip:"Player input delay, in milliseconds. Specifies the maximum delay on actions that cannot be spell queued, such as spell casts that are waiting on resource gains or waiting for a cooldown to expire. Also used with certain APL values (such as 'Aura Is Active With Reaction Time'). Roughly models the sum of reaction time + server latency.",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getReactionTime(),setValue:(e,t,a)=>{t.setReactionTime(e,a)}},mu={id:"challenge-mode",type:"boolean",label:"Challenge Mode",labelTooltip:"Enables Challenge Mode",changedEvent:e=>e.challengeModeChangeEmitter,getValue:e=>e.getChallengeModeEnabled(),setValue:(e,t,a)=>{t.setChallengeModeEnabled(e,a)}},du={id:"channel-clip-delay",type:"number",label:"Channel Clip Delay",labelTooltip:"Clip delay following channeled spells, in milliseconds. This delay occurs following any full or partial channel ending after the GCD becomes available, due to the player not being able to queue the next spell.",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getChannelClipDelay(),setValue:(e,t,a)=>{t.setChannelClipDelay(e,a)}},pu={id:"in-front-of-target",type:"boolean",label:"In Front of Target",labelTooltip:"Stand in front of the target, causing Blocks and Parries to be included in the attack table.",changedEvent:e=>e.inFrontOfTargetChangeEmitter,getValue:e=>e.getInFrontOfTarget(),setValue:(e,t,a)=>{t.setInFrontOfTarget(e,a)}},uu={id:"distance-from-target",type:"number",label:"Distance From Target",labelTooltip:"Distance from targets, in yards. Used to calculate travel time for certain spells.",changedEvent:e=>e.distanceFromTargetChangeEmitter,getValue:e=>e.getDistanceFromTarget(),setValue:(e,t,a)=>{t.setDistanceFromTarget(e,a)}},gu={id:"tank-assignment",type:"enum",extraCssClasses:["tank-selector","threat-metrics","within-raid-sim-hide"],label:"Tank Assignment",labelTooltip:"Determines which mobs will be tanked. Most mobs default to targeting the Main Tank, but in preset multi-target encounters this is not always true.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:e=>e.getRaid().tanksChangeEmitter,getValue:e=>(e.getRaid()?.getTanks()||[]).findIndex(t=>F.equals(t,e.makeUnitReference())),setValue:(e,t,a)=>{const i=[];if(-1!=a){for(let e=0;e<a;e++)i.push(zs());i.push(t.makeUnitReference())}t.getRaid().setTanks(e,i)}},fu={id:"incoming-hps",type:"number",label:"Incoming HPS",labelTooltip:"\n\t\t<p>Average amount of healing received per second. Used for calculating chance of death.</p>\n\t\t<p>If set to 0, defaults to 25% of the primary target's base DPS.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().hps,setValue:(e,t,a)=>{const i=t.getHealingModel();i.hps=a,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find(t=>F.equals(t,e.makeUnitReference()))},wu={id:"healing-cadence",type:"number",float:!0,label:"Healing Cadence",labelTooltip:"\n\t\t<p>How often the incoming heal 'ticks', in seconds. Generally, longer durations favor Effective Hit Points (EHP) for minimizing Chance of Death, while shorter durations favor avoidance.</p>\n\t\t<p>Example: if Incoming HPS is set to 1000 and this is set to 1s, then every 1s a heal will be received for 1000. If this is instead set to 2s, then every 2s a heal will be recieved for 2000.</p>\n\t\t<p>If set to 0, default values for Healing Cadence and Cadence +/- are inferred from boss damage parameters.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceSeconds,setValue:(e,t,a)=>{const i=t.getHealingModel();i.cadenceSeconds=a,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find(t=>F.equals(t,e.makeUnitReference()))},yu={id:"healing-cadence-variation",type:"number",float:!0,label:"Cadence +/-",labelTooltip:"\n\t\t<p>Magnitude of random variation in healing intervals, in seconds.</p>\n\t\t<p>Example: if Healing Cadence is set to 1s with 0.5s variation, then the interval between successive heals will vary uniformly between 0.5 and 1.5s. If the variation is instead set to 2s, then 50% of healing intervals will fall between 0s and 1s, and the other 50% will fall between 1s and 3s.</p>\n\t\t<p>The amount of healing per 'tick' is automatically scaled up or down based on the randomized time since the last tick, so as to keep HPS constant.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceVariation,setValue:(e,t,a)=>{const i=t.getHealingModel();i.cadenceVariation=a,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find(t=>F.equals(t,e.makeUnitReference()))},bu={id:"healing-model-absorb-frac",type:"number",float:!0,label:"Absorb %",labelTooltip:"\n\t\t<p>% of each incoming heal 'tick' to model as an absorb shield rather than as a direct heal.</p>\n\t",changedEvent:e=>e.healingModelChangeEmitter,getValue:e=>100*e.getHealingModel().absorbFrac,setValue:(e,t,a)=>{const i=t.getHealingModel();i.absorbFrac=a/100,t.setHealingModel(e,i)}},Su={id:"burst-window",type:"number",float:!1,label:"TMI Burst Window",labelTooltip:"\n\t\t<p>Size in whole seconds of the burst window for calculating TMI. It is important to use a consistent setting when comparing this metric.</p>\n\t\t<p>Default is 6 seconds. If set to 0, TMI calculations are disabled.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().burstWindow,setValue:(e,t,a)=>{const i=t.getHealingModel();i.burstWindow=a,t.setHealingModel(e,i)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find(t=>F.equals(t,e.makeUnitReference()))},vu={id:"hp-percent-for-defensives",type:"number",float:!0,label:"HP % for Defensive CDs",labelTooltip:"\n\t\t<p>% of Maximum Health, below which defensive cooldowns are allowed to be used.</p>\n\t\t<p>If set to 0, this restriction is disabled.</p>\n\t",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>100*e.getSimpleCooldowns().hpPercentForDefensives,setValue:(e,t,a)=>{const i=t.getSimpleCooldowns();i.hpPercentForDefensives=a/100,t.setSimpleCooldowns(e,i)}},Iu=(e,t,a)=>{const i=new Vm(e,t.player,{label:"EP Weights",header:{title:"Saved EP weights"},storageKey:t.getSavedEPWeightsStorageKey(),getData:e=>js.create({epWeights:e.getEpWeights().toProto()}),setData:(e,t,a)=>{Se.freezeAllAndDo(()=>{t.setEpWeights(e,ke.fromProto(a.epWeights))})},changeEmitters:[t.player.epWeightsChangeEmitter],equals:(e,t)=>js.equals(e,t),toJson:e=>js.toJson(e),fromJson:e=>js.fromJson(e),...a});return t.sim.waitForInit().then(()=>{i.loadUserData(),t.individualConfig.presets.epWeights.forEach(({name:e,epWeights:t,enableWhen:a,onLoad:s})=>{i.addSavedData({name:e,isPreset:!0,data:js.create({epWeights:t.toProto()}),enableWhen:a,onLoad:s})})}),i};class Eu{constructor(e){this.changeEmitter=new Se,this._excludedStats=[],this._excludedPseudoStats=[],this.storageKey=e.getStorageKey("__statweight_settings__"),this.changeEmitter.on(()=>{const e=Ys.toJsonString(this.toProto());window.localStorage.setItem(this.storageKey,e)})}set excludedStats(e){this._excludedStats=e}get excludedStats(){return this._excludedStats.slice()}set excludedPseudoStats(e){this._excludedPseudoStats=e}get excludedPseudoStats(){return this._excludedPseudoStats.slice()}static updateProtoVersion(e){}applyDefaults(e){this.excludedStats=[],this.excludedPseudoStats=[],this.changeEmitter.emit(e)}load(e){const t=window.localStorage.getItem(this.storageKey);if(t){const a=Ys.fromJsonString(t,{ignoreUnknownFields:!0}),{excludedStats:i,excludedPseudoStats:s}=a;this.excludedStats=i||[],this.excludedPseudoStats=s||[],this.changeEmitter.emit(e)}}toProto(){return Ys.create({apiVersion:B,excludedStats:this.excludedStats,excludedPseudoStats:this.excludedPseudoStats})}isStatExcludedFromCalc(e){return!!this.excludedStats.includes(e)}isPseudoStatExcludedFromCalc(e){return!!this.excludedPseudoStats.includes(e)}isUnitStatExcludedFromCalc(e){return e.isStat()?this.isStatExcludedFromCalc(e.getStat()):this.isPseudoStatExcludedFromCalc(e.getPseudoStat())}setStatExcluded(e,t,a){const i=(e,t)=>{const i=t.indexOf(e);return a?-1===i&&t.push(e):-1!==i&&t.splice(i,1),t};t.isStat()?this.excludedStats=i(t.getStat(),this.excludedStats):this.excludedPseudoStats=i(t.getPseudoStat(),this.excludedPseudoStats),this.changeEmitter.emit(e)}}const ku=e=>{const t={footer:!0,scrollContents:!0};return e.sim.getShowThreatMetrics()?{size:"xl",...t}:t},Cu=class a extends Io{constructor(a,i){super(a.rootElem,"ep-weights-menu",{...ku(a),disposeOnClose:!1}),this.showAllStats=!1,this.header?.insertAdjacentElement("afterbegin",e("h5",{className:"modal-title"},"Calculate Stat Weights")),this.simUI=a,this.statsType="ep",this.epStats=this.simUI.individualConfig.epStats,this.epPseudoStats=this.simUI.individualConfig.epPseudoStats||[],this.epReferenceStat=this.simUI.individualConfig.epReferenceStat,this.settings=i;const s=this.buildStatsTable(),n=t(),o=t(),r=t(),c=t(),h=t(),m=t(),d=t(),p=t(),g=t(),f=t(),w=t(),y=e=>void 0!==e?Pe(e):"??",b=e=>Object.values(this.epStats).find(t=>y(t)===e),S=e(l,null,this.epStats.map(t=>e("option",null,y(t))));this.body.appendChild(e("div",{className:"d-flex flex-column flex-lg-row align-items-lg-start gap-3"},e("div",{className:"ep-weights-content order-1 order-lg-0"},e("div",{className:"ep-weights-options row"},e("div",{className:"col col-sm-3"},e("select",{ref:p,className:"ep-type-select form-select"},e("option",{value:"ep"},"EP"),e("option",{value:"weight"},"Weights"))),e("div",{ref:w,className:"show-all-stats-container col col-sm-3"})),e("div",{className:"ep-reference-options row"},e("div",{className:"col col-sm-4 damage-metrics"},e("span",null,"DPS/TPS reference:"),e("select",{ref:h,className:"ref-stat-select form-select damage-metrics"},S.cloneNode(!0))),e("div",{className:"col col-sm-4 healing-metrics"},e("span",null,"Healing reference:"),e("select",{ref:m,className:"ref-stat-select form-select healing-metrics"},S.cloneNode(!0))),e("div",{className:"col col-sm-4 threat-metrics"},e("span",null,"Mitigation reference:"),e("select",{ref:d,className:"ref-stat-select form-select threat-metrics"},S.cloneNode(!0))),e("p",null,"The above stat selectors control which reference stat is used for EP normalisation for the different EP columns.")),e("p",null,"The 'Current EP' column displays the values currently used by the item pickers to sort items.",e("br",null),"Use the ",e("button",{className:"fa fa-copy"})," icon above the EPs to use newly calculated EPs."),e("div",{ref:n,className:"results-ep-table-container modal-scroll-table"},e("table",{ref:r,className:"results-ep-table"},e("thead",null,e("tr",null,e("th",null,"Stat"),e("th",null,"Update"),s.map(({metric:t,type:a,label:i,metricRef:s})=>{const n="action"===a;return e("th",{className:_e(t&&`${t}-metrics`,n?"text-center":`type-${a}`)},e("span",null,i),e("button",{ref:s,className:"col-action"},e("i",{className:_e("fas",n?"fa-arrows-rotate":"fa-copy")})))})),e("tr",{className:"ep-ratios"},e("td",null,"EP Ratio"),e("td",null),s.filter(({type:e})=>"action"!==e).map(({metric:t,type:a,ratioRef:i})=>e("td",{ref:i,className:_e("type-ratio",`${t}-metrics`,`type-${a}`)})),e("td",{className:"text-center align-middle"},e("button",{ref:g,className:"btn btn-primary compute-ep"},e("i",{className:"fas fa-calculator"}),e("span",{className:"not-tiny"},"Update "),"EP")))),e("tbody",{ref:c})))),e("div",{ref:o,className:"ep-weights-sidebar sticky-lg-top order-0 order-lg-1"}))),this.footer.appendChild(e(l,null,e("button",{ref:f,className:"btn btn-primary calc-weights"},e("i",{className:"fas fa-calculator me-1"}),"Calculate"))),this.container=n.value,this.sidebar=o.value,this.table=r.value,this.tableBody=c.value;const v=e("div",{className:"results-pending-overlay"});this.resultsViewer=new Ro(v);const I=()=>{"ep"===this.statsType?(this.table.classList.remove("stats-type-weight"),this.table.classList.add("stats-type-ep")):(this.table.classList.add("stats-type-weight"),this.table.classList.remove("stats-type-ep"))},E=p.value;E.addEventListener("input",()=>{this.statsType=E.value,I()}),E.value=this.statsType,I();const k=()=>{this.simUI.player.epRefStatChangeEmitter.emit(Se.nextEventID()),this.simUI.prevEpSimResult=this.calculateEp(this.getPrevSimResult()),this.updateTable()},C=h.value;C&&(C.addEventListener("input",()=>{this.simUI.dpsRefStat=b(C.value),k()}),C.value=y(this.getDpsEpRefStat()));const _=m.value;_&&(_.addEventListener("input",()=>{this.simUI.healRefStat=b(_.value),k()}),_.value=y(this.getHealEpRefStat()));const x=d.value;x&&(x.addEventListener("input",()=>{this.simUI.tankRefStat=b(x.value),k()}),x.value=y(this.getTankEpRefStat()));const T=f.value;let P=!1;T?.addEventListener("click",async()=>{if(P)return;P=!0;try{await this.simUI.sim.signalManager.abortType(Pt.All)}catch(o){return void console.error(o)}T.disabled=!0,this.simUI.rootElem.classList.add("blurred"),this.simUI.rootElem.insertAdjacentElement("afterend",v),this.container.scrollTo({top:0}),this.container.classList.add("pending"),this.resultsViewer.setPending();const e=this.simUI.sim.getIterations();let t=!1;this.resultsViewer.addAbortButton(async()=>{if(!t)try{t=!0,await a.sim.signalManager.abortType(Pt.StatWeights)}catch(o){console.error("Error on stat weight abort!"),console.error(o)}finally{t=!1,P||(T.disabled=!1)}});const i=this.epStats.filter(e=>!this.settings.isStatExcludedFromCalc(e)),s=this.epPseudoStats.filter(e=>!this.settings.isPseudoStatExcludedFromCalc(e)),n=await this.simUI.player.computeStatWeights(Se.nextEventID(),i,s,this.epReferenceStat,e=>{this.setSimProgress(e)});this.simUI.rootElem.classList.remove("blurred"),v.remove(),this.container.classList.remove("pending"),this.resultsViewer.hideAll(),P=!1,t||(T.disabled=!1),n&&(this.simUI.prevEpIterations=e,this.simUI.prevEpSimResult=this.calculateEp(n),this.updateTable())}),this.addOnHideCallback(()=>{this.simUI.sim.signalManager.abortType(Pt.StatWeights).catch(console.error)});const R=(e,t,a,i,s)=>{const n=e.previousElementSibling;u(n,{content:()=>{if(!s)return t;const e=y(s());return`${t} Normalized by ${e}.`}}),u(e,{content:a}),e.addEventListener("click",()=>{this.setEpWeightsWithoutExcluded(ke.fromProto(i())),this.updateTable()})};s.forEach(({metricRef:e,labelTooltip:t,actionTooltip:a,getWeights:i,getEpRefStat:s})=>R(e.value,t,a,i,s)),new Rt(w.value,this,{id:"ep-show-all-stats",label:"Show All Stats",inline:!0,changedEvent:()=>new Se,getValue:()=>this.showAllStats,setValue:(e,t,a)=>{this.showAllStats=a,this.updateTable()}}),this.updateTable();const D=(e,t)=>{new Co(e,this.simUI.player,{id:`ep-ratio-${t}`,float:!0,changedEvent:e=>e.epRatiosChangeEmitter,getValue:()=>this.simUI.player.getEpRatios()[t],setValue:(e,a,i)=>{const s=a.getEpRatios();s[t]=i,a.setEpRatios(e,s)}})};s.filter(({type:e,ratioRef:t})=>"ep"===e&&!!t?.value).map(({ratioRef:e})=>e.value).forEach(D),this.simUI.player.epRatiosChangeEmitter.on(e=>this.updateTable());s.filter(({type:e,ratioRef:t})=>"weight"===e&&!!t?.value).map(({ratioRef:e})=>e.value).forEach(D);const N=g.value;u(N,{content:"Compute Weighted EP"}),N.addEventListener("click",()=>{const e=this.getPrevSimResult(),t=this.simUI.player.getEpRatios();if("ep"===this.statsType){const a=ke.fromProto(e.dps.epValues).scale(t[0]),i=ke.fromProto(e.hps.epValues).scale(t[1]),s=ke.fromProto(e.tps.epValues).scale(t[2]),n=ke.fromProto(e.dtps.epValues).scale(t[3]),o=ke.fromProto(e.tmi.epValues).scale(t[4]),l=ke.fromProto(e.pDeath.epValues).scale(t[5]),r=a.add(i).add(s).add(n).add(o).add(l);this.setEpWeightsWithoutExcluded(r)}else{const a=ke.fromProto(e.dps.weights).scale(t[0]),i=ke.fromProto(e.hps.weights).scale(t[1]),s=ke.fromProto(e.tps.weights).scale(t[2]),n=ke.fromProto(e.dtps.weights).scale(t[3]),o=ke.fromProto(e.tmi.weights).scale(t[4]),l=ke.fromProto(e.pDeath.weights).scale(t[5]),r=a.add(i).add(s).add(n).add(o).add(l);this.setEpWeightsWithoutExcluded(r)}this.updateTable()}),this.buildSavedEPWeightsPicker()}setEpWeightsWithoutExcluded(e){const{excludedStats:t,excludedPseudoStats:a}=this.settings,i=this.simUI.player.getEpWeights();for(const s of t)e=e.withStat(s,i.getStat(s));for(const s of a)e=e.withPseudoStat(s,i.getPseudoStat(s));this.simUI.player.setEpWeights(Se.nextEventID(),e)}isEpStat(e){return e.isStat()?this.epStats.includes(e.getStat()):this.epPseudoStats.includes(e.getPseudoStat())}setSimProgress(t){this.resultsViewer.setContent(e("div",{className:"results-sim"},e("div",null,t.completedSims," / ",t.totalSims,e("br",null),"simulations complete"),e("div",null,t.completedIterations," / ",t.totalIterations,e("br",null),"iterations complete")))}updateTable(){const t=e(l,null);a.epUnitStats.forEach(e=>{if(!this.showAllStats&&e.isStat()&&!this.epStats.includes(e.getStat())||e.isPseudoStat()&&!this.epPseudoStats.includes(e.getPseudoStat()))return;const a=this.makeTableRow(e);t.appendChild(a)}),this.tableBody.replaceChildren(t)}makeTableRow(a){const i=this.settings.isUnitStatExcludedFromCalc(a)?null:this.simUI.prevEpSimResult,s=this.simUI.player.getEpRatios(),n=((e,t,a)=>a?(a.dps?.epValues?t[0]*e.getProtoValue(a.dps.epValues):0)+(a.hps?.epValues?t[1]*e.getProtoValue(a.hps.epValues):0)+(a.tps?.epValues?t[2]*e.getProtoValue(a.tps.epValues):0)+(a.dtps?.epValues?t[3]*e.getProtoValue(a.dtps.epValues):0)+(a.tmi?.epValues?t[4]*e.getProtoValue(a.tmi.epValues):0)+(a.pDeath?.epValues?t[5]*e.getProtoValue(a.pDeath.epValues):0):0)(a,s,i),o=t(),l=t(),r=e("tr",null,e("td",null,a.getFullName(this.simUI.player.getClass())),e("td",{ref:l,className:"swcalc-include-toggle"}),this.makeTableRowCells(a,i?.dps,"damage-metrics",n,s[0]),this.makeTableRowCells(a,i?.hps,"healing-metrics",n,s[1]),this.makeTableRowCells(a,i?.tps,"threat-metrics",n,s[2]),this.makeTableRowCells(a,i?.dtps,"threat-metrics",n,s[3]),this.makeTableRowCells(a,i?.tmi,"threat-metrics",n,s[4]),this.makeTableRowCells(a,i?.pDeath,"threat-metrics",n,s[5]),e("td",{ref:o,className:"current-ep"}));l.value&&this.isEpStat(a)&&new Rt(l.value,this,{id:"sw-stat-toggle-"+a.getFullName(this.simUI.player.getClass()),getValue:e=>!e.settings.isUnitStatExcludedFromCalc(a),setValue:(e,t,i)=>t.settings.setStatExcluded(e,a,!i),changedEvent:e=>e.settings.changeEmitter,enableWhen:e=>!a.isStat()||e.epReferenceStat!=a.getStat()});const c=o.value;return new Co(c,this.simUI.player,{id:`ep-weight-stat-${Bs(a.getShortName(this.simUI.player.playerClass.classID))}`,float:!0,changedEvent:e=>e.epWeightsChangeEmitter,getValue:()=>this.simUI.player.getEpWeights().getUnitStat(a),setValue:(e,t,i)=>{const s=t.getEpWeights().withUnitStat(a,i);t.setEpWeights(e,s)}}),r}makeTableRowCells(a,i,s,n,o){let r=null,c=null;const h=0===o,m=t(),d=t();if(i){const e=a.getProtoValue(i.weights),t=a.getProtoValue(i.weightsStdev);r=this.makeTableCellContents(e,t);const s=a.getProtoValue(i.epValues),n=a.getProtoValue(i.epValuesStdev);c=this.makeTableCellContents(s,n)}else r=e("span",{className:"results-avg notapplicable"},"N/A"),c=r.cloneNode(!0);const p=e(l,null,e("td",{ref:m,className:_e("stdev-cell","type-weight",i&&h&&"unused-ep",s)},r),e("td",{ref:d,className:_e("stdev-cell","type-ep",i&&h&&"unused-ep",s)},c));if(!i||h)return p;const u=n-this.simUI.player.getEpWeights().getUnitStat(a),g=d.value.querySelector(".type-ep .results-avg");return"0.00"===u.toFixed(2)||(u>0?g.classList.add("positive"):u<0&&g.classList.add("negative")),p}makeTableCellContents(t,a){const i=this.simUI.prevEpIterations||1;return e(l,null,e("span",{className:"results-avg"},t.toFixed(2)),e("span",{className:"results-stdev"},"(",e("i",{className:"fas fa-plus-minus fa-xs"}),Hs(a,i).toFixed(2),")"))}calculateEp(e){const t=qs.clone(e);return void 0!==this.simUI.dpsRefStat&&(a.normaliseEpValue(this.simUI.dpsRefStat,t.dps),a.normaliseEpValue(this.simUI.dpsRefStat,t.tps)),void 0!==this.simUI.healRefStat&&a.normaliseEpValue(this.simUI.healRefStat,t.hps),void 0!==this.simUI.tankRefStat&&(a.normaliseEpValue(this.simUI.tankRefStat,t.dtps),a.normaliseEpValue(this.simUI.tankRefStat,t.tmi),a.normaliseEpValue(this.simUI.tankRefStat,t.pDeath)),t}static normaliseEpValue(e,t){const i=ve.fromStat(e),s=i.getProtoValue(t.weights),n=i.getProtoValue(t.weightsStdev);a.epUnitStats.forEach(e=>{const a=e.getProtoValue(t.weights);e.setProtoValue(t.epValues,0===s?0:a/s);const i=e.getProtoValue(t.weightsStdev);e.setProtoValue(t.epValuesStdev,0===n?0:i/n)})}getDpsEpRefStat(){return void 0!==this.simUI.dpsRefStat?this.simUI.dpsRefStat:this.epReferenceStat}getHealEpRefStat(){return void 0!==this.simUI.healRefStat?this.simUI.healRefStat:this.epReferenceStat}getTankEpRefStat(){return void 0!==this.simUI.tankRefStat?this.simUI.tankRefStat:n.StatArmor}getPrevSimResult(){return this.simUI.prevEpSimResult||qs.create({dps:{weights:(new ke).toProto(),weightsStdev:(new ke).toProto(),epValues:(new ke).toProto(),epValuesStdev:(new ke).toProto()},hps:{weights:(new ke).toProto(),weightsStdev:(new ke).toProto(),epValues:(new ke).toProto(),epValuesStdev:(new ke).toProto()},tps:{weights:(new ke).toProto(),weightsStdev:(new ke).toProto(),epValues:(new ke).toProto(),epValuesStdev:(new ke).toProto()},dtps:{weights:(new ke).toProto(),weightsStdev:(new ke).toProto(),epValues:(new ke).toProto(),epValuesStdev:(new ke).toProto()},tmi:{weights:(new ke).toProto(),weightsStdev:(new ke).toProto(),epValues:(new ke).toProto(),epValuesStdev:(new ke).toProto()},pDeath:{weights:(new ke).toProto(),weightsStdev:(new ke).toProto(),epValues:(new ke).toProto(),epValuesStdev:(new ke).toProto()}})}buildSavedEPWeightsPicker(){Iu(this.sidebar,this.simUI)}buildStatsTable(){const e="Copy to Current EP",a=()=>({metricRef:t(),ratioRef:t()});return[{metric:"damage",type:"weight",label:"DPS Weight",labelTooltip:"Per-point increase in DPS (Damage Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().dps.weights,...a()},{metric:"damage",type:"ep",label:"DPS EP",labelTooltip:"EP (Equivalency Points) for DPS (Damage Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().dps.epValues,getEpRefStat:()=>this.getDpsEpRefStat(),...a()},{metric:"healing",type:"weight",label:"HPS Weight",labelTooltip:"Per-point increase in HPS (Healing Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().hps.weights,...a()},{metric:"healing",type:"ep",label:"HPS EP",labelTooltip:"EP (Equivalency Points) for HPS (Healing Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().hps.epValues,getEpRefStat:()=>this.getHealEpRefStat(),...a()},{metric:"threat",type:"weight",label:"TPS Weight",labelTooltip:"Per-point increase in TPS (Threat Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().tps.weights,...a()},{metric:"threat",type:"ep",label:"TPS EP",labelTooltip:"EP (Equivalency Points) for TPS (Threat Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().tps.epValues,getEpRefStat:()=>this.getDpsEpRefStat(),...a()},{metric:"threat",type:"weight",label:"DTPS Weight",labelTooltip:"Per-point increase in DTPS (Damage Taken Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().dtps.weights,...a()},{metric:"threat",type:"ep",label:"DTPS EP",labelTooltip:"EP (Equivalency Points) for DTPS (Damage Taken Per Second) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().dtps.epValues,getEpRefStat:()=>this.getTankEpRefStat(),...a()},{metric:"threat",type:"weight",label:"TMI Weight",labelTooltip:"Per-point decrease in TMI (Theck-Meloree Index) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().tmi.weights,...a()},{metric:"threat",type:"ep",label:"TMI EP",labelTooltip:"EP (Equivalency Points) for TMI (Theck-Meloree Index) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().tmi.epValues,getEpRefStat:()=>this.getTankEpRefStat(),...a()},{metric:"threat",type:"weight",label:"Death Weight",labelTooltip:"Per-point decrease in p(death) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().pDeath.weights,...a()},{metric:"threat",type:"ep",label:"Death EP",labelTooltip:"EP (Equivalency Points) for p(death) for each stat.",actionTooltip:e,getWeights:()=>this.getPrevSimResult().pDeath.epValues,getEpRefStat:()=>this.getTankEpRefStat(),...a()},{type:"action",label:"Current EP",labelTooltip:"Current EP Weights. Used to sort the gear selector menus.",actionTooltip:"Restore Default EP",getWeights:()=>this.simUI.individualConfig.defaults.epWeights.toProto(),...a()}]}};Cu.epUnitStats=ve.getAll().filter(e=>!!e.isStat()||[o.PseudoStatMainHandDps,o.PseudoStatOffHandDps,o.PseudoStatRangedDps,o.PseudoStatPhysicalHitPercent,o.PseudoStatSpellHitPercent,o.PseudoStatPhysicalCritPercent,o.PseudoStatSpellCritPercent].includes(e.getPseudoStat()));let _u=Cu;function xu(e){return e.requiredTalentRows?e.requiredTalentRows:[0,1,2,3,4,5]}class Tu extends we{constructor(e){super(null),this.toast=null,this.container=e,this.hasSeenNotice||Ks()||$s()||(this.render(),this.toast?.element.addEventListener("hide.bs.toast",()=>{this.setHasSeenNotice()},{once:!0}))}get settingsKey(){return`${Z}_notice-local-sim.v1`}get hasSeenNotice(){return window.localStorage.getItem(this.settingsKey)}setHasSeenNotice(){window.localStorage.setItem(this.settingsKey,"true")}render(){this.toast=new No({additionalClasses:["toast-notice-local-download"],container:this.container,variant:"info",title:"Did you know?",autohide:!1,body:e(l,null,e("p",null,"You can download our local sim to speed up your simulations significantly?"),e("a",{href:x,className:"btn btn-outline-light",target:"_blank",onclick:()=>this.setHasSeenNotice()},"Download"))})}}class Pu extends Io{constructor(a,i){super(a,"settings-menu",{title:"Options",footer:!0,disposeOnClose:!1}),this.simUI=i;const s=t(),n=t(),o=t(),l=t(),r=t(),c=t(),h=t(),m=t(),d=t(),p=t(),g=e("div",null,e("div",{className:"picker-group"},e("div",{className:"fixed-rng-seed-container"},e("div",{ref:n,className:"fixed-rng-seed"}),e("div",{className:"form-text"},e("span",null,"Last used RNG seed:")," ",e("span",{ref:o,className:"last-used-rng-seed"},"0"))),e("div",{ref:l,className:"language-picker within-raid-sim-hide"})),e("div",{ref:r,className:"show-threat-metrics-picker w-50 pe-2"}),e("div",{ref:c,className:"show-experimental-picker w-50 pe-2"}),e("div",{ref:h,className:"show-quick-swap-picker w-50 pe-2"}),e("div",{ref:m,className:"use-concurrency-container w-50 pe-2"},e("div",{ref:d,className:"use-concurrent-workers-picker"}),e("div",{ref:p,className:"form-text",hidden:!0})));this.body.innerHTML="",this.body.appendChild(g);const f=e("button",{ref:s,className:"restore-defaults-button btn btn-primary"},"Restore Defaults");if(this.footer&&(this.footer.innerHTML="",this.footer.appendChild(f)),s.value&&(u(s.value,{content:"Restores all default settings (gear, consumes, buffs, talents, EP weights, etc). Saved settings are preserved."}),s.value.addEventListener("click",()=>{this.simUI.applyDefaults(Se.nextEventID()),new No({variant:"success",body:"Restored to default settings."})})),n.value&&new Co(n.value,this.simUI.sim,{id:"simui-fixed-rng-seed",label:"Fixed RNG Seed",labelTooltip:"Seed value for the random number generator used during sims, or 0 to use different randomness each run. Use this to share exact sim results or for debugging.",extraCssClasses:["mb-0"],changedEvent:e=>e.fixedRngSeedChangeEmitter,getValue:e=>e.getFixedRngSeed(),setValue:(e,t,a)=>{t.setFixedRngSeed(e,a)}}),o.value&&(o.value.textContent=String(this.simUI.sim.getLastUsedRngSeed()),this.simUI.sim.lastUsedRngSeedChangeEmitter.on(()=>{o.value&&(o.value.textContent=String(this.simUI.sim.getLastUsedRngSeed()))})),l.value){const e=Object.keys(X),t=e.indexOf("en");new vd(l.value,this.simUI.sim,{id:"simui-language-picker",label:"Language",labelTooltip:"Controls the language for Wowhead tooltips.",values:e.map((e,t)=>({name:X[e],value:t})),changedEvent:e=>e.languageChangeEmitter,getValue:a=>{const i=e.indexOf(a.getLanguage());return-1==i?t:i},setValue:(t,a,i)=>{a.setLanguage(t,e[i]||"en"),Q(e[i]||"en")}}).changeEmitter.on(()=>setTimeout(()=>location.reload(),300))}if(r.value&&new Rt(r.value,this.simUI.sim,{id:"simui-show-threat-metrics",label:"Show Threat/Tank Options",labelTooltip:"Shows all options and metrics relevant to tanks, like TPS/DTPS.",inline:!0,changedEvent:e=>e.showThreatMetricsChangeEmitter,getValue:e=>e.getShowThreatMetrics(),setValue:(e,t,a)=>{t.setShowThreatMetrics(e,a)}}),c.value&&new Rt(c.value,this.simUI.sim,{id:"simui-show-experimental",label:"Show Experimental",labelTooltip:"Shows experimental options, if there are any active experiments.",inline:!0,changedEvent:e=>e.showExperimentalChangeEmitter,getValue:e=>e.getShowExperimental(),setValue:(e,t,a)=>{t.setShowExperimental(e,a)}}),h.value&&new Rt(h.value,this.simUI.sim,{id:"simui-show-quick-swap",label:"Show quick swap interface",labelTooltip:"Allows you to quickly swap between Gems/Enchants through your favorites. (Disabled on touch devices)",inline:!0,changedEvent:e=>e.showQuickSwapChangeEmitter,getValue:e=>e.getShowQuickSwap(),setValue:(e,t,a)=>{t.setShowQuickSwap(e,a)}}),m.value&&d.value){const e=[{value:0,name:"Off"}];for(let t=2;t<=navigator.hardwareConcurrency;t++)e.push({value:t,name:t.toString()});if(new vd(d.value,this.simUI.sim,{id:"simui-concurrent-workers-picker",label:"Use Multiple CPU Cores",labelTooltip:"Use web workers to spread sim workload over multiple CPU cores.",changedEvent:e=>e.wasmConcurrencyChangeEmitter,getValue:e=>e.getWasmConcurrency(),setValue:(e,t,a)=>t.setWasmConcurrency(e,a),values:e}),p.value&&navigator.userAgent.toLowerCase().includes("firefox")){const e=p.value;e.hidden=!1,e.textContent="Too many workers can cause significant memory usage! If sim doesn't finish due to RAM running out use a lower number."}this.simUI.sim.isWasm().then(e=>{e||(m.value.hidden=!0)})}}}class Ru extends we{static buildDiscordLink(){const t=e("a",{href:"https://discord.gg/p3DgvmnDCS",target:"_blank",className:"discord-link link-alt",dataset:{tippyContent:"Join us on Discord"}},e("i",{className:"fab fa-discord fa-lg"}));return u(t),t}static buildGitHubLink(){const t=e("a",{href:ee,target:"_blank",className:"github-link link-alt",dataset:{tippyContent:"Contribute on GitHub"}},e("i",{className:"fab fa-github fa-lg"}));return u(t),t}static buildPatreonLink(){const t=e("a",{href:"https://patreon.com/wowsims",target:"_blank",className:"patreon-link link-alt",dataset:{tippyContent:"Support us on Patreon"}},e("i",{className:"fab fa-patreon fa-lg"})," Patreon");return u(t),t}}class Du extends we{constructor(t,a){super(t,"sim-header"),this.simUI=a,this.simTabsContainer=this.rootElem.querySelector(".sim-tabs"),this.simToolbar=this.rootElem.querySelector(".sim-toolbar"),this.knownIssuesContent=e("ul",{className:"text-start ps-3 mb-0"}),this.knownIssuesLink=this.addKnownIssuesLink(),this.addBugReportLink(),this.addDownloadBinaryLink(),this.addSimOptionsLink(),this.addSocialLinks(),new IntersectionObserver(([e])=>e.target.classList.toggle("stuck",e.intersectionRatio<1),{threshold:[1]}).observe(this.rootElem)}activateTab(e){this.simTabsContainer.getElementsByClassName(e)[0].click()}addTab(t,a){const i=0==this.simTabsContainer.children.length;this.simTabsContainer.appendChild(e("li",{className:`${a} nav-item`,attributes:{role:"presentation","aria-controls":a}},e("button",{className:`nav-link ${i&&"active"}`,type:"button",dataset:{bsToggle:"tab",bsTarget:`#${a}`},attributes:{role:"tab","aria-selected":i}},t)))}addSimTabLink(e){const t=0==this.simTabsContainer.children.length;e.navLink.setAttribute("aria-selected",t.toString()),t&&e.navLink.classList.add("active","show"),this.simTabsContainer.appendChild(e.navItem)}addImportLink(e,t,a,i=!1){this.addImportExportLink(".import-dropdown",e,t,a,i)}addExportLink(e,t,a,i=!1){this.addImportExportLink(".export-dropdown",e,t,a,i)}addImportExportLink(a,i,s,n,o){const l=this.rootElem.querySelector(a).querySelector(".dropdown-menu"),r=t();if(l.appendChild(e("li",null,e("button",{ref:r,className:_e("dropdown-item",o&&"disabled")},i))),r.value){if(o)return void u(r.value,{content:"Currently unsupported"});r.value.addEventListener("click",()=>s.open())}}addToolbarLink({parent:a,tooltip:i,classes:s,onclick:n,text:o,...l}){const r=t();return a.appendChild(e(To,{linkRef:r,buttonClassName:s,...l},o)),n&&r.value.addEventListener("click",n),i&&u(r.value,{content:i,placement:"bottom"}),r.value}addKnownIssuesLink(){return this.addToolbarLink({parent:this.simToolbar,text:"Known Issues",tooltip:this.knownIssuesContent,classes:"known-issues link-danger hide"})}addKnownIssue(t){const a=e("li",null);a.innerHTML=t,this.knownIssuesContent.appendChild(a),this.knownIssuesLink.classList.remove("hide"),this.knownIssuesLink._tippy?.setContent(this.knownIssuesContent)}addBugReportLink(){this.addToolbarLink({href:te,parent:this.simToolbar,icon:"fas fa-bug fa-lg",tooltip:"Report a bug or<br>Request a feature"})}addDownloadBinaryLink(){const e=x,t="fas fa-gauge-high fa-lg",a=this.simToolbar;Ks()?fetch("/version").then(i=>{i.json().then(i=>{2==i.outdated&&this.addToolbarLink({href:e,parent:a,icon:t,tooltip:"Newer version of simulator available for download",classes:"downbin link-danger"})}).catch(e=>{console.warn("No version info found!")})}).catch(Le):this.addToolbarLink({href:e,parent:a,icon:t,tooltip:"Download simulator for faster simulating",classes:"downbin"})}addSimOptionsLink(){const e=new Pu(this.simUI.rootElem,this.simUI);this.addToolbarLink({parent:this.simToolbar,icon:"fas fa-cog fa-lg",tooltip:"Show Sim Options",classes:"sim-options",onclick:()=>e.open()})}addSocialLinks(){const t=e("div",{className:"sim-toolbar-socials"});this.simToolbar.appendChild(t),this.addDiscordLink(t),this.addGitHubLink(t),this.addPatreonLink(t)}addDiscordLink(t){t.appendChild(e(To,null,Ru.buildDiscordLink()))}addGitHubLink(t){t.appendChild(e(To,null,Ru.buildGitHubLink()))}addPatreonLink(t){t.appendChild(e(To,null,Ru.buildPatreonLink()))}customRootElement(){return e("header",{className:"sim-header"},e("div",{className:"sim-header-container"},e("ul",{className:"sim-tabs nav nav-tabs",attributes:{role:"tablist"}}),e("div",{className:"import-export nav within-raid-sim-hide"},e("div",{className:"dropdown sim-dropdown-menu import-dropdown"},e("button",{className:"import-link",attributes:{"aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},e("i",{className:"fa fa-download"})," ",s.t("import.title")),e("ul",{className:"dropdown-menu"})),e("div",{className:"dropdown sim-dropdown-menu export-dropdown"},e("button",{className:"export-link",attributes:{"aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},e("i",{className:"fa fa-right-from-bracket"})," ",s.t("export.title")),e("ul",{className:"dropdown-menu"}))),e("div",{className:"sim-toolbar nav"})))}}class Nu extends we{constructor(a,i,s={}){super(a,"sim-title-dropdown-root");const n=i?{type:"Spec",spec:i}:{type:"Raid"},o=this.buildRootSimLink(n);if(s.noDropdown)return void this.rootElem.replaceChildren(o);const l=t();this.rootElem.replaceChildren(e("div",{className:"dropdown sim-link-dropdown"},o,e("ul",{ref:l,className:"dropdown-menu"}))),this.dropdownMenu=l.value,this.buildDropdown(),this.dropdownMenu.addEventListener("click",e=>{e.target.closest("a")||(e.stopPropagation(),e.preventDefault())})}buildDropdown(){ae.status>=ie.Alpha&&this.dropdownMenu?.appendChild(e("li",null,this.buildRaidLink())),Js.naturalOrder.forEach(t=>this.dropdownMenu?.appendChild(e("li",null,this.buildClassDropdown(t))))}buildClassDropdown(t){return e("div",{className:"dropend sim-link-dropdown"},this.buildClassLink(t),e("ul",{className:"dropdown-menu"},Object.values(t.specs).map(t=>e("li",null,this.buildSpecLink(t)))))}buildRootSimLink(t){return e("button",{className:_e("sim-link",this.getContextualKlass(t)),dataset:{bsToggle:"dropdown",bsTrigger:"click"},attributes:{"aria-expanded":"false"}},e("div",{className:"sim-link-content"},e("img",{src:this.getSimIconPath(t),className:"sim-link-icon"}),e("div",{className:"d-flex flex-column"},e("span",{className:"sim-link-label text-white"},s.t("sidebar.header.title")),e("span",{className:"sim-link-title"},"Raid"===t.type&&Zs,"Spec"===t.type&&ze.getFullSpecName(t.spec)),this.launchStatusLabel(t))))}buildRaidLink(){return e("a",{href:Qs,className:_e("sim-link",this.getContextualKlass({type:"Raid"}))},e("div",{className:"sim-link-content"},e("img",{src:this.getSimIconPath({type:"Raid"}),className:"sim-link-icon"}),e("div",{className:"d-flex flex-column"},e("span",{className:"sim-link-title"},Zs),this.launchStatusLabel({type:"Raid"}))))}buildClassLink(t){return e("button",{className:_e("sim-link",this.getContextualKlass({type:"Class",class:t})),dataset:{bsToggle:"dropdown"},attributes:{"aria-expanded":"false"}},e("div",{className:"sim-link-content"},e("img",{src:this.getSimIconPath({type:"Class",class:t}),className:"sim-link-icon"}),e("div",{className:"d-flex flex-column"},e("span",{className:"sim-link-title"},se(t)))))}buildSpecLink(t){return e("a",{href:t.simLink,className:_e("sim-link",this.getContextualKlass({type:"Spec",spec:t}))},e("div",{className:"sim-link-content"},e("img",{src:this.getSimIconPath({type:"Spec",spec:t}),className:"sim-link-icon"}),e("div",{className:"d-flex flex-column"},e("span",{className:"sim-link-label"},se(ze.getPlayerClass(t))),e("span",{className:"sim-link-title"},ne(t)),this.launchStatusLabel({type:"Spec",spec:t}))))}launchStatusLabel(t){if("Raid"===t.type&&ae.status===ie.Launched)return null;const a="Raid"===t.type?ae.status:oe[t.spec.specID].status,i="Raid"===t.type?ae.phase:oe[t.spec.specID].phase;return e("span",{className:"launch-status-label text-brand"},s.t("sidebar.header.phase",{phase:s.t(`common.phases.${i}`),status:le(a)}))}getSimIconPath(e){let t="";switch(e.type){case"Raid":t=tn;break;case"Class":t=e.class.getIcon("large");break;case"Spec":t=e.spec.getIcon("large")}return t}getContextualKlass(e){switch(e.type){case"Class":return en(e.class);case"Spec":return Xs(e.spec);default:return"text-white"}}}var Gu=(e=>(e.bulkSimAsync="bulkSimAsync",e.bulkSimCombos="bulkSimCombos",e.computeStats="computeStats",e.computeStatsJson="computeStatsJson",e.raidSim="raidSim",e.raidSimJson="raidSimJson",e.raidSimAsync="raidSimAsync",e.statWeights="statWeights",e.statWeightsAsync="statWeightsAsync",e.statWeightRequests="statWeightRequests",e.statWeightCompute="statWeightCompute",e.raidSimRequestSplit="raidSimRequestSplit",e.raidSimResultCombination="raidSimResultCombination",e.abortById="abortById",e))(Gu||{});const Uu=5;class Ou{constructor(e,t){this.buffs=J.create(),this.compChangeEmitter=new Se,this.buffsChangeEmitter=new Se,this.sim=t,this.raid=e,this.players=[...Array(5).keys()].map(e=>null),this.playerChangeListener=e=>this.changeEmitter.emit(e),this.changeEmitter=Se.onAny([this.compChangeEmitter,this.buffsChangeEmitter],"PartyChange")}size(){return this.players.filter(e=>null!=e).length}isEmpty(){return 0==this.size()}clear(e){this.setBuffs(e,J.create());for(let t=0;t<5;t++)this.setPlayer(e,t,null)}getIndex(){return this.raid.getParties().indexOf(this)}getPlayers(){return this.players.slice()}getPlayer(e){return this.players[e]}setPlayer(e,t,a){if(t<0||t>=5)throw new Error("Invalid player index: "+t);a!=this.players[t]&&Se.freezeAllAndDo(()=>{const i=this.players[t];if(null!=i&&(i.changeEmitter.off(this.playerChangeListener),i.setParty(null)),null!=a){const i=a.getParty();i&&i.setPlayer(e,a.getPartyIndex(),null),this.players[t]=a,a.changeEmitter.on(this.playerChangeListener),a.setParty(this)}else this.players[t]=null;this.compChangeEmitter.emit(e)})}getBuffs(){return J.clone(this.buffs)}setBuffs(e,t){J.equals(this.buffs,t)||(this.buffs=J.clone(t),this.buffsChangeEmitter.emit(e))}toProto(e,t){return an.create({players:this.players.map(a=>null==a?sn.create():a.toProto(e,t)),buffs:this.buffs})}fromProto(e,t){Se.freezeAllAndDo(()=>{this.setBuffs(e,t.buffs||J.create());for(let a=0;a<5;a++){if(!t.players[a]||t.players[a].class==v.ClassUnknown){this.setPlayer(e,a,null);continue}const i=t.players[a],s=nn(i),n=this.players[a];if(n&&s.specID==n.getSpec())n.fromProto(e,i);else{const t=new yg(s,this.sim);t.fromProto(e,i),this.setPlayer(e,a,t)}}})}}const Au=5;class Lu{constructor(e){this.buffs=U.create(),this.debuffs=A.create(),this.tanks=[],this.targetDummies=0,this.numActiveParties=5,this.compChangeEmitter=new Se,this.buffsChangeEmitter=new Se,this.debuffsChangeEmitter=new Se,this.tanksChangeEmitter=new Se,this.targetDummiesChangeEmitter=new Se,this.numActivePartiesChangeEmitter=new Se,this.sim=e,this.parties=[...Array(5).keys()].map(t=>{const a=new Ou(this,e);return a.compChangeEmitter.on(e=>this.compChangeEmitter.emit(e)),a.changeEmitter.on(e=>this.changeEmitter.emit(e)),a}),this.activePlayers=[],this.numActivePartiesChangeEmitter.on(e=>this.compChangeEmitter.emit(e)),this.changeEmitter=Se.onAny([this.compChangeEmitter,this.buffsChangeEmitter,this.debuffsChangeEmitter,this.tanksChangeEmitter,this.targetDummiesChangeEmitter],"RaidChange"),this.changeEmitter.on(()=>{this.activePlayers=[]})}size(){return on(this.parties.map(e=>e.size()))}isEmpty(){return 0==this.size()}getParties(){return this.parties.slice()}getParty(e){return this.parties[e]}getPlayers(){return this.parties.map(e=>e.getPlayers()).flat()}getPlayer(e){if(-1===e)return null;return this.parties[Math.floor(e/5)].getPlayer(e%5)}getPlayerFromUnitReference(e,t){return e&&e.type!=W.Unknown?e.type==W.Player?this.getPlayer(e.index):e.type==W.Self&&t||null:null}setPlayer(e,t,a){this.parties[Math.floor(t/5)].setPlayer(e,t%5,a)}getClassCount(e){return this.getPlayers().filter(t=>null!=t&&t.getClass()==e).length}getBuffs(){return U.clone(this.buffs)}setBuffs(e,t){U.equals(this.buffs,t)||(this.buffs=U.clone(t),this.buffsChangeEmitter.emit(e))}getDebuffs(){return A.clone(this.debuffs)}setDebuffs(e,t){A.equals(this.debuffs,t)||(this.debuffs=A.clone(t),this.debuffsChangeEmitter.emit(e))}getTanks(){return this.tanks.map(e=>F.clone(e))}setTanks(e,t){this.tanks.length==t.length&&this.tanks.every((e,a)=>F.equals(e,t[a]))||(this.tanks=t.map(e=>F.clone(e)),this.tanksChangeEmitter.emit(e))}getTargetDummies(){return this.targetDummies}setTargetDummies(e,t){this.targetDummies!=t&&(this.targetDummies=t,this.targetDummiesChangeEmitter.emit(e))}getNumActiveParties(){return this.numActiveParties}setNumActiveParties(e,t){t!=this.numActiveParties&&t>0&&(this.numActiveParties=t,this.numActivePartiesChangeEmitter.emit(e))}getActivePlayers(){if(0==this.activePlayers.length){const e=this.getParties().filter((e,t)=>t<this.numActiveParties);this.activePlayers=e.map(e=>e.getPlayers()).flat().filter(e=>null!=e)}return this.activePlayers}toProto(e,t){return ln.create({parties:this.parties.map(a=>a.toProto(e,t)),buffs:this.getBuffs(),debuffs:this.getDebuffs(),tanks:this.getTanks(),targetDummies:this.getTargetDummies(),numActiveParties:this.getNumActiveParties()})}fromProto(e,t){Se.freezeAllAndDo(()=>{this.setBuffs(e,t.buffs||U.create()),this.setDebuffs(e,t.debuffs||A.create()),this.setTanks(e,t.tanks),this.setTargetDummies(e,t.targetDummies),this.setNumActiveParties(e,t.numActiveParties||5);for(let a=0;a<5;a++)t.parties[a]?this.parties[a].fromProto(e,t.parties[a]):this.parties[a].clear(e)})}clear(e){Se.freezeAllAndDo(()=>{for(let t=0;t<5;t++)this.parties[t].clear(e)})}}const Vu=`/${re}/sim_worker.js`,Fu=e=>e+"-"+Array.from(Array(4)).map(()=>Math.floor(65536*Math.random()).toString(16)).join("");class Wu{constructor(e){this.workers=[],this.workersDisabled=[],this.setNumWorkers(e)}setNumWorkers(e){if(e<this.workers.length){for(let t=this.workers.length-1;t>=e;t--)this.workers[t].disable(),this.workersDisabled[t]=this.workers[t];this.workers.length=e}else for(let t=0;t<e;t++)this.workers[t]||(this.workersDisabled[t]?(this.workers[t]=this.workersDisabled[t],delete this.workersDisabled[t],this.workers[t].enable()):this.workers[t]=new Mu(t))}getNumWorkers(){return this.workers.length}getLeastBusyWorker(){return this.workers.reduce((e,t)=>e.getSimTaskWorkAmount()<t.getSimTaskWorkAmount()?e:t)}async makeApiCall(e,t){return await this.getLeastBusyWorker().doApiCall(e,t,Fu(e))}async computeStats(e){const t=await this.makeApiCall(Gu.computeStats,rn.toBinary(e));return cn.fromBinary(t)}getProgressName(e){return`${e}progress`}async statWeightsAsync(e,t,a){const i=this.getLeastBusyWorker();i.log("Stat weights request: "+hn.toJsonString(e));const s=Fu(Gu.statWeightsAsync);a.abort.onTrigger(async()=>{await i.sendAbortById(s)});const n=e.simOptions?e.simOptions.iterations*e.statsToWeigh.length:3e4,o=await this.doAsyncRequest(Gu.statWeightsAsync,hn.toBinary(e),s,i,t,n);return i.log("Stat weights result: "+qs.toJsonString(o.finalWeightResult)),o.finalWeightResult}async statWeightRequests(e){const t=await this.makeApiCall(Gu.statWeightRequests,hn.toBinary(e));return mn.fromBinary(t)}async statWeightCompute(e){const t=await this.makeApiCall(Gu.statWeightCompute,dn.toBinary(e));return qs.fromBinary(t)}async bulkSimAsync(e,t,a){const i=this.getLeastBusyWorker();i.log("bulk sim request: "+pn.toJsonString(e,{enumAsInteger:!0}));const s=Fu(Gu.bulkSimAsync);a.abort.onTrigger(async()=>{await i.sendAbortById(s)});const n=e.baseSettings?.simOptions?.iterations??3e4,o=await this.doAsyncRequest(Gu.bulkSimAsync,pn.toBinary(e),s,i,t,n),l=un.toJson(o.finalBulkResult);return i.log("bulk sim result: "+JSON.stringify(l)),o.finalBulkResult}async bulkSimCombosAsync(e){const t=this.getLeastBusyWorker();t.log("bulk sim combinations request: "+gn.toJsonString(e,{enumAsInteger:!0}));const a=Fu(Gu.bulkSimCombos),i=await t.doApiCall(Gu.bulkSimCombos,gn.toBinary(e),a);return fn.fromBinary(i)}async raidSimAsync(e,t,a){const i=this.getLeastBusyWorker();i.log("Raid sim request: "+Gt.toJsonString(e));const s=e.requestId;a.abort.onTrigger(async()=>{await i.sendAbortById(s)});const n=e.simOptions?.iterations??3e3,o=await this.doAsyncRequest(Gu.raidSimAsync,Gt.toBinary(e),s,i,t,n),l=wn.toJson(o.finalRaidResult);return delete l.logs,i.log("Raid sim result: "+JSON.stringify(l)),o.finalRaidResult}async raidSimRequestSplit(e){const t=await this.makeApiCall(Gu.raidSimRequestSplit,yn.toBinary(e));return bn.fromBinary(t)}async raidSimResultCombination(e){const t=await this.makeApiCall(Gu.raidSimResultCombination,Sn.toBinary(e));return wn.fromBinary(t)}isWasm(){return this.workers[0].isWasmWorker()}async doAsyncRequest(e,t,a,i,s,n){try{i.addSimTaskRunning(a,n),i.doApiCall(e,t,a);const o=new Promise(e=>{i.addPromiseFunc(this.getProgressName(a),this.newProgressHandler(a,i,s,t=>e(t)),Le)});return await o}finally{i.updateSimTask(a,0)}}newProgressHandler(e,t,a,i){return s=>{const n=vn.fromBinary(s);a(n),t.updateSimTask(e,Math.max(1,n.totalIterations-n.completedIterations)),null==n.finalRaidResult&&null==n.finalWeightResult&&null==n.finalBulkResult?t.addPromiseFunc(this.getProgressName(e),this.newProgressHandler(e,t,a,i),Le):i(n)}}}class Mu{constructor(e){this.workerId=e,this.simTasksRunning={},this.taskIdsToPromiseFuncs={},this.wasmWorker=!1,this.shouldDestroy=!1,this.onReady=new Promise((e,t)=>{this.resolveReady=e}),this.setupWorker(),this.log("Created.")}setupWorker(){this.setTaskActive("setup",!0),this.onReady=new Promise((e,t)=>{this.resolveReady=e}),this.worker=new window.Worker(Vu),this.worker.addEventListener("message",({data:e})=>{const{id:t,msg:a,outputData:i}=e;switch(a){case"ready":this.wasmWorker=!!i&&!!i[0],this.postMessage({msg:"setID",id:this.workerId.toString()}),this.resolveReady(),this.setTaskActive("setup",!1),this.log(`Ready, isWasm: ${this.wasmWorker}`);break;case"idConfirm":break;default:const e=this.taskIdsToPromiseFuncs[t];if(!e)return void console.warn(`Unrecognized result id ${t} for msg ${a}`);t.includes("progress")||this.setTaskActive(t,!1),delete this.taskIdsToPromiseFuncs[t],e[0](i)}})}addSimTaskRunning(e,t){this.simTasksRunning[e]={workLeft:t},this.log(`Added work ${e}, current work amount: ${this.getSimTaskWorkAmount()}`)}updateSimTask(e,t){if(t<=0)return delete this.simTasksRunning[e],this.log(`Work ${e} done, current work amount: ${this.getSimTaskWorkAmount()}`),void(this.shouldDestroy&&0==this.getSimTaskWorkAmount()&&this.disable(!0));this.simTasksRunning[e].workLeft=t}getSimTaskWorkAmount(){let e=0;for(const t of Object.values(this.simTasksRunning))e+=t.workLeft;return e}hasTaskId(e){return!!this.simTasksRunning[e]}setTaskActive(e,t){t?this.addSimTaskRunning(e+"task",1):this.updateSimTask(e+"task",0)}async isWasmWorker(){if(!this.onReady||this.shouldDestroy)throw new Error("Disabled worker was used!");return await this.onReady,this.wasmWorker}addPromiseFunc(e,t,a){this.taskIdsToPromiseFuncs[e]=[t,a]}async doApiCall(e,t,a){if(!this.onReady||this.shouldDestroy)throw new Error("Disabled worker was used!");if(!a)throw new Error("ApiCall with empty id!");this.setTaskActive(a,!0),await this.onReady;const i=new Promise((i,s)=>{this.taskIdsToPromiseFuncs[a]=[i,s],this.postMessage({msg:e,id:a,inputData:t})});return await i}postMessage(e){if(!this.worker)throw new Error(`Worker ${this.workerId} postMessage while disabled!`);this.worker.postMessage(e)}disable(e=!1){this.shouldDestroy=!0,!this.worker||!e&&this.getSimTaskWorkAmount()||(this.worker.terminate(),delete this.worker,delete this.onReady,delete this.resolveReady,this.log("Disabled."))}enable(){this.shouldDestroy=!1,this.worker||(this.setupWorker(),this.log("Enabled."))}log(e){}async sendAbortById(e){const t=In.toBinary(In.create({requestId:e})),a=Fu(Gu.abortById),i=await this.doApiCall(Gu.abortById,t,a);return En.fromBinary(i)}}class zu{constructor(e,t){this.concurrency=e,this.iterationsTotal=t,this.iterationsDone=Array(this.concurrency).fill(0),this.dpsValues=Array(this.concurrency).fill(0),this.hpsValues=Array(this.concurrency).fill(0),this.finalResults=Array(this.concurrency)}getIterationsDone(){let e=0;for(const t of this.iterationsDone)e+=t;return e}getDpsAvg(){let e=0;for(const t of this.dpsValues)e+=t;return e/this.concurrency}getHpsAvg(){let e=0;for(const t of this.hpsValues)e+=t;return e/this.concurrency}updateProgress(e,t){this.iterationsDone[e]=t.completedIterations,this.dpsValues[e]=t.dps,this.hpsValues[e]=t.hps,t.finalRaidResult&&(this.finalResults[e]=t.finalRaidResult)}makeProgressMetrics(){return vn.create({totalIterations:this.iterationsTotal,completedIterations:this.getIterationsDone(),dps:this.getDpsAvg(),hps:this.getHpsAvg()})}}const ju=(e,t)=>{const a=wn.create();return"string"==typeof e?(console.error(e),a.error=kn.create({message:e})):(e.message&&console.error(e.message),a.error=e),t(vn.create({finalRaidResult:a})),a},Bu=async(e,t,a,i)=>{console.log(`Sending requests split for ${t.getNumWorkers()} splits.`);const s=await t.raidSimRequestSplit(yn.create({splitCount:t.getNumWorkers(),request:e}));if(s.errorResult)return ju(s.errorResult,a);if(i.abort.isTriggered())return ju(kn.create({type:xt.ErrorOutcomeAborted}),a);console.log(`Running ${e.simOptions.iterations} iterations on ${s.splitsDone} concurrent sims...`);const n=await((e,t,a,i,s)=>new Promise(n=>{const o=new zu(e.length,t);let l=0,r=e.length;const c=(e,t)=>{if(r&&(o.updateProgress(e,t),l++,l%r==0&&i(o.makeProgressMetrics()),t.finalRaidResult)){let a;if(r--,t.finalRaidResult.error&&(t.finalRaidResult.error.type==xt.ErrorOutcomeError&&console.error(`Worker ${e} had an error!`),a=t.finalRaidResult,s.abort.trigger()),a||0==r){r=0;const e=o.makeProgressMetrics();return e.finalRaidResult=a,i(e),void n({errorResult:a,results:o.finalResults,progressMetricsFinal:e})}}};for(let t=0;t<e.length;t++)a.raidSimAsync(e[t],e=>c(t,e),s)}))(s.requests,e.simOptions.iterations,t,a,i);if(n.errorResult&&n.errorResult.error)return ju(n.errorResult.error,a);if(i.abort.isTriggered())return ju(kn.create({type:xt.ErrorOutcomeAborted}),a);console.log(`All ${s.splitsDone} sims finished successfully. Combining ${n.results.length} results.`);const o=await t.raidSimResultCombination(Sn.create({results:n.results}));return o.error?ju(o.error,a):(n.progressMetricsFinal.finalRaidResult=o,a(n.progressMetricsFinal),o)},Hu=(e,t)=>{const a=wn.create();return"string"==typeof e?(console.error(e),a.error=kn.create({message:e})):(e.message&&console.error(e.message),a.error=e),t(vn.create({finalWeightResult:a})),a},qu=`${Z}_wasmconcurrency`,Yu=class e{constructor({type:t}={}){this.iterations=12500,this.phase=ce,this.faction=he.Alliance,this.fixedRngSeed=0,this.filters=e.defaultFilters(),this.showDamageMetrics=!0,this.showThreatMetrics=!1,this.showHealingMetrics=!1,this.showExperimental=!1,this.wasmConcurrency=0,this.showQuickSwap=!0,this.showEPValues=!1,this.useCustomEPValues=!1,this.useSoftCapBreakpoints=!0,this.language="",this.db_=null,this.iterationsChangeEmitter=new Se,this.phaseChangeEmitter=new Se,this.factionChangeEmitter=new Se,this.fixedRngSeedChangeEmitter=new Se,this.lastUsedRngSeedChangeEmitter=new Se,this.filtersChangeEmitter=new Se,this.showDamageMetricsChangeEmitter=new Se,this.showThreatMetricsChangeEmitter=new Se,this.showHealingMetricsChangeEmitter=new Se,this.showExperimentalChangeEmitter=new Se,this.wasmConcurrencyChangeEmitter=new Se,this.showQuickSwapChangeEmitter=new Se,this.showEPValuesChangeEmitter=new Se,this.useCustomEPValuesChangeEmitter=new Se,this.useSoftCapBreakpointsChangeEmitter=new Se,this.languageChangeEmitter=new Se,this.crashEmitter=new Se,this.unitMetadataEmitter=new Se("UnitMetadata"),this.simResultEmitter=new Se,this.bulkSimStartEmitter=new Se,this.bulkSimResultEmitter=new Se,this.lastUsedRngSeed=0,this.modifyRaidProto=Le,this.type=t??_n.SimTypeIndividual,this.workerPool=new Wu(1),this.wasmConcurrencyChangeEmitter.on(async()=>{if(await this.workerPool.isWasm()){const e=Math.max(1,Math.min(this.wasmConcurrency,navigator.hardwareConcurrency));this.workerPool.setNumWorkers(e)}});let a=parseInt(window.localStorage.getItem(qu)??"NaN");isNaN(a)&&(a=0,navigator.hardwareConcurrency>1&&(a=Math.min(4,Math.floor(navigator.hardwareConcurrency/2)))),this.setWasmConcurrency(Se.nextEventID(),a),this.signalManager=new xn,this._initPromise=We.get().then(e=>{this.db_=e}),this.raid=new Lu(this),this.encounter=new rp(this),this.settingsChangeEmitter=Se.onAny([this.iterationsChangeEmitter,this.phaseChangeEmitter,this.fixedRngSeedChangeEmitter,this.filtersChangeEmitter,this.showDamageMetricsChangeEmitter,this.showThreatMetricsChangeEmitter,this.showHealingMetricsChangeEmitter,this.showExperimentalChangeEmitter,this.wasmConcurrencyChangeEmitter,this.showQuickSwapChangeEmitter,this.showEPValuesChangeEmitter,this.useCustomEPValuesChangeEmitter,this.useSoftCapBreakpointsChangeEmitter,this.languageChangeEmitter]),this.changeEmitter=Se.onAny([this.settingsChangeEmitter,this.raid.changeEmitter,this.encounter.changeEmitter]),Se.onAny([this.raid.changeEmitter,this.encounter.changeEmitter]).on(e=>this.updateCharacterStats(e)),this.language=me()}waitForInit(){return this._initPromise}isWasm(){return this.workerPool.isWasm()}async shouldUseWasmConcurrency(){return await this.isWasm()&&this.getWasmConcurrency()>=2&&this.workerPool.getNumWorkers()>=2}get db(){return this.db_}setModifyRaidProto(e){this.modifyRaidProto=e}getModifiedRaidProto(){const e=this.raid.toProto(!1,!0);return this.modifyRaidProto(e),e.parties.forEach(e=>{e.players.forEach(e=>{if(!e.equipment)return;let t=this.db.lookupEquipmentSpec(e.equipment),a=!1;const i=[e.profession1,e.profession2].includes(I.Blacksmithing);t.hasInactiveMetaGem(i)&&(t=t.withoutMetaGem(),a=!0),i||(t=t.withoutBlacksmithSockets(),a=!0),a&&(e.equipment=t.asSpec());const s=e.database,n=[],o=[],l=new Set,r=new Set;Object.values(e.consumables??[]).forEach(e=>{if(!e||l.has(e))return;const t=this.db.getConsumable(e);if(t){l.add(t.id),n.push(t);for(const e of t.effectIds){if(r.has(e))continue;const t=this.db.getSpellEffect(e);t&&(r.add(t.id),o.push(t))}}}),s.consumables=n,s.spellEffects=o,e.database=s})}),e}makeRaidSimRequest(e){const t=this.getModifiedRaidProto(),a=this.encounter.toProto();return Gt.create({requestId:Fu(Gu.raidSimAsync),type:this.type,raid:t,encounter:a,simOptions:Tn.create({iterations:e?1:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debugFirstIteration:!0})})}async runBulkSim(e,t,a){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const i=pn.create({baseSettings:this.makeRaidSimRequest(!1),bulkSettings:e});if(null!=i.baseSettings&&null!=i.baseSettings.simOptions&&(i.baseSettings.simOptions.debugFirstIteration=!1),!i.baseSettings?.raid||0==i.baseSettings?.raid?.parties.length||0==i.baseSettings?.raid?.parties[0].players.length)throw new Error("Raid must contain exactly 1 player for bulk sim.");const s=i.baseSettings.raid.parties[0].players[0].database;s.items.push(...t.items),s.enchants.push(...t.enchants),s.gems.push(...t.gems),s.reforgeStats.push(...t.reforgeStats),s.itemEffectRandPropPoints.push(...t.itemEffectRandPropPoints),s.randomSuffixes.push(...t.randomSuffixes),s.consumables.push(...t.consumables),s.spellEffects.push(...t.spellEffects),this.bulkSimStartEmitter.emit(Se.nextEventID(),i);const n=this.signalManager.registerRunning(Pt.BulkSim);try{const e=await this.workerPool.bulkSimAsync(i,a,n);if(e.error){if(e.error.type!=xt.ErrorOutcomeError)return e;throw new $u(e.error.message)}return this.bulkSimResultEmitter.emit(Se.nextEventID(),e),e}catch(o){if(o instanceof $u)throw o;throw console.log(o),new Error("Something went wrong running your raid sim. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(n)}}async calculateBulkCombinations(e,t){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const a=gn.create({baseSettings:this.makeRaidSimRequest(!1),bulkSettings:e});if(null!=a.baseSettings&&null!=a.baseSettings.simOptions&&(a.baseSettings.simOptions.debugFirstIteration=!1),!a.baseSettings?.raid||0==a.baseSettings?.raid?.parties.length||0==a.baseSettings?.raid?.parties[0].players.length)throw new Error("Raid must contain exactly 1 player for bulk sim.");const i=a.baseSettings.raid.parties[0].players[0].database;i.items.push(...t.items),i.enchants.push(...t.enchants),i.gems.push(...t.gems),i.reforgeStats.push(...t.reforgeStats),i.itemEffectRandPropPoints.push(...t.itemEffectRandPropPoints),i.randomSuffixes.push(...t.randomSuffixes),this.bulkSimStartEmitter.emit(Se.nextEventID(),a);try{const e=await this.workerPool.bulkSimCombosAsync(a);if(""!=e.errorResult)throw new $u(e.errorResult);return e}catch(s){if(s instanceof $u)throw s;throw console.log(s),new Error("Something went wrong running your raid sim. Reload the page and try again.")}}async runRaidSim(e,t){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");const a=this.signalManager.registerRunning(Pt.RaidSim);try{await this.waitForInit();const i=this.makeRaidSimRequest(!1);let s;if(s=await this.shouldUseWasmConcurrency()?await Bu(i,this.workerPool,t,a):await this.workerPool.raidSimAsync(i,t,a),s.error){if(s.error.type!=xt.ErrorOutcomeError)return s.error;throw new $u(s.error.message)}const n=await Pn.makeNew(i,s);return this.simResultEmitter.emit(e,n),n}catch(i){if(i instanceof $u)throw i;throw console.error(i),new Error("Something went wrong running your raid sim. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(a)}}async runRaidSimWithLogs(e){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");const t=this.signalManager.registerRunning(Pt.RaidSim);try{await this.waitForInit();const a=this.makeRaidSimRequest(!0),i=await this.workerPool.raidSimAsync(a,Le,t);if(i.error)throw new $u(i.error.message);const s=await Pn.makeNew(a,i);return this.simResultEmitter.emit(e,s),s}catch(a){if(a instanceof $u)throw a;throw console.error(a),new Error("Something went wrong running your raid sim. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(t)}}async updateCharacterStats(e){if(0==e)return;e=Se.nextEventID(),await this.waitForInit();const t=this.raid.getPlayers(),a=rn.create({raid:this.getModifiedRaidProto(),encounter:this.encounter.toProto()}),i=await this.workerPool.computeStats(a);""==i.errorResult?Se.freezeAllAndDo(async()=>{const a=i.raidStats.parties.map((a,i)=>a.players.map((a,s)=>{const n=t[5*i+s];return n?(n.setCurrentStats(e,a),n.updateMetadata()):null})).flat().filter(e=>null!=e),s=this.encounter.targetsMetadata.update(i.encounterStats.targets.map(e=>e.metadata));(await Promise.all(a.concat([s]))).some(e=>e)&&this.unitMetadataEmitter.emit(e)}):this.crashEmitter.emit(e,new $u(i.errorResult))}async statWeights(e,t,a,i,s){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");if(await this.waitForInit(),null==e.getParty())return console.warn("Trying to get stat weights without a party!"),qs.create();{const o=this.raid.getTanks().map(e=>e.index).includes(e.getRaidIndex())?[F.create({type:W.Player,index:0})]:[],l=hn.create({player:e.toProto(!1,!0),raidBuffs:this.raid.getBuffs(),partyBuffs:e.getParty().getBuffs(),debuffs:this.raid.getDebuffs(),encounter:this.encounter.toProto(),simOptions:Tn.create({iterations:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debug:!1}),tanks:o,statsToWeigh:t,pseudoStatsToWeigh:a,epReferenceStat:i}),r=this.signalManager.registerRunning(Pt.StatWeights);try{let e;if(e=await this.shouldUseWasmConcurrency()?await(async(e,t,a,i)=>{console.log("Getting stat weight sim requests.");const s=Fu(Gu.statWeightsAsync),n=await t.statWeightRequests(e);if(n.baseRequest.requestId=s,i.abort.isTriggered())return Hu(kn.create({type:xt.ErrorOutcomeAborted}),a);let o=n.baseRequest.simOptions.iterations,l=0,r=1,c=0;for(const g of n.statSimRequests)g.requestLow.requestId=s,g.requestHigh.requestId=s,o+=g.requestLow.simOptions.iterations+g.requestHigh.simOptions.iterations,r+=2;console.log(`Need to run a total of ${r} sims and ${o} iterations.`);let h=0;const m=e=>{l+=e.completedIterations-h,h=e.completedIterations,a(vn.create({totalIterations:o,completedIterations:l,totalSims:r,completedSims:c})),e.finalRaidResult&&c++},d=await Bu(n.baseRequest,t,m,i);if(d.error)return Hu(d.error,a);const p=dn.create({baseResult:d,epReferenceStat:n.epReferenceStat,statSimResults:[]});for(const g of n.statSimRequests){if(i.abort.isTriggered())return Hu(kn.create({type:xt.ErrorOutcomeAborted}),a);h=0;const e=await Bu(g.requestLow,t,m,i);if(e.error)return Hu(e.error,a);h=0;const s=await Bu(g.requestHigh,t,m,i);if(s.error)return Hu(s.error,a);p.statSimResults.push(Cn.create({statData:g.statData,resultLow:e,resultHigh:s}))}console.log(`All ${r} sims finished successfully. Computing weights.`);const u=await t.statWeightCompute(p);return u.error?Hu(u.error,a):(a(vn.create({finalWeightResult:u})),u)})(l,this.workerPool,s,r):await this.workerPool.statWeightsAsync(l,s,r),e.error){if(e.error.type!=xt.ErrorOutcomeError)return e;throw new $u(e.error.message)}return e}catch(n){if(n instanceof $u)throw n;throw console.error(n),new Error("Something went wrong calculating your stat weights. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(r)}}}getUnitMetadata(e,t,a){if(!e||e.type==W.Unknown)return this.getUnitMetadata(a,t,a);if(e.type==W.Player)return this.raid.getPlayerFromUnitReference(e)?.getMetadata();if(e.type==W.Target)return this.encounter.targetsMetadata.asList()[e.index];if(e.type==W.Pet){const a=this.raid.getPlayerFromUnitReference(e.owner,t);return a?a.getPetMetadatas().asList()[e.index]:void 0}return e.type==W.Self?t?.getMetadata():e.type==W.CurrentTarget?this.encounter.targetsMetadata.asList()[0]:void 0}getPhase(){return this.phase}setPhase(e,t){t!=this.phase&&(this.phase=t,this.phaseChangeEmitter.emit(e))}getFaction(){return this.faction}setFaction(e,t){t!=this.faction&&t&&(this.faction=t,this.factionChangeEmitter.emit(e))}getFixedRngSeed(){return this.fixedRngSeed}setFixedRngSeed(e,t){t!=this.fixedRngSeed&&(this.fixedRngSeed=t,this.fixedRngSeedChangeEmitter.emit(e))}nextRngSeed(){let t=0;return t=this.fixedRngSeed?this.fixedRngSeed:Math.floor(Math.random()*e.MAX_RNG_SEED),this.lastUsedRngSeed=t,this.lastUsedRngSeedChangeEmitter.emit(Se.nextEventID()),t}getLastUsedRngSeed(){return this.lastUsedRngSeed}getFilters(){return Rn.clone(this.filters)}setFilters(e,t){Rn.equals(t,this.filters)||(this.filters=Rn.clone(t),this.filtersChangeEmitter.emit(e))}getShowDamageMetrics(){return this.showDamageMetrics}setShowDamageMetrics(e,t){t!=this.showDamageMetrics&&(this.showDamageMetrics=t,this.showDamageMetricsChangeEmitter.emit(e))}getShowThreatMetrics(){return this.showThreatMetrics}setShowThreatMetrics(e,t){t!=this.showThreatMetrics&&(this.showThreatMetrics=t,this.showThreatMetricsChangeEmitter.emit(e))}getShowHealingMetrics(){return this.showHealingMetrics||this.showThreatMetrics&&[p.SpecBloodDeathKnight,p.SpecGuardianDruid,p.SpecBrewmasterMonk,p.SpecProtectionPaladin].includes(this.raid.getPlayer(0)?.playerSpec.specID)}setShowHealingMetrics(e,t){t!=this.showHealingMetrics&&(this.showHealingMetrics=t,this.showHealingMetricsChangeEmitter.emit(e))}getShowExperimental(){return this.showExperimental}setShowExperimental(e,t){t!=this.showExperimental&&(this.showExperimental=t,this.showExperimentalChangeEmitter.emit(e))}getWasmConcurrency(){return this.wasmConcurrency}setWasmConcurrency(e,t){t!=this.wasmConcurrency&&(this.wasmConcurrency=t,window.localStorage.setItem(qu,t.toString()),this.wasmConcurrencyChangeEmitter.emit(e))}getShowQuickSwap(){return!de()&&this.showQuickSwap}setShowQuickSwap(e,t){t!=this.showQuickSwap&&(this.showQuickSwap=t,this.showQuickSwapChangeEmitter.emit(e))}getShowEPValues(){return this.showEPValues}setShowEPValues(e,t){t!=this.showEPValues&&(this.showEPValues=t,this.showEPValuesChangeEmitter.emit(e))}getUseCustomEPValues(){return this.useCustomEPValues}setUseCustomEPValues(e,t){t!==this.useCustomEPValues&&(this.useCustomEPValues=t,this.useCustomEPValuesChangeEmitter.emit(e))}getUseSoftCapBreakpoints(){return this.useSoftCapBreakpoints}setUseSoftCapBreakpoints(e,t){t!==this.useSoftCapBreakpoints&&(this.useSoftCapBreakpoints=t,this.useSoftCapBreakpointsChangeEmitter.emit(e))}getLanguage(){return this.language}setLanguage(e,t){(t=t||"en")!=this.language&&(this.language=t,this.languageChangeEmitter.emit(e))}getIterations(){return this.iterations}setIterations(e,t){t!=this.iterations&&(this.iterations=t,this.iterationsChangeEmitter.emit(e))}toProto(){const t=this.getFilters();return t.armorTypes.length==e.ALL_ARMOR_TYPES.length&&(t.armorTypes=[]),t.weaponTypes.length==e.ALL_WEAPON_TYPES.length&&(t.weaponTypes=[]),t.rangedWeaponTypes.length==e.ALL_RANGED_WEAPON_TYPES.length&&(t.rangedWeaponTypes=[]),t.sources.length==e.ALL_SOURCES.length&&(t.sources=[]),t.raids.length==e.ALL_RAIDS.length&&(t.raids=[]),Gn.create({iterations:this.getIterations(),phase:this.getPhase(),fixedRngSeed:BigInt(this.getFixedRngSeed()),showDamageMetrics:this.getShowDamageMetrics(),showThreatMetrics:this.getShowThreatMetrics(),showHealingMetrics:this.getShowHealingMetrics(),showExperimental:this.getShowExperimental(),showQuickSwap:this.getShowQuickSwap(),showEpValues:this.getShowEPValues(),useCustomEpValues:this.getUseCustomEPValues(),useSoftCapBreakpoints:this.getUseSoftCapBreakpoints(),language:this.getLanguage(),faction:this.getFaction(),filters:t})}fromProto(t,a){Se.freezeAllAndDo(()=>{this.setIterations(t,a.iterations||12500),this.setPhase(t,a.phase||ce),this.setFixedRngSeed(t,Number(a.fixedRngSeed)),this.setShowDamageMetrics(t,a.showDamageMetrics),this.setShowThreatMetrics(t,a.showThreatMetrics),this.setShowHealingMetrics(t,a.showHealingMetrics),this.setShowExperimental(t,a.showExperimental),this.setShowQuickSwap(t,a.showQuickSwap),this.setShowEPValues(t,a.showEpValues),this.setUseCustomEPValues(t,a.useCustomEpValues),this.setUseSoftCapBreakpoints(t,a.useSoftCapBreakpoints),this.setLanguage(t,a.language),this.setFaction(t,a.faction||he.Alliance);const i=a.filters||e.defaultFilters();0==i.armorTypes.length&&(this.type==_n.SimTypeIndividual?i.armorTypes=[this.raid.getActivePlayers()[0].getPlayerClass().armorTypes[0]]:i.armorTypes=e.ALL_ARMOR_TYPES.slice()),0==i.weaponTypes.length&&(i.weaponTypes=e.ALL_WEAPON_TYPES.slice()),0==i.rangedWeaponTypes.length&&(i.rangedWeaponTypes=e.ALL_RANGED_WEAPON_TYPES.slice()),0==i.sources.length&&(i.sources=e.ALL_SOURCES.slice()),0==i.raids.length&&(i.raids=e.ALL_RAIDS.slice()),this.setFilters(t,i)})}applyDefaults(t,a,i){this.fromProto(t,Gn.create({iterations:12500,phase:ce,faction:he.Alliance,showDamageMetrics:!i,showThreatMetrics:a,showHealingMetrics:i,showQuickSwap:!0,language:this.getLanguage(),filters:e.defaultFilters(),showEpValues:!1,useSoftCapBreakpoints:!0}))}static defaultFilters(){return Rn.create({oneHandedWeapons:!0,twoHandedWeapons:!0})}};Yu.MAX_RNG_SEED=Math.pow(2,32)-1,Yu.ALL_ARMOR_TYPES=Ve(pe).filter(e=>0!=e),Yu.ALL_WEAPON_TYPES=Ve(h).filter(e=>0!=e),Yu.ALL_RANGED_WEAPON_TYPES=Ve(d).filter(e=>0!=e),Yu.ALL_SOURCES=Ve(Dn).filter(e=>0!=e),Yu.ALL_RAIDS=Ve(Nn).filter(e=>0!=e);let Ku=Yu;class $u extends Error{constructor(e){super(e),this.errorStr=e}}const Ju=[];class Zu extends we{constructor(t,a,i){super(t,"sim-ui"),this.sim=a,this.config=i,this.disabled=i.simStatus.status===ie.Unlaunched,this.isWithinRaidSim=null!=this.rootElem.closest(".within-raid-sim");const n=e(l,null,e("div",{className:"sim-root"},e("div",{className:"sim-bg"}),i.noticeText?e("div",{className:"notices-banner alert border-bottom mb-0 text-center within-raid-sim-hide"},i.noticeText):null,e("div",{className:"sim-container"},e("aside",{className:"sim-sidebar"},e("div",{className:"sim-title"}),e("div",{className:"sim-sidebar-content"},e("div",{className:"sim-sidebar-actions within-raid-sim-hide"}),e("div",{className:"sim-sidebar-results within-raid-sim-hide"}),e("div",{className:"sim-sidebar-stats"}),e("div",{className:"sim-sidebar-socials"}))),e("div",{className:"sim-content container-fluid"}))),e("div",{className:"sim-toast-container p-3 bottom-0 right-0",id:"toastContainer"}));this.rootElem.appendChild(n),this.simContentContainer=this.rootElem.querySelector(".sim-content"),this.simHeader=new Du(this.simContentContainer,this),this.simMain=document.createElement("main"),this.simMain.classList.add("sim-main","tab-content"),this.simContentContainer.appendChild(this.simMain),this.rootElem.classList.add(this.config.cssClass),this.isWithinRaidSim||this.rootElem.classList.add("not-within-raid-sim"),this.changeEmitter=Se.onAny([this.sim.changeEmitter],"SimUIChange"),this.sim.crashEmitter.on((e,t)=>this.handleCrash(t));const o=()=>{this.sim.getShowDamageMetrics()?this.rootElem.classList.remove("hide-damage-metrics"):this.rootElem.classList.add("hide-damage-metrics")};o(),this.sim.showDamageMetricsChangeEmitter.on(o);const r=()=>{this.sim.getShowThreatMetrics()?this.rootElem.classList.remove("hide-threat-metrics"):this.rootElem.classList.add("hide-threat-metrics")};r(),this.sim.showThreatMetricsChangeEmitter.on(r);const c=()=>{this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-healing-metrics"):this.rootElem.classList.add("hide-healing-metrics")};c(),this.sim.showHealingMetricsChangeEmitter.on(c);const h=()=>{this.sim.getShowThreatMetrics()||this.sim.getShowDamageMetrics()&&this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-ep-ratios"):this.rootElem.classList.add("hide-ep-ratios")};h(),this.sim.showDamageMetricsChangeEmitter.on(h),this.sim.showHealingMetricsChangeEmitter.on(h),this.sim.showThreatMetricsChangeEmitter.on(h);const m=()=>{this.sim.getShowExperimental()?this.rootElem.classList.remove("hide-experimental"):this.rootElem.classList.add("hide-experimental")};m(),this.sim.showExperimentalChangeEmitter.on(m),this.addKnownIssues(i);const d=this.rootElem.querySelector(".sim-title");new Nu(d,i.spec,{noDropdown:this.isWithinRaidSim}),this.simActionsContainer=this.rootElem.querySelector(".sim-sidebar-actions"),this.addNoticeForLocalSim(),this.iterationsPicker=new Co(this.simActionsContainer,this.sim,{id:"simui-iterations",label:s.t("sidebar.iterations"),extraCssClasses:["iterations-picker","within-raid-sim-hide"],changedEvent:e=>e.iterationsChangeEmitter,getValue:e=>e.getIterations(),setValue:(e,t,a)=>{t.setIterations(e,a)}}).rootElem;const p=this.rootElem.querySelector(".sim-sidebar-results");this.resultsViewer=new Ro(p);const u=this.rootElem.querySelector(".sim-sidebar-socials");u.appendChild(Ru.buildDiscordLink()),u.appendChild(Ru.buildGitHubLink()),u.appendChild(Ru.buildPatreonLink()),this.simTabContentsContainer=this.rootElem.querySelector(".sim-main.tab-content"),this.isWithinRaidSim||window.addEventListener("message",async e=>{"runOnce"==e.data&&this.runSimOnce()}),this.disabled&&p.appendChild(e("div",{className:"sim-ui-unlaunched-container d-flex flex-column align-items-center text-center mt-auto mb-auto ms-auto me-auto"},e("i",{className:"fas fa-ban fa-3x mb-2"}),e("h6",null,"This sim is currently not supported."),e("p",null,"Want to contribute?",e("br",null),"Make sure to join our ",e("a",{href:"https://discord.gg/p3DgvmnDCS",target:"_blank"},"Discord"),"!"),this.config.spec?.isHealingSpec&&e("p",null,"Looking for healing simulations?",e("br",null),"Check out ",e("a",{href:"https://questionablyepic.com/live/"},"QE Live"),"!")))}addNoticeForLocalSim(){new Tu(this.simActionsContainer)}addAction(t,a,i){return this.simActionsContainer.appendChild(e("button",{className:_e("sim-sidebar-action-button btn btn-primary w-100",a),onclick:i,disabled:this.disabled},t,e("span",{className:"sim-sidebar-action-button-loading-icon"},e("i",{className:"fas fa-spinner fa-spin"}))))}addActionGroup(a,i={}){const s=[],n=t(),{cssClass:o}=i;return this.simActionsContainer.appendChild(e("div",{ref:n,className:_e("d-flex btn-group w-100",o),attributes:{role:"group"}},a.map(({label:t,cssClass:a,children:i,onClick:n})=>e("button",{ref:e=>s.push(e),onclick:n,className:_e("sim-sidebar-action-button btn btn-primary",a)},t,i,e("span",{className:"sim-sidebar-action-button-loading-icon"},e("i",{className:"fas fa-spinner fa-spin"})))))),{group:n.value,children:s}}addTab(t,a,i){const s=a.replace(/\s+/g,"-")+"-tab",n=0==this.simTabContentsContainer.children.length;this.simHeader.addTab(t,s),this.simTabContentsContainer.appendChild(e("div",{id:s,className:_e("tab-pane fade",n&&"active show")},i))}addSimTab(e){this.simHeader.addSimTabLink(e)}addWarning(e){this.resultsViewer.addWarning(e)}addKnownIssues(e){let t="";switch(e.simStatus.status){case ie.Unlaunched:t="This sim is a WORK IN PROGRESS. It is not fully developed and should not be used for general purposes.";break;case ie.Alpha:t="This sim is in ALPHA. Bugs are expected; please let us know if you find one!";break;case ie.Beta:t="This sim is in BETA. There may still be a few bugs; please let us know if you find one!"}t&&(e.knownIssues=[t].concat(e.knownIssues||[])),e.knownIssues?.forEach(e=>this.simHeader.addKnownIssue(e)),Ju?.forEach(e=>this.simHeader.addKnownIssue(e))}getSettingsStorageKey(){return this.getStorageKey("__currentSettings__")}getSavedEncounterStorageKey(){return"sharedData__savedEncounter__"}isIndividualSim(){return this.rootElem.classList.contains("individual-sim-ui")}async runSim(e){this.resultsViewer.setPending();try{await this.sim.signalManager.abortType(Pt.All);const t=await this.sim.runRaidSim(Se.nextEventID(),e);t instanceof Pn||t.type!=xt.ErrorOutcomeAborted||new No({variant:"info",body:"Raid sim cancelled."})}catch(t){this.resultsViewer.hideAll(),this.handleCrash(t)}}async runSimOnce(){this.resultsViewer.setPending();try{await this.sim.runRaidSimWithLogs(Se.nextEventID())}catch(e){this.resultsViewer.hideAll(),this.handleCrash(e)}}async handleCrash(e){if(!(e instanceof $u))return void(e.message?new No({variant:"error",body:e.message}):alert(e));new No({variant:"error",body:"The Simulation failed. Generated an error report."});const t=e.errorStr;if(t.startsWith("[USER_ERROR] ")){let e=t.substring(13);return e=await xe.replaceAllInString(e),void alert(e)}if(window.confirm("Simulation Failure:\n"+t+"\nPress Ok to file crash report")){const e=this.hashCode(t),a=this.toLink(),i=this.sim.getLastUsedRngSeed();fetch("https://api.github.com/search/issues?q=is:issue+is:open+repo:wowsims/mop+"+e).then(s=>{s.json().then(s=>{if(s.total_count>0)window.open(s.items[0].html_url,"_blank");else{const s=new URL(ue);s.searchParams.append("title",`Crash Report ${e}`),s.searchParams.append("assignees",""),s.searchParams.append("labels","");const n=2048-s.toString().length;let o=`Link:\n${a}\n\nRNG Seed: ${i}\n\n${t}`;a.includes("/raid/")&&(o=`${t}\nRNG Seed: ${i}\nLink:\n${a}`);let l=!1;for(;o.length>n-(l?3:0);)o=o.slice(0,o.lastIndexOf("%")),l=!0;l&&(o+="...",new Qu(this.rootElem,a).open()),s.searchParams.append("body",o),window.open(s.toString(),"_blank")}})}).catch(e=>{alert("Failed to file report... try again another time:"+e)})}}hashCode(e){let t=0;for(let a=0,i=e.length;a<i;a++){t=(t<<5)-t+e.charCodeAt(a),t|=0}return t}}class Qu extends Io{constructor(t,a){super(t,"crash",{title:"Extra Crash Information"}),this.body.appendChild(e("div",{className:"sim-crash-report"},e("h3",{className:"sim-crash-report-header"},"Please append the following complete link to the issue you just created. This will simplify debugging the issue."),e("textarea",{className:"sim-crash-report-text form-control"},a)))}}function Xu(e,t){return function(e,t){gg[e]=t}(e,t),t}const eg=[];class tg extends Zu{constructor(e,t,a){super(e,t.sim,{cssClass:a.cssClass,cssScheme:a.cssScheme,spec:t.getPlayerSpec(),knownIssues:a.knownIssues,simStatus:oe[t.getSpec()]}),this.epWeightsModal=null,this.bt=null,this.rootElem.classList.add("individual-sim-ui"),this.player=t,this.individualConfig=this.applyDefaultConfigOptions(a),this.raidSimResultsManager=null,this.prevEpIterations=0,this.prevEpSimResult=null,this.statWeightActionSettings=new Eu(this),(a.itemSwapSlots||[]).length>0&&!eg.includes(t.getSpec())&&eg.push(t.getSpec()),this.addWarning({updateOn:this.player.gearChangeEmitter,getContent:()=>{if(!this.player.getGear().hasInactiveMetaGem(this.player.isBlacksmithing()))return"";const e=this.player.getGear().getMetaGem();return`Meta gem disabled (${e.name}): ${Un(e)}`}}),this.addWarning({updateOn:Se.onAny([this.player.gearChangeEmitter,this.player.professionChangeEmitter]),getContent:()=>{const e=this.player.getGear().getFailedProfessionRequirements(this.player.getProfessions());return 0==e.length?"":e.map(e=>`${e.name} requires ${Us.get(e.requiredProfession)}, but it is not selected.`)}}),this.addWarning({updateOn:this.player.gearChangeEmitter,getContent:()=>{const e=this.player.getGear().getJCGems(this.player.isBlacksmithing());return e.length<=2?"":`Only 2 Jewelcrafting Gems are allowed, but ${e.length} are equipped.`}}),this.addWarning({updateOn:this.player.talentsChangeEmitter,getContent:()=>{const e=On(this.player.getTalentsString()),t=xu(this.player.getSpecConfig());if(0==e&&0==t.length)return"";if(function(e,t){const a=xu(e),i=t.split("").map(Number);return a.every(e=>i[e]>0)}(this.player.getSpecConfig(),this.player.getTalentsString()))return"";{const e=function(e,t){const a=xu(e),i=t.split("").map(Number);return a.filter(e=>0===i[e])}(this.player.getSpecConfig(),this.player.getTalentsString());return`Missing required talent selections in row ${e.map(e=>e+1).join(", ")}.`}}}),this.addWarning({updateOn:this.player.gearChangeEmitter,getContent:()=>this.player.armorSpecializationArmorType&&this.player.hasArmorSpecializationBonus()?`Equip ${An.get(this.player.armorSpecializationArmorType)} gear in each slot for the Armor Specialization (5% primary stat) effect.`:""}),this.addWarning({updateOn:Se.onAny([this.player.gearChangeEmitter,this.player.talentsChangeEmitter]),getContent:()=>this.player.canDualWield2H()||(this.player.getEquippedItem(r.ItemSlotMainHand)?.item.handType!=m.HandTypeTwoHand||null==this.player.getEquippedItem(r.ItemSlotOffHand))&&this.player.getEquippedItem(r.ItemSlotOffHand)?.item.handType!=m.HandTypeTwoHand?"":"Dual wielding two-handed weapon(s) without Titan's Grip spec."}),(a.warnings||[]).forEach(e=>this.addWarning(e(this))),this.isWithinRaidSim||this.sim.waitForInit().then(()=>{Ho.registerSetBonusNotices(this.sim.db),this.loadSettings(),this.player.getPlayerSpec().isHealingSpec&&alert(Ln)}),this.addSidebarComponents(),this.addGearTab(),this.addSettingsTab(),this.addTalentsTab(),this.addRotationTab(),this.isWithinRaidSim||this.addDetailedResultsTab(),this.sim.waitForInit().then(()=>{this.addTopbarComponents()})}applyDefaultConfigOptions(e){return e.otherInputs.inputs=[mu,...e.otherInputs.inputs],e}loadSettings(){const e=Se.nextEventID();Se.freezeAllAndDo(()=>{this.applyDefaults(e);const t=window.localStorage.getItem(this.getSettingsStorageKey());if(null!=t)try{const a=ft.fromJsonString(t,{ignoreUnknownFields:!0});this.fromProto(e,a)}catch(a){console.warn("Failed to parse saved settings: "+a)}try{const t=gm.tryParseUrlLocation(window.location);t&&this.fromProto(e,t.settings,t.categories)}catch(a){console.warn("Failed to parse link settings: "+a)}window.location.hash="",this.player.setName(e,"Player"),this.changeEmitter.on(e=>{const t=ft.toJsonString(this.toProto());window.localStorage.setItem(this.getSettingsStorageKey(),t)}),this.statWeightActionSettings.load(e)})}addSidebarComponents(){this.raidSimResultsManager=Vn(this),this.sim.waitForInit().then(()=>{this.epWeightsModal=((e,t)=>{const a=new _u(e,t);return e.addAction(s.t("sidebar.buttons.stat_weights"),"ep-weights-action",()=>{a.open()}),a})(this,this.statWeightActionSettings)}),new _o(this.rootElem.querySelector(".sim-sidebar-stats"),this,this.player,this.individualConfig.displayStats,this.individualConfig.modifyDisplayStats,this.individualConfig.overwriteDisplayStats)}addGearTab(){new qm(this.simTabContentsContainer,this).rootElem.classList.add("active","show")}addBulkTab(){const e=new Im(this.simTabContentsContainer,this);return e.navLink.hidden=!this.sim.getShowExperimental(),this.sim.showExperimentalChangeEmitter.on(()=>{e.navLink.hidden=!this.sim.getShowExperimental()}),e}addSettingsTab(){new ou(this.simTabContentsContainer,this)}addTalentsTab(){new cu(this.simTabContentsContainer,this)}addRotationTab(){new lp(this.simTabContentsContainer,this)}addDetailedResultsTab(){const t=e("div",{className:"detailed-results"});this.addTab(s.t("results.title"),"detailed-results-tab",t),new Fn(t,this,this.raidSimResultsManager)}addTopbarComponents(){this.simHeader.addImportLink("JSON",new Ql(this.rootElem,this),!0),this.simHeader.addImportLink("WoWHead",new vm(this.rootElem,this),!1,!1),this.simHeader.addImportLink("Addon",new Jl(this.rootElem,this),!0),this.simHeader.addExportLink("Link",new Pm(this.rootElem,this),!1),this.simHeader.addExportLink("JSON",new Tm(this.rootElem,this),!0),this.simHeader.addExportLink("WoWHead",new Lm(this.rootElem,this),!1,!1),this.simHeader.addExportLink("Pawn EP",new Dm(this.rootElem,this),!1),this.simHeader.addExportLink("CLI",new xm(this.rootElem,this),!0)}applyDefaultRotation(e){Se.freezeAllAndDo(()=>{const t=this.individualConfig.defaults.rotationType||Wt.TypeAuto;if(this.player.setAplRotation(e,Ft.create({type:t})),!this.individualConfig.defaults.simpleRotation)return;const a=this.individualConfig.defaults.simpleRotation||this.player.specTypeFunctions.rotationCreate();this.player.setSimpleRotation(e,a),this.player.setSimpleCooldowns(e,ge.create({hpPercentForDefensives:this.player.playerSpec.isTankSpec?.4:0}))})}applyEmptyAplRotation(e){Se.freezeAllAndDo(()=>{this.player.setAplRotation(e,Ft.create({type:Wt.TypeAPL}))})}applyDefaults(e){Se.freezeAllAndDo(()=>{const t=this.player.getPlayerSpec().isTankSpec,a=this.player.getPlayerSpec().isHealingSpec;this.player.applySharedDefaults(e),this.player.setRace(e,this.individualConfig.defaults.other?.race||this.player.getPlayerClass().races[0]),this.player.setGear(e,this.sim.db.lookupEquipmentSpec(this.individualConfig.defaults.gear)),this.player.setConsumes(e,this.individualConfig.defaults.consumables),this.applyDefaultRotation(e),this.player.setTalentsString(e,this.individualConfig.defaults.talents.talentsString),this.player.setGlyphs(e,this.individualConfig.defaults.talents.glyphs||E.create()),this.player.setSpecOptions(e,this.individualConfig.defaults.specOptions),this.player.setBuffs(e,this.individualConfig.defaults.individualBuffs),this.player.getParty().setBuffs(e,this.individualConfig.defaults.partyBuffs),this.player.getRaid().setBuffs(e,this.individualConfig.defaults.raidBuffs),this.player.setEpWeights(e,this.individualConfig.defaults.epWeights),this.individualConfig.defaults.itemSwap&&this.player.itemSwapSettings.setItemSwapSettings(e,!0,this.sim.db.lookupItemSwap(this.individualConfig.defaults.itemSwap||N.create()));const i=this.player.getDefaultEpRatios(t,a);this.player.setEpRatios(e,i),this.individualConfig.defaults.statCaps&&this.player.setStatCaps(e,this.individualConfig.defaults.statCaps),this.individualConfig.defaults.softCapBreakpoints&&this.player.setSoftCapBreakpoints(e,this.individualConfig.defaults.softCapBreakpoints),this.player.setBreakpointLimits(e,this.individualConfig.defaults.breakpointLimits||new ke),this.player.setProfession1(e,this.individualConfig.defaults.other?.profession1||I.Engineering),void 0===this.individualConfig.defaults.other?.profession2?this.player.setProfession2(e,I.Jewelcrafting):this.player.setProfession2(e,this.individualConfig.defaults.other.profession2),this.player.setDistanceFromTarget(e,this.individualConfig.defaults.other?.distanceFromTarget||0),this.player.setChannelClipDelay(e,this.individualConfig.defaults.other?.channelClipDelay||0),this.player.setReactionTime(e,this.individualConfig.defaults.other?.reactionTime||100),this.isWithinRaidSim?this.sim.raid.setTargetDummies(e,0):(this.sim.raid.setTargetDummies(e,a?9:0),this.sim.encounter.applyDefaults(e),this.sim.encounter.setExecuteProportion90(e,this.individualConfig.defaults.other?.highHpThreshold||.9),this.sim.raid.setDebuffs(e,this.individualConfig.defaults.debuffs),this.sim.applyDefaults(e,t,a),this.individualConfig.defaults.other?.iterationCount&&this.sim.setIterations(e,this.individualConfig.defaults.other.iterationCount),t?this.sim.raid.setTanks(e,[this.player.makeUnitReference()]):this.sim.raid.setTanks(e,[]),this.statWeightActionSettings.applyDefaults(e)),this.individualConfig.defaultBuild&&Bm.applyBuild(e,this.individualConfig.defaultBuild,this)})}getSavedGearStorageKey(){return this.getStorageKey("__savedGear__")}getSavedEPWeightsStorageKey(){return this.getStorageKey("__savedEPWeights__")}getSavedRotationStorageKey(){return this.getStorageKey("__savedRotation__")}getSavedSettingsStorageKey(){return this.getStorageKey("__savedSettings__")}getSavedTalentsStorageKey(){return this.getStorageKey("__savedTalents__")}getStorageKey(e){return ze.getLocalStorageKey(this.player.getPlayerSpec())+e}toProto(e){const t=t=>!e||0==e.length||e.includes(t),a=ft.create({player:this.player.toProto(!0,!1,e)});return t(hl.Miscellaneous)&&ft.mergePartial(a,{tanks:this.sim.raid.getTanks()}),t(hl.Encounter)&&ft.mergePartial(a,{encounter:this.sim.encounter.toProto()}),t(hl.External)&&ft.mergePartial(a,{partyBuffs:this.player.getParty()?.getBuffs()||J.create(),raidBuffs:this.sim.raid.getBuffs(),debuffs:this.sim.raid.getDebuffs(),targetDummies:this.sim.raid.getTargetDummies()}),t(hl.UISettings)&&ft.mergePartial(a,{settings:this.sim.toProto(),epWeightsStats:this.player.getEpWeights().toProto(),epRatios:this.player.getEpRatios(),statCaps:this.player.getStatCaps().toProto(),breakpointLimits:this.player.getBreakpointLimits().toProto(),dpsRefStat:this.dpsRefStat,healRefStat:this.healRefStat,tankRefStat:this.tankRefStat}),a}toLink(){return Pm.createLink(this)}fromProto(e,t,a){const i=e=>!a||0==a.length||a.includes(e),s=this.player.getPlayerSpec().isTankSpec,n=this.player.getPlayerSpec().isHealingSpec;Se.freezeAllAndDo(()=>{if(t.player){if(this.player.fromProto(e,t.player,a),i(hl.Miscellaneous)&&this.sim.raid.setTanks(e,t.tanks||[]),i(hl.External)){this.sim.raid.setBuffs(e,t.raidBuffs||U.create()),this.sim.raid.setDebuffs(e,t.debuffs||A.create());const a=this.player.getParty();a&&a.setBuffs(e,t.partyBuffs||J.create()),this.sim.raid.setTargetDummies(e,t.targetDummies)}if(i(hl.Encounter)&&this.sim.encounter.fromProto(e,t.encounter||R.create()),i(hl.UISettings)){t.epWeightsStats?this.player.setEpWeights(e,ke.fromProto(t.epWeightsStats)):this.player.setEpWeights(e,this.individualConfig.defaults.epWeights);const a=this.player.getDefaultEpRatios(s,n);if(t.epRatios){const i=new Array(a.length-t.epRatios.length).fill(0);this.player.setEpRatios(e,t.epRatios.concat(i))}else this.player.setEpRatios(e,a);t.statCaps&&this.player.setStatCaps(e,ke.fromProto(t.statCaps)),t.breakpointLimits&&this.player.setBreakpointLimits(e,ke.fromProto(t.breakpointLimits)),t.dpsRefStat&&(this.dpsRefStat=t.dpsRefStat),t.healRefStat&&(this.healRefStat=t.healRefStat),t.tankRefStat&&(this.tankRefStat=t.tankRefStat),t.settings?this.sim.fromProto(e,t.settings):this.sim.applyDefaults(e,s,n)}}})}hasCapForPseudoStat(e){const t=this.individualConfig.defaults.statCaps||new ke,a=this.player.getStatCaps(),i=this.individualConfig.defaults.softCapBreakpoints||[];return Wn(e,a.add(t),i)}hasDisplayPseudoStat(e){for(const t of this.individualConfig.displayStats)if(t.equalsPseudoStat(e))return!0;return!1}}const ag={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};function ig(e,t){return window.getComputedStyle(t)[e]}class sg{constructor(e,t){this.last_cluster=0,this.scroll_debounce=0,this.pointer_events_set=!1,this.resize_debounce=0,this.cache={},this.options={rows_in_block:void 0!==t.rows_in_block?t.rows_in_block:ag.rows_in_block,blocks_in_cluster:void 0!==t.blocks_in_cluster?t.blocks_in_cluster:ag.blocks_in_cluster,show_no_data_row:void 0!==t.show_no_data_row?t.show_no_data_row:ag.show_no_data_row,no_data_class:void 0!==t.no_data_class?t.no_data_class:ag.no_data_class,no_data_text:void 0!==t.no_data_text?t.no_data_text:ag.no_data_text,keep_parity:void 0!==t.keep_parity?t.keep_parity:ag.keep_parity,tag:void 0!==t.tag?t.tag:ag.tag,callbacks:void 0!==t.callbacks?t.callbacks:ag.callbacks,cluster_height:0,item_height:void 0!==t.item_height?t.item_height:0,content_tag:"",block_height:0,scroll_top:0,rows_in_cluster:0},this.ds=e,this.displayedRows=t.rows,this.scroll_elem=t.scroll_elem,this.content_elem=t.content_elem,this.content_elem.hasAttribute("tabindex")||this.content_elem.setAttribute("tabindex","0");const a=this.scroll_elem.scrollTop;this.getRowsHeight(t.rows),this.insertToDom(t.rows,this.cache),this.scroll_elem.scrollTop=a,this.scroll_elem.addEventListener("scroll",this.scrollEv.bind(this)),window.addEventListener("resize",this.resizeEv.bind(this))}destroy(e){this.scroll_elem.removeEventListener("scroll",this.scrollEv.bind(this)),window.removeEventListener("resize",this.resizeEv.bind(this)),e&&this.setContentElemRows(this.generateEmptyRow())}dispose(){this.destroy()}refresh(e){(this.getRowsHeight(this.displayedRows)||e)&&this.update()}update(){const e=this.scroll_elem.scrollTop;this.ds.getNumberOfRows()*this.options.item_height<e&&(this.scroll_elem.scrollTop=0,this.last_cluster=0),this.insertToDom(this.displayedRows,this.cache),this.scroll_elem.scrollTop=e}elementUpdate(e){for(const t of this.displayedRows)e(t)}getScrollProgress(){return this.options.scroll_top/(this.ds.getNumberOfRows()*this.options.item_height)*100||0}scrollEv(){navigator.platform.toLowerCase().indexOf("mac")+1&&(this.pointer_events_set||(this.content_elem.style.pointerEvents="none"),this.pointer_events_set=!0,clearTimeout(this.scroll_debounce),this.scroll_debounce=window.setTimeout(()=>{this.content_elem.style.pointerEvents="auto",this.pointer_events_set=!1},50)),this.last_cluster!=(this.last_cluster=this.getClusterNum(this.ds.getNumberOfRows()))&&this.insertToDom(this.displayedRows,this.cache),this.options.callbacks.scrollingProgress&&this.options.callbacks.scrollingProgress(this.getScrollProgress())}resizeEv(){clearTimeout(this.resize_debounce),this.resize_debounce=window.setTimeout(this.refresh.bind(this),100)}insertToDom(e,t){this.options.cluster_height||this.exploreEnvironment(e,t);const a=this.generate(),i=a.rows;this.displayedRows=a.rows;const s=this.checkChanges("data",i,t),n=this.checkChanges("top",a.top_offset,t),o=this.checkChanges("bottom",a.bottom_offset,t),l=this.options.callbacks,r=[];if(s||n){if(a.top_offset){if(this.options.keep_parity){const e=this.renderExtraTag("keep-parity");e.hidden=!0,r.push(e)}r.push(this.renderExtraTag("top-space",a.top_offset))}r.push(...i),a.bottom_offset&&r.push(this.renderExtraTag("bottom-space",a.bottom_offset)),l.clusterWillChange&&l.clusterWillChange(),this.setContentElemRows(r),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",a.rows_above.toString()),this.content_elem.style.counterIncrement="clusterize-counter "+(a.rows_above-1),l.clusterChanged&&l.clusterChanged()}else o&&(this.content_elem.lastChild.style.height=a.bottom_offset+"px")}exploreEnvironment(e,t){const a=this.options;a.content_tag=this.content_elem.tagName.toLowerCase(),e.length&&(this.content_elem.children.length<=1&&this.setContentElemRows([e[0],e[0],e[0]]),a.tag||(a.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(e))}setContentElemRows(e){this.content_elem.innerHTML="",this.content_elem.append(...e)}getRowsHeight(e){const t=this.options,a=t.item_height;t.cluster_height=0;const i=this.content_elem.children;if(e.length&&i.length){const e=i[Math.floor(i.length/2)];if(t.item_height=e.offsetHeight,"tr"==t.tag&&"collapse"!=ig("borderCollapse",this.content_elem)&&(t.item_height+=parseInt(ig("borderSpacing",this.content_elem),10)||0),"tr"!=t.tag){const a=parseInt(ig("marginTop",e),10)||0,i=parseInt(ig("marginBottom",e),10)||0;t.item_height+=Math.max(a,i)}}return t.block_height=t.item_height*t.rows_in_block,t.rows_in_cluster=t.blocks_in_cluster*t.rows_in_block,t.cluster_height=t.blocks_in_cluster*t.block_height,a!=t.item_height}generate(){const e=this.options,t=this.ds.getNumberOfRows();if(t<e.rows_in_block){const e=this.ds.generateRows(0,t);return{top_offset:0,bottom_offset:0,rows_above:0,rows:t?e:this.generateEmptyRow()}}let a=Math.max((e.rows_in_cluster-e.rows_in_block)*this.getClusterNum(t),0),i=a+e.rows_in_cluster,s=Math.max(a*e.item_height,0),n=Math.max((t-i)*e.item_height,0),o=[],l=a;return s<1&&l++,o=this.ds.generateRows(a,i),{top_offset:s,bottom_offset:n,rows_above:l,rows:o}}generateEmptyRow(){const e=this.options;if(!e.tag||!e.show_no_data_row)return[];const t=document.createElement(e.tag);let a,i=document.createTextNode(e.no_data_text);return t.className=e.no_data_class,"tr"==e.tag&&(a=document.createElement("td"),a.colSpan=100,a.appendChild(i)),t.appendChild(a||i),[t]}getClusterNum(e){const t=this.options;t.scroll_top=this.scroll_elem.scrollTop;const a=Math.max(t.cluster_height-t.block_height,1),i=Math.floor(t.scroll_top/a),s=Math.floor(e*t.item_height/a);return Math.min(i,s)}renderExtraTag(e,t){const a=document.createElement(this.options.tag),i="clusterize-";return a.className=[i+"extra-row",i+e].join(" "),a.style.marginTop="0",a.style.marginBottom="0",t&&(a.style.height=t+"px"),a}checkChanges(e,t,a){const i=t!=a[e];return a[e]=t,i}}const ng={[Oe.UNSPECIFIED]:"None",[Oe.ALLIANCE_ONLY]:"Alliance only",[Oe.HORDE_ONLY]:"Horde only"};class og extends Io{constructor(t,a,i){super(t,"filters-menu",{size:"md",title:"Filters",disposeOnClose:!1});const s=this.newSection("General"),n=e("div",{className:"ilvl-filters"});s.appendChild(n),new Co(n,a.sim,{id:"filters-min-ilvl",label:"Min ILvl",showZeroes:!1,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minIlvl,setValue:(e,t,a)=>{const i=t.getFilters();i.minIlvl=a,t.setFilters(e,i)}}),n.appendChild(e("span",{className:"ilvl-filters-separator"},"-")),new Co(n,a.sim,{id:"filters-max-ilvl",label:"Max ILvl",showZeroes:!1,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxIlvl,setValue:(e,t,a)=>{const i=t.getFilters();i.maxIlvl=a,t.setFilters(e,i)}}),new vd(s,a.sim,{id:"filters-faction-restriction",label:"Faction Restrictions",values:[Oe.UNSPECIFIED,Oe.ALLIANCE_ONLY,Oe.HORDE_ONLY].map(e=>({name:ng[e],value:e})),changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().factionRestriction,setValue:(e,t,a)=>{const i=t.getFilters();i.factionRestriction=a,t.setFilters(e,i)}});const o=this.newSection("Source");o.classList.add("filters-menu-section-bool-list"),Ku.ALL_SOURCES.forEach(e=>{new Rt(o,a.sim,{id:`filters-source-${e}`,label:Mn.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().sources.includes(e),setValue:(t,a,i)=>{const s=a.getFilters();i?s.sources.push(e):s.sources=s.sources.filter(t=>t!=e),a.setFilters(t,s)}})});const l=this.newSection("Raids");if(l.classList.add("filters-menu-section-bool-list"),Ku.ALL_RAIDS.forEach(e=>{new Rt(l,a.sim,{id:`filters-raid-${e}`,label:zn.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().raids.includes(e),setValue:(t,a,i)=>{const s=a.getFilters();i?s.raids.push(e):s.raids=s.raids.filter(t=>t!=e),a.setFilters(t,s)}})}),yg.ARMOR_SLOTS.includes(i)){const e=a.getPlayerClass().armorTypes;if(e.length>1){const t=this.newSection("Armor Type");t.classList.add("filters-menu-section-bool-list"),e.forEach(e=>{new Rt(t,a.sim,{id:`filters-armor-type-${e}`,label:An.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().armorTypes.includes(e),setValue:(t,a,i)=>{const s=a.getFilters();i?s.armorTypes.push(e):s.armorTypes=s.armorTypes.filter(t=>t!=e),a.setFilters(t,s)}})})}}else if(yg.WEAPON_SLOTS.includes(i)){if(a.getPlayerClass().weaponTypes.length>0){const e=this.newSection("Weapon Type");e.classList.add("filters-menu-section-bool-list");a.getPlayerClass().weaponTypes.map(e=>e.weaponType).forEach(t=>{new Rt(e,a.sim,{id:`filters-weapon-type-${t}`,label:jn.get(t),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().weaponTypes.includes(t),setValue:(e,a,i)=>{const s=a.getFilters();i?s.weaponTypes.push(t):s.weaponTypes=s.weaponTypes.filter(e=>e!=t),a.setFilters(e,s)}})});const t=this.newSection("Weapon Speed");t.classList.add("filters-menu-section-number-list"),new Co(t,a.sim,{id:"filters-min-weapon-speed",label:"Min MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minMhWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.minMhWeaponSpeed=a,t.setFilters(e,i)}}),new Co(t,a.sim,{id:"filters-max-weapon-speed",label:"Max MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxMhWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.maxMhWeaponSpeed=a,t.setFilters(e,i)}}),a.getPlayerSpec().canDualWield&&(new Co(t,a.sim,{id:"filters-min-oh-weapon-speed",label:"Min OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minOhWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.minOhWeaponSpeed=a,t.setFilters(e,i)}}),new Co(t,a.sim,{id:"filters-max-oh-weapon-speed",label:"Max OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxOhWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.maxOhWeaponSpeed=a,t.setFilters(e,i)}}))}const e=a.getPlayerClass().rangedWeaponTypes;if(e.length<1)return;const t=this.newSection("Ranged Weapon Type");t.classList.add("filters-menu-section-bool-list"),e.forEach(e=>{new Rt(t,a.sim,{id:`filter-ranged-weapon-type-${e}`,label:Bn.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().rangedWeaponTypes.includes(e),setValue:(t,a,i)=>{const s=a.getFilters();i?s.rangedWeaponTypes.push(e):s.rangedWeaponTypes=s.rangedWeaponTypes.filter(t=>t!=e),a.setFilters(t,s)}})});const i=this.newSection("Ranged Weapon Speed");i.classList.add("filters-menu-section-number-list"),new Co(i,a.sim,{id:"filters-min-ranged-weapon-speed",label:"Min Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minRangedWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.minRangedWeaponSpeed=a,t.setFilters(e,i)}}),new Co(i,a.sim,{id:"filters-max-ranged-weapon-speed",label:"Max Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxRangedWeaponSpeed,setValue:(e,t,a)=>{const i=t.getFilters();i.maxRangedWeaponSpeed=a,t.setFilters(e,i)}})}}newSection(e){const t=document.createElement("div");return t.classList.add("menu-section",`${e.toLowerCase().replaceAll(" ","-")}-section`),this.body.appendChild(t),t.innerHTML=`\n\t\t\t<div class="menu-section-header">\n\t\t\t\t<h6 class="menu-section-title">${e}</h6>\n\t\t\t</div>\n\t\t\t<div class="menu-section-content"></div>\n\t\t`,t.getElementsByClassName("menu-section-content")[0]}}class lg{constructor(a,i,s,n,o,l,c,h,m,d,p,g,f,w){this.sortBy=1,this.sortDirection=fe.DESC,this.id=a,this.label=c,this.simUI=s,this.player=l,this.itemData=m,this.socketColor=d,this.computeEP=p,this.equippedToItemFn=g,this.onItemClick=w,this.slot=n,this.gearData=h,this.currentFilters=this.player.sim.getFilters();const y=c===o,b=t(),S=t(),I=t(),E=t(),k=t(),C=t(),_=t(),x=t(),T=t(),P=t(),R=t(),D=![r.ItemSlotTrinket1,r.ItemSlotTrinket2].includes(n);if(this.tabContent=e("div",{id:this.id,className:"selector-modal-tab-pane tab-pane fade "+(y?"active show":"")},e("div",{className:"selector-modal-filters"},e("input",{ref:b,className:"selector-modal-search form-control",type:"text",placeholder:"Search..."}),c===rg.Items&&e("button",{ref:I,className:"selector-modal-filters-button btn btn-primary"},"Filters"),e("div",{ref:k,className:"selector-modal-phase-selector"}),e("div",{ref:_,className:"sim-input selector-modal-boolean-option selector-modal-show-1h-weapons hide"}),e("div",{ref:x,className:"sim-input selector-modal-boolean-option selector-modal-show-2h-weapons hide"}),e("div",{ref:C,className:"sim-input selector-modal-boolean-option selector-modal-show-matching-gems"}),D&&e("div",{ref:E,className:"sim-input selector-modal-boolean-option selector-modal-show-ep-values"}),e("button",{ref:P,className:"selector-modal-remove-button btn btn-danger"},"Unequip Item")),e("div",{className:"selector-modal-list-labels"},(c===rg.Items||c===rg.Upgrades)&&e("h6",{className:"ilvl-label interactive",onclick:e=>{e.preventDefault(),this.sort(1)}},"ILvl"),e("h6",{className:"item-label"},c===rg.Items?"Item":c===rg.Enchants?"Enchant":[rg.Gem1,rg.Gem2,rg.Gem3].includes(c)?"Gem":c===rg.Reforging?"Reforge":c===rg.Upgrades?"Upgrade":c===rg.Tinkers?"Tinker":""),c===rg.Items&&e("h6",{className:"source-label"},"Source"),e("h6",{className:"ep-label interactive",onclick:e=>{e.preventDefault(),this.sort(0)}},e("span",null,"EP"),e("i",{className:"fa-solid fa-plus-minus fa-2xs"}),e("button",{ref:S,className:"btn btn-link p-0 ms-1"},e("i",{className:"far fa-question-circle fa-lg"}))),e("h6",{className:"favorite-label"}),e("h6",{ref:R,className:"compare-label hide"})),e("ul",{ref:T,className:"selector-modal-list"})),i.appendChild(this.tabContent),this.label===rg.Items&&this.bindToggleCompare(R.value),c===rg.Items&&l.getPlayerClass().weaponTypes.length>0&&(n===r.ItemSlotMainHand||n===r.ItemSlotOffHand&&l.getClass()===v.ClassWarrior)&&(_.value&&function(e,t){e.classList.remove("hide"),new Rt(e,t,{id:"show-1h-weapons-selector",extraCssClasses:["show-1h-weapons-selector","mb-0"],label:"1H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().oneHandedWeapons,setValue:(e,t,a)=>{const i=t.getFilters();i.oneHandedWeapons=a,t.setFilters(e,i)}})}(_.value,l.sim),x.value&&function(e,t){e.classList.remove("hide"),new Rt(e,t,{id:"show-2h-weapons-selector",extraCssClasses:["show-2h-weapons-selector","mb-0"],label:"2H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().twoHandedWeapons,setValue:(e,t,a)=>{const i=t.getFilters();i.twoHandedWeapons=a,t.setFilters(e,i)}})}(x.value,l.sim)),D&&(E.value&&function(e,t){new Rt(e,t,{id:"show-ep-values-selector",extraCssClasses:["show-ep-values-selector","input-inline","mb-0"],label:"Show EP",inline:!0,changedEvent:e=>e.showEPValuesChangeEmitter,getValue:e=>e.getShowEPValues(),setValue:(e,t,a)=>{t.setShowEPValues(e,a)}})}(E.value,l.sim),u(S.value,{content:Hn})),C.value&&(!function(e,t){new Rt(e,t,{id:"show-matching-gems-selector",extraCssClasses:["show-matching-gems-selector","input-inline","mb-0"],label:"Match Socket",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().matchingGemsOnly,setValue:(e,t,a)=>{const i=t.getFilters();i.matchingGemsOnly=a,t.setFilters(e,i)}})}(C.value,l.sim),c.startsWith("Gem")||C.value?.classList.add("hide")),k.value&&function(e,t){new vd(e,t,{id:"phase-selector",extraCssClasses:["phase-selector"],values:[{name:"Phase 1 (5.0 - T14)",value:1},{name:"Phase 2 (5.1)",value:2},{name:"Phase 3 (5.2 - T15)",value:3},{name:"Phase 4 (5.3)",value:4},{name:"Phase 5 (5.4 - T16)",value:5}],changedEvent:e=>e.phaseChangeEmitter,getValue:e=>e.getPhase(),setValue:(e,t,a)=>{t.setPhase(e,a)}})}(k.value,l.sim),c===rg.Items){const e=new og(i,l,n);I.value?.addEventListener("click",()=>e.open())}this.listElem=T.value,this.itemsToDisplay=[],this.scroller=new sg({getNumberOfRows:()=>this.itemsToDisplay.length,generateRows:(e,t)=>{const a=[];for(let i=e;i<t&&!(i>=this.itemsToDisplay.length);++i)a.push(this.createItemElem({idx:this.itemsToDisplay[i],data:this.itemData[this.itemsToDisplay[i]]}));return a}},{rows:[],scroll_elem:this.listElem,content_elem:this.listElem,item_height:56,show_no_data_row:!1,no_data_text:"",tag:"li",rows_in_block:16,blocks_in_cluster:2});const N=P.value;if(N)switch(N.addEventListener("click",e=>{f(Se.nextEventID())}),c){case rg.Enchants:N.textContent="Remove Enchant";break;case rg.Tinkers:N.textContent="Remove Tinkers";break;case rg.Reforging:N.textContent="Remove Reforge";break;case rg.RandomSuffixes:N.textContent="Remove Random Suffix";break;case rg.Upgrades:N.textContent="Remove Upgrade";break;case rg.Gem1:case rg.Gem2:case rg.Gem3:N.textContent="Remove Gem"}this.updateSelected(),this.searchInput=b.value,this.searchInput.addEventListener("input",()=>this.applyFilters())}sizeRefresh(){this.scroller.refresh(!0),this.applyFilters()}dispose(){this.scroller.dispose()}getItemIdByItemType(e){switch(this.label){case rg.Enchants:case rg.Tinkers:return e?.effectId;case rg.Reforging:return e?.reforge.id;case rg.Items:case rg.Gem1:case rg.Gem2:case rg.Gem3:case rg.RandomSuffixes:return e?.id;case rg.Upgrades:return e;default:return null}}updateSelected(){const e=this.gearData.getEquippedItem(),t=this.equippedToItemFn(e),a=this.getItemIdByItemType(t),i=null!=t?this.computeEP(t):0;this.scroller.elementUpdate(e=>{const t=e.dataset.idx,s=this.itemData[parseFloat(t)];s.id===a?e.classList.add("active"):e.classList.remove("active");const n=e.querySelector(".selector-modal-list-item-ep-delta");if(n&&(n.textContent="",null!==s.item)){const e=this.computeEP(s.item);i!==e&&Ae(n,i,e,0)}})}applyFilters(){this.currentFilters=this.player.sim.getFilters();let e=new Array(this.itemData.length);for(let a=0;a<this.itemData.length;++a)e[a]=a;const t=this.player.getEquippedItem(this.slot);this.label===rg.Items?e=this.player.filterItemData(e,e=>this.itemData[e].item,this.slot):this.label===rg.Enchants||this.label===rg.Tinkers?e=this.player.filterEnchantData(e,e=>this.itemData[e].item,this.slot,t):this.label!==rg.Gem1&&this.label!==rg.Gem2&&this.label!==rg.Gem3||(e=this.player.filterGemData(e,e=>this.itemData[e].item,this.slot,this.socketColor)),e=e.filter(e=>{const t=this.itemData[e];if(t.phase>this.player.sim.getPhase())return!1;if(this.searchInput.value.length){const e=e=>e.toLowerCase().replaceAll(/[^a-zA-Z0-9\s]/g,""),a=e(this.searchInput.value).split(" "),i=e(t.name.toString());let s=!0;if(a.some(e=>{i.includes(e)||(s=!1)}),!s)return!1}return!0}),[r.ItemSlotTrinket1,r.ItemSlotTrinket2].includes(this.slot)?this.sortBy=1:this.sortBy=0,e=this.sortIdxs(e),this.itemsToDisplay=e,this.scroller.update(),this.hideOrShowEPValues()}sort(e){this.sortBy===e?this.sortDirection=1-this.sortDirection:this.sortDirection=fe.DESC,this.sortBy=e,this.itemsToDisplay=this.sortIdxs(this.itemsToDisplay),this.scroller.update()}sortIdxs(e){let t=(e,t)=>{const a=this.sortDirection===fe.DESC?t:e,i=this.sortDirection===fe.DESC?e:t,s=this.computeEP(a)-this.computeEP(i);return Math.abs(s)<.01?(a.scalingOptions?.[y.Base].ilvl||a.ilvl)-(i.scalingOptions?.[y.Base].ilvl||i.ilvl):s};if(1===this.sortBy)t=(e,t)=>{const a=this.sortDirection===fe.DESC?t:e,i=this.sortDirection===fe.DESC?e:t;return(a.scalingOptions?.[y.Base].ilvl||a.ilvl)-(i.scalingOptions?.[y.Base].ilvl||i.ilvl)};return e.sort((e,a)=>{const i=this.itemData[e],s=this.itemData[a];return this.isItemFavorited(i)&&!this.isItemFavorited(s)?-1:this.isItemFavorited(s)&&!this.isItemFavorited(i)?1:t(i.item,s.item)})}hideOrShowEPValues(){const e=this.tabContent.querySelectorAll(".ep-label"),t=this.tabContent.querySelectorAll(".selector-modal-list"),a=this.player.sim.getShowEPValues(),i=a?"":"none";for(const s of e)s.style.display=i;for(const s of t)a?s.classList.remove("hide-ep"):s.classList.add("hide-ep")}createItemElem(a){const i=a.data,s=this.computeEP(i.item),n=this.equippedToItemFn(this.gearData.getEquippedItem()),o=null!=n,c=this.getItemIdByItemType(n),h=o?this.computeEP(n):0,m=t(),d=t(),p=t(),g=t(),f=t(),w=t(),y=t(),S=t(),v=e("li",{className:"selector-modal-list-item "+(c===i.id?"active":""),dataset:{idx:a.idx.toString()}},(this.label===rg.Items||this.label===rg.Upgrades)&&e("div",{className:"selector-modal-list-item-ilvl-container"},i.ilvl||i.item.ilvl),e("div",{className:"selector-modal-list-label-cell gap-1",ref:m},e("a",{className:"selector-modal-list-item-link",ref:p,dataset:{whtticon:"false"}},e("img",{className:"selector-modal-list-item-icon",ref:g}),e("label",{className:"selector-modal-list-item-name",ref:d},"string"==typeof i.name?i.name:i.name.cloneNode(!0),i.nameDescription&&Jo(i.nameDescription)))),this.label===rg.Items&&e("div",{className:"selector-modal-list-item-source-container"},this.getSourceInfo(i.item,this.player.sim)),![r.ItemSlotTrinket1,r.ItemSlotTrinket2].includes(this.slot)&&e("div",{className:"selector-modal-list-item-ep"},e("span",{className:"selector-modal-list-item-ep-value"},s<9.95?s.toFixed(1).toString():Math.round(s).toString()),e("span",{className:"selector-modal-list-item-ep-delta",ref:e=>o&&h!==s&&Ae(e,h,s,0)})),e("div",{className:"selector-modal-list-item-favorite-container"},e("button",{className:"selector-modal-list-item-favorite btn btn-link p-0",ref:f},e("i",{ref:w,className:"far fa-star fa-xl"}))),e("div",{ref:y,className:"selector-modal-list-item-compare-container hide"},e("button",{className:"selector-modal-list-item-compare btn btn-link p-0",ref:S},e("i",{className:"fas fa-arrow-right-arrow-left fa-xl"})))),I=e=>{const t=this.player.sim.getFilters();let a,s;switch(this.label){case rg.Items:a="favoriteItems",s=i.id;break;case rg.Enchants:case rg.Tinkers:a="favoriteEnchants",s=Bo(i.item);break;case rg.Gem1:case rg.Gem2:case rg.Gem3:a="favoriteGems",s=i.id;break;case rg.RandomSuffixes:a="favoriteRandomSuffixes",s=i.id;break;case rg.Reforging:a="favoriteReforges",s=i.id;break;default:return}if(e)t[a].push(s);else{const e=t[a].indexOf(s);-1!==e&&t[a].splice(e,1)}f.value.classList.toggle("text-brand"),w.value.classList.toggle("fas"),w.value.classList.toggle("far"),v.dataset.fav=e.toString(),this.player.sim.setFilters(Se.nextEventID(),t)};f.value.addEventListener("click",()=>I("false"===v.dataset.fav));this.isItemFavorited(i)?(f.value.classList.add("text-brand"),w.value?.classList.add("fas"),v.dataset.fav="true"):(w.value?.classList.add("far"),v.dataset.fav="false");const E=u(f.value);var k;if(k="true"===v.dataset.fav,E.setContent(k?"Remove from favorites":"Add to favorites"),this.label===rg.Items){const t=u(S.value);this.bindToggleCompare(y.value);const a=this.simUI instanceof tg?this.simUI:null;if(a){const s=()=>a.bt?.hasItem(b.create({id:i.id})),n=()=>{const e=s();t.setContent(e?"Remove from Batch Sim":"Add to Batch Sim"),S.value.classList[e?"add":"remove"]("text-brand")};n(),a.bt?.itemsChangedEmitter.on(()=>{n()}),S.value.addEventListener("click",()=>{const t=s();a.bt?.[t?"removeItem":"addItem"](b.create({id:i.id})),new No({delay:1e3,variant:"success",body:e(l,null,e("strong",null,i.name)," was ",e(l,null,t?"removed from the batch":"added to the batch"),".")})})}}p.value.addEventListener("click",e=>{if(e.preventDefault(),e.target===f.value)return!1;this.onItemClick(i)}),i.actionId.fill().then(e=>{e.setWowheadHref(p.value),g.value.src=e.iconUrl}),ko(d.value,i.quality);const C=new Ho(this.player,{itemId:i.id});return C.hasNotice&&m.value?.appendChild(C.rootElem),v}isItemFavorited(e){return this.label===rg.Items?this.currentFilters.favoriteItems.includes(e.id):this.label===rg.Enchants||this.label===rg.Tinkers?this.currentFilters.favoriteEnchants.includes(Bo(e.item)):this.label.startsWith("Gem")?this.currentFilters.favoriteGems.includes(e.id):this.label===rg.RandomSuffixes?this.currentFilters.favoriteRandomSuffixes.includes(e.id):this.label===rg.Reforging&&this.currentFilters.favoriteReforges.includes(e.id)}getSourceInfo(t,a){const i=(t,a)=>e("a",{href:t,target:"_blank",dataset:{whtticon:"false"}},e("small",null,a));if(!t.sources?.length){if(t.randomSuffixOptions.length)return i(`${xe.makeItemUrl(t.id)}#dropped-by`,"World Drop");if(qn(t)){const a=Yn(t);return a?i(xe.makeItemUrl(t.id),e("span",null,a,e("br",null),"PVP")):e(l,null)}return e(l,null)}let s=t.sources[0];if("crafted"===s.source.oneofKind){const e=s.source.crafted;return e.spellId?i(xe.makeSpellUrl(e.spellId),Us.get(e.profession)??"Unknown"):i(xe.makeItemUrl(t.id),Us.get(e.profession)??"Unknown")}if("drop"===s.source.oneofKind){const n=s.source.drop,o=a.db.getZone(n.zoneId),r=a.db.getNpc(n.npcId);if(!o)return console.error("No zone found for item:",t),e(l,null);const c=n.category?` - ${n.category}`:"";return r?i(xe.makeNpcUrl(r.id),e("span",null,o.name," (",Kn.get(n.difficulty)??"Unknown",")",e("br",null),r.name+c)):n.otherName?i(xe.makeZoneUrl(o.id),e("span",null,o.name,e("br",null),n.otherName)):i(xe.makeZoneUrl(o.id),o.name)}if("quest"===s.source.oneofKind&&s.source.quest.name){const a=s.source.quest;return i(xe.makeQuestUrl(a.id),e("span",null,"Quest",t.factionRestriction===Oe.ALLIANCE_ONLY&&e("img",{src:"/mop/assets/img/alliance.png",className:"ms-1",width:"15",height:"15"}),t.factionRestriction===Oe.HORDE_ONLY&&e("img",{src:"/mop/assets/img/horde.png",className:"ms-1",width:"15",height:"15"}),e("br",null),a.name))}if("rep"===(s=t.sources.find(e=>"rep"===e.source.oneofKind)??s).source.oneofKind){const a=t.sources.filter(e=>"rep"===e.source.oneofKind).map(e=>"rep"===e.source.oneofKind?$n[e.source.rep.repFactionId]:$n[Jn.RepFactionUnknown]),n=s.source.rep,o=Zn[n.repFactionId];return i(xe.makeNpcUrl(o),e(l,null,a.map(a=>e("span",null,a,t.factionRestriction===Oe.ALLIANCE_ONLY&&e("img",{src:"/mop/assets/img/alliance.png",className:"ms-1",width:"15",height:"15"}),t.factionRestriction===Oe.HORDE_ONLY&&e("img",{src:"/mop/assets/img/horde.png",className:"ms-1",width:"15",height:"15"}),e("br",null))),e("span",null,Qn[n.repLevel])))}if(qn(t)){const a=Yn(t);return a?i(xe.makeItemUrl(t.id),e("span",null,a,e("br",null),"PVP")):e(l,null)}if("soldBy"===s.source.oneofKind){const t=s.source.soldBy;return i(xe.makeNpcUrl(t.npcId),e("span",null,"Sold by",e("br",null),t.npcName))}return e(l,null)}bindToggleCompare(e){}}var rg=(e=>(e.Items="Items",e.RandomSuffixes="Random Suffix",e.Enchants="Enchants",e.Tinkers="Tinkers",e.Reforging="Reforging",e.Upgrades="Upgrades",e.Gem1="Gem1",e.Gem2="Gem2",e.Gem3="Gem3",e))(rg||{});class cg extends Io{constructor(t,a,i,s,n){super(t,"selector-modal",{disposeOnClose:!1,size:"xl"}),this.ilists=[],this.itemSlotTabElems=[],this.currentSlot=r.ItemSlotHead,this.currentTab="Items",this.disabledTabs=[],this.simUI=a,this.player=i,this.gearPicker=s,this.options={id:Bt(),...n},this.disabledTabs=this.options.disabledTabs||[],this.addItemSlotTabs(),this.header.insertAdjacentElement("afterbegin",e("div",null,e("h6",{className:"selector-modal-title"}),e("ul",{className:"nav nav-tabs selector-modal-tabs"}))),this.body.appendChild(e("div",{className:"tab-content selector-modal-tab-content"})),this.titleElem=this.rootElem.querySelector(".selector-modal-title"),this.tabsElem=this.rootElem.querySelector(".selector-modal-tabs"),this.contentElem=this.rootElem.querySelector(".selector-modal-tab-content"),this.body.appendChild(e("div",{className:"d-flex align-items-center form-text"},e("i",{className:"fas fa-circle-exclamation fa-xl me-2"}),e("span",null,"If gear is missing, check the selected phase and your gear filters.",e("br",null),"If the problem persists, save any un-saved data, click the",e("i",{className:"fas fa-cog mx-1"}),'to open your sim options, then click the "Restore Defaults".')))}openTab(e,t,a){this.titleElem.textContent=De.get(e)??"",this.setData(e,t,a),this.setActiveItemSlotTab(e),this.open()}onShow(){if(this.gearPicker){const e=this.switchToPreviousItemSlotTab.bind(this),t=this.switchToNextItemSlotTab.bind(this);document.addEventListener("keydown",e),document.addEventListener("keydown",t),this.addOnHideCallback(()=>document.removeEventListener("keydown",e)),this.addOnHideCallback(()=>document.removeEventListener("keydown",t))}}setData(e,t,a){this.tabsElem.innerText="",this.contentElem.innerText="",this.ilists=[];const i=a.getEquippedItem(),s=this.player.getItems(e),n=this.player.getEnchants(e),o=this.player.getTinkers(e),l=!!i?.item&&!!this.player.getAvailableReforgings(i).length,r=!(this.player.getChallengeModeEnabled()||!i?.item)&&i.hasUpgradeOptions();("Enchants"===t&&!n.length||"Reforging"===t&&!l||"Upgrades"===t&&!r||["Gem1","Gem2","Gem3"].includes(t)&&0===i?.numSockets(this.player.isBlacksmithing()))&&(t="Items"),this.currentTab=t,this.currentSlot=e;!this.disabledTabs?.includes("Items")&&this.addTab({id:Bs(`${this.options.id}-Items`),label:"Items",gearData:a,itemData:s.map(e=>{const t=new Xn({item:e,challengeMode:this.player.getChallengeModeEnabled()});return{item:e,id:e.id,actionId:t.asActionId(),ilvl:e.scalingOptions?.[y.Base].ilvl||e.ilvl,name:e.name,quality:e.quality,nameDescription:e.nameDescription,phase:e.phase,ignoreEPFilter:!1,onEquip:(e,t)=>{const i=a.getEquippedItem();i?a.equipItem(e,i.withItem(t)):a.equipItem(e,new Xn({item:t,challengeMode:this.player.getChallengeModeEnabled()}))}}}),computeEP:t=>this.player.computeItemEP(t,e),equippedToItemFn:e=>e?.item,onRemove:e=>{a.equipItem(e,null),this.removeTabs("Enchants"),this.removeTabs("Random Suffix"),this.removeTabs("Reforging"),this.removeTabs("Upgrades"),this.removeTabs("Gem")}});!this.disabledTabs?.includes("Enchants")&&this.addTab({id:Bs(`${this.options.id}-Enchants`),label:"Enchants",gearData:a,itemData:n.sort((e,t)=>e.effectId>t.effectId?-1:e.effectId<t.effectId?1:0).map(e=>({item:e,id:e.effectId,actionId:e.itemId?xe.fromItemId(e.itemId):xe.fromSpellId(e.spellId),name:e.name,quality:e.quality,phase:e.phase||1,ignoreEPFilter:!0,nameDescription:"",onEquip:(e,t)=>{const i=a.getEquippedItem();i&&a.equipItem(e,i.withEnchant(t))}})),computeEP:e=>this.player.computeEnchantEP(e),equippedToItemFn:e=>e?.enchant,onRemove:e=>{const t=a.getEquippedItem();t&&a.equipItem(e,t.withEnchant(null))}});!this.disabledTabs?.includes("Tinkers")&&this.player.hasProfession(I.Engineering)&&this.addTab({id:Bs(`${this.options.id}-Tinkers`),label:"Tinkers",gearData:a,itemData:o.sort((e,t)=>e.effectId>t.effectId?-1:e.effectId<t.effectId?1:0).map(e=>({item:e,id:e.effectId,actionId:e.itemId?xe.fromItemId(e.itemId):xe.fromSpellId(e.spellId),name:e.name,quality:e.quality,phase:e.phase||1,ignoreEPFilter:!0,nameDescription:"",onEquip:(e,t)=>{const i=a.getEquippedItem();i&&a.equipItem(e,i.withTinker(t))}})),computeEP:e=>this.player.computeEnchantEP(e),equippedToItemFn:e=>e?.tinker,onRemove:e=>{const t=a.getEquippedItem();t&&a.equipItem(e,t.withTinker(null))}});!this.disabledTabs?.includes("Random Suffix")&&this.addRandomSuffixTab(i,a);!(this.player.getChallengeModeEnabled()||this.disabledTabs?.includes("Upgrades"))&&this.addUpgradesTab(i,a);!this.disabledTabs?.includes("Reforging")&&this.addReforgingTab(i,a);!["Gem1","Gem2","Gem3"].some(e=>this.disabledTabs?.includes(e))&&this.addGemTabs(e,i,a),this.ilists.find(e=>t===e.label)?.sizeRefresh()}addItemSlotTabs(){this.gearPicker&&this.dialog.prepend(e("div",{className:"gear-picker-modal-slots"},this.gearPicker.itemPickers.map(a=>{const i=t(),s=e("div",{className:"item-picker-icon-wrapper",dataset:{slot:a.slot}},e("a",{ref:i,className:"item-picker-icon",href:"javascript:void(0)",onclick:e=>{e.preventDefault(),a.slot!=this.currentSlot&&a.openSelectorModal(this.currentTab)},dataset:{whtticon:"false"}})),n=()=>{a.item?(this.player.setWowheadData(a.item,i.value),a.item.asActionId().fill().then(e=>{e.setBackgroundAndHref(i.value)})):i.value.style.backgroundImage=`url('${$o(a.slot)}')`};return n(),a.onUpdate(()=>n()),u(i.value,{content:`Edit ${De.get(a.slot)}`,placement:"left"}),this.itemSlotTabElems.push(s),s})))}setActiveItemSlotTab(e){this.itemSlotTabElems.forEach(t=>{t.dataset.slot===e.toString()?t.classList.add("active"):t.classList.contains("active")&&t.classList.remove("active")})}switchToPreviousItemSlotTab(e){if("ArrowUp"===e.key&&this.gearPicker){e.preventDefault();const t=eo(this.currentSlot-1,Object.keys(r).length/2);this.gearPicker.itemPickers[t].openSelectorModal(this.currentTab)}}switchToNextItemSlotTab(e){if("ArrowDown"===e.key&&this.gearPicker){e.preventDefault();const t=eo(this.currentSlot+1,Object.keys(r).length/2);this.gearPicker.itemPickers[t].openSelectorModal(this.currentTab)}}addGemTabs(e,t,a){if(!t)return;const i=this.player.computeStatsEP(new ke(t.item.socketBonus))/(t.item.gemSockets.length||1);t.curSocketColors(this.player.isBlacksmithing()).forEach((e,t)=>{const s=rg[`Gem${t+1}`];this.addTab({id:Bs(`${this.options.id}-${s}`),label:s,gearData:a,itemData:this.player.getGems(e).map(e=>({item:e,id:e.id,actionId:xe.fromItemId(e.id),name:e.name,quality:e.quality,phase:e.phase,nameDescription:"",ignoreEPFilter:!0,onEquip:(e,i)=>{const s=a.getEquippedItem();s&&a.equipItem(e,s.withGem(i,t))}})),computeEP:t=>{let a=this.player.computeGemEP(t);return to(t,e)&&(a+=i),a},equippedToItemFn:e=>e?.gems[t],onRemove:e=>{const i=a.getEquippedItem();i&&a.equipItem(e,i.withGem(null,t))},setTabContent:i=>{const s=Zo(e,null,t);i.appendChild(s),i.classList.add("selector-modal-tab-gem");const n=i.querySelector(".gem-icon"),o=Re(e),l=()=>{const e=a.getEquippedItem(),i=e?.gems[t];i?(n.classList.remove("hide"),xe.fromItemId(i.id).fill().then(e=>{n.setAttribute("src",e.iconUrl)})):(n.classList.add("hide"),n.setAttribute("src",o))};a.changeEvent.on(l),this.addOnDisposeCallback(()=>a.changeEvent.off(l)),l()},socketColor:e})})}addRandomSuffixTab(e,t){if(!e||!e.item.randomSuffixOptions.length)return;const a=e.item;this.addTab({id:Bs(`${this.options.id}-Random Suffix`),label:"Random Suffix",gearData:t,itemData:this.player.getRandomSuffixes(a).map(e=>({item:e,id:e.id,actionId:xe.fromRandomSuffix(a,e),name:e.name,quality:a.quality,phase:a.phase,nameDescription:"",ignoreEPFilter:!0,onEquip:(e,a)=>{const i=t.getEquippedItem();i&&t.equipItem(e,i.withItem(i.item).withRandomSuffix(a))}})),computeEP:e=>this.player.computeRandomSuffixEP(e),equippedToItemFn:e=>e?.randomSuffix,onRemove:e=>{const a=t.getEquippedItem();a&&t.equipItem(e,a.withItem(a.item).withRandomSuffix(null)),this.removeTabs("Reforging"),this.removeTabs("Upgrades")}})}addReforgingTab(t,a){if(!t||t.hasRandomSuffixOptions()&&!t.randomSuffix)return;const s=t.item;this.addTab({id:Bs(`${this.options.id}-Reforging`),label:"Reforging",gearData:a,itemData:this.player.getAvailableReforgings(t).map(t=>({item:t,id:t.id,actionId:xe.fromReforge(s,t.reforge),name:e("div",null,e("span",{className:"reforge-value negative"},t.fromAmount," ",Ne.get(t.fromStat)),e("span",{className:"reforge-value positive"},"+",t.toAmount," ",Ne.get(t.toStat))),quality:i.ItemQualityCommon,phase:s.phase,nameDescription:"",ignoreEPFilter:!0,onEquip:(e,t)=>{const i=a.getEquippedItem();i&&a.equipItem(e,i.withReforge(t.reforge))}})),computeEP:e=>this.player.computeReforgingEP(e),equippedToItemFn:e=>e?.getReforgeData()||null,onRemove:e=>{const t=a.getEquippedItem();t&&a.equipItem(e,t.withItem(t.item).withRandomSuffix(t._randomSuffix))}})}addUpgradesTab(t,a){if(!t||!t.hasUpgradeOptions()||t.hasRandomSuffixOptions()&&!t.randomSuffix)return;const s=t.item,n=t.getUpgrades(),o=Object.entries(n),r=o.length-1;this.addTab({id:Bs(`${this.options.id}-Upgrades`),label:"Upgrades",gearData:a,itemData:o.map(([n,o],c)=>{const h=Number(n),m=t.withUpgrade(h);return{item:Number(h),id:Number(h),actionId:xe.fromItemId(s.id,0,t._randomSuffix?.id,0,h),name:e(l,null,c>0?e(l,null,"+ ",m.ilvlFromPrevious*c):e(l,null,"Base")," ",e("div",{className:"selector-modal-list-item-upgrade-step-container ms-2"},`(${h}/${r})`)),ilvl:o.ilvl,quality:i.ItemQualityCommon,phase:s.phase,nameDescription:"",ignoreEPFilter:!0,onEquip:(e,t)=>{const i=a.getEquippedItem();i&&a.equipItem(e,i.withUpgrade(t))}}}),computeEP:e=>this.player.computeUpgradeEP(t,e,this.currentSlot),equippedToItemFn:e=>e?._upgrade,onRemove:e=>{const t=a.getEquippedItem();t&&a.equipItem(e,t.withUpgrade(y.Base))}})}addTab({id:a,label:i,gearData:s,itemData:n,computeEP:o,equippedToItemFn:l,onRemove:r,setTabContent:c,socketColor:h}){if(!n.length)return;const m=i===this.currentTab,d=t();this.tabsElem.appendChild(e("li",{className:"nav-item"},e("button",{ref:d,className:_e("nav-link selector-modal-item-tab",m&&"active"),dataset:{label:i,bsToggle:"tab",bsTarget:`#${a}`},attributes:{role:"tab","aria-selected":m}}))),c?c(d.value):d.value.textContent=i;const p=new lg(a,this.contentElem,this.simUI,this.currentSlot,this.currentTab,this.player,i,s,n,h||T.GemColorUnknown,o,l,r,e=>{const t=s.getEquippedItem(),a=e;e.onEquip(Se.nextEventID(),a.item);const i=Et.is(a.item),n=s.getEquippedItem()||null,o=t?._randomSuffix?.id!==n?.randomSuffix?.id,l=t?.upgrade!==n?.upgrade;(i||o||l)&&(o||(this.removeTabs("Random Suffix"),this.addRandomSuffixTab(n,s)),l||(this.removeTabs("Upgrades"),this.addUpgradesTab(n,s)),this.removeTabs("Reforging"),this.addReforgingTab(n,s),this.removeTabs("Gem"),this.addGemTabs(this.currentSlot,n,s))}),u=()=>{p.updateSelected()},g=()=>{p.applyFilters()},f=()=>{p.hideOrShowEPValues()};s.changeEvent.on(u),this.player.sim.phaseChangeEmitter.on(g),this.player.sim.filtersChangeEmitter.on(g),this.player.sim.showEPValuesChangeEmitter.on(f),this.addOnDisposeCallback(()=>{s.changeEvent.off(u),this.player.sim.phaseChangeEmitter.off(g),this.player.sim.filtersChangeEmitter.off(g),this.player.sim.showEPValuesChangeEmitter.off(f),p.dispose()}),d.value.addEventListener("click",e=>{this.currentTab=i}),d.value.addEventListener("shown.bs.tab",e=>{p.sizeRefresh()}),this.ilists.push(p)}removeTabs(e){const t=[...this.tabsElem.querySelectorAll(".selector-modal-item-tab")].filter(t=>t.dataset?.label?.includes(e)),a=t.map(e=>document.querySelector(e.dataset.bsTarget)).filter(e=>Boolean(e));t.forEach(e=>e.parentElement?.remove()),a.forEach(e=>e.remove())}}class hg extends we{constructor(a,i,s,n){super(a,"icon-picker-root"),this.rootElem.classList.add("icon-picker"),this.player=s,this.slot=n;const o=t(),l=t();this.rootElem.prepend(e("a",{ref:o,className:"icon-picker-button",href:"#",attributes:{role:"button"}},e("div",{ref:l,className:"item-picker-sockets-container"}))),this.iconAnchor=o.value,this.socketsContainerElem=l.value;const r=new cg(i.rootElem,i,this.player);s.sim.waitForInit().then(()=>{this.iconAnchor.addEventListener("click",e=>{e.preventDefault(),r.openTab(this.slot,rg.Items,this.createGearData())})}),s.itemSwapSettings.changeEmitter.on(()=>{this.update(s.itemSwapSettings.getGear().getEquippedItem(n))})}update(t){this.iconAnchor.style.backgroundImage=`url('${$o(this.slot)}')`,this.iconAnchor.removeAttribute("data-wowhead"),this.iconAnchor.href="#",t?(t.asActionId().fillAndSet(this.iconAnchor,!0,!0),this.player.setWowheadData(t,this.iconAnchor),this.socketsContainerElem.replaceChildren(e(l,null,t.allSocketColors().map((e,a)=>{const i=Zo(e,t.gems[a],a);if(a===t.numPossibleSockets-1&&t.couldHaveExtraSocket()){const e=()=>{i.classList[this.player.isBlacksmithing()?"remove":"add"]("hide")};this.player.professionChangeEmitter.on(e),e()}return i}))),this.iconAnchor.classList.add("active")):(this.socketsContainerElem.replaceChildren(),this.iconAnchor.classList.remove("active"))}createGearData(){return{equipItem:(e,t)=>{this.player.itemSwapSettings.equipItem(e,this.slot,t)},getEquippedItem:()=>this.player.itemSwapSettings.getItem(this.slot),changeEvent:this.player.itemSwapSettings.changeEmitter}}}class mg{constructor(e){this.changeEmitter=new Se("PlayerItemSwap"),this.enableItemSwap=!1,this.gear=new ao({}),this.bonusStats=new ke,this.player=e}setItemSwapSettings(e,t,a,i){this.enableItemSwap=t,this.gear=a,this.bonusStats=i||new ke,this.changeEmitter.emit(e)}setBonusStats(e,t){this.bonusStats=t,this.changeEmitter.emit(e)}getBonusStats(){return this.bonusStats}getEnableItemSwap(){return this.enableItemSwap}setEnableItemSwap(e,t){t!=this.enableItemSwap&&(this.enableItemSwap=t,this.changeEmitter.emit(e))}equipItem(e,t,a){this.setGear(e,this.gear.withEquippedItem(t,a,this.player.canDualWield2H()))}getItem(e){return this.gear.getEquippedItem(e)}getGear(){return this.gear}setGear(e,t){t.equals(this.gear)||(this.gear=t,this.changeEmitter.emit(e))}toProto(){return N.create({prepullBonusStats:this.bonusStats.toProto(),items:this.gear.asArray().map(e=>e?e.asSpec():b.create())})}}class dg extends we{constructor(a,i,s,n){super(a,"item-swap-picker-root"),this.itemSlots=n.itemSlots,new Rt(this.rootElem,s,{id:"enable-item-swap",reverse:!0,label:"Enable Item Swapping",labelTooltip:"Allows configuring an Item Swap Set which is used with the <b>Item Swap</b> APL action.",extraCssClasses:["input-inline"],getValue:e=>e.itemSwapSettings.getEnableItemSwap(),setValue(e,t,a){t.itemSwapSettings.setEnableItemSwap(e,a)},changedEvent:e=>e.itemSwapSettings.changeEmitter});const o=t(),r=t(),c=t(),h=ye.newGroupContainer("icon-group");this.rootElem.appendChild(e(l,null,e("div",{ref:o,className:"input-root input-inline input-item-swap-container"},e("label",{className:"form-label"},"Item Swap"),e("button",{ref:r,className:"gear-swap-icon"},e("i",{className:"fas fa-arrows-rotate me-1"})),h),n.note&&e("p",{ref:c,className:"form-text"},n.note)));const m=()=>{s.itemSwapSettings.getEnableItemSwap()?(o.value?.classList.remove("hide"),c.value?.classList.remove("hide")):(o.value?.classList.add("hide"),c.value?.classList.add("hide"))};s.itemSwapSettings.changeEmitter.on(m),m(),r.value&&(r.value.addEventListener("click",e=>this.swapWithGear(Se.nextEventID(),s)),u(r.value,{content:"Swap with equipped items"}));const d=e(l,null);this.itemSlots.forEach(e=>{new hg(d,i,s,e)}),h.appendChild(d)}swapWithGear(e,t){let a=t.getGear(),i=t.itemSwapSettings.getGear();this.itemSlots.forEach(e=>{const s=t.getGear().getEquippedItem(e),n=t.itemSwapSettings.getGear().getEquippedItem(e);a=a.withEquippedItem(e,n,t.canDualWield2H()),i=i.withEquippedItem(e,s,t.canDualWield2H())}),Se.freezeAllAndDo(()=>{t.setGear(e,a),t.itemSwapSettings.setGear(e,i)})}}class pg{constructor(){this.name="",this.auras=[],this.spells=[]}getName(){return this.name}getAuras(){return this.auras.slice()}getSpells(){return this.spells.slice()}async update(e){let t=e.spells.map(e=>({data:e,id:xe.fromProto(e.id)})),a=e.auras.map(e=>({data:e,id:xe.fromProto(e.id)}));await Promise.all([...t,...a].map(e=>e.id.fill().then(t=>e.id=t))),t=t.sort((e,t)=>Me(e.id.name,t.id.name)),a=a.sort((e,t)=>Me(e.id.name,t.id.name));let i=!1;return e.name!=this.name&&(this.name=e.name,i=!0),(t.length!=this.spells.length||t.some((e,t)=>!e.id.equals(this.spells[t].id)))&&(this.spells=t,i=!0),(a.length!=this.auras.length||a.some((e,t)=>!e.id.equals(this.auras[t].id)))&&(this.auras=a,i=!0),i}}class ug{constructor(){this.metadatas=[]}async update(e){const t=this.metadatas.length;if(e.length>t)for(let i=t;i<e.length;i++)this.metadatas.push(new pg);else e.length<t&&(this.metadatas=this.metadatas.slice(0,e.length));const a=await Promise.all(e.map((e,t)=>this.metadatas[t].update(e)));return t!=this.metadatas.length||a.some(e=>e)}asList(){return this.metadatas.slice()}}const gg={};function fg(e){const t=gg[e];if(t.secondaryResource=Xi.create(e),!t)throw new Error("No config registered for Spec: "+e);return t}const wg=class e{constructor(t,a){this.name="",this.buffs=O.create(),this.consumables=G.create(),this.bonusStats=new ke,this.gear=new io({}),this.profession1=0,this.profession2=0,this.aplRotation=Ft.create(),this.talentsString="",this.glyphs=E.create(),this.reactionTime=0,this.channelClipDelay=0,this.inFrontOfTarget=!1,this.distanceFromTarget=0,this.healingModel=D.create(),this.healingEnabled=!1,this.challengeModeEnabled=!1,this.autoRotationGenerator=null,this.simpleRotationGenerator=null,this.itemEPCache=new Array,this.gemEPCache=new Map,this.randomSuffixEPCache=new Map,this.enchantEPCache=new Map,this.upgradeEPCache=new Map,this.talents=null,this.epRatios=new Array(e.numEpRatios).fill(0),this.epWeights=new ke,this.statCaps=new ke,this.softCapBreakpoints=[],this.breakpointLimits=new ke,this.currentStats=so.create(),this.metadata=new pg,this.petMetadatas=new ug,this.nameChangeEmitter=new Se("PlayerName"),this.buffsChangeEmitter=new Se("PlayerBuffs"),this.consumesChangeEmitter=new Se("PlayerConsumes"),this.bonusStatsChangeEmitter=new Se("PlayerBonusStats"),this.gearChangeEmitter=new Se("PlayerGear"),this.professionChangeEmitter=new Se("PlayerProfession"),this.raceChangeEmitter=new Se("PlayerRace"),this.rotationChangeEmitter=new Se("PlayerRotation"),this.talentsChangeEmitter=new Se("PlayerTalents"),this.glyphsChangeEmitter=new Se("PlayerGlyphs"),this.specOptionsChangeEmitter=new Se("PlayerSpecOptions"),this.inFrontOfTargetChangeEmitter=new Se("PlayerInFrontOfTarget"),this.distanceFromTargetChangeEmitter=new Se("PlayerDistanceFromTarget"),this.healingModelChangeEmitter=new Se("PlayerHealingModel"),this.epWeightsChangeEmitter=new Se("PlayerEpWeights"),this.statCapsChangeEmitter=new Se("StatCaps"),this.softCapBreakpointsChangeEmitter=new Se("SoftCapBreakpoints"),this.breakpointLimitsChangeEmitter=new Se("BreakpointLimits"),this.miscOptionsChangeEmitter=new Se("PlayerMiscOptions"),this.challengeModeChangeEmitter=new Se("ChallengeMode"),this.currentStatsEmitter=new Se("PlayerCurrentStats"),this.epRatiosChangeEmitter=new Se("PlayerEpRatios"),this.epRefStatChangeEmitter=new Se("PlayerEpRefStat"),this.sim=a,this.party=null,this.raid=null,this.playerSpec=t,this.playerClass=ze.getPlayerClass(t),this.race=this.playerClass.races[0],this.specTypeFunctions=dt[this.getSpec()],this.specOptions=this.specTypeFunctions.optionsCreate(),this.specConfig=fg(this.getSpec()),this.secondaryResource=this.specConfig.secondaryResource,this.autoRotationGenerator=this.specConfig.autoRotation,this.specConfig.simpleRotation?this.simpleRotationGenerator=this.specConfig.simpleRotation:this.simpleRotationGenerator=null,this.hiddenMCDs=this.specConfig.hiddenMCDs||new Array;for(let e=0;e<r.ItemSlotOffHand+1;++e)this.itemEPCache[e]=new Map;this.itemSwapSettings=new mg(this),this.bindChallengeModeChange(),this.changeEmitter=Se.onAny([this.nameChangeEmitter,this.buffsChangeEmitter,this.consumesChangeEmitter,this.bonusStatsChangeEmitter,this.gearChangeEmitter,this.professionChangeEmitter,this.raceChangeEmitter,this.rotationChangeEmitter,this.talentsChangeEmitter,this.glyphsChangeEmitter,this.specOptionsChangeEmitter,this.miscOptionsChangeEmitter,this.inFrontOfTargetChangeEmitter,this.distanceFromTargetChangeEmitter,this.healingModelChangeEmitter,this.epWeightsChangeEmitter,this.epRatiosChangeEmitter,this.epRefStatChangeEmitter,this.statCapsChangeEmitter,this.breakpointLimitsChangeEmitter,this.challengeModeChangeEmitter],"PlayerChange")}bindChallengeModeChange(){this.challengeModeChangeEmitter.on(()=>{this.setGear(Se.nextEventID(),this.gear,!0)})}getSpecIcon(){return this.playerSpec.getIcon("medium")}getPlayerSpec(){return this.playerSpec}getSpec(){return this.getPlayerSpec().specID}getPlayerClass(){return this.playerClass}getClass(){return this.playerSpec.classID}getClassColor(){return this.playerClass.hexColor}canEnableTargetDummies(){return[v.ClassDruid,v.ClassPaladin,v.ClassPriest,v.ClassShaman,v.ClassMonk].includes(this.getClass())}shouldEnableTargetDummies(){if(this.getPlayerSpec().isHealingSpec||this.getPlayerSpec().isTankSpec)return!0;if(!this.itemSwapSettings.getEnableItemSwap())return!1;return this.itemSwapSettings.getGear().hasTrinketFromOptions([72898,77969,77204,77989])}isSpec(e){return this.getSpec()==e}isClass(e){return this.getClass()==e}getParty(){return this.party}getRaid(){return this.raid}getPartyIndex(){if(null==this.party)throw new Error("Can't get party index for player without a party!");return this.party.getPlayers().indexOf(this)}getRaidIndex(){if(null==this.party)throw new Error("Can't get raid index for player without a party!");return 5*this.party.getIndex()+this.getPartyIndex()}setParty(e){null==e?(this.party=null,this.raid=null):(this.party=e,this.raid=e.raid)}getOtherPartyMembers(){return null==this.party?[]:this.party.getPlayers().filter(e=>null!=e&&e!=this)}getItems(e){return this.sim.db.getItems(e).filter(t=>Ue(t,this.playerSpec,e))}getRandomSuffixes(e){return e.randomSuffixOptions.map(e=>this.sim.db.getRandomSuffixById(e)).filter(e=>!!e&&this.computeRandomSuffixEP(e)>0)}getAvailableReforgings(e){return this.sim.db.getAvailableReforges(e.item).map(t=>e.getReforgeData(t))}getReforge(e){return this.sim.db.getReforgeById(e)}getEnchants(e){return this.sim.db.getEnchants(e).filter(e=>no(e,this.playerSpec))}getTinkers(e){return this.sim.db.getEnchants(e).filter(e=>e.requiredProfession==I.Engineering)}getGems(e){return this.sim.db.getGems(e)}getEpWeights(){return this.epWeights}setEpWeights(e,t){this.epWeights=t,this.epWeightsChangeEmitter.emit(e),this.gemEPCache=new Map,this.enchantEPCache=new Map,this.randomSuffixEPCache=new Map,this.upgradeEPCache=new Map;for(let a=0;a<r.ItemSlotOffHand+1;++a)this.itemEPCache[a]=new Map}getStatCaps(){return this.statCaps}setStatCaps(e,t){this.statCaps=t,this.statCapsChangeEmitter.emit(e)}getSoftCapBreakpoints(){return this.softCapBreakpoints}setSoftCapBreakpoints(e,t){this.softCapBreakpoints=t,this.softCapBreakpointsChangeEmitter.emit(e)}getBreakpointLimits(){return this.breakpointLimits}setBreakpointLimits(e,t){this.breakpointLimits=t,this.breakpointLimitsChangeEmitter.emit(e)}getDefaultEpRatios(t,a){const i=new Array(e.numEpRatios).fill(0);return a?i[1]=1:t?(i[2]=1,i[3]=1,this.getSpec()==p.SpecBloodDeathKnight&&(i[1]=1)):i[0]=1,i}getEpRatios(){return this.epRatios.slice()}setEpRatios(e,t){this.epRatios=t,this.epRatiosChangeEmitter.emit(e)}async computeStatWeights(e,t,a,i,s){try{const e=await this.sim.statWeights(this,t,a,i,s);return e.error?(e.error.type==xt.ErrorOutcomeAborted&&new No({variant:"info",body:"Statweight sim cancelled."}),null):e}catch(n){return console.error(n),new No({variant:"error",body:n?.message||"Something went wrong calculating your stat weights. Reload the page and try again."}),null}}getCurrentStats(){return so.clone(this.currentStats)}setCurrentStats(e,t){this.currentStats=t,this.currentStatsEmitter.emit(e)}getMetadata(){return this.metadata}getPetMetadatas(){return this.petMetadatas}async updateMetadata(){const e=this.metadata.update(this.currentStats.metadata),t=this.petMetadatas.update(this.currentStats.pets.map(e=>e.metadata)),a=await e,i=await t;return a||i}getName(){return this.name}setName(e,t){t!=this.name&&(this.name=t,this.nameChangeEmitter.emit(e))}getLabel(){return this.party?`${this.name} (#${this.getRaidIndex()+1})`:this.name}getRace(){return this.race}setRace(e,t){t!=this.race&&(this.race=t,this.raceChangeEmitter.emit(e))}getProfession1(){return this.profession1}setProfession1(e,t){t!=this.profession1&&(this.profession1=t,this.professionChangeEmitter.emit(e))}getProfession2(){return this.profession2}setProfession2(e,t){t!=this.profession2&&(this.profession2=t,this.professionChangeEmitter.emit(e))}getProfessions(){return[this.profession1,this.profession2].filter(e=>e!=I.ProfessionUnknown)}setProfessions(e,t){Se.freezeAllAndDo(()=>{this.setProfession1(e,t[0]||I.ProfessionUnknown),this.setProfession2(e,t[1]||I.ProfessionUnknown)})}hasProfession(e){return this.getProfessions().includes(e)}isBlacksmithing(){return this.hasProfession(I.Blacksmithing)}getFaction(){return oo[this.getRace()]}getBuffs(){return O.clone(this.buffs)}setBuffs(e,t){O.equals(this.buffs,t)||(this.buffs=O.clone(t),this.buffsChangeEmitter.emit(e))}getConsumes(){return G.clone(this.consumables)}setConsumes(e,t){G.equals(this.consumables,t)||(this.consumables=G.clone(t),this.consumesChangeEmitter.emit(e))}canDualWield2H(){return this.getSpec()==p.SpecFuryWarrior}equipItem(e,t,a){this.setGear(e,this.gear.withEquippedItem(t,a,this.canDualWield2H()))}getEquippedItem(e){return this.gear.getEquippedItem(e)}getEquippedItems(){return this.gear.getEquippedItems()}getGear(){return this.gear}setGear(e,t,a){t.equals(this.gear)&&!a||(this.gear=t.withChallengeMode(this.challengeModeEnabled),this.gearChangeEmitter.emit(e))}getBonusStats(){return this.bonusStats}setBonusStats(e,t){t.equals(this.bonusStats)||(this.bonusStats=t,this.bonusStatsChangeEmitter.emit(e))}getMeleeCritCapInfo(){const e=this.currentStats.finalStats?.pseudoStats[o.PseudoStatPhysicalCritPercent]||0,t=this.currentStats.finalStats?.pseudoStats[o.PseudoStatPhysicalHitPercent]||0,a=(this.currentStats.finalStats?.stats[n.StatExpertiseRating]||0)/Ee/4,i=void 0!==this.getGear().getEquippedItem(r.ItemSlotOffHand)?.item.weaponSpeed,s=i&&this.getClass()!=v.ClassWarrior?27:8,l=this.getInFrontOfTarget()?14:0,c=6.5+l,h=Math.max(s-t,0),m=Math.max(6.5-a,0)+Math.max(l-a,0),d=80.8-h-m-0;return{meleeCrit:e,meleeHit:t,expertise:a,suppression:4.8,glancing:24,hasOffhandWeapon:i,meleeHitCap:s,expertiseCap:c,remainingMeleeHitCap:h,remainingExpertiseCap:m,baseCritCap:d,specSpecificOffset:0,playerCritCapDelta:e-d}}getMeleeCritCap(){return this.getMeleeCritCapInfo().playerCritCapDelta}setAplRotation(e,t){Ft.equals(t,this.aplRotation)||(this.aplRotation=Ft.clone(t),this.rotationChangeEmitter.emit(e))}getSimpleRotation(){const e=this.aplRotation.simple?.specRotationJson||"";if(!e)return this.specTypeFunctions.rotationCreate();try{const t=JSON.parse(e);return this.specTypeFunctions.rotationFromJson(t)}catch(t){return console.warn(`Error parsing rotation spec options: ${t}\n\nSpec options: '${e}'`),this.specTypeFunctions.rotationCreate()}}setSimpleRotation(e,t){this.specTypeFunctions.rotationEquals(t,this.getSimpleRotation())||(this.aplRotation.simple||(this.aplRotation.simple=lo.create()),this.aplRotation.simple.specRotationJson=JSON.stringify(this.specTypeFunctions.rotationToJson(t)),this.rotationChangeEmitter.emit(e))}getSimpleCooldowns(){return ge.clone(this.aplRotation.simple?.cooldowns||ge.create())}setSimpleCooldowns(e,t){ge.equals(this.getSimpleCooldowns(),t)||(this.aplRotation.simple||(this.aplRotation.simple=lo.create()),this.aplRotation.simple.cooldowns=t,this.rotationChangeEmitter.emit(e))}getRotationType(){return this.aplRotation.type==Wt.TypeUnknown?Wt.TypeAPL:this.aplRotation.type}hasSimpleRotationGenerator(){return null!=this.simpleRotationGenerator}getResolvedAplRotation(){const e=this.getRotationType();if(e==Wt.TypeAuto&&this.autoRotationGenerator){const e=Ft.clone(this.autoRotationGenerator(this));return e.type=Wt.TypeAuto,e}if(e==Wt.TypeSimple&&this.simpleRotationGenerator){const e=this.getSimpleRotation(),t=Ft.clone(this.simpleRotationGenerator(this,e,this.getSimpleCooldowns()));return t.simple=this.aplRotation.simple,t.type=Wt.TypeSimple,t}return Ds(this.aplRotation,["uuid"])}getTalents(){return null==this.talents&&(this.talents=$l(this.playerSpec,this.talentsString)),this.talents}getTalentsString(){return this.talentsString}setTalentsString(e,t){t!=this.talentsString&&(this.talentsString=t,this.talents=null,this.talentsChangeEmitter.emit(e))}getTalentTreePoints(){return ro(this.getTalentsString())}getTalentTreeIcon(){return this.playerSpec.getIcon("medium")}getGlyphs(){return E.clone(this.glyphs)}setGlyphs(e,t){E.equals(this.glyphs,t)||(this.glyphs=E.clone(t),this.glyphsChangeEmitter.emit(e))}getMajorGlyphs(){return[this.glyphs.major1,this.glyphs.major2,this.glyphs.major3].filter(e=>0!=e)}getMinorGlyphs(){return[this.glyphs.minor1,this.glyphs.minor2,this.glyphs.minor3].filter(e=>0!=e)}getAllGlyphs(){return this.getMajorGlyphs().concat(this.getMinorGlyphs())}getClassOptions(){return this.getSpecOptions().classOptions}setClassOptions(e,t){const a=this.getSpecOptions();a.classOptions=t,this.specTypeFunctions.optionsEquals(a,this.specOptions)||(this.specOptions=this.specTypeFunctions.optionsCopy(a),this.specOptionsChangeEmitter.emit(e))}getSpecOptions(){return this.specTypeFunctions.optionsCopy(this.specOptions)}setSpecOptions(e,t){this.specTypeFunctions.optionsEquals(t,this.specOptions)||(this.specOptions=this.specTypeFunctions.optionsCopy(t),this.specOptionsChangeEmitter.emit(e))}getReactionTime(){return this.reactionTime}setReactionTime(e,t){t!=this.reactionTime&&(this.reactionTime=t,this.miscOptionsChangeEmitter.emit(e))}getChannelClipDelay(){return this.channelClipDelay}setChannelClipDelay(e,t){t!=this.channelClipDelay&&(this.channelClipDelay=t,this.miscOptionsChangeEmitter.emit(e))}getChallengeModeEnabled(){return this.challengeModeEnabled}setChallengeModeEnabled(e,t){t!==this.challengeModeEnabled&&(this.challengeModeEnabled=t,this.challengeModeChangeEmitter.emit(e))}getInFrontOfTarget(){return this.inFrontOfTarget}setInFrontOfTarget(e,t){t!=this.inFrontOfTarget&&(this.inFrontOfTarget=t,this.inFrontOfTargetChangeEmitter.emit(e))}getDistanceFromTarget(){return this.distanceFromTarget}setDistanceFromTarget(e,t){t!=this.distanceFromTarget&&(this.distanceFromTarget=t,this.distanceFromTargetChangeEmitter.emit(e))}setDefaultHealingParams(e){const t=this.sim.encounter.primaryTarget,a=t.dualWield;if(0==e.cadenceSeconds){let i=1.5*t.swingSpeed;a&&(i/=2),e.cadenceSeconds=.4,e.cadenceVariation=i-e.cadenceSeconds}0==e.hps&&(e.hps=.25*t.minBaseDamage/t.swingSpeed,a&&(e.hps*=1.5))}enableHealing(){this.healingEnabled=!0;const e=this.getHealingModel();0!=e.cadenceSeconds&&0!=e.hps||(this.setDefaultHealingParams(e),this.setHealingModel(0,e))}getHealingModel(){return D.clone(this.healingModel)}setHealingModel(e,t){D.equals(this.healingModel,t)||(this.healingModel=D.clone(t),this.healingEnabled&&this.setDefaultHealingParams(this.healingModel),this.healingModelChangeEmitter.emit(e))}computeStatsEP(e){return null==e?0:e.computeEP(this.epWeights)}computeGemEP(e){if(this.gemEPCache.has(e.id))return this.gemEPCache.get(e.id);const t=this.computeStatsEP(new ke(e.stats)),a=co(this.playerSpec,e,ke.fromProto(this.currentStats.finalStats));let i=0;e.unique&&(i-=.01);const s=t+a+i;return this.gemEPCache.set(e.id,s),s}computeEnchantEP(e){if(this.enchantEPCache.has(e.effectId))return this.enchantEPCache.get(e.effectId);const t=this.computeStatsEP(new ke(e.stats));return this.enchantEPCache.set(e.effectId,t),t}computeRandomSuffixEP(e){if(this.randomSuffixEPCache.has(e.id))return this.randomSuffixEPCache.get(e.id);const t=this.computeStatsEP(new ke(e.stats));return this.randomSuffixEPCache.set(e.id,t),t}computeReforgingEP(e){let t=new ke([]);return t=t.addStat(e.fromStat,e.fromAmount),t=t.addStat(e.toStat,e.toAmount),this.computeStatsEP(t)}computeUpgradeEP(e,t,a){const i=`${e.id}-${a}-${e.randomSuffix?.id}-${t}`;if(this.upgradeEPCache.has(i))return this.upgradeEPCache.get(i);const s=e.withUpgrade(t).calcStats(a),n=this.computeStatsEP(s);return this.upgradeEPCache.set(i,n),n}computeItemEP(e,t){if(null==e)return 0;const a=`${e.id}-${this.challengeModeEnabled}`,i=this.itemEPCache[t].get(a);if(void 0!==i)return i;const s=new Xn({item:e,challengeMode:this.challengeModeEnabled}).withDynamicStats(),n=s.calcStats(t);let o=0;if(e.randomSuffixOptions.length>0){const e=s.item.randomSuffixOptions.map(e=>this.computeRandomSuffixEP(this.sim.db.getRandomSuffixById(e)||0));o=Math.max(...e)*s.item.randPropPoints/1e4}let l=n.computeEP(this.epWeights)+o;e.unique&&(l-=.01);const r=on(e.gemSockets.map(e=>{const t=this.sim.db.getGems(e).filter(e=>ho(e,this.sim.getPhase()));return t.length>0?Math.max(...t.map(e=>this.computeGemEP(e))):0})),c=on(e.gemSockets.map(e=>{const t=this.sim.db.getGems(e).filter(t=>ho(t,this.sim.getPhase())&&to(t,e));return t.length>0?Math.max(...t.map(e=>this.computeGemEP(e))):0}))+this.computeStatsEP(new ke(e.socketBonus));return l+=Math.max(c,r),this.itemEPCache[t].set(a,l),l}async setWowheadData(e,t){const a=this.hasProfession(I.Blacksmithing),i=e.gems.length?e.curGems(a).map(e=>e?e.id:0):[],s=[e.enchant?.effectId,e.tinker?.effectId].filter(e=>void 0!==e);e.asActionId().setWowheadDataset(t,{gemIds:i,itemLevel:Number(e.ilvl),enchantIds:s,reforgeId:e.reforge?.id,randomEnchantmentId:e.randomSuffix?.id,setPieceIds:this.gear.asArray().filter(e=>null!=e).map(e=>e.item.id),hasExtraSocket:e.hasExtraSocket(a),upgradeStep:e.upgrade}),t.dataset.whtticon="false"}get armorSpecializationArmorType(){return this.playerClass.armorTypes[0]}hasArmorSpecializationBonus(){return[r.ItemSlotHead,r.ItemSlotShoulder,r.ItemSlotChest,r.ItemSlotWrist,r.ItemSlotHands,r.ItemSlotWaist,r.ItemSlotLegs,r.ItemSlotFeet].some(e=>{const t=this.getEquippedItem(e)?.item;if(!t)return!1;return t.armorType!==this.armorSpecializationArmorType})}hasEotBPItemEquipped(){return[r.ItemSlotMainHand,r.ItemSlotOffHand].some(e=>{const t=this.getEquippedItem(e)?.item;return t&&(po(t)||uo(t))})}filterItemData(t,a,i){const s=this.sim.getFilters(),n=(e,t)=>e.filter(e=>t(a(e)));0!=s.minIlvl&&(t=n(t,e=>(e.scalingOptions?.[y.Base].ilvl||e.ilvl)>=s.minIlvl)),0!=s.maxIlvl&&(t=n(t,e=>(e.scalingOptions?.[y.Base].ilvl||e.ilvl)<=s.maxIlvl)),s.factionRestriction!=Oe.UNSPECIFIED&&(t=n(t,e=>e.factionRestriction==s.factionRestriction||e.factionRestriction==Oe.UNSPECIFIED)),s.sources.includes(Dn.SourceCrafting)||(t=n(t,e=>!e.sources.some(e=>"crafted"==e.source.oneofKind))),s.sources.includes(Dn.SourceQuest)||(t=n(t,e=>!e.sources.some(e=>"quest"==e.source.oneofKind))),s.sources.includes(Dn.SourceReputation)||(t=n(t,e=>!e.sources.some(e=>"rep"==e.source.oneofKind))),s.sources.includes(Dn.SourcePvp)||(t=n(t,e=>!qn(e)));for(const[o,l]of Object.entries(e.DIFFICULTY_SRCS)){const a=parseInt(o);if(!s.sources.includes(a)&&(t=n(t,e=>!e.sources.some(e=>"drop"==e.source.oneofKind&&e.source.drop.difficulty==l)),l==mo.DifficultyRaid10H||l==mo.DifficultyRaid25H)){const a=e.HEROIC_TO_NORMAL[l];t=n(t,e=>!e.sources.some(e=>"drop"==e.source.oneofKind&&e.source.drop.difficulty==a&&e.source.drop.category==bo))}}for(const[o,l]of Object.entries(e.RAID_IDS)){const e=parseInt(o);s.raids.includes(e)||(t=n(t,e=>!e.sources.some(e=>"drop"==e.source.oneofKind&&e.source.drop.zoneId==l)))}return e.ARMOR_SLOTS.includes(i)?t=n(t,e=>!!s.armorTypes.includes(e.armorType)):e.WEAPON_SLOTS.includes(i)&&(t=n(t,e=>{if(e.handType==m.HandTypeUnknown&&e.rangedWeaponType==d.RangedWeaponTypeUnknown)return!1;if(!s.weaponTypes.includes(e.weaponType)&&e.handType>m.HandTypeUnknown)return!1;if(!s.oneHandedWeapons&&e.handType!=m.HandTypeTwoHand)return!1;if(!s.twoHandedWeapons&&e.handType==m.HandTypeTwoHand)return!1;if(!s.rangedWeaponTypes.includes(e.rangedWeaponType)&&e.rangedWeaponType>d.RangedWeaponTypeUnknown)return!1;let t=i==r.ItemSlotMainHand?s.minMhWeaponSpeed:s.minOhWeaponSpeed,a=i==r.ItemSlotMainHand?s.maxMhWeaponSpeed:s.maxOhWeaponSpeed;return e.rangedWeaponType>0&&(t=s.minRangedWeaponSpeed,a=s.maxRangedWeaponSpeed),!(t>0&&e.weaponSpeed<t)&&!(a>0&&e.weaponSpeed>a)})),t}filterEnchantData(e,t,a,i){return i?e.filter(e=>{const a=t(e);return!!go(a,i.item)}):e}filterGemData(e,t,a,i){const s=this.sim.getFilters(),n=this.hasProfession(I.Jewelcrafting);return e.filter(e=>{const a=t(e);if(!n&&a.requiredProfession==I.Jewelcrafting)return!1;if(s.matchingGemsOnly&&!to(a,i))return!1;const o=this.specConfig.gemStats??this.specConfig.epStats,l=a.stats.map((e,t)=>e>0?t:-1).filter(e=>e>=0);return!!l.length&&!l.some(e=>!o.includes(e))})}makeUnitReference(){return null==this.party?zs():fo(this.getRaidIndex())}toDatabase(){const e=this.getGear().toDatabase(this.sim.db),t=this.itemSwapSettings.getGear().toDatabase(this.sim.db);return We.mergeSimDatabases(e,t)}toProto(e,t,a){const i=e=>!a||0==a.length||a.includes(e),s=this.getGear(),n=t?this.getResolvedAplRotation():Ds(this.aplRotation,["uuid"]);let o=sn.create({class:this.getClass(),database:e?void 0:this.toDatabase()});return i(hl.Gear)&&sn.mergePartial(o,{equipment:s.asSpec(),bonusStats:this.getBonusStats().toProto(),enableItemSwap:this.itemSwapSettings.getEnableItemSwap(),itemSwap:this.itemSwapSettings.toProto()}),i(hl.Talents)&&sn.mergePartial(o,{talentsString:this.getTalentsString(),glyphs:this.getGlyphs()}),i(hl.Rotation)&&sn.mergePartial(o,{cooldowns:ge.create({hpPercentForDefensives:this.getSimpleCooldowns().hpPercentForDefensives}),rotation:n}),i(hl.Consumes)&&sn.mergePartial(o,{consumables:this.getConsumes()}),i(hl.Miscellaneous)&&(sn.mergePartial(o,{name:this.getName(),race:this.getRace(),profession1:this.getProfession1(),profession2:this.getProfession2(),reactionTimeMs:this.getReactionTime(),channelClipDelayMs:this.getChannelClipDelay(),inFrontOfTarget:this.getInFrontOfTarget(),distanceFromTarget:this.getDistanceFromTarget(),healingModel:this.getHealingModel(),challengeMode:this.getChallengeModeEnabled()}),o=wo(this.getSpec(),o,this.getSpecOptions())),i(hl.External)&&sn.mergePartial(o,{buffs:this.getBuffs()}),o}fromProto(t,a,i){Se.freezeAllAndDo(()=>{e.updateProtoVersion(a);const s=e=>!i||0==i.length||i.includes(e);t=Se.nextEventID(),s(hl.Gear)&&(this.setGear(t,a.equipment?this.sim.db.lookupEquipmentSpec(a.equipment):new io({})),this.itemSwapSettings.setItemSwapSettings(t,a.enableItemSwap,a.itemSwap?this.sim.db.lookupItemSwap(a.itemSwap):new ao({}),ke.fromProto(a.itemSwap?.prepullBonusStats)),this.setBonusStats(t,ke.fromProto(a.bonusStats||L.create()))),s(hl.Talents)&&(this.setTalentsString(t,a.talentsString),this.setGlyphs(t,a.glyphs||E.create())),s(hl.Rotation)&&(a.rotation?.type==Wt.TypeUnknown&&(a.rotation||(a.rotation=Ft.create()),a.rotation.type=Wt.TypeAuto),this.setAplRotation(t,a.rotation||Ft.create())),s(hl.Consumes)&&this.setConsumes(t,a.consumables||G.create()),s(hl.Miscellaneous)&&(this.setSpecOptions(t,this.specTypeFunctions.optionsFromPlayer(a)),this.setName(t,a.name),this.setRace(t,a.race),this.setProfession1(t,a.profession1),this.setProfession2(t,a.profession2),this.setReactionTime(t,a.reactionTimeMs),this.setChannelClipDelay(t,a.channelClipDelayMs),this.setInFrontOfTarget(t,a.inFrontOfTarget),this.setDistanceFromTarget(t,a.distanceFromTarget),this.setHealingModel(t,a.healingModel||D.create()),this.setChallengeModeEnabled(t,a.challengeMode)),s(hl.External)&&this.setBuffs(t,a.buffs||O.create())})}clone(t){const a=new e(this.playerSpec,this.sim);return a.fromProto(t,this.toProto()),a}applySharedDefaults(e){Se.freezeAllAndDo(()=>{this.setReactionTime(e,100),this.setInFrontOfTarget(e,this.playerSpec.isTankSpec),this.setHealingModel(e,D.create({burstWindow:this.playerSpec.isTankSpec?6:0})),this.setSimpleCooldowns(e,ge.create({hpPercentForDefensives:this.playerSpec.isTankSpec?.4:0})),this.setBonusStats(e,new ke)})}getBaseMastery(){return 8}getMasteryPerPointModifier(){return yo.get(this.getSpec())||0}static updateProtoVersion(e){e.apiVersion}getSpecConfig(){return this.specConfig}};wg.numEpRatios=6,wg.ARMOR_SLOTS=[r.ItemSlotHead,r.ItemSlotShoulder,r.ItemSlotChest,r.ItemSlotWrist,r.ItemSlotHands,r.ItemSlotLegs,r.ItemSlotWaist,r.ItemSlotFeet],wg.WEAPON_SLOTS=[r.ItemSlotMainHand,r.ItemSlotOffHand],wg.DIFFICULTY_SRCS={[Dn.SourceDungeon]:mo.DifficultyNormal,[Dn.SourceDungeonH]:mo.DifficultyHeroic,[Dn.SourceRaidRF]:mo.DifficultyRaid25RF,[Dn.SourceRaid]:mo.DifficultyRaid25,[Dn.SourceRaidH]:mo.DifficultyRaid25H},wg.HEROIC_TO_NORMAL={[mo.DifficultyHeroic]:mo.DifficultyNormal,[mo.DifficultyRaid10H]:mo.DifficultyRaid10,[mo.DifficultyRaid25H]:mo.DifficultyRaid25},wg.RAID_IDS={[Nn.RaidMogushanVaults]:6125,[Nn.RaidHeartOfFear]:6297,[Nn.RaidTerraceOfEndlessSpring]:6067,[Nn.RaidThroneOfThunder]:6622,[Nn.RaidSiegeOfOrgrimmar]:6738};let yg=wg;const bg=(e,t,a)=>{const i=S.fromJson(t);return Sg(e,i,a||{})},Sg=(e,t,a)=>{const i=[];return void 0!==a.faction&&i.push(e=>e.getFaction()==a.faction),void 0!==a.customCondition&&i.push(a.customCondition),{name:e,tooltip:a.tooltip||So,gear:t,enableWhen:i.length?e=>i.every(t=>t(e)):void 0,onLoad:a?.onLoad}},vg=(e,t,a)=>Ig(e,t,a||{}),Ig=(e,t,a)=>{const i=[];return void 0!==a?.customCondition&&i.push(a.customCondition),{name:e,epWeights:t,enableWhen:i.length?e=>i.every(t=>t(e)):void 0,onLoad:a?.onLoad}},Eg=(e,t,a)=>{const i=Ns.create({rotation:Ft.fromJson(t)});return Cg(e,i,a)},kg=(e,t,a,i)=>{const s=t==p.SpecBloodDeathKnight||t==p.SpecGuardianDruid||t==p.SpecProtectionPaladin||t==p.SpecProtectionWarrior,n=Ns.create({rotation:{type:Wt.TypeSimple,simple:{specRotationJson:JSON.stringify(dt[t].rotationToJson(a)),cooldowns:ge.create({hpPercentForDefensives:s?.4:0})}}});return Cg(e,n,i)},Cg=(e,t,a)=>{const i=[];return{name:e,rotation:t,enableWhen:i.length?e=>i.every(t=>t(e)):void 0,onLoad:a?.onLoad}},_g=(e,t,a,i,s,n)=>({name:e,encounter:t,targetDummies:s,tanks:i,healingModel:a,...n}),xg=(e,t)=>{const a=N.fromJson(t);return Tg(e,a)},Tg=(e,t)=>({name:e,itemSwap:t}),Pg=(e,t)=>({name:e,...t}),Rg=(e,t,a,{settings:i,...s}={},n)=>{const o=ft.fromJson(a),l={};o.player&&(o.player.equipment&&(l.gear=bg(e,o.player.equipment,n)),(o.player?.talentsString||o.player?.glyphs)&&(l.talents=((e,t)=>{const a=[];return{name:e,data:t,enableWhen:a.length>0?e=>a.every(t=>t(e)):void 0}})(e,Dt.create({talentsString:o.player?.talentsString,glyphs:o.player?.glyphs}))),o.player?.rotation&&o.player?.rotation.type===Wt.TypeAPL&&(l.rotation=Cg(e,Ns.create({rotation:o.player.rotation}),n))),o.encounter&&(l.encounter=_g(e,o.encounter,o.player?.healingModel,o.tanks,o.targetDummies,n));const r=((e,t,a)=>{const i={name:e};return a.player?.race&&(i.race=a.player.race),a.player&&(i.specOptions=dt[t].optionsFromPlayer(a.player),a.player.buffs&&(i.buffs=a.player.buffs),a.player.consumables&&(i.consumables=a.player.consumables),i.playerOptions={reactionTimeMs:a.player.reactionTimeMs,channelClipDelayMs:a.player.channelClipDelayMs,inFrontOfTarget:a.player.inFrontOfTarget,distanceFromTarget:a.player.distanceFromTarget,enableItemSwap:a.player.enableItemSwap},a.player.profession1&&(i.playerOptions.profession1=a.player.profession1),a.player.profession2&&(i.playerOptions.profession2=a.player.profession2),a.player.itemSwap&&(i.playerOptions.itemSwap=a.player.itemSwap)),a.raidBuffs&&(i.raidBuffs=a.raidBuffs),a.partyBuffs&&(i.partyBuffs=a.partyBuffs),a.debuffs&&(i.debuffs=a.debuffs),i})(e,t,o);return(Object.keys(r).length>1||i)&&(l.settings={...r,...i}),o.epWeightsStats&&(l.epWeights=Ig(e,ke.fromProto(o.epWeightsStats),n)),Pg(e,{...l,...s})},Dg=(t,a,i)=>{const s=t.map(({condition:e,message:t})=>e(a)&&t).filter(e=>!!e);s.length&&new No({variant:"warning",body:e(l,null,s.map(t=>e("p",null,t))),delay:5e3*s.length,...i})};export{bp as $,bu as A,Io as B,Go as C,uu as D,Em as E,Cp as F,nd as G,wu as H,dl as I,Jm as J,Dg as K,du as L,Au as M,Sp as N,Mp as O,yg as P,Vp as Q,dd as R,Ku as S,gu as T,$m as U,pd as V,vp as W,fd as X,cd as Y,ad as Z,Ep as _,rp as a,kp as a0,yp as a1,xp as a2,Pp as a3,Tp as a4,Gp as a5,Rp as a6,zp as a7,Ip as a8,od as a9,Zm as aa,td as ab,id as ac,Co as ad,Iu as ae,fl as af,No as ag,Fp as ah,Wp as ai,kg as aj,zm as ak,vd as b,Uu as c,Do as d,Vm as e,ud as f,fg as g,cp as h,gd as i,Zu as j,xg as k,Eg as l,bg as m,vg as n,Rg as o,um as p,Pg as q,_g as r,Xu as s,tg as t,hu as u,fu as v,yu as w,Su as x,vu as y,pu as z};
