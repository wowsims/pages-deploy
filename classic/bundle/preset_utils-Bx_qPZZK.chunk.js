import{e,b9 as t,al as s,T as a,h as i,u as n,C as o,k as l,w as r,an as c,az as d,ba as h,bb as m,bc as u,s as p,z as g,Y as f,O as I,ap as w,f as b,bd as S,H as x,be as v,bf as y,x as E,aj as k,aa as P,bg as C,bh as T,aI as N,bi as _,i as R,bj as D,ao as A,bk as L,_ as V,bl as M,bm as U,bn as W,P as F,c as O,bo as q,bp as H,bq as B,aZ as z,S as j,br as $,bs as G,aD as K,bt as J,o as Z,bu as Y,bv as Q,bw as X,bx as ee,by as te,bz as se,bA as ae,Z as ie,y as ne,D as oe,bB as le,j as re,bC as ce,bD as de,b8 as he,bE as me,bF as ue,E as pe,ai as ge,am as fe,q as Ie,U as we,g as be,bG as Se,bH as xe,bI as ve,bJ as ye,bK as Ee,bL as ke,bM as Pe,bN as Ce,bO as Te,bP as Ne,bQ as _e,bR as Re,bS as De,bT as Ae,bU as Le,bV as Ve,bW as Me,bX as Ue,bY as We,bZ as Fe,b_ as Oe,F as qe,b$ as He,c0 as Be,c1 as ze,c2 as je,c3 as $e,c4 as Ge,c5 as Ke,c6 as Je,c7 as Ze,c8 as Ye,c9 as Qe,ca as Xe,cb as et,ak as tt,ae as st,cc as at,as as it,aC as nt,aV as ot,ac as lt,ad as rt,aO as ct,aU as dt,aP as ht,ar as mt,ay as ut,av as pt,ah as gt,ab as ft,ag as It,at as wt,au as bt,b0 as St,af as xt,cd as vt,ce as yt,cf as Et,aS as kt,cg as Pt,ch as Ct,ci as Tt,cj as Nt,ck as _t,cl as Rt,cm as Dt,cn as At,co as Lt,cp as Vt,cq as Mt,cr as Ut,cs as Wt,ct as Ft,cu as Ot,cv as qt,cw as Ht,cx as Bt,cy as zt,cz as jt,cA as $t,t as Gt,I as Kt,p as Jt,cB as Zt,cC as Yt,cD as Qt,cE as Xt,cF as es,cG as ts,cH as ss,cI as as,cJ as is,cK as ns,l as os,cL as ls,cM as rs,a as cs,cN as ds,cO as hs,cP as ms,cQ as us,cR as ps,cS as gs,cT as fs,cU as Is,cV as ws,a8 as bs,cW as Ss,a1 as xs,cX as vs,cY as ys,cZ as Es,c_ as ks,c$ as Ps,d0 as Cs,d1 as Ts,b as Ns,d2 as _s,d3 as Rs,d4 as Ds,d5 as As,d6 as Ls,d7 as Vs,d8 as Ms,d9 as Us,da as Ws,db as Fs,dc as Os,dd as qs,de as Hs,df as Bs,dg as zs,dh as js,di as $s,dj as Gs,dk as Ks,dl as Js,dm as Zs,dn as Ys,dp as Qs,dq as Xs,dr as ea,ds as ta,dt as sa,du as aa,dv as ia,dw as na,dx as oa,dy as la,dz as ra,dA as ca,dB as da,dC as ha,dD as ma,dE as ua,dF as pa,dG as ga,dH as fa,dI as Ia,dJ as wa,dK as ba,dL as Sa,dM as xa,dN as va,dO as ya,dP as Ea,dQ as ka,dR as Pa,dS as Ca,dT as Ta,dU as Na,dV as _a,dW as Ra,dX as Da,dY as Aa,dZ as La,d_ as Va,d$ as Ma,e0 as Ua,e1 as Wa,e2 as Fa,e3 as Oa,e4 as qa,e5 as Ha,e6 as Ba,e7 as za,e8 as ja,e9 as $a,ea as Ga,eb as Ka,ec as Ja,ed as Za,ee as Ya,A as Qa,ef as Xa,eg as ei,eh as ti,ei as si,ej as ai,ek as ii,el as ni,em as oi,en as li,eo as ri,ep as ci,eq as di,er as hi,es as mi,et as ui,eu as pi,ev as gi,ew as fi,ex as Ii,ey as wi,ez as bi,eA as Si,eB as xi,eC as vi,eD as yi,eE as Ei,eF as ki,eG as Pi,eH as Ci,eI as Ti,eJ as Ni,eK as _i,eL as Ri,eM as Di,r as Ai,eN as Li,eO as Vi,eP as Mi,a3 as Ui,eQ as Wi,eR as Fi,eS as Oi,a7 as qi,eT as Hi,eU as Bi,eV as zi,eW as ji,eX as $i,eY as Gi,eZ as Ki,a0 as Ji,Q as Zi,e_ as Yi,e$ as Qi,f0 as Xi,f1 as en,f2 as tn,f3 as sn,f4 as an,a4 as nn,f5 as on,f6 as ln,a5 as rn,f7 as cn,f8 as dn}from"./detailed_results-CJY9MGga.chunk.js";import{T as hn,t as mn,M as un,i as pn}from"./index-CsPe537V.chunk.js";class gn{constructor(e){const{title:t,variant:s,autoShow:a=!0,canClose:i=!0,body:n,additionalClasses:o,container:l,...r}=e||{};this.container=l||document.getElementById("toastContainer"),this.additionalClasses=o,this.title=t||"WoWSims",this.variant=s||"info",this.body=n,this.canClose=i,this.element=this.template(),this.container.appendChild(this.element),this.instance=hn.getOrCreateInstance(this.element,{delay:3e3,...r}),a&&this.instance.show(),this.element.addEventListener("hidden.bs.toast",(()=>{this.destroy()}))}destroy(){this.instance.dispose(),this.element.remove()}show(){this.instance.show()}hide(){this.instance.hide()}getVariantIcon(){switch(this.variant){case"info":return"fa-info-circle";case"success":return"fa-check-circle";case"error":return"fa-exclamation-circle";case"warning":return"fa-triangle-exclamation"}}template(){return e("div",{className:t("toast position-relative bottom-0 end-0",`toast--${this.variant}`,this.additionalClasses),attributes:{role:"alert","aria-live":"assertive","aria-atomic":"true"}},e("div",{className:"toast-header"},e("i",{className:`d-block fas fa-2xl me-2 ${this.getVariantIcon()}`}),e("strong",{className:"me-auto"},this.title),this.canClose&&e("a",{href:"javascript:void(0);",className:"btn-close",attributes:{role:"button","aria-label":"Close"},dataset:{bsDismiss:"toast"},"aria-label":"Close"},e("i",{className:`fas fa-times fa-1xl ${this.getVariantIcon()}`}))),e("div",{className:"toast-body"},this.body))}}var fn=(e=>(e[e.Gear=0]="Gear",e[e.Talents=1]="Talents",e[e.Rotation=2]="Rotation",e[e.Consumes=3]="Consumes",e[e.Miscellaneous=4]="Miscellaneous",e[e.External=5]="External",e[e.Encounter=6]="Encounter",e[e.UISettings=7]="UISettings",e))(fn||{});const In=(()=>{const e=new Map;return e.set(0,"g"),e.set(1,"t"),e.set(2,"r"),e.set(3,"c"),e.set(4,"m"),e.set(5,"x"),e.set(6,"e"),e.set(7,"u"),e})(),wn=5;class bn{constructor(e,t){this.buffs=s.create(),this.compChangeEmitter=new a,this.buffsChangeEmitter=new a,this.sim=t,this.raid=e,this.players=[...Array(5).keys()].map((e=>null)),this.playerChangeListener=e=>this.changeEmitter.emit(e),this.changeEmitter=a.onAny([this.compChangeEmitter,this.buffsChangeEmitter],"PartyChange")}size(){return this.players.filter((e=>null!=e)).length}isEmpty(){return 0==this.size()}clear(e){this.setBuffs(e,s.create());for(let t=0;t<5;t++)this.setPlayer(e,t,null)}getIndex(){return this.raid.getParties().indexOf(this)}getPlayers(){return this.players.slice()}getPlayer(e){return this.players[e]}setPlayer(e,t,s){if(t<0||t>=5)throw new Error("Invalid player index: "+t);s!=this.players[t]&&a.freezeAllAndDo((()=>{const a=this.players[t];if(null!=a&&(a.changeEmitter.off(this.playerChangeListener),a.setParty(null)),null!=s){const a=s.getParty();a&&a.setPlayer(e,s.getPartyIndex(),null),this.players[t]=s,s.changeEmitter.on(this.playerChangeListener),s.setParty(this)}else this.players[t]=null;this.compChangeEmitter.emit(e)}))}getBuffs(){return s.clone(this.buffs)}setBuffs(e,t){s.equals(this.buffs,t)||(this.buffs=s.clone(t),this.buffsChangeEmitter.emit(e))}toProto(e,t){return i.create({players:this.players.map((s=>null==s?n.create():s.toProto(e,t))),buffs:this.buffs})}fromProto(e,t){a.freezeAllAndDo((()=>{this.setBuffs(e,t.buffs||s.create());for(let s=0;s<5;s++){if(!t.players[s]||t.players[s].class==o.ClassUnknown){this.setPlayer(e,s,null);continue}const a=t.players[s],i=l(a),n=this.players[s];if(n&&i==n.spec)n.fromProto(e,a);else{const t=new $n(i,this.sim);t.fromProto(e,a),this.setPlayer(e,s,t)}}}))}}const Sn=r(c).length,xn=r(d).length;class vn{constructor(e,t){this.stat=e,this.pseudoStat=t}isStat(){return null!=this.stat}isPseudoStat(){return null!=this.pseudoStat}getStat(){if(!this.isStat())throw new Error("Not a stat!");return this.stat}getPseudoStat(){if(!this.isPseudoStat())throw new Error("Not a pseudo stat!");return this.pseudoStat}equals(e){return this.stat==e.stat&&this.pseudoStat==e.pseudoStat}getName(e){return this.isStat()?h(this.stat):m.get(this.pseudoStat)}getProtoValue(e){return this.isStat()?e.stats[this.stat]:e.pseudoStats[this.pseudoStat]}setProtoValue(e,t){this.isStat()?e.stats[this.stat]=t:e.pseudoStats[this.pseudoStat]=t}static fromStat(e){return new vn(e,null)}static fromPseudoStat(e){return new vn(null,e)}static getAll(){const e=r(c).filter((e=>![c.StatEnergy,c.StatRage].includes(e))),t=r(d);return[e.map((e=>vn.fromStat(e))),t.map((e=>vn.fromPseudoStat(e)))].flat()}}class yn{constructor(e,t){this.stats=yn.initStatsArray(Sn,e),this.pseudoStats=yn.initStatsArray(xn,t)}static initStatsArray(e,t){let s=t?.slice(0,e)||[];s.length<e&&(s=s.concat(new Array(e-(t?.length||0)).fill(0)));for(let a=0;a<e;a++)null==s[a]&&(s[a]=0);return s}equals(e){return this.stats.every(((t,s)=>t==e.getStat(s)))&&this.pseudoStats.every(((t,s)=>t==e.getPseudoStat(s)))}getStat(e){return this.stats[e]}getPseudoStat(e){return this.pseudoStats[e]}getUnitStat(e){return e.isStat()?this.stats[e.getStat()]:this.pseudoStats[e.getPseudoStat()]}withStat(e,t){const s=this.stats.slice();return s[e]=t,new yn(s,this.pseudoStats)}withPseudoStat(e,t){const s=this.pseudoStats.slice();return s[e]=t,new yn(this.stats,s)}withUnitStat(e,t){return e.isStat()?this.withStat(e.getStat(),t):this.withPseudoStat(e.getPseudoStat(),t)}addStat(e,t){return this.withStat(e,this.getStat(e)+t)}addPseudoStat(e,t){return this.withPseudoStat(e,this.getPseudoStat(e)+t)}add(e){return new yn(this.stats.map(((t,s)=>t+e.stats[s])),this.pseudoStats.map(((t,s)=>t+e.pseudoStats[s])))}subtract(e){return new yn(this.stats.map(((t,s)=>t-e.stats[s])),this.pseudoStats.map(((t,s)=>t-e.pseudoStats[s])))}scale(e){return new yn(this.stats.map(((t,s)=>t*e)),this.pseudoStats.map(((t,s)=>t*e)))}computeEP(e){let t=0;return this.stats.forEach(((s,a)=>{t+=s*e.stats[a]})),this.pseudoStats.forEach(((s,a)=>{t+=s*e.pseudoStats[a]})),t}belowCaps(e){for(const[t,s]of this.stats.entries())if(e.stats[t]>0&&s>e.stats[t])return!1;return!0}asArray(){return this.stats.slice()}toJson(){return u.toJson(this.toProto())}toProto(){return u.create({stats:this.stats.slice(),pseudoStats:this.pseudoStats.slice()})}static fromJson(e){return yn.fromProto(u.fromJson(e))}static fromMap(e,t){const s=new Array(Sn).fill(0);Object.entries(e).forEach((e=>{const[t,a]=e;s[Number(t)]=a}));const a=new Array(xn).fill(0);return t&&Object.entries(t).forEach((e=>{const[t,s]=e;a[Number(t)]=s})),new yn(s,a)}static fromProto(e){return e?new yn(e.stats,e.pseudoStats):new yn}}class En extends p{constructor(t,s){const a=g();super(t,"copy-button",e("button",{className:`btn ${s.extraCssClasses?.join(" ")??""}`,ref:a},e("i",{className:"fas fa-copy me-1"}),s.text??"Copy to Clipboard")),this.config=s;const i=a.value;let n=!1;i.addEventListener("click",(()=>{if(n)return;const e=this.config.getContent();if(null==navigator.clipboard)alert(e);else{n=!0,navigator.clipboard.writeText(e);const t=i.innerHTML;i.innerHTML='<i class="fas fa-check me-1"></i>Copied',setTimeout((()=>{i.innerHTML=t,n=!1}),1500)}})),s.tooltip&&mn(i,{content:s.tooltip})}}class kn extends f{constructor(t,s,i){super(t,"talents-picker-root",s,i),this.config=i,this.pointsPerRow=i.pointsPerRow,this.numRows=Math.max(...i.trees.map((e=>e.talents.map((e=>e.location.rowIdx)).flat())).flat())+1,this.numCols=Math.max(...i.trees.map((e=>e.talents.map((e=>e.location.colIdx)).flat())).flat())+1;const n=()=>v;this.maxPoints=n();const o=()=>this.maxPoints-s.getTalentTreePoints().reduce(((e,t)=>e+t),0),l=g(),r=g(),c=g(),d=g(),h=g();this.rootElem.appendChild(e("div",{className:"talents-picker-inner"},e("div",{className:"talents-picker-header"},e("div",{className:"d-flex"},e("label",null,"Points Remaining:",e("span",{ref:l},o()))),e("div",{className:"talents-picker-actions",ref:r})),e("div",{id:"talents-carousel",className:"carousel slide"},e("div",{className:"carousel-inner",ref:c}),e("button",{className:"carousel-control-prev",type:"button",ref:d},e("span",{className:"carousel-control-prev-icon",attributes:{"aria-hidden":!0}}),e("span",{className:"visually-hidden"},"Previous")),e("button",{className:"carousel-control-next",type:"button",ref:h},e("span",{className:"carousel-control-next-icon",attributes:{"aria-hidden":!0}}),e("span",{className:"visually-hidden"},"Next")))));const m=c.value,u=d.value,p=h.value;a.onAny([s.talentsChangeEmitter]).on((()=>{this.setMaxPoints(n()),l.value.textContent=`${o()}`})),new En(r.value,{extraCssClasses:["btn-sm","btn-outline-primary","copy-talents"],getContent:()=>s.getTalentsString(),text:"Copy",tooltip:"Copy talent string"}),this.trees=i.trees.map(((e,t)=>{const s=document.createElement("div");return m.appendChild(s),s.classList.add("carousel-item"),1===t&&s.classList.add("active"),new Pn(s,e,this,i.klass,t)})),this.trees.forEach((e=>e.talents.forEach((e=>e.setPoints(0,!1)))));let f=0;u.addEventListener("click",(()=>{f>=1||(f+=1,m.style.transform=`translateX(${33.3*f}%)`,m.children[Math.abs(f-2)%3].classList.remove("active"),m.children[Math.abs(f-1)%3].classList.add("active"))})),p.addEventListener("click",(()=>{f<=-1||(f-=1,m.style.transform=`translateX(${33.3*f}%)`,m.children[Math.abs(f)%3].classList.remove("active"),m.children[Math.abs(f)+1].classList.add("active"))})),this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.trees.map((e=>e.getTalentsString())).join("-").replace(/-+$/g,"")}setInputValue(e){const t=e.split("-");this.trees.forEach(((e,s)=>e.setTalentsString(t[s]||""))),this.updateTrees()}updateTrees(){this.isFull()?this.rootElem.classList.add("talents-full"):this.rootElem.classList.remove("talents-full"),this.trees.forEach((e=>e.update()))}get numPoints(){return I(this.trees.map((e=>e.numPoints)))}isFull(){return this.numPoints>=this.maxPoints}setMaxPoints(e){e!=this.maxPoints&&(this.maxPoints=e,this.updateTrees())}}class Pn extends p{constructor(t,s,i,n,o){super(t,"talent-tree-picker-root"),this.config=s,this.numPoints=0,this.picker=i,this.rootElem.appendChild(e(b,null,e("div",{className:"talent-tree-header"},e("img",{src:w(n,o),className:"talent-tree-icon"}),e("span",{className:"talent-tree-title"}),e("label",{className:"talent-tree-points"}),e("button",{className:"talent-tree-reset btn link-danger"},e("i",{className:"fa fa-times"}))),e("div",{className:"talent-tree-background"}),e("div",{className:"talent-tree-main"}))),this.title=this.rootElem.getElementsByClassName("talent-tree-title")[0],this.pointsElem=this.rootElem.querySelector(".talent-tree-points");this.rootElem.querySelector(".talent-tree-background").style.backgroundImage=`url('${s.backgroundUrl}')`;const l=this.rootElem.querySelector(".talent-tree-main");l.style.gridTemplateRows=`repeat(${this.picker.numRows}, 1fr)`,l.style.gridTemplateColumns=`repeat(${this.picker.numCols}, 1fr)`;const r="3.5rem";l.style.height=`calc(${r} * ${this.picker.numRows})`,l.style.maxWidth=`calc(${r} * ${this.picker.numCols})`,this.rootElem.style.maxWidth=`calc(${r} * ${this.picker.numCols+2})`,this.talents=s.talents.map((e=>new Tn(l,e,this))),this.talents.forEach((e=>{e.config.prereqLocation&&this.getTalent(e.config.prereqLocation).config.childLocations.push(e.config.location)}));const c=(e,t)=>{e.initChildReqs(),e.zIndex=t;for(const s of e.config.childLocations){const a=this.getTalent(s);a.parentReq=e.getChildReqArrow(s),c(a,t-2)}};for(const e of this.talents)0!=e.config.childLocations.length&&void 0===e.config.prereqLocation&&c(e,20);const d=this.rootElem.querySelector(".talent-tree-reset");mn(d,{content:"Reset talent points"}),d.addEventListener("click",(e=>{this.talents.forEach((e=>e.setPoints(0,!1))),this.picker.inputChanged(a.nextEventID())}))}update(){this.title.innerHTML=this.config.name,this.pointsElem.textContent=`${this.numPoints} / ${this.getMaxSpendablePoints()}`,this.talents.forEach((e=>e.update()))}getTalent(e){const t=this.talents.find((t=>t.getRow()==e.rowIdx&&t.getCol()==e.colIdx));if(!t)throw new Error("No talent found with location: "+e);return t}getTalentsString(){return this.talents.map((e=>String(e.getPoints()))).join("").replace(/0+$/g,"")}setTalentsString(e){this.talents.forEach(((t,s)=>t.setPoints(Number(e.charAt(s)),!1)))}getMaxSpendablePoints(){return this.picker.maxPoints}}class Cn extends p{constructor(t,s,a){super(t,"talent-picker-req-arrow",document.createElement("div")),this.zIdx=0,this.parentLoc=s,this.childLoc=a,this.rootElem.style.gridRow=String(s.rowIdx+1),this.rootElem.style.gridColumn=String(s.colIdx+1);let i=Math.max(s.rowIdx,a.rowIdx)+1,n=Math.max(s.colIdx,a.colIdx)+1;s.rowIdx==a.rowIdx?(this.dir=s.colIdx<a.colIdx?"right":"left",this.rootElem.dataset.reqArrowColSize=String(Math.abs(s.colIdx-a.colIdx)),n="left"==this.dir?n+1:n-1):s.colIdx==a.colIdx?(this.dir="down",this.rootElem.dataset.reqArrowRowSize=String(Math.abs(s.rowIdx-a.rowIdx)),i+=1):(this.dir=s.colIdx<a.colIdx?"rightdown":"leftdown",this.rootElem.dataset.reqArrowColSize=String(Math.abs(s.colIdx-a.colIdx)),this.rootElem.dataset.reqArrowRowSize=String(Math.abs(s.rowIdx-a.rowIdx)),i+=1,n="rightdown"==this.dir?n+1:n-1,this.rootElem.appendChild(e("div",null))),this.rootElem.style.gridRowEnd=String(i),this.rootElem.style.gridColumnEnd=String(n),this.rootElem.classList.add(`talent-picker-req-arrow-${this.dir}`)}get zIndex(){return this.zIdx}set zIndex(e){this.zIdx=e,this.rootElem.style.zIndex=String(e)}setReqFufilled(e){e?this.rootElem.dataset.reqActive="true":delete this.rootElem.dataset.reqActive}}class Tn extends p{constructor(e,t,s){super(e,"talent-picker-root",document.createElement("a")),this.config=t,this.tree=s,this.childReqs=[],this.parentReq=null,this.zIdx=0,this.rootElem.style.gridRow=String(this.config.location.rowIdx+1),this.rootElem.style.gridColumn=String(this.config.location.colIdx+1),this.rootElem.dataset.maxPoints=String(this.config.maxPoints),this.rootElem.dataset.whtticon="false",this.pointsDisplay=document.createElement("span"),this.pointsDisplay.classList.add("talent-picker-points"),this.rootElem.appendChild(this.pointsDisplay),this.rootElem.addEventListener("click",(e=>{e.preventDefault()})),this.rootElem.addEventListener("contextmenu",(e=>{e.preventDefault()})),this.rootElem.addEventListener("touchmove",(e=>{null!=this.longTouchTimer&&(clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0)})),this.rootElem.addEventListener("touchstart",(e=>{e.preventDefault(),this.longTouchTimer=window.setTimeout((()=>{this.setPoints(0,!0),this.tree.picker.inputChanged(a.nextEventID()),this.longTouchTimer=void 0}),750)})),this.rootElem.addEventListener("touchend",(e=>{if(e.preventDefault(),null==this.longTouchTimer)return;clearTimeout(this.longTouchTimer),this.longTouchTimer=void 0;let t=this.getPoints()+1;this.config.maxPoints<t&&(t=0),this.setPoints(t,!0),this.tree.picker.inputChanged(a.nextEventID())})),this.rootElem.addEventListener("mousedown",(e=>{S(e)?this.setPoints(this.getPoints()-1,!0):this.setPoints(this.getPoints()+1,!0),this.tree.picker.inputChanged(a.nextEventID())}))}initChildReqs(){if(0!=this.config.childLocations.length)for(const e of this.config.childLocations)this.childReqs.push(new Cn(this.rootElem.parentElement,this.config.location,e))}getChildReqArrow(e){for(const t of this.childReqs)if(t.childLoc===e)return t;throw Error("missing child prereq?")}get zIndex(){return this.zIdx}set zIndex(e){this.zIdx=e,this.rootElem.style.zIndex=String(this.zIdx);for(const t of this.childReqs)t.zIndex=this.zIdx-1}getRow(){return this.config.location.rowIdx}getCol(){return this.config.location.colIdx}getPoints(){const e=Number(this.rootElem.dataset.points);return isNaN(e)?0:e}isFull(){return this.getPoints()>=this.config.maxPoints}canSetPoints(e){const t=this.getPoints();if(e>t){const s=e-t;if(this.tree.picker.numPoints+s>this.tree.picker.maxPoints)return!1;if(this.tree.numPoints<this.getRow()*this.tree.picker.pointsPerRow)return!1;if(this.config.prereqLocation&&!this.tree.getTalent(this.config.prereqLocation).isFull())return!1}else{const s=t-e,a=[...Array(this.tree.picker.numRows).keys()].map((e=>this.tree.talents.filter((t=>t.getRow()==e)))).map((e=>I(e.map((e=>e.getPoints())))));a[this.getRow()]-=s;const i=a.map(((e,t)=>I(a.slice(0,t+1))));if(!this.tree.talents.every((e=>0==e.getPoints()||0==e.getRow()||i[e.getRow()-1]>=e.getRow()*this.tree.picker.pointsPerRow)))return!1;for(const e of this.config.childLocations)if(this.tree.getTalent(e).getPoints()>0)return!1}return!0}setPoints(e,t){const s=this.getPoints();if(e=Math.max(0,e),e=Math.min(this.config.maxPoints,e),t&&!this.canSetPoints(e))return;this.tree.numPoints+=e-s,this.rootElem.dataset.points=String(e),this.pointsDisplay.textContent=e+"/"+this.config.maxPoints,this.isFull()?this.rootElem.classList.add("talent-full"):this.rootElem.classList.remove("talent-full");const a=this.getSpellIdForPoints(e);x.fromSpellId(a).fill().then((e=>{e.setWowheadHref(this.rootElem),this.rootElem.style.backgroundImage=`url('${e.iconUrl}')`}))}getSpellIdForPoints(e){const t=Math.max(0,e-1);if(this.config.spellIds[t])return this.config.spellIds[t];throw new Error(`No rank ${e} for talent ${String(this.config.fieldName)}`)}update(){const e=this.canSetPoints(this.getPoints()+1);e?this.rootElem.classList.add("talent-picker-can-add"):this.rootElem.classList.remove("talent-picker-can-add"),this.parentReq&&this.parentReq.setReqFufilled(e||this.isFull())}}function Nn(e){return e.forEach((e=>{e.talents.forEach(((t,s)=>{if(t.childLocations=[],0!=s){const a=e.talents[s-1];if(t.location.rowIdx<a.location.rowIdx||t.location.rowIdx==a.location.rowIdx&&t.location.colIdx<=a.location.colIdx)throw new Error(`Out-of-order talent: ${String(t.fieldName)}`)}if(t.spellIds.length<t.maxPoints){let e=t.spellIds[t.spellIds.length-1];for(let s=t.spellIds.length;s<t.maxPoints;s++)e++,t.spellIds.push(e)}}))})),e}const _n=Nn([{name:"Balance",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/283.jpg",talents:[{fieldName:"improvedWrath",location:{rowIdx:0,colIdx:0},spellIds:[16814,16815,16816,16817,16818],maxPoints:5},{fieldName:"naturesGrasp",location:{rowIdx:0,colIdx:1},spellIds:[16689],maxPoints:1},{fieldName:"improvedNaturesGrasp",location:{rowIdx:0,colIdx:2},spellIds:[17245,17247,17248,17249],maxPoints:4,prereqLocation:{rowIdx:0,colIdx:1}},{fieldName:"improvedEntanglingRoots",location:{rowIdx:1,colIdx:0},spellIds:[16918,16919,16920],maxPoints:3},{fieldName:"improvedMoonfire",location:{rowIdx:1,colIdx:1},spellIds:[16821,16822,16823,16824,16825],maxPoints:5},{fieldName:"naturalWeapons",location:{rowIdx:1,colIdx:2},spellIds:[16902,16903,16904,16905,16906],maxPoints:5},{fieldName:"naturalShapeshifter",location:{rowIdx:1,colIdx:3},spellIds:[16833,16834,16835],maxPoints:3},{fieldName:"improvedThorns",location:{rowIdx:2,colIdx:0},spellIds:[16836,16839,16840],maxPoints:3},{fieldName:"omenOfClarity",location:{rowIdx:2,colIdx:2},spellIds:[16864],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"naturesReach",location:{rowIdx:2,colIdx:3},spellIds:[16819,16820],maxPoints:2},{fieldName:"vengeance",location:{rowIdx:3,colIdx:1},spellIds:[16909,16910,16911,16912,16913],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"improvedStarfire",location:{rowIdx:3,colIdx:2},spellIds:[16850,16923,16924,16925,16926],maxPoints:5},{fieldName:"naturesGrace",location:{rowIdx:4,colIdx:1},spellIds:[16880],maxPoints:1},{fieldName:"moonglow",location:{rowIdx:4,colIdx:2},spellIds:[16845,16846,16847],maxPoints:3},{fieldName:"moonfury",location:{rowIdx:5,colIdx:1},spellIds:[16896,16897,16899,16900,16901],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"moonkinForm",location:{rowIdx:6,colIdx:1},spellIds:[24858],maxPoints:1}]},{name:"Feral Combat",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/281.jpg",talents:[{fieldName:"ferocity",location:{rowIdx:0,colIdx:1},spellIds:[16934,16935,16936,16937,16938],maxPoints:5},{fieldName:"feralAggression",location:{rowIdx:0,colIdx:2},spellIds:[16858,16859,16860,16861,16862],maxPoints:5},{fieldName:"feralInstinct",location:{rowIdx:1,colIdx:0},spellIds:[16947,16948,16949,16950,16951],maxPoints:5},{fieldName:"brutalImpact",location:{rowIdx:1,colIdx:1},spellIds:[16940,16941],maxPoints:2},{fieldName:"thickHide",location:{rowIdx:1,colIdx:2},spellIds:[16929,16930,16931,16932,16933],maxPoints:5},{fieldName:"felineSwiftness",location:{rowIdx:2,colIdx:0},spellIds:[17002,24866],maxPoints:2},{fieldName:"feralCharge",location:{rowIdx:2,colIdx:1},spellIds:[16979],maxPoints:1},{fieldName:"sharpenedClaws",location:{rowIdx:2,colIdx:2},spellIds:[16942,16943,16944],maxPoints:3},{fieldName:"improvedShred",location:{rowIdx:3,colIdx:0},spellIds:[16966,16968],maxPoints:2},{fieldName:"predatoryStrikes",location:{rowIdx:3,colIdx:1},spellIds:[16972,16974,16975],maxPoints:3},{fieldName:"bloodFrenzy",location:{rowIdx:3,colIdx:2},spellIds:[16952,16954],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"primalFury",location:{rowIdx:3,colIdx:3},spellIds:[16958,16961],maxPoints:2},{fieldName:"savageFury",location:{rowIdx:4,colIdx:0},spellIds:[16998,16999],maxPoints:2},{fieldName:"faerieFireFeral",location:{rowIdx:4,colIdx:2},spellIds:[16857],maxPoints:1},{fieldName:"heartOfTheWild",location:{rowIdx:5,colIdx:1},spellIds:[17003,17004,17005,17006,24894],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"leaderOfThePack",location:{rowIdx:6,colIdx:1},spellIds:[17007],maxPoints:1}]},{name:"Restoration",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/282.jpg",talents:[{fieldName:"improvedMarkOfTheWild",location:{rowIdx:0,colIdx:1},spellIds:[17050,17051,17053,17054,17055],maxPoints:5},{fieldName:"furor",location:{rowIdx:0,colIdx:2},spellIds:[17056,17058,17059,17060,17061],maxPoints:5},{fieldName:"improvedHealingTouch",location:{rowIdx:1,colIdx:0},spellIds:[17069,17070,17071,17072,17073],maxPoints:5},{fieldName:"naturesFocus",location:{rowIdx:1,colIdx:1},spellIds:[17063,17065,17066,17067,17068],maxPoints:5},{fieldName:"improvedEnrage",location:{rowIdx:1,colIdx:2},spellIds:[17079,17082],maxPoints:2},{fieldName:"reflection",location:{rowIdx:2,colIdx:1},spellIds:[17106,17107,17108],maxPoints:3},{fieldName:"insectSwarm",location:{rowIdx:2,colIdx:2},spellIds:[5570],maxPoints:1},{fieldName:"subtlety",location:{rowIdx:2,colIdx:3},spellIds:[17118,17119,17120,17121,17122],maxPoints:5},{fieldName:"tranquilSpirit",location:{rowIdx:3,colIdx:1},spellIds:[24968,24969,24970,24971,24972],maxPoints:5},{fieldName:"improvedRejuvenation",location:{rowIdx:3,colIdx:3},spellIds:[17111,17112,17113],maxPoints:3},{fieldName:"naturesSwiftness",location:{rowIdx:4,colIdx:0},spellIds:[17116],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:0}},{fieldName:"giftOfNature",location:{rowIdx:4,colIdx:2},spellIds:[17104,24943,24944,24945,24946],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"improvedTranquility",location:{rowIdx:4,colIdx:3},spellIds:[17123,17124],maxPoints:2},{fieldName:"improvedRegrowth",location:{rowIdx:5,colIdx:2},spellIds:[17074,17075,17076,17077,17078],maxPoints:5},{fieldName:"swiftmend",location:{rowIdx:6,colIdx:1},spellIds:[18562],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}}]}]),Rn=Nn([{name:"Beast Mastery",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/361.jpg",talents:[{fieldName:"improvedAspectOfTheHawk",location:{rowIdx:0,colIdx:1},spellIds:[19552,19553,19554,19555,19556],maxPoints:5},{fieldName:"enduranceTraining",location:{rowIdx:0,colIdx:2},spellIds:[19583,19584,19585,19586,19587],maxPoints:5},{fieldName:"improvedEyesOfTheBeast",location:{rowIdx:1,colIdx:0},spellIds:[19557,19558],maxPoints:2},{fieldName:"improvedAspectOfTheMonkey",location:{rowIdx:1,colIdx:1},spellIds:[19549,19550,19551,24386,24387],maxPoints:5},{fieldName:"thickHide",location:{rowIdx:1,colIdx:2},spellIds:[19609,19610,19612],maxPoints:3},{fieldName:"improvedRevivePet",location:{rowIdx:1,colIdx:3},spellIds:[24443,19575],maxPoints:2},{fieldName:"pathfinding",location:{rowIdx:2,colIdx:0},spellIds:[19559,19560],maxPoints:2},{fieldName:"bestialSwiftness",location:{rowIdx:2,colIdx:1},spellIds:[19596],maxPoints:1},{fieldName:"unleashedFury",location:{rowIdx:2,colIdx:2},spellIds:[19616,19617,19618,19619,19620],maxPoints:5},{fieldName:"improvedMendPet",location:{rowIdx:3,colIdx:1},spellIds:[19572,19573],maxPoints:2},{fieldName:"ferocity",location:{rowIdx:3,colIdx:2},spellIds:[19598,19599,19600,19601,19602],maxPoints:5},{fieldName:"spiritBond",location:{rowIdx:4,colIdx:0},spellIds:[19578,20895],maxPoints:2},{fieldName:"intimidation",location:{rowIdx:4,colIdx:1},spellIds:[19577],maxPoints:1},{fieldName:"bestialDiscipline",location:{rowIdx:4,colIdx:3},spellIds:[19590,19592],maxPoints:2},{fieldName:"frenzy",location:{rowIdx:5,colIdx:2},spellIds:[19621,19622,19623,19624,19625],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"bestialWrath",location:{rowIdx:6,colIdx:1},spellIds:[19574],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Marksmanship",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/363.jpg",talents:[{fieldName:"improvedConcussiveShot",location:{rowIdx:0,colIdx:1},spellIds:[19407,19412,19413,19414,19415],maxPoints:5},{fieldName:"efficiency",location:{rowIdx:0,colIdx:2},spellIds:[19416,19417,19418,19419,19420],maxPoints:5},{fieldName:"improvedHuntersMark",location:{rowIdx:1,colIdx:1},spellIds:[19421,19422,19423,19424,19425],maxPoints:5},{fieldName:"lethalShots",location:{rowIdx:1,colIdx:2},spellIds:[19426,19427,19429,19430,19431],maxPoints:5},{fieldName:"aimedShot",location:{rowIdx:2,colIdx:0},spellIds:[19434],maxPoints:1},{fieldName:"improvedArcaneShot",location:{rowIdx:2,colIdx:1},spellIds:[19454,19455,19456,19457,19458],maxPoints:5},{fieldName:"hawkEye",location:{rowIdx:2,colIdx:3},spellIds:[19498,19499,19500],maxPoints:3},{fieldName:"improvedSerpentSting",location:{rowIdx:3,colIdx:1},spellIds:[19464,19465,19466,19467,19468],maxPoints:5},{fieldName:"mortalShots",location:{rowIdx:3,colIdx:2},spellIds:[19485,19487,19488,19489,19490],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"scatterShot",location:{rowIdx:4,colIdx:0},spellIds:[19503],maxPoints:1},{fieldName:"barrage",location:{rowIdx:4,colIdx:1},spellIds:[19461,19462,24691],maxPoints:3},{fieldName:"improvedScorpidSting",location:{rowIdx:4,colIdx:2},spellIds:[19491,19493,19494],maxPoints:3},{fieldName:"rangedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[19507,19508,19509,19510,19511],maxPoints:5},{fieldName:"trueshotAura",location:{rowIdx:6,colIdx:1},spellIds:[19506],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Survival",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/362.jpg",talents:[{fieldName:"monsterSlaying",location:{rowIdx:0,colIdx:0},spellIds:[24293,24294,24295],maxPoints:3},{fieldName:"humanoidSlaying",location:{rowIdx:0,colIdx:1},spellIds:[19151,19152,19153],maxPoints:3},{fieldName:"deflection",location:{rowIdx:0,colIdx:2},spellIds:[19295,19297,19298,19300,19301],maxPoints:5},{fieldName:"entrapment",location:{rowIdx:1,colIdx:0},spellIds:[19184,19387,19388,19389,19390],maxPoints:5},{fieldName:"savageStrikes",location:{rowIdx:1,colIdx:1},spellIds:[19159,19160],maxPoints:2},{fieldName:"improvedWingClip",location:{rowIdx:1,colIdx:2},spellIds:[19228,19232,19233,19234,19235],maxPoints:5},{fieldName:"cleverTraps",location:{rowIdx:2,colIdx:0},spellIds:[19239,19245],maxPoints:2},{fieldName:"survivalist",location:{rowIdx:2,colIdx:1},spellIds:[19255,19256,19257,19258,19259],maxPoints:5},{fieldName:"deterrence",location:{rowIdx:2,colIdx:2},spellIds:[19263],maxPoints:1},{fieldName:"trapMastery",location:{rowIdx:3,colIdx:0},spellIds:[19376,19377],maxPoints:2},{fieldName:"surefooted",location:{rowIdx:3,colIdx:1},spellIds:[19290,19294,24283],maxPoints:3},{fieldName:"improvedFeignDeath",location:{rowIdx:3,colIdx:3},spellIds:[19286,19287],maxPoints:2},{fieldName:"killerInstinct",location:{rowIdx:4,colIdx:1},spellIds:[19370,19371,19373],maxPoints:3},{fieldName:"counterattack",location:{rowIdx:4,colIdx:2},spellIds:[19306],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"lightningReflexes",location:{rowIdx:5,colIdx:2},spellIds:[19168,19180,19181,24296,24297],maxPoints:5},{fieldName:"wyvernSting",location:{rowIdx:6,colIdx:1},spellIds:[19386],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Dn=Nn([{name:"Arcane",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/81.jpg",talents:[{fieldName:"arcaneSubtlety",location:{rowIdx:0,colIdx:0},spellIds:[11210,12592],maxPoints:2},{fieldName:"arcaneFocus",location:{rowIdx:0,colIdx:1},spellIds:[11222,12839,12840,12841,12842],maxPoints:5},{fieldName:"improvedArcaneMissiles",location:{rowIdx:0,colIdx:2},spellIds:[11237,12463,12464,16769,16770],maxPoints:5},{fieldName:"wandSpecialization",location:{rowIdx:1,colIdx:0},spellIds:[6057,6085],maxPoints:2},{fieldName:"magicAbsorption",location:{rowIdx:1,colIdx:1},spellIds:[29441,29444,29445,29446,29447],maxPoints:5},{fieldName:"arcaneConcentration",location:{rowIdx:1,colIdx:2},spellIds:[11213,12574,12575,12576,12577],maxPoints:5},{fieldName:"magicAttunement",location:{rowIdx:2,colIdx:0},spellIds:[11247,12606],maxPoints:2},{fieldName:"improvedArcaneExplosion",location:{rowIdx:2,colIdx:1},spellIds:[11242,12467,12469],maxPoints:3},{fieldName:"arcaneResilience",location:{rowIdx:2,colIdx:2},spellIds:[28574],maxPoints:1},{fieldName:"improvedManaShield",location:{rowIdx:3,colIdx:0},spellIds:[11252,12605],maxPoints:2},{fieldName:"improvedCounterspell",location:{rowIdx:3,colIdx:1},spellIds:[11255,12598],maxPoints:2},{fieldName:"arcaneMeditation",location:{rowIdx:3,colIdx:3},spellIds:[18462,18463,18464],maxPoints:3},{fieldName:"presenceOfMind",location:{rowIdx:4,colIdx:1},spellIds:[12043],maxPoints:1},{fieldName:"arcaneMind",location:{rowIdx:4,colIdx:2},spellIds:[11232,12500,12501,12502,12503],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"arcaneInstability",location:{rowIdx:5,colIdx:1},spellIds:[15058,15059,15060],maxPoints:3,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"arcanePower",location:{rowIdx:6,colIdx:1},spellIds:[12042],maxPoints:1,prereqLocation:{rowIdx:5,colIdx:1}}]},{name:"Fire",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/41.jpg",talents:[{fieldName:"improvedFireball",location:{rowIdx:0,colIdx:1},spellIds:[11069,12338,12339,12340,12341],maxPoints:5},{fieldName:"impact",location:{rowIdx:0,colIdx:2},spellIds:[11103,12357,12358,12359,12360],maxPoints:5},{fieldName:"ignite",location:{rowIdx:1,colIdx:0},spellIds:[11119,11120,12846,12847,12848],maxPoints:5},{fieldName:"flameThrowing",location:{rowIdx:1,colIdx:1},spellIds:[11100,12353],maxPoints:2},{fieldName:"improvedFireBlast",location:{rowIdx:1,colIdx:2},spellIds:[11078,11080,12342],maxPoints:3},{fieldName:"incinerate",location:{rowIdx:2,colIdx:0},spellIds:[18459,18460],maxPoints:2},{fieldName:"improvedFlamestrike",location:{rowIdx:2,colIdx:1},spellIds:[11108,12349,12350],maxPoints:3},{fieldName:"pyroblast",location:{rowIdx:2,colIdx:2},spellIds:[11366],maxPoints:1},{fieldName:"burningSoul",location:{rowIdx:2,colIdx:3},spellIds:[11083,12351],maxPoints:2},{fieldName:"improvedScorch",location:{rowIdx:3,colIdx:0},spellIds:[11095,12872,12873],maxPoints:3},{fieldName:"improvedFireWard",location:{rowIdx:3,colIdx:1},spellIds:[11094,13043],maxPoints:2},{fieldName:"masterOfElements",location:{rowIdx:3,colIdx:3},spellIds:[29074,29075,29076],maxPoints:3},{fieldName:"criticalMass",location:{rowIdx:4,colIdx:1},spellIds:[11115,11367,11368],maxPoints:3},{fieldName:"blastWave",location:{rowIdx:4,colIdx:2},spellIds:[11113],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"firePower",location:{rowIdx:5,colIdx:2},spellIds:[11124,12378,12398,12399,12400],maxPoints:5},{fieldName:"combustion",location:{rowIdx:6,colIdx:1},spellIds:[11129],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Frost",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/61.jpg",talents:[{fieldName:"frostWarding",location:{rowIdx:0,colIdx:0},spellIds:[11189,28332],maxPoints:2},{fieldName:"improvedFrostbolt",location:{rowIdx:0,colIdx:1},spellIds:[11070,12473,16763,16765,16766],maxPoints:5},{fieldName:"elementalPrecision",location:{rowIdx:0,colIdx:2},spellIds:[29438,29439,29440],maxPoints:3},{fieldName:"iceShards",location:{rowIdx:1,colIdx:0},spellIds:[11207,12672,15047,15052,15053],maxPoints:5},{fieldName:"frostbite",location:{rowIdx:1,colIdx:1},spellIds:[11071,12496,12497],maxPoints:3},{fieldName:"improvedFrostNova",location:{rowIdx:1,colIdx:2},spellIds:[11165,12475],maxPoints:2},{fieldName:"permafrost",location:{rowIdx:1,colIdx:3},spellIds:[11175,12569,12571],maxPoints:3},{fieldName:"piercingIce",location:{rowIdx:2,colIdx:0},spellIds:[11151,12952,12953],maxPoints:3},{fieldName:"coldSnap",location:{rowIdx:2,colIdx:1},spellIds:[12472],maxPoints:1},{fieldName:"improvedBlizzard",location:{rowIdx:2,colIdx:3},spellIds:[11185,12487,12488],maxPoints:3},{fieldName:"arcticReach",location:{rowIdx:3,colIdx:0},spellIds:[16757,16758],maxPoints:2},{fieldName:"frostChanneling",location:{rowIdx:3,colIdx:1},spellIds:[11160,12518,12519],maxPoints:3},{fieldName:"shatter",location:{rowIdx:3,colIdx:2},spellIds:[11170,12982,12983,12984,12985],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"iceBlock",location:{rowIdx:4,colIdx:1},spellIds:[11958],maxPoints:1},{fieldName:"improvedConeOfCold",location:{rowIdx:4,colIdx:2},spellIds:[11190,12489,12490],maxPoints:3},{fieldName:"wintersChill",location:{rowIdx:5,colIdx:2},spellIds:[11180,28592,28593,28594,28595],maxPoints:5},{fieldName:"iceBarrier",location:{rowIdx:6,colIdx:1},spellIds:[11426],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),An=Nn([{name:"Holy",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/382.jpg",talents:[{fieldName:"divineStrength",location:{rowIdx:0,colIdx:1},spellIds:[20262,20263,20264,20265,20266],maxPoints:5},{fieldName:"divineIntellect",location:{rowIdx:0,colIdx:2},spellIds:[20257,20258,20259,20260,20261],maxPoints:5},{fieldName:"spiritualFocus",location:{rowIdx:1,colIdx:1},spellIds:[20205,20206,20207,20208,20209],maxPoints:5},{fieldName:"improvedSealOfRighteousness",location:{rowIdx:1,colIdx:2},spellIds:[20224,20225,20330,20331,20332],maxPoints:5},{fieldName:"healingLight",location:{rowIdx:2,colIdx:0},spellIds:[20237,20238,20239],maxPoints:3},{fieldName:"consecration",location:{rowIdx:2,colIdx:1},spellIds:[26573],maxPoints:1},{fieldName:"improvedLayOnHands",location:{rowIdx:2,colIdx:2},spellIds:[20234,20235],maxPoints:2},{fieldName:"unyieldingFaith",location:{rowIdx:2,colIdx:3},spellIds:[9453,25836],maxPoints:2},{fieldName:"illumination",location:{rowIdx:3,colIdx:1},spellIds:[20210,20212,20213,20214,20215],maxPoints:5},{fieldName:"improvedBlessingOfWisdom",location:{rowIdx:3,colIdx:2},spellIds:[20244,20245],maxPoints:2},{fieldName:"divineFavor",location:{rowIdx:4,colIdx:1},spellIds:[20216],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}},{fieldName:"lastingJudgement",location:{rowIdx:4,colIdx:2},spellIds:[20359,20360,20361],maxPoints:3},{fieldName:"holyPower",location:{rowIdx:5,colIdx:2},spellIds:[5923,5924,5925,5926,25829],maxPoints:5},{fieldName:"holyShock",location:{rowIdx:6,colIdx:1},spellIds:[20473],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Protection",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/383.jpg",talents:[{fieldName:"improvedDevotionAura",location:{rowIdx:0,colIdx:1},spellIds:[20138,20139,20140,20141,20142],maxPoints:5},{fieldName:"redoubt",location:{rowIdx:0,colIdx:2},spellIds:[20127,20130,20135,20136,20137],maxPoints:5},{fieldName:"precision",location:{rowIdx:1,colIdx:0},spellIds:[20189,20192,20193],maxPoints:3},{fieldName:"guardiansFavor",location:{rowIdx:1,colIdx:1},spellIds:[20174,20175],maxPoints:2},{fieldName:"toughness",location:{rowIdx:1,colIdx:3},spellIds:[20143,20144,20145,20146,20147],maxPoints:5},{fieldName:"blessingOfKings",location:{rowIdx:2,colIdx:0},spellIds:[20217],maxPoints:1},{fieldName:"improvedRighteousFury",location:{rowIdx:2,colIdx:1},spellIds:[20468,20469,20470],maxPoints:3},{fieldName:"shieldSpecialization",location:{rowIdx:2,colIdx:2},spellIds:[20148,20149,20150],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"anticipation",location:{rowIdx:2,colIdx:3},spellIds:[20096,20097,20098,20099,20100],maxPoints:5},{fieldName:"improvedHammerOfJustice",location:{rowIdx:3,colIdx:1},spellIds:[20487,20488,20489],maxPoints:3},{fieldName:"improvedConcentrationAura",location:{rowIdx:3,colIdx:2},spellIds:[20254,20255,20256],maxPoints:3},{fieldName:"blessingOfSanctuary",location:{rowIdx:4,colIdx:1},spellIds:[20911],maxPoints:1},{fieldName:"reckoning",location:{rowIdx:4,colIdx:2},spellIds:[20177,20179,20180,20181,20182],maxPoints:5},{fieldName:"oneHandedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[20196,20197,20198,20199,20200],maxPoints:5},{fieldName:"holyShield",location:{rowIdx:6,colIdx:1},spellIds:[20925],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Retribution",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/381.jpg",talents:[{fieldName:"improvedBlessingOfMight",location:{rowIdx:0,colIdx:1},spellIds:[20042,20045,20046,20047,20048],maxPoints:5},{fieldName:"benediction",location:{rowIdx:0,colIdx:2},spellIds:[20101,20102,20103,20104,20105],maxPoints:5},{fieldName:"improvedJudgement",location:{rowIdx:1,colIdx:0},spellIds:[25956,25957],maxPoints:2},{fieldName:"improvedSealOfTheCrusader",location:{rowIdx:1,colIdx:1},spellIds:[20335,20336,20337],maxPoints:3},{fieldName:"deflection",location:{rowIdx:1,colIdx:2},spellIds:[20060,20061,20062,20063,20064],maxPoints:5},{fieldName:"vindication",location:{rowIdx:2,colIdx:0},spellIds:[9452,26016,26021],maxPoints:3},{fieldName:"conviction",location:{rowIdx:2,colIdx:1},spellIds:[20117,20118,20119,20120,20121],maxPoints:5},{fieldName:"sealOfCommand",location:{rowIdx:2,colIdx:2},spellIds:[20375],maxPoints:1},{fieldName:"pursuitOfJustice",location:{rowIdx:2,colIdx:3},spellIds:[26022,26023],maxPoints:2},{fieldName:"eyeForAnEye",location:{rowIdx:3,colIdx:0},spellIds:[9799,25988],maxPoints:2},{fieldName:"improvedRetributionAura",location:{rowIdx:3,colIdx:2},spellIds:[20091,20092],maxPoints:2},{fieldName:"twoHandedWeaponSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[20111,20112,20113],maxPoints:3},{fieldName:"sanctityAura",location:{rowIdx:4,colIdx:2},spellIds:[20218],maxPoints:1},{fieldName:"vengeance",location:{rowIdx:5,colIdx:1},spellIds:[20049,20056,20057,20058,20059],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"repentance",location:{rowIdx:6,colIdx:1},spellIds:[20066],maxPoints:1}]}]),Ln=Nn([{name:"Discipline",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/201.jpg",talents:[{fieldName:"unbreakableWill",location:{rowIdx:0,colIdx:1},spellIds:[14522,14788,14789,14790,14791],maxPoints:5},{fieldName:"wandSpecialization",location:{rowIdx:0,colIdx:2},spellIds:[14524,14525,14526,14527,14528],maxPoints:5},{fieldName:"silentResolve",location:{rowIdx:1,colIdx:0},spellIds:[14523,14784,14785,14786,14787],maxPoints:5},{fieldName:"improvedPowerWordFortitude",location:{rowIdx:1,colIdx:1},spellIds:[14749,14767],maxPoints:2},{fieldName:"improvedPowerWordShield",location:{rowIdx:1,colIdx:2},spellIds:[14748,14768,14769],maxPoints:3},{fieldName:"martyrdom",location:{rowIdx:1,colIdx:3},spellIds:[14531,14774],maxPoints:2},{fieldName:"innerFocus",location:{rowIdx:2,colIdx:1},spellIds:[14751],maxPoints:1},{fieldName:"meditation",location:{rowIdx:2,colIdx:2},spellIds:[14521,14776,14777],maxPoints:3},{fieldName:"improvedInnerFire",location:{rowIdx:3,colIdx:0},spellIds:[14747,14770,14771],maxPoints:3},{fieldName:"mentalAgility",location:{rowIdx:3,colIdx:1},spellIds:[14520,14780,14781,14782,14783],maxPoints:5},{fieldName:"improvedManaBurn",location:{rowIdx:3,colIdx:3},spellIds:[14750,14772],maxPoints:2},{fieldName:"mentalStrength",location:{rowIdx:4,colIdx:1},spellIds:[18551,18552,18553,18554,18555],maxPoints:5},{fieldName:"divineSpirit",location:{rowIdx:4,colIdx:2},spellIds:[14752],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"forceOfWill",location:{rowIdx:5,colIdx:2},spellIds:[18544,18547,18548,18549,18550],maxPoints:5},{fieldName:"powerInfusion",location:{rowIdx:6,colIdx:1},spellIds:[10060],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Holy",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/202.jpg",talents:[{fieldName:"healingFocus",location:{rowIdx:0,colIdx:0},spellIds:[14913,15012],maxPoints:2},{fieldName:"improvedRenew",location:{rowIdx:0,colIdx:1},spellIds:[14908,15020,17191],maxPoints:3},{fieldName:"holySpecialization",location:{rowIdx:0,colIdx:2},spellIds:[14889,15008,15009,15010,15011],maxPoints:5},{fieldName:"spellWarding",location:{rowIdx:1,colIdx:1},spellIds:[27900,27901,27902,27903,27904],maxPoints:5},{fieldName:"divineFury",location:{rowIdx:1,colIdx:2},spellIds:[18530,18531,18533,18534,18535],maxPoints:5},{fieldName:"holyNova",location:{rowIdx:2,colIdx:0},spellIds:[15237],maxPoints:1},{fieldName:"blessedRecovery",location:{rowIdx:2,colIdx:1},spellIds:[27811,27815,27816],maxPoints:3},{fieldName:"inspiration",location:{rowIdx:2,colIdx:3},spellIds:[14892,15362,15363],maxPoints:3},{fieldName:"holyReach",location:{rowIdx:3,colIdx:0},spellIds:[27789,27790],maxPoints:2},{fieldName:"improvedHealing",location:{rowIdx:3,colIdx:1},spellIds:[14912,15013,15014],maxPoints:3},{fieldName:"searingLight",location:{rowIdx:3,colIdx:2},spellIds:[14909,15017],maxPoints:2,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"improvedPrayerOfHealing",location:{rowIdx:4,colIdx:0},spellIds:[14911,15018],maxPoints:2},{fieldName:"spiritOfRedemption",location:{rowIdx:4,colIdx:1},spellIds:[20711],maxPoints:1},{fieldName:"spiritualGuidance",location:{rowIdx:4,colIdx:2},spellIds:[14901,15028,15029,15030,15031],maxPoints:5},{fieldName:"spiritualHealing",location:{rowIdx:5,colIdx:2},spellIds:[14898,15349,15354,15355,15356],maxPoints:5},{fieldName:"lightwell",location:{rowIdx:6,colIdx:1},spellIds:[724],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Shadow",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/203.jpg",talents:[{fieldName:"spiritTap",location:{rowIdx:0,colIdx:1},spellIds:[15270,15335,15336,15337,15338],maxPoints:5},{fieldName:"blackout",location:{rowIdx:0,colIdx:2},spellIds:[15268,15323,15324,15325,15326],maxPoints:5},{fieldName:"shadowAffinity",location:{rowIdx:1,colIdx:0},spellIds:[15318,15272,15320],maxPoints:3},{fieldName:"improvedShadowWordPain",location:{rowIdx:1,colIdx:1},spellIds:[15275,15317],maxPoints:2},{fieldName:"shadowFocus",location:{rowIdx:1,colIdx:2},spellIds:[15260,15327,15328],maxPoints:5},{fieldName:"improvedPsychicScream",location:{rowIdx:2,colIdx:0},spellIds:[15392,15448],maxPoints:2},{fieldName:"improvedMindBlast",location:{rowIdx:2,colIdx:1},spellIds:[15273,15312,15313,15314,15316],maxPoints:5},{fieldName:"mindFlay",location:{rowIdx:2,colIdx:2},spellIds:[15407],maxPoints:1},{fieldName:"improvedFade",location:{rowIdx:3,colIdx:1},spellIds:[15274,15311],maxPoints:2},{fieldName:"shadowReach",location:{rowIdx:3,colIdx:2},spellIds:[17322,17323,17325],maxPoints:3},{fieldName:"shadowWeaving",location:{rowIdx:3,colIdx:3},spellIds:[15257,15331,15332,15333,15334],maxPoints:5},{fieldName:"silence",location:{rowIdx:4,colIdx:0},spellIds:[15487],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:0}},{fieldName:"vampiricEmbrace",location:{rowIdx:4,colIdx:1},spellIds:[15286],maxPoints:1},{fieldName:"improvedVampiricEmbrace",location:{rowIdx:4,colIdx:2},spellIds:[27839,27840],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"darkness",location:{rowIdx:5,colIdx:2},spellIds:[15259,15307,15308,15309,15310],maxPoints:5},{fieldName:"shadowform",location:{rowIdx:6,colIdx:1},spellIds:[15473],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Vn=Nn([{name:"Assassination",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/182.jpg",talents:[{fieldName:"improvedEviscerate",location:{rowIdx:0,colIdx:0},spellIds:[14162,14163,14164],maxPoints:3},{fieldName:"remorselessAttacks",location:{rowIdx:0,colIdx:1},spellIds:[14144,14148],maxPoints:2},{fieldName:"malice",location:{rowIdx:0,colIdx:2},spellIds:[14138,14139,14140,14141,14142],maxPoints:5},{fieldName:"ruthlessness",location:{rowIdx:1,colIdx:0},spellIds:[14156,14160,14161],maxPoints:3},{fieldName:"murder",location:{rowIdx:1,colIdx:1},spellIds:[14158,14159],maxPoints:2},{fieldName:"improvedSliceAndDice",location:{rowIdx:1,colIdx:3},spellIds:[14165,14166,14167],maxPoints:3},{fieldName:"relentlessStrikes",location:{rowIdx:2,colIdx:0},spellIds:[14179],maxPoints:1},{fieldName:"improvedExposeArmor",location:{rowIdx:2,colIdx:1},spellIds:[14168,14169],maxPoints:2},{fieldName:"lethality",location:{rowIdx:2,colIdx:2},spellIds:[14128,14132,14135,14136,14137],maxPoints:5,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"vilePoisons",location:{rowIdx:3,colIdx:1},spellIds:[16513,16514,16515,16719,16720],maxPoints:5},{fieldName:"improvedPoisons",location:{rowIdx:3,colIdx:2},spellIds:[14113,14114,14115,14116,14117],maxPoints:5},{fieldName:"coldBlood",location:{rowIdx:4,colIdx:1},spellIds:[14177],maxPoints:1},{fieldName:"improvedKidneyShot",location:{rowIdx:4,colIdx:2},spellIds:[14174,14175,14176],maxPoints:3},{fieldName:"sealFate",location:{rowIdx:5,colIdx:1},spellIds:[14186,14190,14193,14194,14195],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"vigor",location:{rowIdx:6,colIdx:1},spellIds:[14983],maxPoints:1}]},{name:"Combat",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/181.jpg",talents:[{fieldName:"improvedGouge",location:{rowIdx:0,colIdx:0},spellIds:[13741,13792,13793],maxPoints:3},{fieldName:"improvedSinisterStrike",location:{rowIdx:0,colIdx:1},spellIds:[13732,13863],maxPoints:2},{fieldName:"lightningReflexes",location:{rowIdx:0,colIdx:2},spellIds:[13712,13788,13789,13790,13791],maxPoints:5},{fieldName:"improvedBackstab",location:{rowIdx:1,colIdx:0},spellIds:[13733,13865,13866],maxPoints:3},{fieldName:"deflection",location:{rowIdx:1,colIdx:1},spellIds:[13713,13853,13854,13855,13856],maxPoints:5},{fieldName:"precision",location:{rowIdx:1,colIdx:2},spellIds:[13705,13832,13843,13844,13845],maxPoints:5},{fieldName:"endurance",location:{rowIdx:2,colIdx:0},spellIds:[13742,13872],maxPoints:2},{fieldName:"riposte",location:{rowIdx:2,colIdx:1},spellIds:[14251],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"improvedSprint",location:{rowIdx:2,colIdx:3},spellIds:[13743,13875],maxPoints:2},{fieldName:"improvedKick",location:{rowIdx:3,colIdx:0},spellIds:[13754,13867],maxPoints:2},{fieldName:"daggerSpecialization",location:{rowIdx:3,colIdx:1},spellIds:[13706,13804,13805,13806,13807],maxPoints:5},{fieldName:"dualWieldSpecialization",location:{rowIdx:3,colIdx:2},spellIds:[13715,13848,13849,13851,13852],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:2}},{fieldName:"maceSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[13709,13800,13801,13802,13803],maxPoints:5},{fieldName:"bladeFlurry",location:{rowIdx:4,colIdx:1},spellIds:[13877],maxPoints:1},{fieldName:"swordSpecialization",location:{rowIdx:4,colIdx:2},spellIds:[13960,13961,13962,13963,13964],maxPoints:5},{fieldName:"fistWeaponSpecialization",location:{rowIdx:4,colIdx:3},spellIds:[13707,13966,13967,13968,13969],maxPoints:5},{fieldName:"weaponExpertise",location:{rowIdx:5,colIdx:1},spellIds:[30919,30920],maxPoints:2,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"aggression",location:{rowIdx:5,colIdx:2},spellIds:[18427,18428,18429],maxPoints:3},{fieldName:"adrenalineRush",location:{rowIdx:6,colIdx:1},spellIds:[13750],maxPoints:1}]},{name:"Subtlety",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/183.jpg",talents:[{fieldName:"masterOfDeception",location:{rowIdx:0,colIdx:1},spellIds:[13958,13970,13971,13972,13973],maxPoints:5},{fieldName:"opportunity",location:{rowIdx:0,colIdx:2},spellIds:[14057,14072,14073,14074,14075],maxPoints:5},{fieldName:"sleightOfHand",location:{rowIdx:1,colIdx:0},spellIds:[30892,30893],maxPoints:2},{fieldName:"elusiveness",location:{rowIdx:1,colIdx:1},spellIds:[13981,14066],maxPoints:2},{fieldName:"camouflage",location:{rowIdx:1,colIdx:2},spellIds:[13975,14062,14063,14064,14065],maxPoints:5},{fieldName:"initiative",location:{rowIdx:2,colIdx:0},spellIds:[13976,13979,13980],maxPoints:3},{fieldName:"ghostlyStrike",location:{rowIdx:2,colIdx:1},spellIds:[14278],maxPoints:1},{fieldName:"improvedAmbush",location:{rowIdx:2,colIdx:2},spellIds:[14079,14080,14081],maxPoints:3},{fieldName:"setup",location:{rowIdx:3,colIdx:0},spellIds:[13983,14070,14071],maxPoints:3},{fieldName:"improvedSap",location:{rowIdx:3,colIdx:1},spellIds:[14076,14094,14095],maxPoints:3},{fieldName:"serratedBlades",location:{rowIdx:3,colIdx:2},spellIds:[14171,14172,14173],maxPoints:3},{fieldName:"heightenedSenses",location:{rowIdx:4,colIdx:0},spellIds:[30894,30895],maxPoints:2},{fieldName:"preparation",location:{rowIdx:4,colIdx:1},spellIds:[14185],maxPoints:1},{fieldName:"dirtyDeeds",location:{rowIdx:4,colIdx:2},spellIds:[14082,14083],maxPoints:2},{fieldName:"hemorrhage",location:{rowIdx:4,colIdx:3},spellIds:[16511],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"deadliness",location:{rowIdx:5,colIdx:2},spellIds:[30902,30903,30904,30905,30906],maxPoints:5},{fieldName:"premeditation",location:{rowIdx:6,colIdx:1},spellIds:[14183],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Mn=Nn([{name:"Elemental",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/261.jpg",talents:[{fieldName:"convection",location:{rowIdx:0,colIdx:1},spellIds:[16039,16109,16110,16111,16112],maxPoints:5},{fieldName:"concussion",location:{rowIdx:0,colIdx:2},spellIds:[16035,16105,16106,16107,16108],maxPoints:5},{fieldName:"earthsGrasp",location:{rowIdx:1,colIdx:0},spellIds:[16043,16130],maxPoints:2},{fieldName:"elementalWarding",location:{rowIdx:1,colIdx:1},spellIds:[28996,28997,28998],maxPoints:3},{fieldName:"callOfFlame",location:{rowIdx:1,colIdx:2},spellIds:[16038,16160,16161],maxPoints:3},{fieldName:"elementalFocus",location:{rowIdx:2,colIdx:0},spellIds:[16164],maxPoints:1},{fieldName:"reverberation",location:{rowIdx:2,colIdx:1},spellIds:[16040,16113,16114,16115,16116],maxPoints:5},{fieldName:"callOfThunder",location:{rowIdx:2,colIdx:2},spellIds:[16041,16117,16118,16119,16120],maxPoints:5},{fieldName:"improvedFireTotems",location:{rowIdx:3,colIdx:0},spellIds:[16086,16544],maxPoints:2},{fieldName:"eyeOfTheStorm",location:{rowIdx:3,colIdx:1},spellIds:[29062,29064,29065],maxPoints:3},{fieldName:"elementalDevastation",location:{rowIdx:3,colIdx:3},spellIds:[30160,29179,29180],maxPoints:3},{fieldName:"stormReach",location:{rowIdx:4,colIdx:0},spellIds:[28999,29e3],maxPoints:2},{fieldName:"elementalFury",location:{rowIdx:4,colIdx:1},spellIds:[16089],maxPoints:1},{fieldName:"lightningMastery",location:{rowIdx:5,colIdx:2},spellIds:[16578,16579,16580,16581,16582],maxPoints:5,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"elementalMastery",location:{rowIdx:6,colIdx:1},spellIds:[16166],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Enhancement",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/263.jpg",talents:[{fieldName:"ancestralKnowledge",location:{rowIdx:0,colIdx:1},spellIds:[17485,17486,17487,17488,17489],maxPoints:5},{fieldName:"shieldSpecialization",location:{rowIdx:0,colIdx:2},spellIds:[16253,16298],maxPoints:5},{fieldName:"guardianTotems",location:{rowIdx:1,colIdx:0},spellIds:[16258,16293],maxPoints:2},{fieldName:"thunderingStrikes",location:{rowIdx:1,colIdx:1},spellIds:[16255,16302,16303,16304,16305],maxPoints:5},{fieldName:"improvedGhostWolf",location:{rowIdx:1,colIdx:2},spellIds:[16262,16287],maxPoints:2},{fieldName:"improvedLightningShield",location:{rowIdx:1,colIdx:3},spellIds:[16261,16290],maxPoints:3},{fieldName:"enhancingTotems",location:{rowIdx:2,colIdx:0},spellIds:[16259,16295],maxPoints:2},{fieldName:"twoHandedAxesAndMaces",location:{rowIdx:2,colIdx:2},spellIds:[16269],maxPoints:1},{fieldName:"anticipation",location:{rowIdx:2,colIdx:3},spellIds:[16254,16271,16272,16273,16274],maxPoints:5},{fieldName:"flurry",location:{rowIdx:3,colIdx:1},spellIds:[16256,16281,16282,16283,16284],maxPoints:5,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"toughness",location:{rowIdx:3,colIdx:2},spellIds:[16252,16306,16307,16308,16309],maxPoints:5},{fieldName:"improvedWeaponTotems",location:{rowIdx:4,colIdx:0},spellIds:[29192,29193],maxPoints:2},{fieldName:"elementalWeapons",location:{rowIdx:4,colIdx:1},spellIds:[16266,29079,29080],maxPoints:3},{fieldName:"parry",location:{rowIdx:4,colIdx:2},spellIds:[16268],maxPoints:1},{fieldName:"weaponMastery",location:{rowIdx:5,colIdx:2},spellIds:[29082,29084,29086,29087,29088],maxPoints:5},{fieldName:"stormstrike",location:{rowIdx:6,colIdx:1},spellIds:[17364],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Restoration",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/262.jpg",talents:[{fieldName:"improvedHealingWave",location:{rowIdx:0,colIdx:1},spellIds:[16182,16226,16227,16228,16229],maxPoints:5},{fieldName:"tidalFocus",location:{rowIdx:0,colIdx:2},spellIds:[16179,16214,16215,16216,16217],maxPoints:5},{fieldName:"improvedReincarnation",location:{rowIdx:1,colIdx:0},spellIds:[16184,16209],maxPoints:2},{fieldName:"ancestralHealing",location:{rowIdx:1,colIdx:1},spellIds:[16176,16235,16240],maxPoints:3},{fieldName:"totemicFocus",location:{rowIdx:1,colIdx:2},spellIds:[16173,16222,16223,16224,16225],maxPoints:5},{fieldName:"naturesGuidance",location:{rowIdx:2,colIdx:0},spellIds:[16180,16196,16198],maxPoints:3},{fieldName:"healingFocus",location:{rowIdx:2,colIdx:1},spellIds:[16181,16230,16232,16233,16234],maxPoints:5},{fieldName:"totemicMastery",location:{rowIdx:2,colIdx:2},spellIds:[16189],maxPoints:1},{fieldName:"healingGrace",location:{rowIdx:2,colIdx:3},spellIds:[29187,29189,29191],maxPoints:3},{fieldName:"restorativeTotems",location:{rowIdx:3,colIdx:1},spellIds:[16187,16205,16206,16207,16208],maxPoints:5},{fieldName:"tidalMastery",location:{rowIdx:3,colIdx:2},spellIds:[16194,16218,16219,16220,16221],maxPoints:5},{fieldName:"healingWay",location:{rowIdx:4,colIdx:0},spellIds:[29206,29202,29205],maxPoints:3},{fieldName:"naturesSwiftness",location:{rowIdx:4,colIdx:2},spellIds:[16188],maxPoints:1},{fieldName:"purification",location:{rowIdx:5,colIdx:2},spellIds:[16178,16210,16211,16212,16213],maxPoints:5},{fieldName:"manaTideTotem",location:{rowIdx:6,colIdx:1},spellIds:[16190],maxPoints:1,prereqLocation:{rowIdx:3,colIdx:1}}]}]),Un=Nn([{name:"Affliction",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/302.jpg",talents:[{fieldName:"suppression",location:{rowIdx:0,colIdx:1},spellIds:[18174,18175,18176,18177,18178],maxPoints:5},{fieldName:"improvedCorruption",location:{rowIdx:0,colIdx:2},spellIds:[17810,17811,17812,17813,17814],maxPoints:5},{fieldName:"improvedCurseOfWeakness",location:{rowIdx:1,colIdx:0},spellIds:[18179,18180,18181],maxPoints:3},{fieldName:"improvedDrainSoul",location:{rowIdx:1,colIdx:1},spellIds:[18213,18372],maxPoints:2},{fieldName:"improvedLifeTap",location:{rowIdx:1,colIdx:2},spellIds:[18182,18183],maxPoints:2},{fieldName:"improvedDrainLife",location:{rowIdx:1,colIdx:3},spellIds:[17804,17805,17806,17807,17808],maxPoints:5},{fieldName:"improvedCurseOfAgony",location:{rowIdx:2,colIdx:0},spellIds:[18827,18829,18830],maxPoints:3},{fieldName:"felConcentration",location:{rowIdx:2,colIdx:1},spellIds:[17783,17784,17785,17786,17787],maxPoints:5},{fieldName:"amplifyCurse",location:{rowIdx:2,colIdx:2},spellIds:[18288],maxPoints:1},{fieldName:"grimReach",location:{rowIdx:3,colIdx:0},spellIds:[18218,18219],maxPoints:2},{fieldName:"nightfall",location:{rowIdx:3,colIdx:1},spellIds:[18094,18095],maxPoints:2},{fieldName:"improvedDrainMana",location:{rowIdx:3,colIdx:3},spellIds:[17864,18393],maxPoints:2},{fieldName:"siphonLife",location:{rowIdx:4,colIdx:1},spellIds:[18265],maxPoints:1},{fieldName:"curseOfExhaustion",location:{rowIdx:4,colIdx:2},spellIds:[18223],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"improvedCurseOfExhaustion",location:{rowIdx:4,colIdx:3},spellIds:[18310,18311,18312,18313],maxPoints:4,prereqLocation:{rowIdx:4,colIdx:2}},{fieldName:"shadowMastery",location:{rowIdx:5,colIdx:1},spellIds:[18271,18272,18273,18274,18275],maxPoints:5,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"darkPact",location:{rowIdx:6,colIdx:1},spellIds:[18220],maxPoints:1}]},{name:"Demonology",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/303.jpg",talents:[{fieldName:"improvedHealthstone",location:{rowIdx:0,colIdx:0},spellIds:[18692,18693],maxPoints:2},{fieldName:"improvedImp",location:{rowIdx:0,colIdx:1},spellIds:[18694,18695,18696],maxPoints:3},{fieldName:"demonicEmbrace",location:{rowIdx:0,colIdx:2},spellIds:[18697,18698,18699,18700,18701],maxPoints:5},{fieldName:"improvedHealthFunnel",location:{rowIdx:1,colIdx:0},spellIds:[18703,18704],maxPoints:2},{fieldName:"improvedVoidwalker",location:{rowIdx:1,colIdx:1},spellIds:[18705,18706,18707],maxPoints:3},{fieldName:"felIntellect",location:{rowIdx:1,colIdx:2},spellIds:[18731,18743,18744,18745,18746],maxPoints:5},{fieldName:"improvedSayaad",location:{rowIdx:2,colIdx:0},spellIds:[18754,18755,18756],maxPoints:3},{fieldName:"felDomination",location:{rowIdx:2,colIdx:1},spellIds:[18708],maxPoints:1},{fieldName:"felStamina",location:{rowIdx:2,colIdx:2},spellIds:[18748],maxPoints:5},{fieldName:"masterSummoner",location:{rowIdx:3,colIdx:1},spellIds:[18709,18710],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:1}},{fieldName:"unholyPower",location:{rowIdx:3,colIdx:2},spellIds:[18769,18770,18771,18772,18773],maxPoints:5},{fieldName:"improvedSubjugateDemon",location:{rowIdx:4,colIdx:0},spellIds:[18821,18823,18824,18825],maxPoints:5},{fieldName:"demonicSacrifice",location:{rowIdx:4,colIdx:1},spellIds:[18788],maxPoints:1},{fieldName:"improvedFirestone",location:{rowIdx:4,colIdx:3},spellIds:[18767,18768],maxPoints:2},{fieldName:"masterDemonologist",location:{rowIdx:5,colIdx:2},spellIds:[23785,23822,23823,23824,23825],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"soulLink",location:{rowIdx:6,colIdx:1},spellIds:[19028],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}},{fieldName:"improvedSpellstone",location:{rowIdx:6,colIdx:2},spellIds:[18774,18775],maxPoints:2}]},{name:"Destruction",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/301.jpg",talents:[{fieldName:"improvedShadowBolt",location:{rowIdx:0,colIdx:1},spellIds:[17793,17796,17801,17802,17803],maxPoints:5},{fieldName:"cataclysm",location:{rowIdx:0,colIdx:2},spellIds:[17778,17779,17780,17781,17782],maxPoints:5},{fieldName:"bane",location:{rowIdx:1,colIdx:1},spellIds:[17788,17789,17790,17791,17792],maxPoints:5},{fieldName:"aftermath",location:{rowIdx:1,colIdx:2},spellIds:[18119,18120,18121,18122,18123],maxPoints:5},{fieldName:"improvedFirebolt",location:{rowIdx:2,colIdx:0},spellIds:[18126,18127],maxPoints:2},{fieldName:"improvedLashOfPain",location:{rowIdx:2,colIdx:1},spellIds:[18128],maxPoints:2},{fieldName:"devastation",location:{rowIdx:2,colIdx:2},spellIds:[18130,18131,18132,18133,18134],maxPoints:5},{fieldName:"shadowburn",location:{rowIdx:2,colIdx:3},spellIds:[17877],maxPoints:1},{fieldName:"intensity",location:{rowIdx:3,colIdx:0},spellIds:[18135,18136],maxPoints:2},{fieldName:"destructiveReach",location:{rowIdx:3,colIdx:1},spellIds:[17917,17918],maxPoints:2},{fieldName:"improvedSearingPain",location:{rowIdx:3,colIdx:3},spellIds:[17927,17929,17930,17931,17932],maxPoints:5},{fieldName:"pyroclasm",location:{rowIdx:4,colIdx:0},spellIds:[18096,18073],maxPoints:2,prereqLocation:{rowIdx:3,colIdx:0}},{fieldName:"improvedImmolate",location:{rowIdx:4,colIdx:1},spellIds:[17815,17833,17834,17835,17836],maxPoints:5},{fieldName:"ruin",location:{rowIdx:4,colIdx:2},spellIds:[17959],maxPoints:1,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"emberstorm",location:{rowIdx:5,colIdx:2},spellIds:[17954,17955,17956,17957,17958],maxPoints:5},{fieldName:"conflagrate",location:{rowIdx:6,colIdx:1},spellIds:[17962],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Wn=Nn([{name:"Arms",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/161.jpg",talents:[{fieldName:"improvedHeroicStrike",location:{rowIdx:0,colIdx:0},spellIds:[12282,12663,12664],maxPoints:3},{fieldName:"deflection",location:{rowIdx:0,colIdx:1},spellIds:[16462,16463,16464,16465,16466],maxPoints:5},{fieldName:"improvedRend",location:{rowIdx:0,colIdx:2},spellIds:[12286,12658,12659],maxPoints:3},{fieldName:"improvedCharge",location:{rowIdx:1,colIdx:0},spellIds:[12285,12697],maxPoints:2},{fieldName:"tacticalMastery",location:{rowIdx:1,colIdx:1},spellIds:[12295,12676,12677,12678,12679],maxPoints:5},{fieldName:"improvedThunderClap",location:{rowIdx:1,colIdx:3},spellIds:[12287,12665,12666],maxPoints:3},{fieldName:"improvedOverpower",location:{rowIdx:2,colIdx:0},spellIds:[12290,12963],maxPoints:2},{fieldName:"angerManagement",location:{rowIdx:2,colIdx:1},spellIds:[12296],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:1}},{fieldName:"deepWounds",location:{rowIdx:2,colIdx:2},spellIds:[12834,12849,12867],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:2}},{fieldName:"twoHandedWeaponSpecialization",location:{rowIdx:3,colIdx:1},spellIds:[12163,12711,12712,12713,12714],maxPoints:5},{fieldName:"impale",location:{rowIdx:3,colIdx:2},spellIds:[16493,16494],maxPoints:2,prereqLocation:{rowIdx:2,colIdx:2}},{fieldName:"axeSpecialization",location:{rowIdx:4,colIdx:0},spellIds:[12700,12781,12783,12784,12785],maxPoints:5},{fieldName:"sweepingStrikes",location:{rowIdx:4,colIdx:1},spellIds:[12292],maxPoints:1},{fieldName:"maceSpecialization",location:{rowIdx:4,colIdx:2},spellIds:[12284,12701,12702,12703,12704],maxPoints:5},{fieldName:"swordSpecialization",location:{rowIdx:4,colIdx:3},spellIds:[12281,12812,12813,12814,12815],maxPoints:5},{fieldName:"polearmSpecialization",location:{rowIdx:5,colIdx:0},spellIds:[12165,12830,12831,12832,12833],maxPoints:5},{fieldName:"improvedHamstring",location:{rowIdx:5,colIdx:2},spellIds:[12289,12668,23695],maxPoints:3},{fieldName:"mortalStrike",location:{rowIdx:6,colIdx:1},spellIds:[12294],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Fury",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/164.jpg",talents:[{fieldName:"boomingVoice",location:{rowIdx:0,colIdx:1},spellIds:[12321,12835,12836,12837,12838],maxPoints:5},{fieldName:"cruelty",location:{rowIdx:0,colIdx:2},spellIds:[12320,12852,12853,12855,12856],maxPoints:5},{fieldName:"improvedDemoralizingShout",location:{rowIdx:1,colIdx:1},spellIds:[12324,12876,12877,12878,12879],maxPoints:5},{fieldName:"unbridledWrath",location:{rowIdx:1,colIdx:2},spellIds:[12322,12999,13e3,13001,13002],maxPoints:5},{fieldName:"improvedCleave",location:{rowIdx:2,colIdx:0},spellIds:[12329,12950,20496],maxPoints:3},{fieldName:"piercingHowl",location:{rowIdx:2,colIdx:1},spellIds:[12323],maxPoints:1},{fieldName:"bloodCraze",location:{rowIdx:2,colIdx:2},spellIds:[16487,16489,16492],maxPoints:3},{fieldName:"improvedBattleShout",location:{rowIdx:2,colIdx:3},spellIds:[12318,12857,12858,12860,12861],maxPoints:5},{fieldName:"dualWieldSpecialization",location:{rowIdx:3,colIdx:0},spellIds:[23584,23585,23586,23587,23588],maxPoints:5},{fieldName:"improvedExecute",location:{rowIdx:3,colIdx:1},spellIds:[20502,20503],maxPoints:2},{fieldName:"enrage",location:{rowIdx:3,colIdx:2},spellIds:[12317,13045,13046,13047,13048],maxPoints:5},{fieldName:"improvedSlam",location:{rowIdx:4,colIdx:0},spellIds:[12862,12330,20497,20498,20499],maxPoints:5},{fieldName:"deathWish",location:{rowIdx:4,colIdx:1},spellIds:[12328],maxPoints:1},{fieldName:"improvedIntercept",location:{rowIdx:4,colIdx:3},spellIds:[20504,20505],maxPoints:2},{fieldName:"improvedBerserkerRage",location:{rowIdx:5,colIdx:0},spellIds:[20500,20501],maxPoints:2},{fieldName:"flurry",location:{rowIdx:5,colIdx:2},spellIds:[12319,12971,12972,12973,12974],maxPoints:5,prereqLocation:{rowIdx:3,colIdx:2}},{fieldName:"bloodthirst",location:{rowIdx:6,colIdx:1},spellIds:[23881],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]},{name:"Protection",backgroundUrl:"https://wow.zamimg.com/images/wow/talents/backgrounds/classic/163.jpg",talents:[{fieldName:"shieldSpecialization",location:{rowIdx:0,colIdx:1},spellIds:[12298,12724,12725,12726,12727],maxPoints:5},{fieldName:"anticipation",location:{rowIdx:0,colIdx:2},spellIds:[12297,12750,12751,12752,12753],maxPoints:5},{fieldName:"improvedBloodrage",location:{rowIdx:1,colIdx:0},spellIds:[12301,12818],maxPoints:2},{fieldName:"toughness",location:{rowIdx:1,colIdx:2},spellIds:[12299,12761,12762,12763,12764],maxPoints:5},{fieldName:"ironWill",location:{rowIdx:1,colIdx:3},spellIds:[12300,12959,12960,12961,12962],maxPoints:5},{fieldName:"lastStand",location:{rowIdx:2,colIdx:0},spellIds:[12975],maxPoints:1,prereqLocation:{rowIdx:1,colIdx:0}},{fieldName:"improvedShieldBlock",location:{rowIdx:2,colIdx:1},spellIds:[12945,12307,12944],maxPoints:3,prereqLocation:{rowIdx:0,colIdx:1}},{fieldName:"improvedRevenge",location:{rowIdx:2,colIdx:2},spellIds:[12797,12799,12800],maxPoints:3},{fieldName:"defiance",location:{rowIdx:2,colIdx:3},spellIds:[12303,12788,12789,12791,12792],maxPoints:5},{fieldName:"improvedSunderArmor",location:{rowIdx:3,colIdx:0},spellIds:[12308,12810,12811],maxPoints:3},{fieldName:"improvedDisarm",location:{rowIdx:3,colIdx:1},spellIds:[12313,12804,12807],maxPoints:3},{fieldName:"improvedTaunt",location:{rowIdx:3,colIdx:2},spellIds:[12302,12765],maxPoints:2},{fieldName:"improvedShieldWall",location:{rowIdx:4,colIdx:0},spellIds:[12312,12803],maxPoints:2},{fieldName:"concussionBlow",location:{rowIdx:4,colIdx:1},spellIds:[12809],maxPoints:1},{fieldName:"improvedShieldBash",location:{rowIdx:4,colIdx:2},spellIds:[12311,12958],maxPoints:2},{fieldName:"oneHandedWeaponSpecialization",location:{rowIdx:5,colIdx:2},spellIds:[16538,16539,16540,16541,16542],maxPoints:5},{fieldName:"shieldSlam",location:{rowIdx:6,colIdx:1},spellIds:[23922],maxPoints:1,prereqLocation:{rowIdx:4,colIdx:1}}]}]),Fn={[o.ClassUnknown]:[],[o.ClassDruid]:_n,[o.ClassShaman]:Mn,[o.ClassHunter]:Rn,[o.ClassMage]:Dn,[o.ClassRogue]:Vn,[o.ClassPaladin]:An,[o.ClassPriest]:Ln,[o.ClassWarlock]:Un,[o.ClassWarrior]:Wn};function On(e,t){return function(e,t,s){return t.split("-").forEach(((t,a)=>{const i=s[a];[...t].forEach(((t,s)=>{const a=i.talents[s],n=parseInt(t);a.fieldName&&(1==a.maxPoints?e[a.fieldName]=1==n:e[a.fieldName]=n)}))})),e}(y[e].talentsCreate(),t,Fn[E[e]])}class qn{constructor(){this.name="",this.auras=[],this.spells=[]}getName(){return this.name}getAuras(){return this.auras.slice()}getSpells(){return this.spells.slice()}async update(e){let t=e.spells.map((e=>({data:e,id:x.fromProto(e.id)}))),s=e.auras.map((e=>({data:e,id:x.fromProto(e.id)})));await Promise.all([...t,...s].map((e=>e.id.fill().then((t=>e.id=t))))),t=t.sort(((e,t)=>ce(e.id.name,t.id.name))),s=s.sort(((e,t)=>ce(e.id.name,t.id.name)));let a=!1;return e.name!==this.name&&(this.name=e.name,a=!0),(t.length!==this.spells.length||t.some(((e,t)=>!e.id.equals(this.spells[t].id))))&&(this.spells=t,a=!0),(s.length!==this.auras.length||s.some(((e,t)=>!e.id.equals(this.auras[t].id))))&&(this.auras=s,a=!0),a}}class Hn{constructor(){this.metadatas=[]}async update(e){const t=this.metadatas.length;if(e.length>t)for(let a=t;a<e.length;a++)this.metadatas.push(new qn);else e.length<t&&(this.metadatas=this.metadatas.slice(0,e.length));const s=await Promise.all(e.map(((e,t)=>this.metadatas[t].update(e))));return t!==this.metadatas.length||s.some((e=>e))}asList(){return this.metadatas.slice()}}const Bn={};function zn(e){const t=Bn[e];if(!t)throw new Error("No config registered for Spec: "+e);return t}const jn=class e{constructor(t,s){this.name="",this.buffs=k.create(),this.consumes=P.create(),this.bonusStats=new yn,this.gear=new C({}),this.enableItemSwap=!1,this.itemSwapGear=new T({}),this.profession1=0,this.profession2=0,this.aplRotation=N.create(),this.talentsString="",this.reactionTime=0,this.channelClipDelay=0,this.inFrontOfTarget=!1,this.distanceFromTarget=0,this.healingModel=_.create(),this.healingEnabled=!1,this.isbSbFrequency=3,this.isbCrit=25,this.isbWarlocks=1,this.isbSpriests=0,this.stormstrikeFrequency=20,this.stormstrikeNatureAttackerFrequency=4,this.autoRotationGenerator=null,this.simpleRotationGenerator=null,this.itemEPCache=new Array,this.randomSuffixEPCache=new Map,this.enchantEPCache=new Map,this.talents=null,this.epRatios=new Array(e.numEpRatios).fill(0),this.epWeights=new yn,this.currentStats=R.create(),this.metadata=new qn,this.petMetadatas=new Hn,this.nameChangeEmitter=new a("PlayerName"),this.buffsChangeEmitter=new a("PlayerBuffs"),this.consumesChangeEmitter=new a("PlayerConsumes"),this.bonusStatsChangeEmitter=new a("PlayerBonusStats"),this.gearChangeEmitter=new a("PlayerGear"),this.itemSwapChangeEmitter=new a("PlayerItemSwap"),this.professionChangeEmitter=new a("PlayerProfession"),this.raceChangeEmitter=new a("PlayerRace"),this.rotationChangeEmitter=new a("PlayerRotation"),this.talentsChangeEmitter=new a("PlayerTalents"),this.specOptionsChangeEmitter=new a("PlayerSpecOptions"),this.inFrontOfTargetChangeEmitter=new a("PlayerInFrontOfTarget"),this.distanceFromTargetChangeEmitter=new a("PlayerDistanceFromTarget"),this.healingModelChangeEmitter=new a("PlayerHealingModel"),this.epWeightsChangeEmitter=new a("PlayerEpWeights"),this.miscOptionsChangeEmitter=new a("PlayerMiscOptions"),this.currentStatsEmitter=new a("PlayerCurrentStats"),this.epRatiosChangeEmitter=new a("PlayerEpRatios"),this.epRefStatChangeEmitter=new a("PlayerEpRefStat"),this.sim=s,this.party=null,this.raid=null,this.spec=t,this.race=D[this.spec][0],this.specTypeFunctions=y[this.spec],this.specOptions=this.specTypeFunctions.optionsCreate();const i=Bn[this.spec];if(!i)throw new Error("Could not find spec config for spec: "+this.spec);this.autoRotationGenerator=i.autoRotation,i.simpleRotation?this.simpleRotationGenerator=i.simpleRotation:this.simpleRotationGenerator=null;for(let e=0;e<A.ItemSlotRanged+1;++e)this.itemEPCache[e]=new Map;this.changeEmitter=a.onAny([this.nameChangeEmitter,this.buffsChangeEmitter,this.consumesChangeEmitter,this.bonusStatsChangeEmitter,this.gearChangeEmitter,this.itemSwapChangeEmitter,this.professionChangeEmitter,this.raceChangeEmitter,this.rotationChangeEmitter,this.talentsChangeEmitter,this.specOptionsChangeEmitter,this.miscOptionsChangeEmitter,this.inFrontOfTargetChangeEmitter,this.distanceFromTargetChangeEmitter,this.healingModelChangeEmitter,this.epWeightsChangeEmitter,this.epRatiosChangeEmitter,this.epRefStatChangeEmitter],"PlayerChange")}getSpecIcon(){return L(this.spec,this.getTalentsString())}getClass(){return E[this.spec]}getClassColor(){return V[this.getClass()]}isSpec(e){return this.spec===e}isClass(e){return this.getClass()===e}getParty(){return this.party}getRaid(){return this.raid}getPartyIndex(){if(null===this.party)throw new Error("Can't get party index for player without a party!");return this.party.getPlayers().indexOf(this)}getRaidIndex(){if(null===this.party)throw new Error("Can't get raid index for player without a party!");return 5*this.party.getIndex()+this.getPartyIndex()}setParty(e){null===e?(this.party=null,this.raid=null):(this.party=e,this.raid=e.raid)}getOtherPartyMembers(){return null===this.party?[]:this.party.getPlayers().filter((e=>null!==e&&e!==this))}getItems(e){return this.sim.db.getItems(e).filter((t=>M(this,t,e)))}getRandomSuffixes(e){return e.randomSuffixOptions.map((e=>this.sim.db.getRandomSuffixById(e))).filter((e=>this.computeRandomSuffixEP(e)>0))}getEnchants(e){return this.sim.db.getEnchants(e).filter((e=>U(e,this)))}getEpWeights(){return this.epWeights}setEpWeights(e,t){this.epWeights=t,this.epWeightsChangeEmitter.emit(e),this.enchantEPCache=new Map,this.randomSuffixEPCache=new Map;for(let s=0;s<A.ItemSlotRanged+1;++s)this.itemEPCache[s]=new Map}getDefaultEpRatios(t,s){const a=new Array(e.numEpRatios).fill(0);return s?a[1]=1:t?(a[2]=1,a[3]=1):a[0]=1,a}getEpRatios(){return this.epRatios.slice()}setEpRatios(e,t){this.epRatios=t,this.epRatiosChangeEmitter.emit(e)}async computeStatWeights(e,t,s,a,i){try{const e=await this.sim.statWeights(this,t,s,a,i);return e.error?(e.error.type===W.ErrorOutcomeAborted&&new gn({variant:"info",body:"Statweight sim cancelled."}),null):e}catch(n){return console.error(n),new gn({variant:"error",body:n?.message||"Something went wrong calculating your stat weights. Reload the page and try again."}),null}}getCurrentStats(){return R.clone(this.currentStats)}setCurrentStats(e,t){this.currentStats=t,this.currentStatsEmitter.emit(e)}getMetadata(){return this.metadata}getPetMetadatas(){return this.petMetadatas}async updateMetadata(){const e=this.metadata.update(this.currentStats.metadata),t=this.petMetadatas.update(this.currentStats.pets.map((e=>e.metadata))),s=await e,a=await t;return s||a}getName(){return this.name}setName(e,t){t!==this.name&&(this.name=t,this.nameChangeEmitter.emit(e))}getLabel(){return this.party?`${this.name} (#${this.getRaidIndex()+1})`:this.name}getRace(){return this.race}setRace(e,t){t!==this.race&&(this.race=t,this.raceChangeEmitter.emit(e))}getProfession1(){return this.profession1}setProfession1(e,t){t!==this.profession1&&(this.profession1=t,this.professionChangeEmitter.emit(e))}getProfession2(){return this.profession2}setProfession2(e,t){t!==this.profession2&&(this.profession2=t,this.professionChangeEmitter.emit(e))}getProfessions(){return[this.profession1,this.profession2].filter((e=>e!==F.ProfessionUnknown))}setProfessions(e,t){a.freezeAllAndDo((()=>{this.setProfession1(e,t[0]||F.ProfessionUnknown),this.setProfession2(e,t[1]||F.ProfessionUnknown)}))}hasProfession(e){return this.getProfessions().includes(e)}isBlacksmithing(){return this.hasProfession(F.Blacksmithing)}getFaction(){return O[this.getRace()]}getBuffs(){return k.clone(this.buffs)}setBuffs(e,t){k.equals(this.buffs,t)||(this.buffs=k.clone(t),this.buffsChangeEmitter.emit(e))}getConsumes(){return P.clone(this.consumes)}setConsumes(e,t){P.equals(this.consumes,t)||(this.consumes=P.clone(t),this.consumesChangeEmitter.emit(e))}equipItem(e,t,s){this.setGear(e,this.gear.withEquippedItem(t,s))}getEquippedItem(e){return this.gear.getEquippedItem(e)}getGear(){return this.gear}setGear(e,t){t.equals(this.gear)||(this.gear=t,this.gearChangeEmitter.emit(e))}getEnableItemSwap(){return this.enableItemSwap}setEnableItemSwap(e,t){t!==this.enableItemSwap&&(this.enableItemSwap=t,this.itemSwapChangeEmitter.emit(e))}equipItemSwapitem(e,t,s){this.setItemSwapGear(e,this.itemSwapGear.withEquippedItem(t,s))}getItemSwapItem(e){return this.itemSwapGear.getEquippedItem(e)}getItemSwapGear(){return this.itemSwapGear}setItemSwapGear(e,t){t.equals(this.itemSwapGear)||(this.itemSwapGear=t,this.itemSwapChangeEmitter.emit(e))}getBonusStats(){return this.bonusStats}setBonusStats(e,t){t.equals(this.bonusStats)||(this.bonusStats=t,this.bonusStatsChangeEmitter.emit(e))}getMeleeCritCapInfo(e,t){let s=63;this.sim.encounter.targets&&(s=this.sim.encounter?.primaryTarget.level);const a=this.getGear().hasTwoHandedWeapon(),i=this.getGear().hasOffHandWeapon(),n=s-de,o=5*s,l=10*(1+n),r=3===n?n+1.8:n;let h=300;const m=(this.currentStats.finalStats?.stats[c.StatMeleeCrit]||0)/q,u=(this.currentStats.finalStats?.stats[c.StatMeleeHit]||0)/H,p=(this.currentStats.finalStats?.stats[c.StatExpertise]||0)/B/4,g=e=>this.currentStats.talentsStats?.pseudoStats[e]||0;if(!a)switch(e){case z.WeaponTypeUnknown:break;case z.WeaponTypeAxe:h+=g(d.PseudoStatAxesSkill);break;case z.WeaponTypeDagger:h+=g(d.PseudoStatDaggersSkill);break;case z.WeaponTypeFist:h+=g(d.PseudoStatUnarmedSkill);break;case z.WeaponTypeMace:h+=g(d.PseudoStatMacesSkill);break;case z.WeaponTypeSword:h+=g(d.PseudoStatSwordsSkill)}if(a)switch(e){case z.WeaponTypeUnknown:break;case z.WeaponTypeAxe:h+=g(d.PseudoStatTwoHandedAxesSkill);break;case z.WeaponTypeMace:h+=g(d.PseudoStatTwoHandedMacesSkill);break;case z.WeaponTypeSword:h+=g(d.PseudoStatTwoHandedSwordsSkill)}const f=o-h;let I=f<=10?5+.1*f:5+.2*f+.2*(f-10);I=this.getGear().isDualWielding()&&(this.spec!==j.SpecWarrior||t)?I+19:I+0;const w=5+.1*f;let b=0;this.getInFrontOfTarget()&&(b=3===n?14:5+.1*f);const S=Math.max(I-u,0),x=Math.max(w-p,0)+Math.max(b-p,0);let v=0;if(this.spec===j.SpecEnhancementShaman){v=3*this.getTalents().elementalDevastation}this.sim.raid.getDebuffs();const y=100-l+r-S-x-v;return{meleeCrit:m,meleeHit:u,expertise:p,glancing:l,suppression:r,debuffCrit:0,hasOffhandWeapon:i,meleeHitCap:I,dodgeCap:w,parryCap:b,baseCritCap:y,specSpecificOffset:v,playerCritCapDelta:m-y+0,remainingMeleeHitCap:S}}getSimpleRotation(){const e=this.aplRotation.simple?.specRotationJson||"";if(!e)return this.specTypeFunctions.rotationCreate();try{const t=JSON.parse(e);return this.specTypeFunctions.rotationFromJson(t)}catch(t){return console.warn(`Error parsing rotation spec options: ${t}\n\nSpec options: '${e}'`),this.specTypeFunctions.rotationCreate()}}setSimpleRotation(e,t){this.specTypeFunctions.rotationEquals(t,this.getSimpleRotation())||(this.aplRotation.simple||(this.aplRotation.simple=$.create()),this.aplRotation.simple.specRotationJson=JSON.stringify(this.specTypeFunctions.rotationToJson(t)),this.rotationChangeEmitter.emit(e))}getSimpleCooldowns(){return G.clone(this.aplRotation.simple?.cooldowns||G.create())}setSimpleCooldowns(e,t){G.equals(this.getSimpleCooldowns(),t)||(this.aplRotation.simple||(this.aplRotation.simple=$.create()),this.aplRotation.simple.cooldowns=t,this.rotationChangeEmitter.emit(e))}setAplRotation(e,t){N.equals(t,this.aplRotation)||(this.aplRotation=N.clone(t),this.rotationChangeEmitter.emit(e))}getRotationType(){return this.aplRotation.type===K.TypeUnknown?K.TypeAPL:this.aplRotation.type}hasSimpleRotationGenerator(){return null!==this.simpleRotationGenerator}getResolvedAplRotation(){const e=this.getRotationType();if(e===K.TypeAuto&&this.autoRotationGenerator){const e=N.clone(this.autoRotationGenerator(this));return e.type=K.TypeAuto,e}if(e===K.TypeSimple&&this.simpleRotationGenerator){const e=this.getSimpleRotation(),t=N.clone(this.simpleRotationGenerator(this,e,this.getSimpleCooldowns()));return t.simple=this.aplRotation.simple,t.type=K.TypeSimple,t}return this.aplRotation}getTalents(){return null===this.talents&&(this.talents=On(this.spec,this.talentsString)),this.talents}getTalentsString(){return this.talentsString}setTalentsString(e,t){t!==this.talentsString&&(this.talentsString=t,this.talents=null,this.talentsChangeEmitter.emit(e))}getTalentTree(){return J(this.getTalentsString())}getTalentTreePoints(){return Z(this.getTalentsString())}getTalentTreeIcon(){return L(this.spec,this.getTalentsString())}getSpecOptions(){return this.specTypeFunctions.optionsCopy(this.specOptions)}setSpecOptions(e,t){this.specTypeFunctions.optionsEquals(t,this.specOptions)||(this.specOptions=this.specTypeFunctions.optionsCopy(t),this.specOptionsChangeEmitter.emit(e))}getReactionTime(){return this.reactionTime}setReactionTime(e,t){t!==this.reactionTime&&(this.reactionTime=t,this.miscOptionsChangeEmitter.emit(e))}getChannelClipDelay(){return this.channelClipDelay}setChannelClipDelay(e,t){t!==this.channelClipDelay&&(this.channelClipDelay=t,this.miscOptionsChangeEmitter.emit(e))}getInFrontOfTarget(){return this.inFrontOfTarget}setInFrontOfTarget(e,t){t!==this.inFrontOfTarget&&(this.inFrontOfTarget=t,this.inFrontOfTargetChangeEmitter.emit(e))}getDistanceFromTarget(){return this.distanceFromTarget}setDistanceFromTarget(e,t){t!==this.distanceFromTarget&&(this.distanceFromTarget=t,this.distanceFromTargetChangeEmitter.emit(e))}setDefaultHealingParams(e){const t=this.sim.encounter.primaryTarget,s=t.dualWield;0===e.cadenceSeconds&&(e.cadenceSeconds=1.5*t.swingSpeed,s&&(e.cadenceSeconds/=2)),0===e.hps&&(e.hps=.175*t.minBaseDamage/t.swingSpeed,s&&(e.hps*=1.5))}enableHealing(){this.healingEnabled=!0;const e=this.getHealingModel();0!==e.cadenceSeconds&&0!==e.hps||(this.setDefaultHealingParams(e),this.setHealingModel(0,e))}getHealingModel(){return _.clone(this.healingModel)}setHealingModel(e,t){_.equals(this.healingModel,t)||(this.healingModel=_.clone(t),this.healingEnabled&&this.setDefaultHealingParams(this.healingModel),this.healingModelChangeEmitter.emit(e))}getIsbSbFrequency(){return this.isbSbFrequency}setIsbSbFrequency(e,t){t!==this.isbSbFrequency&&(this.isbSbFrequency=t,this.changeEmitter.emit(e))}getIsbCrit(){return this.isbCrit}setIsbCrit(e,t){t!==this.isbCrit&&(this.isbCrit=t,this.changeEmitter.emit(e))}getIsbWarlocks(){return this.isbWarlocks}setIsbWarlocks(e,t){t!==this.isbWarlocks&&(this.isbWarlocks=t,this.changeEmitter.emit(e))}getIsbSpriests(){return this.isbSpriests}setIsbSpriests(e,t){t!==this.isbSpriests&&(this.isbSpriests=t,this.changeEmitter.emit(e))}getStormstrikeFrequency(){return this.stormstrikeFrequency}setStormstrikeFrequency(e,t){t!==this.stormstrikeFrequency&&(this.stormstrikeFrequency=t,this.changeEmitter.emit(e))}getStormstrikeNatureAttackerFrequency(){return this.stormstrikeNatureAttackerFrequency}setStormstrikeNatureAttackerFrequency(e,t){t!==this.stormstrikeNatureAttackerFrequency&&(this.stormstrikeNatureAttackerFrequency=t,this.changeEmitter.emit(e))}computeStatsEP(e){return void 0===e?0:e.computeEP(this.epWeights)}computeEnchantEP(e){if(this.enchantEPCache.has(e.effectId))return this.enchantEPCache.get(e.effectId);let t=this.computeStatsEP(new yn(e.stats));return e.stats[c.StatMeleeHaste]>0&&(t+=this.epWeights.getPseudoStat(d.PseudoStatMeleeSpeedMultiplier)*e.stats[c.StatMeleeHaste],t+=this.epWeights.getPseudoStat(d.PseudoStatRangedSpeedMultiplier)*e.stats[c.StatMeleeHaste]),e.stats[c.StatSpellHaste]>0&&(t+=this.epWeights.getPseudoStat(d.PseudoStatCastSpeedMultiplier)*e.stats[c.StatSpellHaste]),this.enchantEPCache.set(e.effectId,t),t}computeRandomSuffixEP(e){if(this.randomSuffixEPCache.has(e.id))return this.randomSuffixEPCache.get(e.id);const t=this.computeStatsEP(new yn(e.stats));return this.randomSuffixEPCache.set(e.id,t),t}computeItemEP(e,t){if(null===e)return 0;const s=this.itemEPCache[t].get(e.id);if(void 0!==s)return s;let a=new yn(e.stats);if(e.weaponSpeed>0){const s=Y(e);t===A.ItemSlotMainHand?a=a.withPseudoStat(d.PseudoStatMainHandDps,s):t===A.ItemSlotOffHand?a=a.withPseudoStat(d.PseudoStatOffHandDps,s):t===A.ItemSlotRanged&&(a=a.withPseudoStat(d.PseudoStatRangedDps,s))}a=a.addPseudoStat(d.BonusPhysicalDamage,e.bonusPhysicalDamage);let i=0;if(e.randomSuffixOptions.length>0){const t=e.randomSuffixOptions.map((e=>this.computeRandomSuffixEP(this.sim.db.getRandomSuffixById(e))));i=Math.max(...t)}let n=a.computeEP(this.epWeights)+i;return e.unique&&(n-=.01),e.stats[c.StatMeleeHaste]>0&&(n+=this.epWeights.getPseudoStat(d.PseudoStatMeleeSpeedMultiplier)*e.stats[c.StatMeleeHaste],n+=this.epWeights.getPseudoStat(d.PseudoStatRangedSpeedMultiplier)*e.stats[c.StatMeleeHaste]),e.stats[c.StatSpellHaste]>0&&(n+=this.epWeights.getPseudoStat(d.PseudoStatCastSpeedMultiplier)*e.stats[c.StatSpellHaste]),this.itemEPCache[t].set(e.id,n),n}setWowheadData(e,t){const s=[],a=me(),i=a?a+".":"";s.push(`domain=${i}classic`),null!==e.enchant&&s.push("ench="+e.enchant.effectId),s.push("pcs="+this.gear.asArray().filter((e=>null!==e)).map((e=>e.item.id)).join(":")),t.dataset.wowhead=s.join("&"),t.dataset.whtticon="false"}filterItemData(t,s,a){const i=this.sim.getFilters(),n=(e,t)=>e.filter((e=>t(s(e))));if(0!==i.minIlvl&&(t=n(t,(e=>e.ilvl>=i.minIlvl))),0!==i.maxIlvl&&(t=n(t,(e=>e.ilvl<=i.maxIlvl))),i.factionRestriction!==Q.UNSPECIFIED&&(t=n(t,(e=>e.factionRestriction===i.factionRestriction||e.factionRestriction===Q.UNSPECIFIED))),i.sources.includes(X.SourceCrafting)||(t=n(t,(e=>!e.sources.some((e=>"crafted"===e.source.oneofKind))))),i.sources.includes(X.SourceQuest)||(t=n(t,(e=>!e.sources.some((e=>"quest"===e.source.oneofKind))))),i.sources.includes(X.SourceReputation)||(t=n(t,(e=>!e.sources.some((e=>"rep"===e.source.oneofKind))))),!i.sources.includes(X.SourceDungeon)){const e=[];for(const t in ee){const s=ee[t];"number"!=typeof s||0===s||i.raids.includes(s)||e.push(s)}t=n(t,(t=>!t.sources.some((t=>"drop"===t.source.oneofKind&&e.includes(t.source.drop.zoneId)))))}if(!i.sources.includes(X.SourceRaid)){const e=[];for(const t in te){const s=te[t];"number"!=typeof s||0===s||i.raids.includes(s)||e.push(s)}t=n(t,(t=>!t.sources.some((t=>"drop"===t.source.oneofKind&&e.includes(t.source.drop.zoneId)))))}for(const e in se){const s=se[e];"number"==typeof s&&0!==s&&(t=n(t,(e=>!e.sources.some((e=>"drop"===e.source.oneofKind&&e.source.drop.zoneId===s)))))}return i.sources.includes(X.SourceWorldBOE)||(t=n(t,(e=>0===e.randomSuffixOptions.length))),e.ARMOR_SLOTS.includes(a)?t=n(t,(e=>i.armorTypes.includes(e.armorType))):e.WEAPON_SLOTS.includes(a)?t=n(t,(e=>{if(!i.weaponTypes.includes(e.weaponType))return!1;if(!i.oneHandedWeapons&&e.handType!==he.HandTypeTwoHand)return!1;if(!i.twoHandedWeapons&&e.handType===he.HandTypeTwoHand)return!1;const t=a===A.ItemSlotMainHand?i.minMhWeaponSpeed:i.minOhWeaponSpeed,s=a===A.ItemSlotMainHand?i.maxMhWeaponSpeed:i.maxOhWeaponSpeed;return!(t>0&&e.weaponSpeed<t)&&!(s>0&&e.weaponSpeed>s)})):a===A.ItemSlotRanged&&(t=n(t,(e=>{if(!i.rangedWeaponTypes.includes(e.rangedWeaponType))return!1;const t=i.minRangedWeaponSpeed,s=i.maxRangedWeaponSpeed;return!(t>0&&e.weaponSpeed<t)&&!(s>0&&e.weaponSpeed>s)}))),t}filterEnchantData(e,t,s,a){return a?e.filter((e=>{const s=t(e);return!!ae(s,a.item)})):e}makeUnitReference(){return null===this.party?ie():ne(this.getRaidIndex())}toDatabase(){const e=this.getGear().toDatabase(),t=this.getItemSwapGear().toDatabase();return oe.mergeSimDatabases(e,t)}toProto(e,t,s){const a=e=>!s||0===s.length||s.includes(e),i=this.getGear(),o=t?this.getResolvedAplRotation():this.aplRotation;let l=n.create({class:this.getClass(),database:e?void 0:this.toDatabase()});return a(fn.Gear)&&n.mergePartial(l,{equipment:i.asSpec(),bonusStats:this.getBonusStats().toProto(),enableItemSwap:this.getEnableItemSwap(),itemSwap:this.getItemSwapGear().toProto()}),a(fn.Talents)&&n.mergePartial(l,{talentsString:this.getTalentsString()}),a(fn.Rotation)&&n.mergePartial(l,{cooldowns:G.create({hpPercentForDefensives:this.getSimpleCooldowns().hpPercentForDefensives}),rotation:o}),a(fn.Consumes)&&n.mergePartial(l,{consumes:this.getConsumes()}),a(fn.Miscellaneous)&&(n.mergePartial(l,{name:this.getName(),race:this.getRace(),profession1:this.getProfession1(),profession2:this.getProfession2(),reactionTimeMs:this.getReactionTime(),channelClipDelayMs:this.getChannelClipDelay(),inFrontOfTarget:this.getInFrontOfTarget(),distanceFromTarget:this.getDistanceFromTarget(),healingModel:this.getHealingModel(),isbSbFrequency:this.getIsbSbFrequency(),isbCrit:this.getIsbCrit(),isbWarlocks:this.getIsbWarlocks(),isbSpriests:this.getIsbSpriests(),stormstrikeFrequency:this.getStormstrikeFrequency(),stormstrikeNatureAttackerFrequency:this.getStormstrikeNatureAttackerFrequency()}),l=le(this.spec,l,this.getSpecOptions())),a(fn.External)&&n.mergePartial(l,{buffs:this.getBuffs()}),l}fromProto(e,t,s){const i=e=>!s||0===s.length||s.includes(e);t.rotation?.type===K.TypeLegacy&&(t.rotation.type=K.TypeAuto),a.freezeAllAndDo((()=>{i(fn.Gear)&&(this.setGear(e,t.equipment?this.sim.db.lookupEquipmentSpec(t.equipment):new C({})),this.setEnableItemSwap(e,t.enableItemSwap),this.setItemSwapGear(e,t.itemSwap?this.sim.db.lookupItemSwap(t.itemSwap):new T({})),this.setBonusStats(e,yn.fromProto(t.bonusStats||u.create()))),i(fn.Talents)&&this.setTalentsString(e,t.talentsString),i(fn.Rotation)&&(t.rotation?.type!==K.TypeUnknown&&t.rotation?.type!==K.TypeLegacy||(t.rotation||(t.rotation=N.create()),t.rotation.type=K.TypeAuto),this.setAplRotation(e,t.rotation||N.create())),i(fn.Consumes)&&this.setConsumes(e,t.consumes||P.create()),i(fn.Miscellaneous)&&(this.setSpecOptions(e,this.specTypeFunctions.optionsFromPlayer(t)),this.setName(e,t.name),this.setRace(e,t.race),this.setProfession1(e,t.profession1),this.setProfession2(e,t.profession2),this.setReactionTime(e,t.reactionTimeMs),this.setChannelClipDelay(e,t.channelClipDelayMs),this.setInFrontOfTarget(e,t.inFrontOfTarget),this.setDistanceFromTarget(e,t.distanceFromTarget),this.setHealingModel(e,t.healingModel||_.create()),this.setIsbSbFrequency(e,t.isbSbFrequency),this.setIsbCrit(e,t.isbCrit),this.setIsbWarlocks(e,t.isbWarlocks),this.setIsbSpriests(e,t.isbSpriests),this.setStormstrikeFrequency(e,t.stormstrikeFrequency),this.setStormstrikeNatureAttackerFrequency(e,t.stormstrikeNatureAttackerFrequency)),i(fn.External)&&this.setBuffs(e,t.buffs||k.create())}))}clone(t){const s=new e(this.spec,this.sim);return s.fromProto(t,this.toProto()),s}applySharedDefaults(e){a.freezeAllAndDo((()=>{this.setEnableItemSwap(e,!1),this.setItemSwapGear(e,new T({})),this.setReactionTime(e,200),this.setInFrontOfTarget(e,re(this.spec)),this.setHealingModel(e,_.create({burstWindow:re(this.spec)?6:0})),this.setSimpleCooldowns(e,G.create({hpPercentForDefensives:re(this.spec)?.35:0})),this.setBonusStats(e,new yn),this.setAplRotation(e,N.create({type:K.TypeAuto}))}))}};jn.numEpRatios=6,jn.ARMOR_SLOTS=[A.ItemSlotHead,A.ItemSlotShoulder,A.ItemSlotChest,A.ItemSlotWrist,A.ItemSlotHands,A.ItemSlotLegs,A.ItemSlotWaist,A.ItemSlotFeet],jn.WEAPON_SLOTS=[A.ItemSlotMainHand,A.ItemSlotOffHand];let $n=jn;class Gn{constructor(e){this.duration=120,this.durationVariation=15,this.executeProportion20=.2,this.executeProportion25=.25,this.executeProportion35=.35,this.useHealth=!1,this.targetsChangeEmitter=new a,this.durationChangeEmitter=new a,this.executeProportionChangeEmitter=new a,this.changeEmitter=new a,this.sim=e,this.targetsMetadata=new Hn,e.waitForInit().then((()=>{const t=Gn.getDefaultTarget(e);this.targets=[t.target],[this.targetsChangeEmitter,this.durationChangeEmitter,this.executeProportionChangeEmitter].forEach((e=>e.on((e=>this.changeEmitter.emit(e)))))}))}get primaryTarget(){return ue.clone(this.targets[0])}getDurationVariation(){return this.durationVariation}setDurationVariation(e,t){t!=this.durationVariation&&(this.durationVariation=t,this.durationChangeEmitter.emit(e))}getDuration(){return this.duration}setDuration(e,t){t!=this.duration&&(this.duration=t,this.durationChangeEmitter.emit(e))}getExecuteProportion20(){return this.executeProportion20}setExecuteProportion20(e,t){t!=this.executeProportion20&&(this.executeProportion20=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion25(){return this.executeProportion25}setExecuteProportion25(e,t){t!=this.executeProportion25&&(this.executeProportion25=t,this.executeProportionChangeEmitter.emit(e))}getExecuteProportion35(){return this.executeProportion35}setExecuteProportion35(e,t){t!=this.executeProportion35&&(this.executeProportion35=t,this.executeProportionChangeEmitter.emit(e))}getUseHealth(){return this.useHealth}setUseHealth(e,t){t!=this.useHealth&&(this.useHealth=t,this.durationChangeEmitter.emit(e),this.executeProportionChangeEmitter.emit(e))}matchesPreset(e){return e.targets.length==this.targets.length&&this.targets.every(((t,s)=>ue.equals(t,e.targets[s].target)))}applyPreset(e,t){this.targets=t.targets.map((e=>e.target||ue.create())),this.targetsChangeEmitter.emit(e)}applyPresetTarget(e,t,s){this.targets[s]=t.target||ue.create(),this.targetsChangeEmitter.emit(e)}toProto(){return pe.create({duration:this.duration,durationVariation:this.durationVariation,executeProportion20:this.executeProportion20,executeProportion25:this.executeProportion25,executeProportion35:this.executeProportion35,useHealth:this.useHealth,targets:this.targets})}fromProto(e,t){a.freezeAllAndDo((()=>{this.setDuration(e,t.duration),this.setDurationVariation(e,t.durationVariation),this.setExecuteProportion20(e,t.executeProportion20),this.setExecuteProportion25(e,t.executeProportion25),this.setExecuteProportion35(e,t.executeProportion35),this.setUseHealth(e,t.useHealth),this.targets=t.targets,this.targetsChangeEmitter.emit(e)}))}applyDefaults(e){const t=Gn.getDefaultTarget(this.sim);this.fromProto(e,pe.create({duration:120,durationVariation:15,executeProportion20:.2,executeProportion25:.25,executeProportion35:.35,targets:[t.target]}))}static getDefaultTarget(e){return e.db.getAllPresetTargets()[0]}}const Kn=8;class Jn{constructor(e){this.buffs=ge.create(),this.debuffs=fe.create(),this.tanks=[],this.targetDummies=0,this.numActiveParties=5,this.compChangeEmitter=new a,this.buffsChangeEmitter=new a,this.debuffsChangeEmitter=new a,this.tanksChangeEmitter=new a,this.targetDummiesChangeEmitter=new a,this.numActivePartiesChangeEmitter=new a,this.sim=e,this.parties=[...Array(8).keys()].map((t=>{const s=new bn(this,e);return s.compChangeEmitter.on((e=>this.compChangeEmitter.emit(e))),s.changeEmitter.on((e=>this.changeEmitter.emit(e))),s})),this.activePlayers=[],this.numActivePartiesChangeEmitter.on((e=>this.compChangeEmitter.emit(e))),this.changeEmitter=a.onAny([this.compChangeEmitter,this.buffsChangeEmitter,this.debuffsChangeEmitter,this.tanksChangeEmitter,this.targetDummiesChangeEmitter],"RaidChange"),this.changeEmitter.on((()=>{this.activePlayers=[]}))}size(){return I(this.parties.map((e=>e.size())))}isEmpty(){return 0==this.size()}getParties(){return this.parties.slice()}getParty(e){return this.parties[e]}getPlayers(){return this.parties.map((e=>e.getPlayers())).flat()}getPlayer(e){if(-1===e)return null;return this.parties[Math.floor(e/5)].getPlayer(e%5)}getPlayerFromUnitReference(e,t){return e&&e.type!=Ie.Unknown?e.type==Ie.Player?this.getPlayer(e.index):e.type==Ie.Self&&t||null:null}setPlayer(e,t,s){this.parties[Math.floor(t/5)].setPlayer(e,t%5,s)}getClassCount(e){return this.getPlayers().filter((t=>null!=t&&t.getClass()==e)).length}getBuffs(){return ge.clone(this.buffs)}setBuffs(e,t){ge.equals(this.buffs,t)||(this.buffs=ge.clone(t),this.buffsChangeEmitter.emit(e))}getDebuffs(){return fe.clone(this.debuffs)}setDebuffs(e,t){fe.equals(this.debuffs,t)||(this.debuffs=fe.clone(t),this.debuffsChangeEmitter.emit(e))}getTanks(){return this.tanks.map((e=>we.clone(e)))}setTanks(e,t){this.tanks.length==t.length&&this.tanks.every(((e,s)=>we.equals(e,t[s])))||(this.tanks=t.map((e=>we.clone(e))),this.tanksChangeEmitter.emit(e))}getTargetDummies(){return this.targetDummies}setTargetDummies(e,t){this.targetDummies!=t&&(this.targetDummies=t,this.targetDummiesChangeEmitter.emit(e))}getNumActiveParties(){return this.numActiveParties}setNumActiveParties(e,t){t!=this.numActiveParties&&t>0&&(this.numActiveParties=t,this.numActivePartiesChangeEmitter.emit(e))}getActivePlayers(){if(0==this.activePlayers.length){const e=this.getParties().filter(((e,t)=>t<this.numActiveParties));this.activePlayers=e.map((e=>e.getPlayers())).flat().filter((e=>null!=e))}return this.activePlayers}toProto(e,t){return be.create({parties:this.parties.map((s=>s.toProto(e,t))),buffs:this.getBuffs(),debuffs:this.getDebuffs(),tanks:this.getTanks(),targetDummies:this.getTargetDummies(),numActiveParties:this.getNumActiveParties()})}fromProto(e,t){a.freezeAllAndDo((()=>{this.setBuffs(e,t.buffs||ge.create()),this.setDebuffs(e,t.debuffs||fe.create()),this.setTanks(e,t.tanks),this.setTargetDummies(e,t.targetDummies),this.setNumActiveParties(e,t.numActiveParties||5);for(let s=0;s<8;s++)t.parties[s]?this.parties[s].fromProto(e,t.parties[s]):this.parties[s].clear(e)}))}clear(e){a.freezeAllAndDo((()=>{for(let t=0;t<8;t++)this.parties[t].clear(e)}))}}class Zn{constructor(e,t){this.concurrency=e,this.iterationsTotal=t,this.iterationsDone=Array(this.concurrency).fill(0),this.dpsValues=Array(this.concurrency).fill(0),this.hpsValues=Array(this.concurrency).fill(0),this.finalResults=Array(this.concurrency)}getIterationsDone(){let e=0;for(const t of this.iterationsDone)e+=t;return e}getDpsAvg(){let e=0;for(const t of this.dpsValues)e+=t;return e/this.concurrency}getHpsAvg(){let e=0;for(const t of this.hpsValues)e+=t;return e/this.concurrency}updateProgress(e,t){this.iterationsDone[e]=t.completedIterations,this.dpsValues[e]=t.dps,this.hpsValues[e]=t.hps,t.finalRaidResult&&(this.finalResults[e]=t.finalRaidResult)}makeProgressMetrics(){return ke.create({totalIterations:this.iterationsTotal,completedIterations:this.getIterationsDone(),dps:this.getDpsAvg(),hps:this.getHpsAvg()})}}const Yn=(e,t)=>{const s=Pe.create();return"string"==typeof e?(console.error(e),s.error=xe.create({message:e})):(e.message&&console.error(e.message),s.error=e),t(ke.create({finalRaidResult:s})),s},Qn=async(e,t,s,a)=>{console.log(`Sending requests split for ${t.getNumWorkers()} splits.`);const i=await t.raidSimRequestSplit(Se.create({splitCount:t.getNumWorkers(),request:e}));if(i.errorResult)return Yn(i.errorResult,s);if(a.abort.isTriggered())return Yn(xe.create({type:W.ErrorOutcomeAborted}),s);console.log(`Running ${e.simOptions.iterations} iterations on ${i.splitsDone} concurrent sims...`);const n=await((e,t,s,a,i)=>new Promise((n=>{const o=new Zn(e.length,t);let l=0,r=e.length;const c=(e,t)=>{if(r&&(o.updateProgress(e,t),l++,l%r==0&&a(o.makeProgressMetrics()),t.finalRaidResult)){let s;if(r--,t.finalRaidResult.error&&(t.finalRaidResult.error.type==W.ErrorOutcomeError&&console.error(`Worker ${e} had an error!`),s=t.finalRaidResult,i.abort.trigger()),s||0==r){r=0;const e=o.makeProgressMetrics();return e.finalRaidResult=s,a(e),void n({errorResult:s,results:o.finalResults,progressMetricsFinal:e})}}};for(let t=0;t<e.length;t++)s.raidSimAsync(e[t],(e=>c(t,e)),i)})))(i.requests,e.simOptions.iterations,t,s,a);if(n.errorResult&&n.errorResult.error)return Yn(n.errorResult.error,s);if(a.abort.isTriggered())return Yn(xe.create({type:W.ErrorOutcomeAborted}),s);console.log(`All ${i.splitsDone} sims finished successfully. Combining ${n.results.length} results.`);const o=await t.raidSimResultCombination(ve.create({results:n.results}));return o.error?Yn(o.error,s):(n.progressMetricsFinal.finalRaidResult=o,s(n.progressMetricsFinal),o)},Xn=(e,t)=>{const s=Pe.create();return"string"==typeof e?(console.error(e),s.error=xe.create({message:e})):(e.message&&console.error(e.message),s.error=e),t(ke.create({finalWeightResult:s})),s};var eo=(e=>(e.bulkSimAsync="bulkSimAsync",e.computeStats="computeStats",e.computeStatsJson="computeStatsJson",e.raidSim="raidSim",e.raidSimJson="raidSimJson",e.raidSimAsync="raidSimAsync",e.statWeights="statWeights",e.statWeightsAsync="statWeightsAsync",e.statWeightRequests="statWeightRequests",e.statWeightCompute="statWeightCompute",e.raidSimRequestSplit="raidSimRequestSplit",e.raidSimResultCombination="raidSimResultCombination",e.abortById="abortById",e))(eo||{});const to=`/${Fe}/sim_worker.js`,so=e=>e+"-"+Array.from(Array(4)).map((()=>Math.floor(65536*Math.random()).toString(16))).join("");class ao{constructor(e){this.workers=[],this.workersDisabled=[],this.setNumWorkers(e)}setNumWorkers(e){if(e<this.workers.length){for(let t=this.workers.length-1;t>=e;t--)this.workers[t].disable(),this.workersDisabled[t]=this.workers[t];this.workers.length=e}else for(let t=0;t<e;t++)this.workers[t]||(this.workersDisabled[t]?(this.workers[t]=this.workersDisabled[t],delete this.workersDisabled[t],this.workers[t].enable()):this.workers[t]=new io(t))}getNumWorkers(){return this.workers.length}getLeastBusyWorker(){return this.workers.reduce(((e,t)=>e.getSimTaskWorkAmount()<t.getSimTaskWorkAmount()?e:t))}async makeApiCall(e,t){return await this.getLeastBusyWorker().doApiCall(e,t,so(e))}async computeStats(e){const t=await this.makeApiCall(eo.computeStats,Ce.toBinary(e));return Te.fromBinary(t)}getProgressName(e){return`${e}progress`}async statWeightsAsync(e,t,s){const a=this.getLeastBusyWorker();a.log("Stat weights request: "+Ne.toJsonString(e));const i=so(eo.statWeightsAsync);s.abort.onTrigger((async()=>{await a.sendAbortById(i)}));const n=e.simOptions?e.simOptions.iterations*e.statsToWeigh.length:3e4,o=await this.doAsyncRequest(eo.statWeightsAsync,Ne.toBinary(e),i,a,t,n);return a.log("Stat weights result: "+_e.toJsonString(o.finalWeightResult)),o.finalWeightResult}async statWeightRequests(e){const t=await this.makeApiCall(eo.statWeightRequests,Ne.toBinary(e));return Re.fromBinary(t)}async statWeightCompute(e){const t=await this.makeApiCall(eo.statWeightCompute,ye.toBinary(e));return _e.fromBinary(t)}async bulkSimAsync(e,t,s){const a=this.getLeastBusyWorker();a.log("bulk sim request: "+De.toJsonString(e,{enumAsInteger:!0}));const i=so(eo.bulkSimAsync);s.abort.onTrigger((async()=>{await a.sendAbortById(i)}));const n=e.baseSettings?.simOptions?.iterations??3e4,o=await this.doAsyncRequest(eo.bulkSimAsync,De.toBinary(e),i,a,t,n),l=Ae.toJson(o.finalBulkResult);return a.log("bulk sim result: "+JSON.stringify(l)),o.finalBulkResult}async raidSimAsync(e,t,s){const a=this.getLeastBusyWorker();a.log("Raid sim request: "+Le.toJsonString(e));const i=so(eo.raidSimAsync);s.abort.onTrigger((async()=>{await a.sendAbortById(i)}));const n=e.simOptions?.iterations??3e3,o=await this.doAsyncRequest(eo.raidSimAsync,Le.toBinary(e),i,a,t,n),l=Pe.toJson(o.finalRaidResult);return delete l.logs,a.log("Raid sim result: "+JSON.stringify(l)),o.finalRaidResult}async raidSimRequestSplit(e){const t=await this.makeApiCall(eo.raidSimRequestSplit,Se.toBinary(e));return Ve.fromBinary(t)}async raidSimResultCombination(e){const t=await this.makeApiCall(eo.raidSimResultCombination,ve.toBinary(e));return Pe.fromBinary(t)}isWasm(){return this.workers[0].isWasmWorker()}async doAsyncRequest(e,t,s,a,i,n){try{a.addSimTaskRunning(s,n),a.doApiCall(e,t,s);const o=new Promise((e=>{a.addPromiseFunc(this.getProgressName(s),this.newProgressHandler(s,a,i,(t=>e(t))),Me)}));return await o}finally{a.updateSimTask(s,0)}}newProgressHandler(e,t,s,a){return i=>{const n=ke.fromBinary(i);s(n),t.updateSimTask(e,Math.max(1,n.totalIterations-n.completedIterations)),null==n.finalRaidResult&&null==n.finalWeightResult&&null==n.finalBulkResult?t.addPromiseFunc(this.getProgressName(e),this.newProgressHandler(e,t,s,a),Me):a(n)}}}class io{constructor(e){this.workerId=e,this.simTasksRunning={},this.taskIdsToPromiseFuncs={},this.wasmWorker=!1,this.shouldDestroy=!1,this.onReady=new Promise(((e,t)=>{this.resolveReady=e})),this.setupWorker(),this.log("Created.")}setupWorker(){this.setTaskActive("setup",!0),this.onReady=new Promise(((e,t)=>{this.resolveReady=e})),this.worker=new window.Worker(to),this.worker.addEventListener("message",(({data:e})=>{const{id:t,msg:s,outputData:a}=e;switch(s){case"ready":this.wasmWorker=!!a&&!!a[0],this.postMessage({msg:"setID",id:this.workerId.toString()}),this.resolveReady(),this.setTaskActive("setup",!1),this.log(`Ready, isWasm: ${this.wasmWorker}`);break;case"idConfirm":break;default:const e=this.taskIdsToPromiseFuncs[t];if(!e)return void console.warn(`Unrecognized result id ${t} for msg ${s}`);t.includes("progress")||this.setTaskActive(t,!1),delete this.taskIdsToPromiseFuncs[t],e[0](a)}}))}addSimTaskRunning(e,t){this.simTasksRunning[e]={workLeft:t},this.log(`Added work ${e}, current work amount: ${this.getSimTaskWorkAmount()}`)}updateSimTask(e,t){if(t<=0)return delete this.simTasksRunning[e],this.log(`Work ${e} done, current work amount: ${this.getSimTaskWorkAmount()}`),void(this.shouldDestroy&&0==this.getSimTaskWorkAmount()&&this.disable(!0));this.simTasksRunning[e].workLeft=t}getSimTaskWorkAmount(){let e=0;for(const t of Object.values(this.simTasksRunning))e+=t.workLeft;return e}hasTaskId(e){return!!this.simTasksRunning[e]}setTaskActive(e,t){t?this.addSimTaskRunning(e+"task",1):this.updateSimTask(e+"task",0)}async isWasmWorker(){if(!this.onReady||this.shouldDestroy)throw new Error("Disabled worker was used!");return await this.onReady,this.wasmWorker}addPromiseFunc(e,t,s){this.taskIdsToPromiseFuncs[e]=[t,s]}async doApiCall(e,t,s){if(!this.onReady||this.shouldDestroy)throw new Error("Disabled worker was used!");if(!s)throw new Error("ApiCall with empty id!");this.setTaskActive(s,!0),await this.onReady;const a=new Promise(((a,i)=>{this.taskIdsToPromiseFuncs[s]=[a,i],this.postMessage({msg:e,id:s,inputData:t})}));return await a}postMessage(e){if(!this.worker)throw new Error(`Worker ${this.workerId} postMessage while disabled!`);this.worker.postMessage(e)}disable(e=!1){this.shouldDestroy=!0,!this.worker||!e&&this.getSimTaskWorkAmount()||(this.worker.terminate(),delete this.worker,delete this.onReady,delete this.resolveReady,this.log("Disabled."))}enable(){this.shouldDestroy=!1,this.worker||(this.setupWorker(),this.log("Enabled."))}log(e){console.log(`Worker ${this.workerId}: ${e}`)}async sendAbortById(e){const t=Ue.toBinary(Ue.create({requestId:e})),s=so(eo.abortById),a=await this.doApiCall(eo.abortById,t,s);return We.fromBinary(a)}}const no="classic_wasmconcurrency",oo=class e{constructor(){this.iterations=3e3,this.phase=Oe,this.faction=qe.Alliance,this.fixedRngSeed=0,this.filters=e.defaultFilters(),this.showDamageMetrics=!0,this.showThreatMetrics=!1,this.showHealingMetrics=!1,this.showExperimental=!1,this.wasmConcurrency=0,this.showEPValues=!1,this.language="",this.db_=null,this.iterationsChangeEmitter=new a,this.phaseChangeEmitter=new a,this.factionChangeEmitter=new a,this.fixedRngSeedChangeEmitter=new a,this.lastUsedRngSeedChangeEmitter=new a,this.filtersChangeEmitter=new a,this.showDamageMetricsChangeEmitter=new a,this.showThreatMetricsChangeEmitter=new a,this.showHealingMetricsChangeEmitter=new a,this.showExperimentalChangeEmitter=new a,this.wasmConcurrencyChangeEmitter=new a,this.showEPValuesChangeEmitter=new a,this.languageChangeEmitter=new a,this.crashEmitter=new a,this.unitMetadataEmitter=new a("UnitMetadata"),this.simResultEmitter=new a,this.bulkSimStartEmitter=new a,this.bulkSimResultEmitter=new a,this.lastUsedRngSeed=0,this.modifyRaidProto=Me,this.workerPool=new ao(1),this.wasmConcurrencyChangeEmitter.on((async()=>{if(await this.workerPool.isWasm()){const e=Math.max(1,Math.min(this.wasmConcurrency,navigator.hardwareConcurrency));this.workerPool.setNumWorkers(e)}}));let t=parseInt(window.localStorage.getItem(no)??"NaN");isNaN(t)&&(t=0,navigator.hardwareConcurrency>1&&(t=Math.min(4,Math.floor(navigator.hardwareConcurrency/2)))),this.setWasmConcurrency(a.nextEventID(),t),this.signalManager=new He,this._initPromise=oe.get().then((e=>{this.db_=e})),this.raid=new Jn(this),this.encounter=new Gn(this),this.settingsChangeEmitter=a.onAny([this.iterationsChangeEmitter,this.phaseChangeEmitter,this.fixedRngSeedChangeEmitter,this.filtersChangeEmitter,this.showDamageMetricsChangeEmitter,this.showThreatMetricsChangeEmitter,this.showHealingMetricsChangeEmitter,this.showExperimentalChangeEmitter,this.showEPValuesChangeEmitter,this.languageChangeEmitter]),this.changeEmitter=a.onAny([this.settingsChangeEmitter,this.raid.changeEmitter,this.encounter.changeEmitter]),a.onAny([this.raid.changeEmitter,this.encounter.changeEmitter]).on((e=>this.updateCharacterStats(e)))}waitForInit(){return this._initPromise}isWasm(){return this.workerPool.isWasm()}async shouldUseWasmConcurrency(){return await this.isWasm()&&this.getWasmConcurrency()>=2&&this.workerPool.getNumWorkers()>=2}get db(){return this.db_}setModifyRaidProto(e){this.modifyRaidProto=e}getModifiedRaidProto(){const e=this.raid.toProto(!1,!0);return this.modifyRaidProto(e),e.parties.forEach((e=>{e.players.forEach((e=>{e.equipment&&this.db.lookupEquipmentSpec(e.equipment)}))})),e}makeRaidSimRequest(e){const t=this.getModifiedRaidProto(),s=this.encounter.toProto();return Le.create({raid:t,encounter:s,simOptions:Be.create({iterations:e?1:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debugFirstIteration:!0})})}async runBulkSim(e,t,s){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const i=De.create({baseSettings:this.makeRaidSimRequest(!1),bulkSettings:e});if(null!=i.baseSettings&&null!=i.baseSettings.simOptions&&(i.baseSettings.simOptions.debugFirstIteration=!1),!i.baseSettings?.raid||0==i.baseSettings?.raid?.parties.length||0==i.baseSettings?.raid?.parties[0].players.length)throw new Error("Raid must contain exactly 1 player for bulk sim.");const n=i.baseSettings.raid.parties[0].players[0].database;n?.items.push(...t.items),n?.enchants.push(...t.enchants),this.bulkSimStartEmitter.emit(a.nextEventID(),i);const o=this.signalManager.registerRunning(ze.BulkSim);try{const e=await this.workerPool.bulkSimAsync(i,s,o);if(e.error){if(e.error.type!=W.ErrorOutcomeError)return e;throw new ro(e.error.message)}return this.bulkSimResultEmitter.emit(a.nextEventID(),e),e}catch(l){if(l instanceof ro)throw l;throw console.log(l),new Error("Something went wrong running your raid sim. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(o)}}async runRaidSim(e,t){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");await this.waitForInit();const s=this.signalManager.registerRunning(ze.RaidSim);try{await this.waitForInit();const a=this.makeRaidSimRequest(!1);let i;if(i=await this.shouldUseWasmConcurrency()?await Qn(a,this.workerPool,t,s):await this.workerPool.raidSimAsync(a,t,s),i.error){if(i.error.type!=W.ErrorOutcomeError)return i.error;throw new ro(i.error.message)}const n=await je.makeNew(a,i);return this.simResultEmitter.emit(e,n),n}catch(a){if(a instanceof ro)throw a;throw console.error(a),new Error("Something went wrong running your raid sim. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(s)}}async runRaidSimWithLogs(e){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");const t=this.signalManager.registerRunning(ze.RaidSim);try{await this.waitForInit();const s=this.makeRaidSimRequest(!0),a=await this.workerPool.raidSimAsync(s,Me,t);if(a.error)throw new ro(a.error.message);const i=await je.makeNew(s,a);return this.simResultEmitter.emit(e,i),i}catch(s){if(s instanceof ro)throw s;throw console.error(s),new Error("Something went wrong running your raid sim. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(t)}}async updateCharacterStats(e){if(0==e)return;e=a.nextEventID(),await this.waitForInit();const t=this.raid.getPlayers(),s=Ce.create({raid:this.getModifiedRaidProto(),encounter:this.encounter.toProto()}),i=await this.workerPool.computeStats(s);""==i.errorResult?a.freezeAllAndDo((async()=>{const s=i.raidStats.parties.map(((s,a)=>s.players.map(((s,i)=>{const n=t[5*a+i];return n?(n.setCurrentStats(e,s),n.updateMetadata()):null})))).flat().filter((e=>null!=e)),a=this.encounter.targetsMetadata.update(i.encounterStats.targets.map((e=>e.metadata)));(await Promise.all(s.concat([a]))).some((e=>e))&&this.unitMetadataEmitter.emit(e)})):this.crashEmitter.emit(e,new ro(i.errorResult))}async statWeights(e,t,s,a,i){if(this.raid.isEmpty())throw new Error("Raid is empty! Try adding some players first.");if(this.encounter.targets.length<1)throw new Error("Encounter has no targets! Try adding some targets first.");if(await this.waitForInit(),null==e.getParty())return console.warn("Trying to get stat weights without a party!"),_e.create();{const o=this.raid.getTanks().map((e=>e.index)).includes(e.getRaidIndex())?[we.create({type:Ie.Player,index:0})]:[],l=Ne.create({player:e.toProto(!1,!0),raidBuffs:this.raid.getBuffs(),partyBuffs:e.getParty().getBuffs(),debuffs:this.raid.getDebuffs(),encounter:this.encounter.toProto(),simOptions:Be.create({iterations:this.getIterations(),randomSeed:BigInt(this.nextRngSeed()),debug:!1}),tanks:o,statsToWeigh:t,pseudoStatsToWeigh:s,epReferenceStat:a}),r=this.signalManager.registerRunning(ze.StatWeights);try{let e;if(e=await this.shouldUseWasmConcurrency()?await(async(e,t,s,a)=>{console.log("Getting stat weight sim requests.");const i=await t.statWeightRequests(e);if(a.abort.isTriggered())return Xn(xe.create({type:W.ErrorOutcomeAborted}),s);let n=i.baseRequest.simOptions.iterations,o=0,l=1,r=0;for(const p of i.statSimRequests)n+=p.requestLow.simOptions.iterations+p.requestHigh.simOptions.iterations,l+=2;console.log(`Need to run a total of ${l} sims and ${n} iterations.`);let c=0;const d=e=>{o+=e.completedIterations-c,c=e.completedIterations,s(ke.create({totalIterations:n,completedIterations:o,totalSims:l,completedSims:r})),e.finalRaidResult&&r++},h=await Qn(i.baseRequest,t,d,a);if(h.error)return Xn(h.error,s);const m=ye.create({baseResult:h,epReferenceStat:i.epReferenceStat,statSimResults:[]});for(const p of i.statSimRequests){if(a.abort.isTriggered())return Xn(xe.create({type:W.ErrorOutcomeAborted}),s);c=0;const e=await Qn(p.requestLow,t,d,a);if(e.error)return Xn(e.error,s);c=0;const i=await Qn(p.requestHigh,t,d,a);if(i.error)return Xn(i.error,s);m.statSimResults.push(Ee.create({statData:p.statData,resultLow:e,resultHigh:i}))}console.log(`All ${l} sims finished successfully. Computing weights.`);const u=await t.statWeightCompute(m);return u.error?Xn(u.error,s):(s(ke.create({finalWeightResult:u})),u)})(l,this.workerPool,i,r):await this.workerPool.statWeightsAsync(l,i,r),e.error){if(e.error.type!=W.ErrorOutcomeError)return e;throw new ro(e.error.message)}return e}catch(n){if(n instanceof ro)throw n;throw console.error(n),new Error("Something went wrong calculating your stat weights. Reload the page and try again.")}finally{this.signalManager.unregisterRunning(r)}}}getUnitMetadata(e,t,s){if(!e||e.type==Ie.Unknown)return this.getUnitMetadata(s,t,s);if(e.type==Ie.Player)return this.raid.getPlayerFromUnitReference(e)?.getMetadata();if(e.type==Ie.Target)return this.encounter.targetsMetadata.asList()[e.index];if(e.type==Ie.Pet){const s=this.raid.getPlayerFromUnitReference(e.owner,t);return s?s.getPetMetadatas().asList()[e.index]:void 0}return e.type==Ie.Self?t?.getMetadata():e.type==Ie.CurrentTarget?this.encounter.targetsMetadata.asList()[0]:void 0}getPhase(){return this.phase}setPhase(e,t){t!=this.phase&&t>0&&(this.phase=t,this.phaseChangeEmitter.emit(e))}getFaction(){return this.faction}setFaction(e,t){t!=this.faction&&t&&(this.faction=t,this.factionChangeEmitter.emit(e))}getFixedRngSeed(){return this.fixedRngSeed}setFixedRngSeed(e,t){t!=this.fixedRngSeed&&(this.fixedRngSeed=t,this.fixedRngSeedChangeEmitter.emit(e))}nextRngSeed(){let t=0;return t=this.fixedRngSeed?this.fixedRngSeed:Math.floor(Math.random()*e.MAX_RNG_SEED),this.lastUsedRngSeed=t,this.lastUsedRngSeedChangeEmitter.emit(a.nextEventID()),t}getLastUsedRngSeed(){return this.lastUsedRngSeed}getFilters(){return $e.clone(this.filters)}setFilters(e,t){$e.equals(t,this.filters)||(this.filters=$e.clone(t),this.filtersChangeEmitter.emit(e))}getShowDamageMetrics(){return this.showDamageMetrics}setShowDamageMetrics(e,t){t!=this.showDamageMetrics&&(this.showDamageMetrics=t,this.showDamageMetricsChangeEmitter.emit(e))}getShowThreatMetrics(){return this.showThreatMetrics}setShowThreatMetrics(e,t){t!=this.showThreatMetrics&&(this.showThreatMetrics=t,this.showThreatMetricsChangeEmitter.emit(e))}getShowHealingMetrics(){return this.showHealingMetrics}setShowHealingMetrics(e,t){t!=this.showHealingMetrics&&(this.showHealingMetrics=t,this.showHealingMetricsChangeEmitter.emit(e))}getShowExperimental(){return this.showExperimental}setShowExperimental(e,t){t!=this.showExperimental&&(this.showExperimental=t,this.showExperimentalChangeEmitter.emit(e))}getWasmConcurrency(){return this.wasmConcurrency}setWasmConcurrency(e,t){t!=this.wasmConcurrency&&(this.wasmConcurrency=t,window.localStorage.setItem(no,t.toString()),this.wasmConcurrencyChangeEmitter.emit(e))}getShowEPValues(){return this.showEPValues}setShowEPValues(e,t){t!=this.showEPValues&&(this.showEPValues=t,this.showEPValuesChangeEmitter.emit(e))}getLanguage(){return this.language}setLanguage(e,t){(t=t||Ge())!=this.language&&(this.language=t,Ke(this.language),this.languageChangeEmitter.emit(e))}getIterations(){return this.iterations}setIterations(e,t){t!=this.iterations&&(this.iterations=t,this.iterationsChangeEmitter.emit(e))}toProto(){const t=this.getFilters();return t.armorTypes.length==e.ALL_ARMOR_TYPES.length&&(t.armorTypes=[]),t.weaponTypes.length==e.ALL_WEAPON_TYPES.length&&(t.weaponTypes=[]),t.rangedWeaponTypes.length==e.ALL_RANGED_WEAPON_TYPES.length&&(t.rangedWeaponTypes=[]),t.sources.length==e.ALL_SOURCES.length&&(t.sources=[]),t.raids.length==e.ALL_RAIDS.length&&(t.raids=[]),Je.create({iterations:this.getIterations(),phase:this.getPhase(),fixedRngSeed:BigInt(this.getFixedRngSeed()),showDamageMetrics:this.getShowDamageMetrics(),showThreatMetrics:this.getShowThreatMetrics(),showHealingMetrics:this.getShowHealingMetrics(),showExperimental:this.getShowExperimental(),showEpValues:this.getShowEPValues(),language:this.getLanguage(),faction:this.getFaction(),filters:t})}fromProto(t,s){a.freezeAllAndDo((()=>{this.setIterations(t,s.iterations||3e3),this.setPhase(t,s.phase||Oe),this.setFixedRngSeed(t,Number(s.fixedRngSeed)),this.setShowDamageMetrics(t,s.showDamageMetrics),this.setShowThreatMetrics(t,s.showThreatMetrics),this.setShowHealingMetrics(t,s.showHealingMetrics),this.setShowExperimental(t,s.showExperimental),this.setShowEPValues(t,s.showEpValues),this.setLanguage(t,s.language),this.setFaction(t,s.faction||qe.Alliance);const a=s.filters||e.defaultFilters();0==a.armorTypes.length&&(a.armorTypes=e.ALL_ARMOR_TYPES.slice()),0==a.weaponTypes.length&&(a.weaponTypes=e.ALL_WEAPON_TYPES.slice()),0==a.rangedWeaponTypes.length&&(a.rangedWeaponTypes=e.ALL_RANGED_WEAPON_TYPES.slice()),0==a.sources.length&&(a.sources=e.ALL_SOURCES.slice()),0==a.raids.length&&(a.raids=e.ALL_RAIDS.slice()),this.setFilters(t,a)}))}applyDefaults(t,s,a){this.fromProto(t,Je.create({iterations:3e3,phase:Oe,faction:qe.Alliance,showDamageMetrics:!a,showThreatMetrics:s,showHealingMetrics:a,language:this.getLanguage(),filters:e.defaultFilters(),showEpValues:!1}))}static defaultFilters(){return $e.create({oneHandedWeapons:!0,twoHandedWeapons:!0})}};oo.MAX_RNG_SEED=Math.pow(2,32)-1,oo.ALL_ARMOR_TYPES=r(Ze).filter((e=>0!=e)),oo.ALL_WEAPON_TYPES=r(z).filter((e=>0!=e)),oo.ALL_RANGED_WEAPON_TYPES=r(Ye).filter((e=>0!=e)),oo.ALL_SOURCES=r(X).filter((e=>0!=e)),oo.ALL_RAIDS=r(te).filter((e=>0!=e));let lo=oo;class ro extends Error{constructor(e){super(e),this.errorStr=e}}var co=(e=>(e.Vertical="vertical",e.Horizontal="Horizontal",e))(co||{});class ho extends f{constructor(t,s,i){super(t,"icon-picker-root",s,i),this.incrementValue=()=>{0==this.config.states||this.currentValue+this.step<this.config.states*this.step?(this.currentValue+=this.step,this.inputChanged(a.nextEventID())):this.currentValue>0&&(this.currentValue=0,this.inputChanged(a.nextEventID()))},this.decrementValue=()=>{this.currentValue>0?this.currentValue-=this.step:0===this.config.states?this.currentValue=this.step:this.currentValue=(this.config.states-1)*this.step,this.inputChanged(a.nextEventID())},this.rootElem.classList.add("icon-picker"),this.active=!1,this.config=i,this.currentValue=0,this.step=i.step??1,this.rootAnchor=document.createElement("a"),this.rootAnchor.classList.add("icon-picker-button"),this.rootAnchor.dataset.whtticon="false",this.rootAnchor.dataset.disableWowheadTouchTooltip="true",this.rootAnchor.target="_blank",this.rootElem.prepend(this.rootAnchor);const n=Boolean(this.config.improvedId);n&&this.rootAnchor.classList.add("use-improved-icons"),this.config.improvedId2&&this.rootAnchor.classList.add("use-improved-icons2"),!n&&this.config.states>2&&this.rootAnchor.classList.add("use-counter");const o=g(),l=g(),r=g();this.rootAnchor.appendChild(e("div",{className:"icon-input-level-container"},e("a",{ref:o,className:"icon-picker-button icon-input-improved icon-input-improved1",dataset:{whtticon:"false",disableWowheadTouchTooltip:"true"}}),e("a",{ref:l,className:"icon-picker-button icon-input-improved icon-input-improved2",dataset:{whtticon:"false",disableWowheadTouchTooltip:"true"}}),e("span",{ref:r,className:"icon-picker-label "+(this.config.states>2?"":"hide")}))),this.improvedAnchor=o.value,this.improvedAnchor2=l.value,this.counterElem=r.value,this.config.states>=3&&this.config.improvedId&&this.config.improvedId.fillAndSet(this.improvedAnchor,!0,!0),this.config.states>=4&&this.config.improvedId2&&this.config.improvedId2.fillAndSet(this.improvedAnchor2,!0,!0),this.init();const c=()=>{this.config.actionId(this.modObject)?.fillAndSet(this.rootAnchor,!0,!0),this.showWhen()?(this.rootElem.classList.remove("hide"),this.restoreValue()):(this.storeValue(),this.rootElem.classList.add("hide"))};c(),this.config.changedEvent(this.modObject).on(c);const d=i.reverse?this.decrementValue:this.incrementValue,h=i.reverse?this.incrementValue:this.decrementValue;this.rootAnchor.addEventListener("click",(e=>{e.preventDefault(),d()})),this.rootAnchor.addEventListener("mousedown",(e=>{S(e)&&(e.preventDefault(),h())})),this.rootAnchor.addEventListener("contextmenu",(e=>e.preventDefault()))}getInputElem(){return this.rootAnchor}getInputValue(){return 2==this.config.states?Boolean(this.currentValue):this.currentValue}getActionId(){const e=Number(this.config.getValue(this.modObject));return 0==e?null:1==e?this.config.actionId(this.modObject):2==e&&this.config.improvedId?this.config.improvedId:3==e&&this.config.improvedId2?this.config.improvedId2:this.config.actionId(this.modObject)}setInputValue(e){this.currentValue=Number(e),this.currentValue>0?(this.active=!0,this.rootAnchor.classList.add("active"),this.counterElem.classList.add("active")):(this.active=!1,this.rootAnchor.classList.remove("active"),this.counterElem.classList.remove("active")),this.config.states>=3&&this.config.improvedId&&(this.currentValue>1?this.improvedAnchor.classList.add("active"):this.improvedAnchor.classList.remove("active")),this.config.states>=4&&this.config.improvedId2&&(this.currentValue>2?(this.improvedAnchor2.classList.add("active"),this.improvedAnchor.hidden=!0,this.improvedAnchor2.hidden=!1):(this.improvedAnchor2.classList.remove("active"),this.improvedAnchor.hidden=!1,this.improvedAnchor2.hidden=!0)),!this.config.improvedId&&(this.config.states>3||0==this.config.states)&&(this.counterElem.textContent=String(this.currentValue))}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(0),this.inputChanged(a.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(a.nextEventID()),this.storedValue=void 0)}showWhen(){return null!=this.config.actionId(this.modObject)&&(!this.config.showWhen||this.config.showWhen(this.modObject))}}class mo extends f{constructor(t,s,i){if(super(t,"icon-enum-picker-root",s,i),this.rootElem.classList.add("icon-picker","vertical"===(i.direction??co.Vertical)?"dropdown":"dropend"),this.config=i,this.currentValue=this.config.zeroValue,i.tooltip){const e=mn(this.rootElem,{content:i.tooltip});this.addOnDisposeCallback((()=>e.destroy()))}this.rootElem.appendChild(e(b,null,e("a",{href:"javascript:void(0)",className:"icon-picker-button",attributes:{"aria-expanded":"false",role:"button"},dataset:{bsToggle:"dropdown",whtticon:"false",disableWowheadTouchTooltip:"true"}}),e("ul",{className:"dropdown-menu"}),e("label",{className:"form-label"}))),this.buttonElem=this.rootElem.querySelector(".icon-picker-button"),this.buttonText=this.rootElem.querySelector("label"),this.dropdownMenu=this.rootElem.querySelector(".dropdown-menu"),this.config.numColumns&&(this.dropdownMenu.style.gridTemplateColumns=`repeat(${this.config.numColumns}, 1fr)`),this.config.direction==co.Horizontal&&(this.dropdownMenu.style.gridAutoFlow="column"),this.config.values.forEach(((e,t)=>{const s=document.createElement("li");s.classList.add("icon-dropdown-option","dropdown-option"),this.dropdownMenu.appendChild(s);const i=document.createElement("a");i.classList.add("icon-picker-button"),i.dataset.whtticon="false",i.dataset.disableWowheadTouchTooltip="true",s.appendChild(i);const n=()=>{this.setImage(i,e),this.showValueWhen(e)?s.classList.remove("hide"):(s.classList.add("hide"),this.currentValue==e.value&&(this.setInputValue(this.config.zeroValue),this.inputChanged(a.nextEventID())))};if(this.config.changedEvent(this.modObject).on(n),n(),i.addEventListener("click",(t=>{t.preventDefault(),this.currentValue=e.value,this.storedValue=void 0,this.inputChanged(a.nextEventID())})),e.tooltip){const t=mn(i,{content:e.tooltip});this.addOnDisposeCallback((()=>t.destroy()))}})),this.init();const n=()=>{this.showWhen()?(this.restoreValue(),this.rootElem.classList.remove("hide")):(this.storeValue(),this.rootElem.classList.add("hide"))};n(),this.config.changedEvent(this.modObject).on(n)}storeValue(){void 0===this.storedValue&&(this.storedValue=this.getInputValue(),this.setInputValue(this.config.zeroValue),this.inputChanged(a.nextEventID()))}restoreValue(){void 0!==this.storedValue&&(this.setInputValue(this.storedValue),this.inputChanged(a.nextEventID()),this.storedValue=void 0)}setActionImage(e,t){t.fillAndSet(e,!0,!0)}setImage(e,t){if(t.showWhen&&!t.showWhen(this.modObject))return void e.removeAttribute("href");const s=t.actionId?.(this.modObject);s?(this.setActionImage(e,s),e.style.filter=""):t.iconUrl?(e.style.backgroundImage=`url(${t.iconUrl})`,e.style.filter="grayscale(1)"):(e.href="",e.style.backgroundImage="",e.style.filter="",e.style.backgroundColor=t.color)}update(){super.update(),this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue))}getInputElem(){return this.buttonElem}getInputValue(){return this.currentValue}setInputValue(e){this.currentValue=e,this.setActive(this.enabled&&!this.config.equals(this.currentValue,this.config.zeroValue)),this.buttonText.textContent="",this.buttonText.style.display="none";const t=this.config.values.find((e=>this.config.equals(e.value,this.currentValue)));if(t)this.setImage(this.buttonElem,t),null!=t.text&&(this.buttonText.style.display="block",this.buttonText.textContent=t.text);else if(this.config.backupIconUrl){const e=this.config.backupIconUrl(this.currentValue);this.setActionImage(this.buttonElem,e),this.setActive(!1)}}setActive(e){e?this.buttonElem.classList.add("active"):this.buttonElem.classList.remove("active")}showWhen(){return(!this.config.showWhen||this.config.showWhen(this.modObject))&&!!this.config.values.find((e=>e.actionId&&null!=e.actionId(this.modObject)&&(!e.showWhen||e.showWhen(this.modObject))))}showValueWhen(e){return(!e.actionId||null!=e.actionId?.(this.modObject))&&(!e.showWhen||e.showWhen(this.modObject))}}function uo(e){return{direction:e.direction,values:e.values,label:e.label,tooltip:e.tooltip,showWhen:t=>e.values.filter((e=>!e.showWhen||e.showWhen(t))).length>0}}function po(e){const t=e.getModObject;return{id:e.id,type:"boolean",label:e.label,labelTooltip:e.labelTooltip,changedEvent:s=>e.changedEvent(t(s)),getValue:s=>e.getValue(t(s)),setValue:(s,a,i)=>e.setValue(s,t(a),i),enableWhen:e.enableWhen?s=>e.enableWhen(t(s)):void 0,showWhen:e.showWhen?s=>e.showWhen(t(s)):void 0,extraCssClasses:e.extraCssClasses}}function go(e){return po({id:`${String(e.fieldName)||Qe()}`,label:e.label,labelTooltip:e.labelTooltip,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,s,a)=>{const i=s.getSpecOptions();i[e.fieldName]=a,s.setSpecOptions(t,i)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function fo(e){return po({id:`${String(e.fieldName)||Qe()}`,label:e.label,labelTooltip:e.labelTooltip,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,s,a)=>{const i=s.getSimpleRotation();i[e.fieldName]=a,s.setSimpleRotation(t,i)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses})}function Io(e){const t=e.getModObject;return{id:e.id,type:"number",label:e.label,labelTooltip:e.labelTooltip,float:e.float,positive:e.positive,defaultValue:e.defaultValue,changedEvent:s=>e.changedEvent(t(s)),getValue:s=>e.getValue(t(s)),setValue:(s,a,i)=>e.setValue(s,t(a),i),enableWhen:e.enableWhen?s=>e.enableWhen(t(s)):void 0,showWhen:e.showWhen?s=>e.showWhen(t(s)):void 0,extraCssClasses:e.extraCssClasses}}function wo(e){const t={id:`${String(e.fieldName)||Qe()}`,label:e.label,labelTooltip:e.labelTooltip,float:e.float,positive:e.positive,defaultValue:e.defaultValue,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,s,a)=>{const i=s.getSpecOptions();i[e.fieldName]=a,s.setSpecOptions(t,i)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const e=t.getValue;t.getValue=t=>100*e(t);const s=t.setValue;t.setValue=(e,t,a)=>s(e,t,a/100)}return Io(t)}function bo(e){const t={id:`${String(e.fieldName)||Qe()}`,label:e.label,labelTooltip:e.labelTooltip,float:e.float,positive:e.positive,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,s,a)=>{const i=s.getSimpleRotation();i[e.fieldName]=a,s.setSimpleRotation(t,i)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen,extraCssClasses:e.extraCssClasses};if(e.percent){const e=t.getValue;t.getValue=t=>100*e(t);const s=t.setValue;t.setValue=(e,t,a)=>s(e,t,a/100)}return Io(t)}function So(e){const t=e.getModObject;return{id:e.id,type:"enum",label:e.label,labelTooltip:e.labelTooltip,values:e.values,changedEvent:s=>e.changedEvent(t(s)),getValue:s=>e.getValue(t(s)),setValue:(s,a,i)=>e.setValue(s,t(a),i),enableWhen:e.enableWhen?s=>e.enableWhen(t(s)):void 0,showWhen:e.showWhen?s=>e.showWhen(t(s)):void 0}}function xo(e){return So({id:`${String(e.fieldName)||Qe()}`,label:e.label,labelTooltip:e.labelTooltip,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSpecOptions()[e.fieldName]),setValue:e.setValue||((t,s,a)=>{const i=s.getSpecOptions();i[e.fieldName]=a,s.setSpecOptions(t,i)}),changedEvent:e.changeEmitter||(e=>e.specOptionsChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function vo(e){return So({id:`${String(e.fieldName)||Qe()}`,label:e.label,labelTooltip:e.labelTooltip,values:e.values,getModObject:e=>e,getValue:e.getValue||(t=>t.getSimpleRotation()[e.fieldName]),setValue:e.setValue||((t,s,a)=>{const i=s.getSimpleRotation();i[e.fieldName]=a,s.setSimpleRotation(t,i)}),changedEvent:e.changeEmitter||(e=>e.rotationChangeEmitter),enableWhen:e.enableWhen,showWhen:e.showWhen})}function yo(e){const t=e.getModObject;return{type:"icon",actionId:s=>e.actionId(t(s)),states:e.states,showWhen:e.showWhen,changedEvent:s=>e.changedEvent(t(s)),getValue:s=>e.getValue(t(s)),setValue:(s,a,i)=>e.setValue(s,t(a),i),extraCssClasses:e.extraCssClasses}}function Eo(e,t,s,a){return yo({getModObject:e.getModObject,actionId:t,states:2,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:e.getFieldValue||(t=>a?e.getValue(t)[s]==a:e.getValue(t)[s]),setValue:e.setFieldValue||((t,i,n)=>{const o=e.getValue(i);a?n?o[s]=a:o[s]==a&&(o[s]=0):o[s]=n,e.setValue(t,i,o)}),extraCssClasses:e.extraCssClasses})}function ko(e){return Eo({getModObject:e=>e,getValue:e=>e.getSpecOptions(),setValue:(e,t,s)=>t.setSpecOptions(e,s),changeEmitter:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses,getFieldValue:e.getValue,setFieldValue:e.setValue},e.actionId,e.fieldName,e.value)}function Po(e,t,s){return yo({getModObject:e.getModObject,actionId:t,states:0,step:1,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:t=>e.getValue(t)[s],setValue:(t,a,i)=>{const n=e.getValue(a);i<0&&(i=0),n[s]=i,e.setValue(t,a,n)}})}function Co(e,t,s,a){const i=Po(e,t,a);return i.states=3,i.improvedId=s,i}function To(e,t,s,a,i,n){const o=Po(e,t,a);return o.states=s,o.step=i,o.reverse=n,o}function No(e,t,s,a,i,n){return function(e){const t=e.getModObject;return{type:"iconEnum",numColumns:e.numColumns,direction:e.direction,tooltip:e.tooltip,values:e.values.map((e=>{if(e.showWhen){const s=e.showWhen;e.showWhen=e=>s(t(e))}return e})),equals:e.equals,showWhen:s=>!e.showWhen||e.showWhen(t(s)),zeroValue:e.zeroValue,changedEvent:s=>e.changedEvent(t(s)),getValue:s=>e.getValue(t(s)),setValue:(s,a,i)=>e.setValue(s,t(a),i),extraCssClasses:e.extraCssClasses}}({values:s,zeroValue:0,numColumns:a,direction:i||co.Vertical,tooltip:n,equals:(e,t)=>e==t,getModObject:e.getModObject,changedEvent:e.changeEmitter,showWhen:e.showWhen,getValue:s=>e.getValue(s)[t],setValue:(s,a,i)=>{const n=e.getValue(a);n[t]=i,e.setValue(s,a,n)}})}function _o(e){return No({showWhen:e.showWhen,getModObject:e=>e,getValue:e=>e.getSpecOptions(),setValue:(e,t,s)=>t.setSpecOptions(e,s),getFieldValue:e.getValue,setFieldValue:e.setValue,changeEmitter:e.changeEmitter||(e=>e.specOptionsChangeEmitter),extraCssClasses:e.extraCssClasses},e.fieldName,e.values,e.numColumns,e.direction,e.tooltip)}const Ro=(e,t,s)=>"icon"==s.type?new ho(e,t,s):new mo(e,t,s);function Do(e,t){return e.label=t,e}function Ao(e){return Eo({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,s)=>t.getRaid().setBuffs(e,s),changeEmitter:e=>a.onAny([e.getRaid().buffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function Lo(e){return Eo({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getBuffs(),setValue:(e,t,s)=>t.setBuffs(e,s),changeEmitter:e=>a.onAny([e.buffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function Vo(e){return Eo({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getConsumes().miscConsumes??Xe.create(),setValue:(e,t,s)=>{const a=t.getConsumes();a.miscConsumes=s,t.setConsumes(e,a)},changeEmitter:e=>a.onAny([e.consumesChangeEmitter,e.professionChangeEmitter])},e.actionId,e.fieldName,e.value)}function Mo(e){return Eo({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getDebuffs(),setValue:(e,t,s)=>t.getRaid().setDebuffs(e,s),changeEmitter:e=>a.onAny([e.getRaid().debuffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.fieldName,e.value)}function Uo(e){return Co({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,s)=>t.getRaid().setBuffs(e,s),changeEmitter:e=>a.onAny([e.getRaid().buffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.impId,e.fieldName)}function Wo(e){return Co({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getBuffs(),setValue:(e,t,s)=>t.setBuffs(e,s),changeEmitter:e=>a.onAny([e.buffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.impId,e.fieldName)}function Fo(e){return Co({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getRaid().getDebuffs(),setValue:(e,t,s)=>t.getRaid().setDebuffs(e,s),changeEmitter:e=>a.onAny([e.getRaid().debuffsChangeEmitter])},e.actionId,e.impId,e.fieldName)}function Oo(e){return To({getModObject:e=>e,showWhen:t=>!e.faction||e.faction==t.getFaction(),getValue:e=>e.getBuffs(),setValue:(e,t,s)=>t.setBuffs(e,s),changeEmitter:e=>a.onAny([e.buffsChangeEmitter,e.raceChangeEmitter])},e.actionId,e.numStates,e.fieldName,e.multiplier,e.reverse)}function qo(e){return No({getModObject:e=>e,getValue:e=>e.getConsumes(),setValue:(e,t,s)=>t.setConsumes(e,s),changeEmitter:e=>a.onAny([e.consumesChangeEmitter])},e.fieldName,e.values,e.numColumns,e.direction||co.Vertical)}class Ho extends p{constructor(e,t,s,a){if(super(e,"multi-icon-picker-root"),this.rootElem.classList.add("icon-picker","vertical"===(s.direction??co.Horizontal)?"dropdown":"dropend"),this.simUI=a,this.config=s,this.currentValue=null,this.rootElem.innerHTML='\n\t\t\t<a\n\t\t\t\tclass="icon-picker-button"\n\t\t\t\trole="button"\n\t\t\t\tdata-bs-toggle="dropdown"\n\t\t\t\taria-expanded="false"\n\t\t\t\tdata-disable-wowhead-touch-tooltip="true"\n\t\t\t\tdata-whtticon="false"\n\t\t\t></a>\n\t\t\t<ul class="dropdown-menu"></ul>\n\t\t\t<label class="multi-icon-picker-label form-label"></label>\n\t  ',s.tooltip){const e=mn(this.rootElem,{content:s.tooltip});this.addOnDisposeCallback((()=>e.destroy()))}const i=this.rootElem.querySelector(".multi-icon-picker-label");s.label?i.textContent=s.label:i.remove(),this.buttonElem=this.rootElem.querySelector(".icon-picker-button"),this.dropdownMenu=this.rootElem.querySelector(".dropdown-menu"),this.config.direction==co.Horizontal&&(this.dropdownMenu.style.gridAutoFlow="column"),this.buttonElem.addEventListener("hide.bs.dropdown",(e=>{e.hasOwnProperty("clickEvent")&&e.preventDefault()})),this.buttonElem.addEventListener("contextmenu",(e=>e.preventDefault())),this.buttonElem.addEventListener("mousedown",(e=>{S(e)&&this.clearPicker()})),this.buildBlankOption(),this.pickers=this.config.values.map(((e,s)=>{const a=document.createElement("li");return a.classList.add("icon-picker-option","dropdown-option"),this.dropdownMenu.appendChild(a),new ho(a,t,e)})),a.sim.waitForInit().then((()=>this.updateButtonImage())),a.changeEmitter.on((()=>{this.updateButtonImage(),this.showWhen()?this.rootElem.classList.remove("hide"):this.rootElem.classList.add("hide")}))}showWhen(){return!this.config.showWhen||this.config.showWhen(this.simUI.sim.raid.getPlayer(0))&&!!this.pickers.find((e=>e.showWhen()))}buildBlankOption(){const e=document.createElement("li");this.dropdownMenu.appendChild(e);const t=document.createElement("a");t.classList.add("icon-dropdown-option","dropdown-option"),e.appendChild(t),t.addEventListener("click",(()=>this.clearPicker()))}clearPicker(){a.freezeAllAndDo((()=>{this.pickers.forEach((e=>{e.setInputValue(null),e.inputChanged(a.nextEventID())})),this.updateButtonImage()}))}updateButtonImage(){this.currentValue=this.getMaxValue(),this.currentValue?(this.buttonElem.classList.add("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0):this.currentValue.fillAndSet(this.buttonElem,!1,!0)):(this.buttonElem.classList.remove("active"),null!=this.config.categoryId?this.config.categoryId.fillAndSet(this.buttonElem,!1,!0):this.buttonElem.style.backgroundImage="",this.buttonElem.removeAttribute("href"))}getMaxValue(){return this.pickers.filter((e=>e.showWhen())).map((e=>e.getActionId())).filter((e=>null!=e))[0]||null}}const Bo=Do(Uo({actionId:()=>x.fromSpellId(9885),impId:x.fromSpellId(17055),fieldName:"giftOfTheWild"}),"Mark of the Wild"),zo=Do(Lo({actionId:()=>x.fromSpellId(20217),fieldName:"blessingOfKings",showWhen:e=>e.getFaction()===qe.Alliance}),"Blessing of Kings"),jo=Do(Uo({actionId:()=>x.fromSpellId(10293),impId:x.fromSpellId(20142),showWhen:e=>e.getFaction()===qe.Alliance,fieldName:"devotionAura"}),"Devotion Aura"),$o=Do(Uo({actionId:()=>x.fromSpellId(10408),impId:x.fromSpellId(16293),showWhen:e=>e.getFaction()===qe.Horde,fieldName:"stoneskinTotem"}),"Stoneskin"),Go=uo({values:[Ao({actionId:()=>x.fromSpellId(10958),fieldName:"shadowProtection"}),Ao({actionId:()=>x.fromSpellId(19896),fieldName:"shadowResistanceAura"}),Ao({actionId:()=>x.fromSpellId(10601),fieldName:"natureResistanceTotem",showWhen:e=>e.getFaction()===qe.Horde}),Ao({actionId:()=>x.fromSpellId(20190),fieldName:"aspectOfTheWild"}),Ao({actionId:()=>x.fromSpellId(19900),fieldName:"fireResistanceAura",showWhen:e=>e.getFaction()===qe.Alliance}),Ao({actionId:()=>x.fromSpellId(10538),fieldName:"fireResistanceTotem",showWhen:e=>e.getFaction()===qe.Horde}),Ao({actionId:()=>x.fromSpellId(19898),fieldName:"frostResistanceAura",showWhen:e=>e.getFaction()===qe.Alliance}),Ao({actionId:()=>x.fromSpellId(10479),fieldName:"frostResistanceTotem",showWhen:e=>e.getFaction()===qe.Horde})],label:"Resistances"}),Ko=uo({values:[Uo({actionId:()=>x.fromSpellId(10938),impId:x.fromSpellId(14767),fieldName:"powerWordFortitude"}),Ao({actionId:()=>x.fromItemId(10307),fieldName:"scrollOfStamina"})],label:"Stamina"}),Jo=Do(Uo({actionId:()=>x.fromSpellId(11767),impId:x.fromSpellId(18696),fieldName:"bloodPact"}),"Blood Pact"),Zo=Do(Wo({actionId:()=>x.fromSpellId(25291),impId:x.fromSpellId(20048),fieldName:"blessingOfMight",showWhen:e=>e.getFaction()===qe.Alliance}),"Blessing of Might"),Yo=Do(Uo({actionId:()=>x.fromSpellId(25361),impId:x.fromSpellId(16295),fieldName:"strengthOfEarthTotem",showWhen:e=>e.getFaction()===qe.Horde}),"Strength"),Qo=Do(Uo({actionId:()=>x.fromSpellId(25359),impId:x.fromSpellId(16295),fieldName:"graceOfAirTotem",showWhen:e=>e.getFaction()===qe.Horde}),"Agility"),Xo=uo({values:[Ao({actionId:()=>x.fromSpellId(10157),fieldName:"arcaneBrilliance"}),Ao({actionId:()=>x.fromItemId(10308),fieldName:"scrollOfIntellect"})],label:"Intellect"}),el=uo({values:[Ao({actionId:()=>x.fromSpellId(27841),fieldName:"divineSpirit"}),Ao({actionId:()=>x.fromItemId(10306),fieldName:"scrollOfSpirit"})],label:"Spirit"}),tl=Do(Uo({actionId:()=>x.fromSpellId(25289),impId:x.fromSpellId(12861),fieldName:"battleShout"}),"Battle Shout"),sl=Do(Ao({actionId:()=>x.fromSpellId(20906),fieldName:"trueshotAura"}),"Trueshot Aura"),al=Do(Wo({actionId:()=>x.fromSpellId(25290),impId:x.fromSpellId(20245),fieldName:"blessingOfWisdom",showWhen:e=>e.getFaction()===qe.Alliance}),"Blessing of Wisdom"),il=Do(Uo({actionId:()=>x.fromSpellId(10497),impId:x.fromSpellId(16208),fieldName:"manaSpringTotem",showWhen:e=>e.getFaction()===qe.Horde}),"Mana Spring Totem"),nl=Do(Ao({actionId:()=>x.fromSpellId(24932),fieldName:"leaderOfThePack"}),"Leader of the Pack"),ol=Do(Ao({actionId:()=>x.fromSpellId(24907),fieldName:"moonkinAura"}),"Moonkin Aura"),ll=Uo({actionId:()=>x.fromSpellId(10301),impId:x.fromSpellId(20092),fieldName:"retributionAura",showWhen:e=>e.getFaction()===qe.Alliance}),rl=Ao({actionId:()=>x.fromSpellId(20218),fieldName:"sanctityAura",showWhen:e=>e.getFaction()===qe.Alliance}),cl=Uo({actionId:()=>x.fromSpellId(9910),impId:x.fromSpellId(16840),fieldName:"thorns"}),dl=Oo({actionId:()=>x.fromSpellId(29166),numStates:11,fieldName:"innervates"}),hl=Oo({actionId:()=>x.fromSpellId(10060),numStates:11,fieldName:"powerInfusions"}),ml=To({getModObject:e=>e,showWhen:e=>!ul.faction||ul.faction==e.getFaction(),getValue:e=>e.getRaid().getBuffs(),setValue:(e,t,s)=>t.getRaid().setBuffs(e,s),changeEmitter:e=>a.onAny([e.getRaid().buffsChangeEmitter,e.raceChangeEmitter])},(ul={actionId:()=>x.fromSpellId(23060),numStates:6,fieldName:"battleSquawk"}).actionId,ul.numStates,ul.fieldName,ul.multiplier,ul.reverse);var ul;const pl=Do(Lo({actionId:()=>x.fromSpellId(22888),fieldName:"rallyingCryOfTheDragonslayer"}),"Rallying Cry Of The Dragonslayer"),gl=Do(Lo({actionId:()=>x.fromSpellId(24425),fieldName:"spiritOfZandalar"}),"Spirit of Zandalar"),fl=Do(Lo({actionId:()=>x.fromSpellId(15366),fieldName:"songflowerSerenade"}),"Songflower Serenade"),Il=Do(Lo({actionId:()=>x.fromSpellId(16609),fieldName:"warchiefsBlessing"}),"Warchief's Blessing"),wl=e=>function(e){return No({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getBuffs(),setValue:(e,t,s)=>t.setBuffs(e,s),changeEmitter:e=>a.onAny([e.buffsChangeEmitter,e.raceChangeEmitter])},e.fieldName,e.values,e.numColumns,e.direction||co.Vertical)}({direction:co.Horizontal,values:[{iconUrl:"https://wow.zamimg.com/images/wow/icons/large/inv_misc_orb_02.jpg",value:tt.SaygesUnknown,text:"Sayge's Dark Fortune"},...e.map((e=>e.config))],fieldName:"saygesFortune"}),bl={actionId:()=>x.fromSpellId(23768),value:tt.SaygesDamage,text:"Sayge's Damage"},Sl={actionId:()=>x.fromSpellId(23736),value:tt.SaygesAgility,text:"Sayge's Agility"},xl={actionId:()=>x.fromSpellId(23766),value:tt.SaygesIntellect,text:"Sayge's Intellect"},vl={actionId:()=>x.fromSpellId(23738),value:tt.SaygesSpirit,text:"Sayge's Spirit"},yl={actionId:()=>x.fromSpellId(23737),value:tt.SaygesStamina,text:"Sayge's Stamina"},El=Do(Lo({actionId:()=>x.fromSpellId(22817),fieldName:"fengusFerocity"}),"Fengus' Ferocity"),kl=Do(Lo({actionId:()=>x.fromSpellId(22818),fieldName:"moldarsMoxie"}),"Moldar's Moxie"),Pl=Do(Lo({actionId:()=>x.fromSpellId(22820),fieldName:"slipkiksSavvy"}),"Slip'kik's Savvy"),Cl=uo({values:[Mo({actionId:()=>x.fromSpellId(11597),fieldName:"sunderArmor"}),Fo({actionId:()=>x.fromSpellId(11198),impId:x.fromSpellId(14169),fieldName:"exposeArmor"})],label:"Major Armor Penetration"}),Tl=Do(Mo({actionId:()=>x.fromSpellId(11717),fieldName:"curseOfRecklessness"}),"Curse of Recklessness"),Nl=Do(Mo({actionId:()=>x.fromSpellId(9907),fieldName:"faerieFire"}),"Faerie Fire"),_l=Do(Fo({actionId:()=>x.fromSpellId(11708),impId:x.fromSpellId(18181),fieldName:"curseOfWeakness"}),"Curse of Weakness"),Rl=uo({values:[Fo({actionId:()=>x.fromSpellId(11556),impId:x.fromSpellId(12879),fieldName:"demoralizingShout"}),Fo({actionId:()=>x.fromSpellId(9898),impId:x.fromSpellId(16862),fieldName:"demoralizingRoar"})],label:"Attack Power"}),Dl=uo({values:[Fo({actionId:()=>x.fromSpellId(6343),impId:x.fromSpellId(26110),fieldName:"thunderClap"}),Mo({actionId:()=>x.fromSpellId(21992),fieldName:"thunderfury"})],label:"Attack Speed"}),Al=Do(Mo({actionId:()=>x.fromSpellId(24977),fieldName:"insectSwarm"}),"Insect Swarm"),Ll=Do(Mo({actionId:()=>x.fromSpellId(17803),fieldName:"improvedShadowBolt"}),"Improved Shadow Bolt"),Vl=Do(Mo({actionId:()=>x.fromSpellId(12873),fieldName:"improvedScorch"}),"Scorch"),Ml=Do(Mo({actionId:()=>x.fromSpellId(28595),fieldName:"wintersChill"}),"Winter's Chill"),Ul=Do(Mo({actionId:()=>x.fromSpellId(17364),fieldName:"stormstrike"}),"Stormstrike"),Wl=Do(Mo({actionId:()=>x.fromSpellId(15334),fieldName:"shadowWeaving"}),"Shadow Weaving"),Fl=uo({values:[Mo({actionId:()=>x.fromSpellId(11722),fieldName:"curseOfElements"}),Mo({actionId:()=>x.fromSpellId(17937),fieldName:"curseOfShadow"})],label:"Warlock Curses"}),Ol=Do(Fo({actionId:()=>x.fromSpellId(14325),impId:x.fromSpellId(19425),fieldName:"huntersMark"}),"Hunter's Mark"),ql=Do(Mo({actionId:()=>x.fromSpellId(20355),fieldName:"judgementOfWisdom",showWhen:e=>e.getFaction()===qe.Alliance}),"Judgement of Wisdom"),Hl=Do(Fo({actionId:()=>x.fromSpellId(20303),impId:x.fromSpellId(20337),fieldName:"judgementOfTheCrusader",showWhen:e=>e.getFaction()===qe.Alliance}),"Judgement of the Crusader"),Bl=Mo({actionId:()=>x.fromSpellId(20346),fieldName:"judgementOfLight",showWhen:e=>e.getFaction()===qe.Alliance}),zl=Mo({actionId:()=>x.fromSpellId(11374),fieldName:"giftOfArthas"}),jl=Mo({actionId:()=>x.fromSpellId(15235),fieldName:"crystalYield"}),$l=[{config:Bo,picker:ho,stats:[]},{config:zo,picker:ho,stats:[]},{config:Ko,picker:Ho,stats:[]},{config:Jo,picker:ho,stats:[]},{config:Xo,picker:Ho,stats:[c.StatIntellect]},{config:el,picker:Ho,stats:[c.StatSpirit]},{config:jo,picker:ho,stats:[c.StatArmor]},{config:$o,picker:ho,stats:[c.StatArmor]},{config:Go,picker:Ho,stats:[c.StatNatureResistance,c.StatShadowResistance,c.StatFireResistance,c.StatFrostResistance]},{config:Zo,picker:ho,stats:[c.StatAttackPower,c.StatStrength,c.StatAgility]},{config:Yo,picker:ho,stats:[c.StatStrength]},{config:tl,picker:ho,stats:[c.StatAttackPower]},{config:Qo,picker:ho,stats:[c.StatAgility]},{config:sl,picker:ho,stats:[c.StatRangedAttackPower,c.StatAttackPower]},{config:nl,picker:ho,stats:[c.StatMeleeCrit]},{config:ol,picker:ho,stats:[c.StatSpellCrit]},{config:al,picker:ho,stats:[c.StatMP5]},{config:il,picker:ho,stats:[c.StatMP5]}],Gl=[{config:cl,picker:ho,stats:[c.StatArmor]},{config:ll,picker:ho,stats:[c.StatArmor]},{config:rl,picker:ho,stats:[c.StatHolyPower]},{config:dl,picker:ho,stats:[c.StatMP5]},{config:hl,picker:ho,stats:[c.StatMP5,c.StatSpellPower,c.StatSpellDamage]},{config:ml,picker:ho,stats:[c.StatMeleeHit]}],Kl=[{config:pl,picker:ho,stats:[c.StatMeleeCrit,c.StatSpellCrit,c.StatAttackPower]},{config:fl,picker:ho,stats:[]},{config:gl,picker:ho,stats:[]},{config:Il,picker:ho,stats:[]},{config:El,picker:ho,stats:[c.StatAttackPower]},{config:kl,picker:ho,stats:[c.StatStamina]},{config:Pl,picker:ho,stats:[c.StatSpellCrit]}],Jl=[{config:bl,stats:[]},{config:Sl,stats:[c.StatAgility]},{config:xl,stats:[c.StatIntellect]},{config:vl,stats:[c.StatSpirit,c.StatMP5]},{config:yl,stats:[c.StatStamina]}],Zl=[{config:Cl,stats:[c.StatAttackPower],picker:Ho},{config:Tl,picker:ho,stats:[c.StatAttackPower]},{config:Nl,picker:ho,stats:[c.StatAttackPower]},{config:Hl,picker:ho,stats:[c.StatHolyPower]},{config:Ll,picker:ho,stats:[c.StatShadowPower]},{config:Vl,picker:ho,stats:[c.StatFirePower]},{config:Ml,picker:ho,stats:[c.StatFrostPower]},{config:Ul,picker:ho,stats:[c.StatNaturePower]},{config:Wl,picker:ho,stats:[c.StatShadowPower]},{config:Fl,picker:Ho,stats:[c.StatSpellPower,c.StatSpellDamage]},{config:Rl,picker:Ho,stats:[c.StatArmor]},{config:Dl,picker:Ho,stats:[c.StatArmor]},{config:_l,picker:ho,stats:[c.StatArmor]},{config:Al,picker:ho,stats:[c.StatDodge]},{config:Ol,picker:ho,stats:[c.StatRangedAttackPower]},{config:ql,picker:ho,stats:[c.StatMP5,c.StatIntellect]}],Yl=[{config:zl,picker:ho,stats:[c.StatAttackPower,c.StatRangedAttackPower]},{config:jl,picker:ho,stats:[c.StatAttackPower,c.StatRangedAttackPower]},{config:Bl,picker:ho,stats:[c.StatStamina]}],Ql={actionId:()=>x.fromItemId(8928),value:st.InstantPoison,showWhen:e=>e.getClass()==o.ClassRogue},Xl={actionId:()=>x.fromItemId(8985),value:st.DeadlyPoison,showWhen:e=>e.getClass()==o.ClassRogue},er={actionId:()=>x.fromItemId(10922),value:st.WoundPoison,showWhen:e=>e.getClass()==o.ClassRogue},tr=e=>({actionId:()=>x.fromSpellId(16316),value:st.RockbiterWeapon,showWhen:t=>{if(!t.isClass(o.ClassShaman))return!1;const s=t.getEquippedItem(e);return!s||at(s.item.weaponType)}}),sr=e=>({actionId:()=>x.fromSpellId(16342),value:st.FlametongueWeapon,showWhen:t=>{if(!t.isClass(o.ClassShaman))return!1;const s=t.getEquippedItem(e);return!s||at(s.item.weaponType)}}),ar=e=>({actionId:()=>x.fromSpellId(16356),value:st.FrostbrandWeapon,showWhen:t=>{if(!t.isClass(o.ClassShaman))return!1;const s=t.getEquippedItem(e);return!s||at(s.item.weaponType)}}),ir=e=>({actionId:()=>x.fromSpellId(16362),value:st.WindfuryWeapon,showWhen:t=>{if(!t.isClass(o.ClassShaman))return!1;const s=t.getEquippedItem(e);return!s||at(s.item.weaponType)}});function nr(e){return(t,s)=>({type:"iconEnum",tooltip:s,numColumns:t.length>11?4:t.length>8?3:t.length>5?2:1,values:[{value:0}].concat(t.map((e=>({actionId:e.config.actionId,value:e.config.value,showWhen:t=>!e.config.showWhen||e.config.showWhen(t)})))),equals:(e,t)=>e==t,zeroValue:0,changedEvent:e=>a.onAny([e.consumesChangeEmitter,e.gearChangeEmitter,e.professionChangeEmitter,e.raceChangeEmitter]),showWhen:t=>!e.showWhen||e.showWhen(t),getValue:t=>t.getConsumes()[e.consumesFieldName],setValue:(t,s,i)=>{const n=s.getConsumes();n[e.consumesFieldName]!==i&&(n[e.consumesFieldName]=i,a.freezeAllAndDo((()=>{s.setConsumes(t,n),e.onSet&&e.onSet(t,s,i)})))}})}const or=e=>(t,s,a,i)=>{const n={...e,values:i.map((e=>e.config))};return new Ho(t,s,n,a)},lr={actionId:()=>x.fromItemId(5509),value:it.ConjuredHealthstone},rr={actionId:()=>x.fromItemId(5510),value:it.ConjuredGreaterHealthstone},cr={actionId:()=>x.fromItemId(9421),value:it.ConjuredMajorHealthstone},dr={actionId:()=>x.fromItemId(4381),value:it.ConjuredMinorRecombobulator,showWhen:e=>e.getGear().hasTrinket(4381)},hr={actionId:()=>x.fromItemId(12662),value:it.ConjuredDemonicRune},mr={actionId:()=>x.fromItemId(7676),value:it.ConjuredRogueThistleTea,showWhen:e=>e.getClass()==o.ClassRogue},ur=[{config:cr,stats:[c.StatArmor]},{config:rr,stats:[c.StatArmor]},{config:lr,stats:[c.StatArmor]},{config:hr,stats:[c.StatIntellect]},{config:dr,stats:[c.StatIntellect]},{config:mr,stats:[]}],pr=nr({consumesFieldName:"defaultConjured"}),gr={actionId:()=>x.fromItemId(10646),showWhen:e=>e.hasProfession(F.Engineering),value:nt.SapperGoblinSapper},fr={actionId:()=>x.fromItemId(10507),showWhen:e=>e.hasProfession(F.Engineering),value:ot.ExplosiveSolidDynamite},Ir={actionId:()=>x.fromItemId(4395),showWhen:e=>e.hasProfession(F.Engineering),value:ot.ExplosiveGoblinLandMine},wr=[{config:fr,stats:[]},{config:{actionId:()=>x.fromItemId(18641),showWhen:e=>e.hasProfession(F.Engineering),value:ot.ExplosiveDenseDynamite},stats:[]},{config:{actionId:()=>x.fromItemId(15993),showWhen:e=>e.hasProfession(F.Engineering),value:ot.ExplosiveThoriumGrenade},stats:[]},{config:Ir,stats:[]}],br=[{config:gr,stats:[]}],Sr=nr({consumesFieldName:"fillerExplosive"}),xr=nr({consumesFieldName:"sapperExplosive"}),vr={actionId:()=>x.fromItemId(13510),value:lt.FlaskOfTheTitans},yr={actionId:()=>x.fromItemId(13511),value:lt.FlaskOfDistilledWisdom},Er={actionId:()=>x.fromItemId(13512),value:lt.FlaskOfSupremePower},kr={actionId:()=>x.fromItemId(13513),value:lt.FlaskOfChromaticResistance},Pr=[{config:vr,stats:[]},{config:yr,stats:[c.StatIntellect]},{config:Er,stats:[c.StatMP5,c.StatSpellPower,c.StatSpellDamage]},{config:kr,stats:[]}],Cr=nr({consumesFieldName:"flask"}),Tr={actionId:()=>x.fromItemId(21023),value:rt.FoodDirgesKickChimaerokChops},Nr={actionId:()=>x.fromItemId(13928),value:rt.FoodGrilledSquid},_r={actionId:()=>x.fromItemId(20452),value:rt.FoodSmokedDesertDumpling},Rr={actionId:()=>x.fromItemId(18254),value:rt.FoodRunnTumTuberSurprise},Dr={actionId:()=>x.fromItemId(13810),value:rt.FoodBlessSunfruit},Ar={actionId:()=>x.fromItemId(13813),value:rt.FoodBlessedSunfruitJuice},Lr={actionId:()=>x.fromItemId(13931),value:rt.FoodNightfinSoup},Vr={actionId:()=>x.fromItemId(18045),value:rt.FoodTenderWolfSteak},Mr={actionId:()=>x.fromItemId(21217),value:rt.FoodSagefishDelight},Ur={actionId:()=>x.fromItemId(13851),value:rt.FoodHotWolfRibs},Wr={actionId:()=>x.fromItemId(21072),value:rt.FoodSmokedSagefish},Fr=[{config:Tr,stats:[c.StatStamina]},{config:Nr,stats:[c.StatAgility]},{config:_r,stats:[c.StatStrength]},{config:Rr,stats:[c.StatIntellect]},{config:Dr,stats:[c.StatStrength]},{config:Ar,stats:[c.StatSpirit]},{config:Lr,stats:[c.StatMP5]},{config:Vr,stats:[c.StatStamina,c.StatSpirit]},{config:Mr,stats:[c.StatMP5]},{config:Ur,stats:[c.StatSpirit]},{config:Wr,stats:[c.StatMP5]}],Or=nr({consumesFieldName:"food"}),qr=function(e){return Eo({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getConsumes(),setValue:(e,t,s)=>t.setConsumes(e,s),changeEmitter:e=>a.onAny([e.consumesChangeEmitter,e.professionChangeEmitter])},e.actionId,e.fieldName,e.value)}({actionId:()=>x.fromItemId(12217),fieldName:"dragonBreathChili"}),Hr={actionId:()=>x.fromItemId(21151),value:ct.AlcoholRumseyRumBlackLabel},Br={actionId:()=>x.fromItemId(18269),value:ct.AlcoholGordokGreenGrog},zr={actionId:()=>x.fromItemId(21114),value:ct.AlcoholRumseyRumDark},jr={actionId:()=>x.fromItemId(20709),value:ct.AlcoholRumseyRumLight},$r={actionId:()=>x.fromItemId(18284),value:ct.AlcoholKreegsStoutBeatdown},Gr=[{config:Hr,stats:[c.StatStamina]},{config:Br,stats:[c.StatStamina]},{config:zr,stats:[c.StatStamina]},{config:jr,stats:[c.StatStamina]},{config:$r,stats:[c.StatSpirit]}],Kr=nr({consumesFieldName:"alcohol"}),Jr={actionId:()=>x.fromItemId(13445),value:dt.ElixirOfSuperiorDefense},Zr={actionId:()=>x.fromItemId(8951),value:dt.ElixirOfGreaterDefense},Yr={actionId:()=>x.fromItemId(3389),value:dt.ElixirOfDefense},Qr={actionId:()=>x.fromItemId(5997),value:dt.ElixirOfMinorDefense},Xr={actionId:()=>x.fromItemId(10305),value:dt.ScrollOfProtection},ec=[{config:Jr,stats:[c.StatArmor]},{config:Zr,stats:[c.StatArmor]},{config:Yr,stats:[c.StatArmor]},{config:Qr,stats:[c.StatArmor]},{config:Xr,stats:[c.StatArmor]}],tc=nr({consumesFieldName:"armorElixir"}),sc={actionId:()=>x.fromItemId(3825),value:ht.ElixirOfFortitude},ac={actionId:()=>x.fromItemId(2458),value:ht.ElixirOfMinorFortitude},ic=[{config:sc,stats:[c.StatStamina]},{config:ac,stats:[c.StatStamina]}],nc=nr({consumesFieldName:"healthElixir"}),oc={actionId:()=>x.fromItemId(12460),value:mt.JujuMight},lc={actionId:()=>x.fromItemId(12820),value:mt.WinterfallFirewater},rc=[{config:oc,stats:[c.StatAttackPower]},{config:lc,stats:[c.StatAttackPower]}],cc=nr({consumesFieldName:"attackPowerBuff"}),dc={actionId:()=>x.fromItemId(13452),value:ut.ElixirOfTheMongoose},hc={actionId:()=>x.fromItemId(9187),value:ut.ElixirOfGreaterAgility},mc={actionId:()=>x.fromItemId(8949),value:ut.ElixirOfAgility},uc={actionId:()=>x.fromItemId(3390),value:ut.ElixirOfLesserAgility},pc={actionId:()=>x.fromItemId(10309),value:ut.ScrollOfAgility},gc=[{config:dc,stats:[c.StatAgility,c.StatMeleeCrit]},{config:hc,stats:[c.StatAgility]},{config:mc,stats:[c.StatAgility]},{config:uc,stats:[c.StatAgility]},{config:pc,stats:[c.StatAgility]}],fc=nr({consumesFieldName:"agilityElixir"}),Ic={actionId:()=>x.fromItemId(12451),value:pt.JujuPower},wc={actionId:()=>x.fromItemId(9206),value:pt.ElixirOfGiants},bc={actionId:()=>x.fromItemId(3391),value:pt.ElixirOfOgresStrength},Sc={actionId:()=>x.fromItemId(10310),value:pt.ScrollOfStrength},xc=[{config:Ic,stats:[c.StatStrength]},{config:wc,stats:[c.StatStrength]},{config:bc,stats:[c.StatStrength]},{config:Sc,stats:[c.StatStrength]}],vc=nr({consumesFieldName:"strengthBuff"}),yc={actionId:()=>x.fromItemId(8410),value:gt.ROIDS},Ec={actionId:()=>x.fromItemId(8412),value:gt.GroundScorpokAssay},kc={actionId:()=>x.fromItemId(8411),value:gt.LungJuiceCocktail},Pc={actionId:()=>x.fromItemId(8423),value:gt.CerebralCortexCompound},Cc={actionId:()=>x.fromItemId(8424),value:gt.GizzardGum},Tc=[{config:{actionId:()=>x.fromItemId(20079),value:gt.SpiritOfZanza},stats:[c.StatStamina,c.StatSpirit]},{config:yc,stats:[c.StatStrength]},{config:Ec,stats:[c.StatAgility]},{config:kc,stats:[c.StatStamina]},{config:Pc,stats:[c.StatIntellect]},{config:Cc,stats:[c.StatSpirit]}],Nc=nr({consumesFieldName:"zanzaBuff"}),_c=Vo({actionId:()=>x.fromItemId(12450),fieldName:"jujuFlurry"}),Rc=Vo({actionId:()=>x.fromItemId(5206),fieldName:"boglingRoot"}),Dc=Vo({actionId:()=>x.fromItemId(5342),fieldName:"raptorPunch"}),Ac=[{config:_c,picker:ho,stats:[c.StatAttackPower]},{config:Dc,picker:ho,stats:[c.StatIntellect]},{config:Rc,picker:ho,stats:[c.StatAttackPower]}],Lc=or({direction:co.Vertical,tooltip:"Misc Offensive"}),Vc=Vo({actionId:()=>x.fromItemId(12455),fieldName:"jujuEmber"}),Mc=Vo({actionId:()=>x.fromItemId(12457),fieldName:"jujuChill"}),Uc=Vo({actionId:()=>x.fromItemId(12459),fieldName:"jujuEscape"}),Wc=[{config:Vc,picker:ho,stats:[]},{config:Mc,picker:ho,stats:[]},{config:Uc,picker:ho,stats:[c.StatDodge]}],Fc=or({direction:co.Vertical,tooltip:"Misc Defensive"}),Oc=qo({direction:co.Vertical,values:[{value:0,tooltip:"None"},{actionId:()=>x.fromItemId(12460),value:1}],fieldName:"petAttackPowerConsumable"}),qc=qo({direction:co.Vertical,values:[{value:0,tooltip:"None"},{actionId:()=>x.fromItemId(10309),value:1},{actionId:()=>x.fromItemId(4425),value:2},{actionId:()=>x.fromItemId(1477),value:3},{actionId:()=>x.fromItemId(3012),value:4}],fieldName:"petAgilityConsumable"}),Hc=qo({direction:co.Vertical,values:[{value:0,tooltip:"None"},{actionId:()=>x.fromItemId(12451),value:1},{actionId:()=>x.fromItemId(10310),value:2},{actionId:()=>x.fromItemId(4426),value:3},{actionId:()=>x.fromItemId(2289),value:4},{actionId:()=>x.fromItemId(954),value:5}],fieldName:"petStrengthConsumable"});!function(e){Eo({getModObject:e=>e,showWhen:t=>!e.showWhen||e.showWhen(t),getValue:e=>e.getConsumes().petMiscConsumes??et.create(),setValue:(e,t,s)=>{const a=t.getConsumes();a.petMiscConsumes=s,t.setConsumes(e,a)},changeEmitter:e=>a.onAny([e.consumesChangeEmitter,e.professionChangeEmitter])},e.actionId,e.fieldName,e.value)}({actionId:()=>x.fromItemId(12450),fieldName:"jujuFlurry"}),or({direction:co.Vertical,tooltip:"Misc Pet Consumes"});const Bc={actionId:()=>x.fromItemId(1710),value:ft.GreaterHealingPotion},zc={actionId:()=>x.fromItemId(3928),value:ft.SuperiorHealingPotion},jc={actionId:()=>x.fromItemId(13446),value:ft.MajorHealingPotion},$c={actionId:()=>x.fromItemId(3827),value:ft.ManaPotion},Gc={actionId:()=>x.fromItemId(6149),value:ft.GreaterManaPotion},Kc={actionId:()=>x.fromItemId(13443),value:ft.SuperiorManaPotion},Jc={actionId:()=>x.fromItemId(13444),value:ft.MajorManaPotion},Zc={actionId:()=>x.fromItemId(13442),value:ft.MightyRagePotion,showWhen:e=>e.getClass()==o.ClassWarrior},Yc={actionId:()=>x.fromItemId(5633),value:ft.GreatRagePotion,showWhen:e=>e.getClass()==o.ClassWarrior},Qc={actionId:()=>x.fromItemId(5631),value:ft.RagePotion,showWhen:e=>e.getClass()==o.ClassWarrior};ft.MagicResistancePotion;const Xc={actionId:()=>x.fromItemId(13455),value:ft.GreaterStoneshieldPotion},ed={actionId:()=>x.fromItemId(4623),value:ft.LesserStoneshieldPotion},td=[{config:jc,stats:[c.StatArmor]},{config:zc,stats:[c.StatArmor]},{config:Bc,stats:[c.StatArmor]},{config:Jc,stats:[c.StatIntellect]},{config:Kc,stats:[c.StatIntellect]},{config:Gc,stats:[c.StatIntellect]},{config:$c,stats:[c.StatIntellect]},{config:Zc,stats:[]},{config:Yc,stats:[]},{config:Qc,stats:[]},{config:Xc,stats:[c.StatArmor]},{config:ed,stats:[c.StatArmor]}],sd=nr({consumesFieldName:"defaultPotion"}),ad={actionId:()=>x.fromItemId(13454),value:It.GreaterArcaneElixir},id={actionId:()=>x.fromItemId(9155),value:It.ArcaneElixir},nd=[{config:ad,stats:[c.StatSpellPower,c.StatSpellDamage]},{config:id,stats:[c.StatSpellPower,c.StatSpellDamage]}],od=nr({consumesFieldName:"spellPowerBuff"}),ld={actionId:()=>x.fromItemId(21546),value:wt.ElixirOfGreaterFirepower},rd={actionId:()=>x.fromItemId(6373),value:wt.ElixirOfFirepower},cd=[{config:ld,stats:[c.StatFirePower]},{config:rd,stats:[c.StatFirePower]}],dd=nr({consumesFieldName:"firePowerBuff"}),hd={actionId:()=>x.fromItemId(17708),value:bt.ElixirOfFrostPower},md=[{config:hd,stats:[c.StatFrostPower]}],ud=nr({consumesFieldName:"frostPowerBuff"}),pd=[{config:{actionId:()=>x.fromItemId(9264),value:St.ElixirOfShadowPower},stats:[c.StatShadowPower]}],gd=nr({consumesFieldName:"shadowPowerBuff"}),fd=[{config:{actionId:()=>x.fromItemId(20007),value:xt.MagebloodPotion},stats:[c.StatMP5]}],Id=nr({consumesFieldName:"manaRegenElixir"}),wd={actionId:()=>x.fromSpellId(10614),value:st.Windfury,showWhen:e=>e.getFaction()===qe.Horde&&!e.isSpec(j.SpecFeralDruid)},bd=e=>({actionId:()=>x.fromItemId(20749),value:st.BrilliantWizardOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||at(s.item.weaponType)}}),Sd=e=>({actionId:()=>x.fromItemId(20750),value:st.WizardOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||at(s.item.weaponType)}}),xd=e=>({actionId:()=>x.fromItemId(20746),value:st.LesserWizardOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||at(s.item.weaponType)}}),vd=e=>({actionId:()=>x.fromItemId(20744),value:st.MinorWizardOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||at(s.item.weaponType)}}),yd=e=>({actionId:()=>x.fromItemId(23123),value:st.BlessedWizardOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||at(s.item.weaponType)}}),Ed=e=>({actionId:()=>x.fromItemId(20748),value:st.BrilliantManaOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||at(s.item.weaponType)}}),kd=e=>({actionId:()=>x.fromItemId(20747),value:st.LesserManaOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||at(s.item.weaponType)}}),Pd=e=>({actionId:()=>x.fromItemId(20745),value:st.MinorManaOil,showWhen:t=>{const s=t.getEquippedItem(e);return!s||at(s.item.weaponType)}}),Cd=e=>({actionId:()=>x.fromItemId(23122),value:st.ConsecratedSharpeningStone,showWhen:t=>{const s=t.getEquippedItem(e);return!s||at(s.item.weaponType)}}),Td=e=>({actionId:()=>x.fromItemId(18262),value:st.ElementalSharpeningStone,showWhen:t=>{const s=t.getEquippedItem(e);return(!s||at(s.item.weaponType))&&!t.isSpec(j.SpecFeralDruid)}}),Nd=e=>({actionId:()=>x.fromItemId(12404),value:st.DenseSharpeningStone,showWhen:t=>{const s=t.getEquippedItem(e);return(!s||vt(s.item.weaponType))&&!t.isSpec(j.SpecFeralDruid)}}),_d=e=>({actionId:()=>x.fromItemId(7964),value:st.SolidSharpeningStone,showWhen:t=>{const s=t.getEquippedItem(e);return(!s||vt(s.item.weaponType))&&!t.isSpec(j.SpecFeralDruid)}}),Rd=e=>({actionId:()=>x.fromItemId(12643),value:st.DenseWeightstone,showWhen:t=>{const s=t.getEquippedItem(e);return(!s||yt(s.item.weaponType))&&!t.isSpec(j.SpecFeralDruid)}}),Dd=e=>({actionId:()=>x.fromItemId(7965),value:st.SolidWeightstone,showWhen:t=>{const s=t.getEquippedItem(e);return(!s||yt(s.item.weaponType))&&!t.isSpec(j.SpecFeralDruid)}}),Ad=e=>({actionId:()=>x.fromItemId(3824),value:st.ShadowOil,showWhen:t=>{const s=t.getEquippedItem(e);return(!s||at(s.item.weaponType))&&!t.isSpec(j.SpecFeralDruid)}}),Ld=e=>({actionId:()=>x.fromItemId(3829),value:st.FrostOil,showWhen:t=>{const s=t.getEquippedItem(e);return(!s||at(s.item.weaponType))&&!t.isSpec(j.SpecFeralDruid)}}),Vd=e=>[{config:tr(e),stats:[]},{config:sr(e),stats:[]},{config:ar(e),stats:[]},{config:ir(e),stats:[]}],Md=[{config:Ql,stats:[]},{config:Xl,stats:[]},{config:er,stats:[]}],Ud=e=>[{config:bd(e),stats:[c.StatSpellPower,c.StatSpellDamage]},{config:Sd(e),stats:[c.StatSpellPower,c.StatSpellDamage]},{config:xd(e),stats:[c.StatSpellPower,c.StatSpellDamage]},{config:vd(e),stats:[c.StatSpellPower,c.StatSpellDamage]},{config:yd(e),stats:[c.StatHealingPower,c.StatSpellPower,c.StatSpellDamage]},{config:Ed(e),stats:[c.StatMP5,c.StatHealingPower]},{config:kd(e),stats:[c.StatMP5]},{config:Pd(e),stats:[c.StatMP5]},{config:Cd(e),stats:[c.StatAttackPower]},{config:Td(e),stats:[c.StatAttackPower]},{config:Nd(e),stats:[c.StatAttackPower]},{config:_d(e),stats:[c.StatAttackPower]},{config:Rd(e),stats:[c.StatAttackPower]},{config:Dd(e),stats:[c.StatAttackPower]},{config:Ad(e),stats:[c.StatAttackPower]},{config:Ld(e),stats:[c.StatAttackPower]}],Wd=[...Md,...Vd(A.ItemSlotOffHand),...Ud(A.ItemSlotOffHand)],Fd=[...Md,...Vd(A.ItemSlotMainHand),{config:wd,stats:[c.StatMeleeHit]},...Ud(A.ItemSlotMainHand)],Od=nr({consumesFieldName:"mainHandImbue",showWhen:e=>!!e.getGear().getEquippedItem(A.ItemSlotMainHand)}),qd=nr({consumesFieldName:"offHandImbue",showWhen:e=>!!e.getGear().getEquippedItem(A.ItemSlotOffHand)});class Hd extends f{constructor(e,t,s){super(e,"enum-picker-root",t,s),this.selectElem=document.createElement("select"),this.selectElem.id=s.id,this.selectElem.classList.add("enum-picker-selector","form-select"),s.values.forEach((e=>{const t=document.createElement("option");t.value=String(e.value),t.textContent=e.name,this.selectElem.appendChild(t),e.tooltip&&(t.title=e.tooltip)})),this.rootElem.appendChild(this.selectElem),this.init(),this.selectElem.addEventListener("change",(()=>{this.inputChanged(a.nextEventID())}),{signal:this.signal})}getInputElem(){return this.selectElem}getInputValue(){return parseInt(this.selectElem.value)}setInputValue(e){this.selectElem.value=String(e)}}const Bd={id:"reaction-time",type:"number",label:"Reaction Time",labelTooltip:"Reaction time of the player, in milliseconds. Used with certain APL values (such as 'Aura Is Active With Reaction Time').",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getReactionTime(),setValue:(e,t,s)=>{t.setReactionTime(e,s)}},zd={id:"channel-clip-delay",type:"number",label:"Channel Clip Delay",labelTooltip:"Clip delay following channeled spells, in milliseconds. This delay occurs following any full or partial channel ending after the GCD becomes available, due to the player not being able to queue the next spell.",changedEvent:e=>e.miscOptionsChangeEmitter,getValue:e=>e.getChannelClipDelay(),setValue:(e,t,s)=>{t.setChannelClipDelay(e,s)}},jd={id:"in-front-of-target",type:"boolean",label:"In Front of Target",labelTooltip:"Stand in front of the target, causing Blocks and Parries to be included in the attack table.",changedEvent:e=>e.inFrontOfTargetChangeEmitter,getValue:e=>e.getInFrontOfTarget(),setValue:(e,t,s)=>{t.setInFrontOfTarget(e,s)}},$d={id:"distance-from-target",type:"number",label:"Distance From Target",labelTooltip:"Distance from targets, in yards. Used to calculate travel time for certain spells.",changedEvent:e=>e.distanceFromTargetChangeEmitter,getValue:e=>e.getDistanceFromTarget(),setValue:(e,t,s)=>{t.setDistanceFromTarget(e,s)}},Gd={tooltip:"Improved Shadow Bolt debuff configuration",inputs:[{id:"isb-sb-frequency",type:"number",label:"SB Frequency",labelTooltip:"How often a Shadow Bolt is cast by the external warlock.",float:!0,defaultValue:3,inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbSbFrequency(),setValue:(e,t,s)=>{t.setIsbSbFrequency(e,s)},showWhen:e=>!0===e.getRaid()?.getDebuffs().improvedShadowBolt},{id:"isb-sb-crit",type:"number",label:"SB Crit",labelTooltip:"How often a Shadow Bolt from external warlock is a crit.",float:!0,defaultValue:25,inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbCrit(),setValue:(e,t,s)=>{t.setIsbCrit(e,s)},showWhen:e=>!0===e.getRaid()?.getDebuffs().improvedShadowBolt},{id:"isb-warlock",type:"number",label:"SB Warlocks",labelTooltip:"Number of ISB warlocks.",defaultValue:1,inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbWarlocks(),setValue:(e,t,s)=>{t.setIsbWarlocks(e,s)},showWhen:e=>!0===e.getRaid()?.getDebuffs().improvedShadowBolt},{id:"isb-sb-priests",type:"number",label:"Shadow Priests",labelTooltip:"Number of other shadow priests.",inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getIsbSpriests(),setValue:(e,t,s)=>{t.setIsbSpriests(e,s)},showWhen:e=>!0===e.getRaid()?.getDebuffs().improvedShadowBolt||e?.getTalents().improvedShadowBolt>0}]},Kd={tooltip:"Stormstrike debuff configuration",inputs:[{id:"stormstrike-frequency",type:"number",label:"Stormstrike Cast Frequency",labelTooltip:"How often (in Seconds) that Stormstrike is cast by an external Enhancement Shaman.",float:!0,defaultValue:20,inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getStormstrikeFrequency(),setValue:(e,t,s)=>{t.setStormstrikeFrequency(e,s)},showWhen:e=>!0===e.getRaid()?.getDebuffs().stormstrike},{id:"stormstrike-attackers-frequency",type:"number",label:"Other Nature Attacks Frequency",labelTooltip:"How often (in Seconds) that external attackers deal Nature damage to the target.",float:!0,defaultValue:4,inline:!0,changedEvent:e=>a.onAny([e.changeEmitter,e.getRaid().debuffsChangeEmitter]),getValue:e=>e.getStormstrikeNatureAttackerFrequency(),setValue:(e,t,s)=>{t.setStormstrikeNatureAttackerFrequency(e,s)},showWhen:e=>!0===e.getRaid()?.getDebuffs().stormstrike}]},Jd={id:"tank-assignment",type:"enum",extraCssClasses:["tank-selector","threat-metrics","within-raid-sim-hide"],label:"Tank Assignment",labelTooltip:"Determines which mobs will be tanked. Most mobs default to targeting the Main Tank, but in preset multi-target encounters this is not always true.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:e=>e.getRaid().tanksChangeEmitter,getValue:e=>(e.getRaid()?.getTanks()||[]).findIndex((t=>we.equals(t,e.makeUnitReference()))),setValue:(e,t,s)=>{const a=[];if(-1!=s){for(let e=0;e<s;e++)a.push(ie());a.push(t.makeUnitReference())}t.getRaid().setTanks(e,a)}},Zd={id:"incoming-hps",type:"number",label:"Incoming HPS",labelTooltip:"\n\t\t<p>Average amount of healing received per second. Used for calculating chance of death.</p>\n\t\t<p class=\"mb-0>If set to 0, defaults to 17.5% of the primary target's base DPS.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().hps,setValue:(e,t,s)=>{const a=t.getHealingModel();a.hps=s,t.setHealingModel(e,a)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>we.equals(t,e.makeUnitReference())))},Yd={id:"healing-cadence",type:"number",float:!0,label:"Healing Cadence",labelTooltip:"\n\t\t<p>How often the incoming heal 'ticks', in seconds. Generally, longer durations favor Effective Hit Points (EHP) for minimizing Chance of Death, while shorter durations favor avoidance.</p>\n\t\t<p>Example: if Incoming HPS is set to 1000 and this is set to 1s, then every 1s a heal will be received for 1000. If this is instead set to 2s, then every 2s a heal will be received for 2000.</p>\n\t\t<p class=\"mb-0\">If set to 0, defaults to 1.5 times the primary target's base swing timer, and half that for dual wielding targets.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceSeconds,setValue:(e,t,s)=>{const a=t.getHealingModel();a.cadenceSeconds=s,t.setHealingModel(e,a)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>we.equals(t,e.makeUnitReference())))},Qd={id:"healing-cadence-variation",type:"number",float:!0,label:"Cadence +/-",labelTooltip:"\n\t\t<p>Magnitude of random variation in healing intervals, in seconds.</p>\n\t\t<p>Example: if Healing Cadence is set to 1s with 0.5s variation, then the interval between successive heals will vary uniformly between 0.5 and 1.5s. If the variation is instead set to 2s, then 50% of healing intervals will fall between 0s and 1s, and the other 50% will fall between 1s and 3s.</p>\n\t\t<p class=\"mb-0\">The amount of healing per 'tick' is automatically scaled up or down based on the randomized time since the last tick, so as to keep HPS constant.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().cadenceVariation,setValue:(e,t,s)=>{const a=t.getHealingModel();a.cadenceVariation=s,t.setHealingModel(e,a)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>we.equals(t,e.makeUnitReference())))},Xd={id:"burst-window",type:"number",float:!1,label:"TMI Burst Window",labelTooltip:"\n\t\t<p>Size in whole seconds of the burst window for calculating TMI. It is important to use a consistent setting when comparing this metric.</p>\n\t\t<p>Default is 6 seconds. If set to 0, TMI calculations are disabled.</p>\n\t",changedEvent:e=>e.getRaid().changeEmitter,getValue:e=>e.getHealingModel().burstWindow,setValue:(e,t,s)=>{const a=t.getHealingModel();a.burstWindow=s,t.setHealingModel(e,a)},enableWhen:e=>null!=(e.getRaid()?.getTanks()||[]).find((t=>we.equals(t,e.makeUnitReference())))},eh={id:"hp-percent-for-defensives",type:"number",float:!0,label:"HP % for Defensive CDs",labelTooltip:'\n\t\t<p>% of Maximum Health, below which defensive cooldowns are allowed to be used.</p>\n\t\t<p class="mb-0">If set to 0, this restriction is disabled.</p>\n\t',changedEvent:e=>e.rotationChangeEmitter,getValue:e=>100*e.getSimpleCooldowns().hpPercentForDefensives,setValue:(e,t,s)=>{const a=t.getSimpleCooldowns();a.hpPercentForDefensives=s/100,t.setSimpleCooldowns(e,a)}},th={id:"inspiration-uptime",type:"number",float:!0,label:"Inspiration % Uptime",labelTooltip:'\n\t\t<p>% average of Encounter Duration, during which you have the Inspiration buff.</p>\n\t\t<p class="mb-0">If set to 0, the buff isn\'t applied.</p>\n\t',changedEvent:e=>e.healingModelChangeEmitter,getValue:e=>100*e.getHealingModel().inspirationUptime,setValue:(e,t,s)=>{const a=t.getHealingModel();a.inspirationUptime=s/100,t.setHealingModel(e,a)}};class sh extends f{constructor(e,t,s){super(e,"number-picker-root",t,s),this.float=s.float??!1,this.positive=s.positive??!1,this.showZeroes=s.showZeroes??!0,this.inputElem=document.createElement("input"),this.inputElem.id=s.id,this.inputElem.type="text",this.inputElem.classList.add("form-control","number-picker-input"),this.positive&&this.inputElem.addEventListener("change",(()=>{this.float?this.inputElem.value=Math.abs(parseFloat(this.inputElem.value)).toFixed(2):this.inputElem.value=Math.abs(parseInt(this.inputElem.value)).toString()}),{signal:this.signal}),this.inputElem.addEventListener("change",(()=>{this.inputChanged(a.nextEventID())}),{signal:this.signal}),this.inputElem.addEventListener("input",(()=>{this.updateSize()}),{signal:this.signal}),this.rootElem.appendChild(this.inputElem),this.init(),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.float?parseFloat(this.inputElem.value||"")||0:parseInt(this.inputElem.value||"")||0}setInputValue(e){(0!=e||this.showZeroes)&&(this.float?this.inputElem.value=e.toFixed(2):this.inputElem.value=String(e))}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}const ah=new Map([["Primary",[vn.fromStat(c.StatHealth),vn.fromStat(c.StatMana)]],["Attributes",[vn.fromStat(c.StatStrength),vn.fromStat(c.StatAgility),vn.fromStat(c.StatStamina),vn.fromStat(c.StatIntellect),vn.fromStat(c.StatSpirit)]],["Physical",[vn.fromStat(c.StatAttackPower),vn.fromStat(c.StatFeralAttackPower),vn.fromStat(c.StatRangedAttackPower),vn.fromStat(c.StatMeleeHit),vn.fromStat(c.StatExpertise),vn.fromStat(c.StatMeleeCrit),vn.fromStat(c.StatMeleeHaste),vn.fromPseudoStat(d.PseudoStatMeleeSpeedMultiplier),vn.fromPseudoStat(d.PseudoStatRangedSpeedMultiplier),vn.fromPseudoStat(d.BonusPhysicalDamage)]],["Spell",[vn.fromStat(c.StatSpellPower),vn.fromStat(c.StatSpellDamage),vn.fromStat(c.StatArcanePower),vn.fromStat(c.StatFirePower),vn.fromStat(c.StatFrostPower),vn.fromStat(c.StatHolyPower),vn.fromStat(c.StatNaturePower),vn.fromStat(c.StatShadowPower),vn.fromStat(c.StatSpellHit),vn.fromStat(c.StatSpellCrit),vn.fromPseudoStat(d.PseudoStatCastSpeedMultiplier),vn.fromStat(c.StatSpellPenetration),vn.fromStat(c.StatMP5)]],["Defense",[vn.fromStat(c.StatArmor),vn.fromStat(c.StatBonusArmor),vn.fromStat(c.StatDefense),vn.fromStat(c.StatDodge),vn.fromStat(c.StatParry),vn.fromStat(c.StatBlock),vn.fromStat(c.StatBlockValue)]],["Resistance",[vn.fromStat(c.StatArcaneResistance),vn.fromStat(c.StatFireResistance),vn.fromStat(c.StatFrostResistance),vn.fromStat(c.StatNatureResistance),vn.fromStat(c.StatShadowResistance)]],["Misc",[]]]);class ih extends p{constructor(t,s,i,n){super(t,"character-stats-root"),this.stats=[],this.player=s,this.modifyDisplayStats=n;const o=e("table",{className:"character-stats-table"});this.rootElem.appendChild(o),this.valueElems=[],ah.forEach(((t,a)=>{const n=t.filter((e=>i.find((t=>t.equals(e)))));if(!n.length)return;const l=e("tbody",null);n.forEach((t=>{this.stats.push(t);const a=t.getName(s.getClass()),i=e("tr",{className:"character-stats-table-row"},e("td",{className:"character-stats-table-label"},a),e("td",{className:"character-stats-table-value"},this.bonusStatsLink(t)));l.appendChild(i);const n=i.getElementsByClassName("character-stats-table-value")[0];if(this.valueElems.push(n),t.isStat()&&t.getStat()===c.StatMeleeCrit&&this.shouldShowMeleeCritCap(s)){const t=e("tr",{className:"character-stats-table-row"},e("td",{className:"character-stats-table-label"},"Melee Crit Cap"),e("td",{className:"character-stats-table-value"},e("span",{className:"px-2 border-start border-end border-body border-brand",style:{"--bs-border-opacity":"0"}})));l.appendChild(t);const s=t.getElementsByClassName("character-stats-table-value")[0];this.valueElems.push(s)}})),o.appendChild(l)})),this.updateStats(s),a.onAny([s.currentStatsEmitter,s.sim.changeEmitter,s.talentsChangeEmitter]).on((()=>{this.updateStats(s)}))}updateStats(t){const s=t.getCurrentStats(),a=t.getGear(),i=a.getEquippedItem(A.ItemSlotMainHand),n=a.getEquippedItem(A.ItemSlotOffHand),o=this.modifyDisplayStats?this.modifyDisplayStats(this.player):{};o.talents||(o.talents=new yn),o.buffs||(o.buffs=new yn);const l=yn.fromProto(s.baseStats),r=yn.fromProto(s.gearStats),h=yn.fromProto(s.talentsStats),m=yn.fromProto(s.buffsStats),u=yn.fromProto(s.consumesStats),p=this.getDebuffStats(),f=t.getBonusStats(),I=l,w=r.subtract(l).subtract(f),b=h.subtract(r).add(o.talents),S=m.subtract(h).add(o.buffs),x=u.subtract(m),v=yn.fromProto(s.finalStats).add(o.talents).add(o.buffs).add(p);let y=0;this.stats.forEach((s=>{const a=f.getUnitStat(s);let o;o=0===a?"text-white":a>0?"text-success":"text-danger";const E=g(),k=e("div",{className:"stat-value-link-container"},e("a",{href:"javascript:void(0)",className:`stat-value-link ${o}`,attributes:{role:"button"},ref:E},`${this.statDisplayString(t,v,v,s)} `)),P=E.value;this.valueElems[y].querySelector(".stat-value-link-container")?.remove(),this.valueElems[y].prepend(k);const C=e("div",{className:"d-flex"},e("div",null,e("div",{className:"character-stats-tooltip-row"},e("span",null,"Base:"),e("span",null,this.statDisplayString(t,l,I,s))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Gear:"),e("span",null,this.statDisplayString(t,r,w,s))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Talents:"),e("span",null,this.statDisplayString(t,h,b,s))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Buffs:"),e("span",null,this.statDisplayString(t,m,S,s))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Consumes:"),e("span",null,this.statDisplayString(t,u,x,s))),s.isStat()&&0!=p.getStat(s.getStat())&&e("div",{className:"character-stats-tooltip-row"},e("span",null,"Debuffs:"),e("span",null,this.statDisplayString(t,p,p,s))),0!=a&&e("div",{className:"character-stats-tooltip-row"},e("span",null,"Bonus:"),e("span",null,this.statDisplayString(t,f,f,s))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Total:"),e("span",null,this.statDisplayString(t,v,v,s)))));if(s.isStat()&&s.getStat()===c.StatMeleeHit)C.appendChild(e("div",{className:"ps-2"},e("div",{className:"character-stats-tooltip-row"},e("span",null,"Axes"),e("span",null,this.weaponSkillDisplayString(h,d.PseudoStatAxesSkill))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Daggers"),e("span",null,this.weaponSkillDisplayString(h,d.PseudoStatDaggersSkill))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Maces"),e("span",null,this.weaponSkillDisplayString(h,d.PseudoStatMacesSkill))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Polearms"),e("span",null,this.weaponSkillDisplayString(h,d.PseudoStatPolearmsSkill))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Staves"),e("span",null,this.weaponSkillDisplayString(h,d.PseudoStatStavesSkill))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Swords"),e("span",null,this.weaponSkillDisplayString(h,d.PseudoStatSwordsSkill))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Unarmed"),e("span",null,this.weaponSkillDisplayString(h,d.PseudoStatUnarmedSkill))))),C.appendChild(e("div",{className:"ps-2"},e("div",{className:"character-stats-tooltip-row"},e("span",null,"2H Axes"),e("span",null,this.weaponSkillDisplayString(h,d.PseudoStatTwoHandedAxesSkill))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"2H Maces"),e("span",null,this.weaponSkillDisplayString(h,d.PseudoStatTwoHandedMacesSkill))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"2H Swords"),e("span",null,this.weaponSkillDisplayString(h,d.PseudoStatTwoHandedSwordsSkill)))));else if(s.isStat()&&s.getStat()===c.StatSpellHit)C.appendChild(e("div",{className:"ps-2"},e("div",{className:"character-stats-tooltip-row"},e("span",null,"Arcane"),e("span",null,this.spellSchoolHitDisplayString(v,d.PseudoStatSchoolHitArcane))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Fire"),e("span",null,this.spellSchoolHitDisplayString(v,d.PseudoStatSchoolHitFire))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Frost"),e("span",null,this.spellSchoolHitDisplayString(v,d.PseudoStatSchoolHitFrost))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Holy"),e("span",null,this.spellSchoolHitDisplayString(v,d.PseudoStatSchoolHitHoly))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Nature"),e("span",null,this.spellSchoolHitDisplayString(v,d.PseudoStatSchoolHitNature))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Shadow"),e("span",null,this.spellSchoolHitDisplayString(v,d.PseudoStatSchoolHitShadow)))));else if(s.isPseudoStat()&&s.getPseudoStat()===d.PseudoStatMeleeSpeedMultiplier&&(i||n)){const t=v.getPseudoStat(d.PseudoStatMeleeSpeedMultiplier),s=n&&n.item.weaponType!==z.WeaponTypeShield&&n.item.weaponType!==z.WeaponTypeOffHand&&n.item.weaponType!==z.WeaponTypeUnknown,a=s?"Main-hand":"Weapon";C.appendChild(e("div",{className:"ps-2"},i&&e("div",{className:"character-stats-tooltip-row"},e("span",null,a," Speed"),e("span",null,(i.item.weaponSpeed/t).toFixed(2),"s")),s&&e("div",{className:"character-stats-tooltip-row"},e("span",null,"Off-hand Speed"),e("span",null,(n.item.weaponSpeed/t).toFixed(2),"s"))))}else if(s.isStat()&&s.getStat()===c.StatMeleeCrit&&this.shouldShowMeleeCritCap(t)){y++;const s=t.getGear(),a=s.getEquippedItem(A.ItemSlotMainHand)?.item?.weaponType,i=s.getEquippedItem(A.ItemSlotOffHand)?.item?.weaponType,n=t.getMeleeCritCapInfo(a),o=t.getMeleeCritCapInfo(i),l=t.getGear().isDualWielding()&&t.spec===j.SpecWarrior,r=n.playerCritCapDelta,c=e("a",{href:"javascript:void(0)",className:"stat-value-link",attributes:{role:"button"},ref:E},`${0===r?"Exact ":r>0?"Over by ":"Under by "} ${Math.abs(r).toFixed(2)}%`),d=n.playerCritCapDelta;if(0===d?c.classList.add("text-white"):d>0?c.classList.add("text-danger"):d<0&&c.classList.add("text-success"),this.valueElems[y].querySelector(".stat-value-link-container")?.remove(),this.valueElems[y].prepend(e("div",{className:"stat-value-link-container"},c)),mn(c,{content:e("div",{className:"d-grid gap-1"},this.critCapTooltip(n,o),l&&e("div",{className:"form-text"},e("i",{className:"fas fa-circle-exclamation fa-xl me-2"}),"Crit cap assuming perfect queued ability uptime.")),maxWidth:"90vw"}),l){const s=t.getMeleeCritCapInfo(a,!0),n=t.getMeleeCritCapInfo(i,!0),o=s.playerCritCapDelta,l=e("a",{href:"javascript:void(0)",className:"stat-value-link",attributes:{role:"button"},ref:E},`${0===o?"Exact ":o>0?"Over by ":"Under by "} ${Math.abs(o).toFixed(2)}%`);c.insertAdjacentElement("afterend",l);const r=s.playerCritCapDelta;0===r?l.classList.add("text-white"):r>0?l.classList.add("text-danger"):r<0&&l.classList.add("text-success"),mn(l,{content:e("div",{className:"d-grid gap-1"},this.critCapTooltip(s,n),e("div",{className:"form-text"},e("i",{className:"fas fa-circle-exclamation fa-xl me-2"}),"Crit cap with dual-wield penalty.")),maxWidth:"90vw"})}}mn(P,{content:C,maxWidth:"90vw"}),y++}))}statDisplayString(e,t,s,a){const i=s.getUnitStat(a);let n;if(a.isStat()){const e=a.getStat();if(e===c.StatBlockValue){const e=t.getPseudoStat(d.PseudoStatBlockValueMultiplier)||1,a=Math.max(0,t.getPseudoStat(d.PseudoStatBlockValuePerStrength)*s.getStat(c.StatStrength)-1);n=String(Math.round(i*e+a))}else if(e===c.StatMeleeHit)n=`${(i/H).toFixed(2)}%`;else if(e===c.StatSpellHit)n=`${(i/kt).toFixed(2)}%`;else if(e===c.StatSpellDamage){const e=Math.round(i);n=Math.round(s.getStat(c.StatSpellPower))+e+` (+${e})`}else if(e===c.StatArcanePower||e===c.StatFirePower||e===c.StatFrostPower||e===c.StatHolyPower||e===c.StatNaturePower||e===c.StatShadowPower){const e=Math.round(i);n=Math.round(s.getStat(c.StatSpellPower)+s.getStat(c.StatSpellDamage))+e+` (+${e})`}else e===c.StatMeleeCrit||e===c.StatSpellCrit?n=`${(i/Pt).toFixed(2)}%`:e===c.StatMeleeHaste?n=`${(100*s.getPseudoStat(d.PseudoStatMeleeSpeedMultiplier)).toFixed(2)}%`:e===c.StatSpellHaste?n=`${(i/Ct).toFixed(2)}%`:e===c.StatArmorPenetration?n=`${i} (${(i/Tt).toFixed(2)}%)`:e===c.StatExpertise?n=`${i}%`:e===c.StatDefense?n=`${(5*de+Math.floor(i/Nt)).toFixed(0)}`:e===c.StatBlock?n=`${(i/_t).toFixed(2)}%`:e===c.StatDodge?n=`${(i/Rt).toFixed(2)}%`:e===c.StatParry?n=`${(i/Dt).toFixed(2)}%`:e===c.StatResilience&&(n=`${i} (${(i/At).toFixed(2)}%)`)}else{switch(a.getPseudoStat()){case d.PseudoStatMeleeSpeedMultiplier:n=`${(100*s.getPseudoStat(d.PseudoStatMeleeSpeedMultiplier)).toFixed(2)}%`;break;case d.PseudoStatRangedSpeedMultiplier:n=`${(100*s.getPseudoStat(d.PseudoStatRangedSpeedMultiplier)).toFixed(2)}%`;break;case d.PseudoStatCastSpeedMultiplier:n=`${(100*s.getPseudoStat(d.PseudoStatCastSpeedMultiplier)).toFixed(2)}%`}}return n||(n=String(Math.round(i))),n}weaponSkillDisplayString(e,t){return`${300+e.getPseudoStat(t)}`}spellSchoolHitDisplayString(e,t){return`${(e.getPseudoStat(t)+e.getStat(c.StatSpellHit)).toFixed(2)}%`}critCapTooltip(t,s){return e("div",{className:"d-flex"},e("div",null,e("div",{className:"character-stats-tooltip-row"},e("h6",null,Lt.get(A.ItemSlotMainHand))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Glancing:"),e("span",null,`${t.glancing.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Suppression:"),e("span",null,`${t.suppression.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"White Miss:"),e("span",null,`${t.remainingMeleeHitCap.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Dodge:"),e("span",null,`${t.dodgeCap.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Parry:"),e("span",null,`${t.parryCap.toFixed(2)}%`)),0!=t.specSpecificOffset&&e("div",{className:"character-stats-tooltip-row"},e("span",null,"Spec Offsets:"),e("span",null,`${t.specSpecificOffset.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Final Crit Cap:"),e("span",null,`${t.baseCritCap.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Can Raise By:"),e("span",null,`${t.remainingMeleeHitCap.toFixed(2)}%`))),this.player.getGear().hasOffHandWeapon()&&e("div",{className:"ps-2"},e("div",{className:"character-stats-tooltip-row"},e("h6",null,Lt.get(A.ItemSlotOffHand))),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Glancing:"),e("span",null,`${s.glancing.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Suppression:"),e("span",null,`${s.suppression.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"White Miss:"),e("span",null,`${s.remainingMeleeHitCap.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Dodge:"),e("span",null,`${s.dodgeCap.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Parry:"),e("span",null,`${s.parryCap.toFixed(2)}%`)),0!=s.specSpecificOffset&&e("div",{className:"character-stats-tooltip-row"},e("span",null,"Spec Offsets:"),e("span",null,`${s.specSpecificOffset.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Final Crit Cap:"),e("span",null,`${s.baseCritCap.toFixed(2)}%`)),e("div",{className:"character-stats-tooltip-row"},e("span",null,"Can Raise By:"),e("span",null,`${s.remainingMeleeHitCap.toFixed(2)}%`))))}getDebuffStats(){return new yn}bonusStatsLink(t){const s=t.getName(this.player.getClass()),a=g(),i=g(),n=e("a",{ref:a,href:"javascript:void(0)",className:"add-bonus-stats text-white ms-2",dataset:{bsToggle:"popover"},attributes:{role:"button"}},e("i",{ref:i,className:"fas fa-plus-minus"}));return mn(i.value,{content:`Bonus ${s}`}),mn(a.value,{interactive:!0,trigger:"click",theme:"bonus-stats-popover",placement:"right",onShow:e=>{const a=new sh(null,this.player,{id:"character-bonus-"+(t.isStat()?"stat-"+t.getStat():"pseudostat-"+t.getPseudoStat()),label:`Bonus ${s}`,extraCssClasses:["mb-0"],changedEvent:e=>e.bonusStatsChangeEmitter,getValue:e=>e.getBonusStats().getUnitStat(t),setValue:(s,a,i)=>{const n=a.getBonusStats().withUnitStat(t,i);a.setBonusStats(s,n),e?.hide()}});e.setContent(a.rootElem)}}),n}shouldShowMeleeCritCap(e){return[j.SpecEnhancementShaman,j.SpecRetributionPaladin,j.SpecRogue,j.SpecWarrior,j.SpecHunter].includes(e.spec)}}const nh={[Vt.ItemQualityJunk]:"item-quality-junk",[Vt.ItemQualityCommon]:"item-quality-common",[Vt.ItemQualityUncommon]:"item-quality-uncommon",[Vt.ItemQualityRare]:"item-quality-rare",[Vt.ItemQualityEpic]:"item-quality-epic",[Vt.ItemQualityLegendary]:"item-quality-legendary",[Vt.ItemQualityArtifact]:"item-quality-artifact",[Vt.ItemQualityHeirloom]:"item-quality-heirloom"};function oh(e,t){Object.values(nh).forEach((t=>e.classList.remove(t))),t&&e.classList.add(nh[t])}class lh extends p{constructor(e,t,s){super(e,"content-block",s.rootElem),this.config=s,this.rootElem.classList.add(t),s.extraCssClasses&&this.rootElem.classList.add(...s.extraCssClasses),this.headerElement=this.buildHeader(),this.bodyElement=this.buildBody(),s.bodyClasses?.forEach((e=>{this.bodyElement.classList.add(e)}))}buildHeader(){if(this.config.header&&Object.keys(this.config.header).length){const t=this.config.header.titleTag||"h6",s=g(),a=e("div",{className:"content-block-header"},e(t,{ref:s,className:"content-block-title"},this.config.header.title));return this.config.header.extraCssClasses&&a.classList.add(...this.config.header.extraCssClasses),this.config.header.tooltip&&mn(s.value,{content:this.config.header.tooltip}),this.rootElem.appendChild(a),a}return null}buildBody(){const t=e("div",{className:"content-block-body"});return this.rootElem.appendChild(t),t}}const rh={footer:!1,header:!0,scrollContents:!1,size:"lg",title:null};class ch extends p{constructor(t,s,a={disposeOnClose:!0}){super(t,"modal"),this.isOpen=!1,this.onHideCallbacks=[],this.modalConfig={...rh,...a};const i=g(),n=g(),o=g(),l=g(),r=this.modalConfig.size&&"md"!=this.modalConfig.size?`modal-${this.modalConfig.size}`:"";this.rootElem.classList.add("fade"),this.rootElem.appendChild(e("div",{className:`modal-dialog ${s} ${r} ${this.modalConfig.scrollContents?"modal-overflow-scroll":""}`,ref:i},e("div",{className:"modal-content"},e("div",{className:"modal-header "+(this.modalConfig.header||this.modalConfig.title?"":"p-0 border-0"),ref:n},this.modalConfig.title&&e("h5",{className:"modal-title"},this.modalConfig.title),e("button",{type:"button",className:"btn-close "+(this.modalConfig.closeButton?.fixed?"position-fixed":""),onclick:()=>this.close(),attributes:{"aria-label":"Close"}},e("i",{className:"fas fa-times fa-2xl"}))),e("div",{className:"modal-body",ref:o}),this.modalConfig.footer&&e("div",{className:"modal-footer",ref:l})))),this.dialog=i.value,this.header=n.value,this.body=o.value,this.footer=l.value,this.modal=new un(this.rootElem),this.modalConfig.disposeOnClose&&this.rootElem.addEventListener("hidden.bs.modal",(()=>{this.rootElem.remove(),this.dispose()}),{once:!0})}open(){const e=this.closeModalOnEscKey.bind(this),t=this.showBSFn.bind(this),s=this.hideBSFn.bind(this),a=this.hiddenBSFn.bind(this);document.addEventListener("keydown",e),this.rootElem.addEventListener("show.bs.modal",t),this.rootElem.addEventListener("hide.bs.modal",s),this.rootElem.addEventListener("hidden.bs.modal",a),this.addOnHideCallback((()=>document.removeEventListener("keydown",e))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("show.bs.modal",t))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("hide.bs.modal",s))),this.addOnHideCallback((()=>this.rootElem.removeEventListener("hidden.bs.modal",a))),this.modal.show(),this.isOpen=!0}close(){this.modal.hide(),this.isOpen=!1}addOnHideCallback(e){this.onHideCallbacks.push(e)}onShow(e){}onHide(e){this.onHideCallbacks.forEach((e=>e()))}async showBSFn(e){e.stopImmediatePropagation();const t=await new Promise((e=>{setTimeout((()=>{this.modal._backdrop._element&&e(this.modal._backdrop._element)}),100)}));this.rootElem.insertAdjacentElement("afterend",t),this.onShow(e)}hideBSFn(e){e.stopImmediatePropagation(),this.onHide(e)}hiddenBSFn(e){e.stopPropagation()}closeModalOnEscKey(e){"Escape"==e.key&&this.close()}}let dh=null;async function hh(e){return(await(null==dh&&(dh=fetch("/classic/assets/enchants/descriptions.json").then((e=>e.json())).then((e=>{const t={};for(const s in e)t[parseInt(s)]=e[s];return t}))),dh))[e.effectId]||e.name}function mh(e){return e.effectId+"-"+e.type}let uh={rows_in_block:50,blocks_in_cluster:4,tag:null,show_no_data_row:!0,no_data_class:"clusterize-no-data",no_data_text:"No data",keep_parity:!0,callbacks:{}};function ph(e,t){return window.getComputedStyle(t)[e]}class gh{constructor(e,t){this.last_cluster=0,this.scroll_debounce=0,this.pointer_events_set=!1,this.resize_debounce=0,this.cache={},this.options={rows_in_block:void 0!==t.rows_in_block?t.rows_in_block:uh.rows_in_block,blocks_in_cluster:void 0!==t.blocks_in_cluster?t.blocks_in_cluster:uh.blocks_in_cluster,show_no_data_row:void 0!==t.show_no_data_row?t.show_no_data_row:uh.show_no_data_row,no_data_class:void 0!==t.no_data_class?t.no_data_class:uh.no_data_class,no_data_text:void 0!==t.no_data_text?t.no_data_text:uh.no_data_text,keep_parity:void 0!==t.keep_parity?t.keep_parity:uh.keep_parity,tag:void 0!==t.tag?t.tag:uh.tag,callbacks:void 0!==t.callbacks?t.callbacks:uh.callbacks,cluster_height:0,item_height:void 0!==t.item_height?t.item_height:0,content_tag:"",block_height:0,scroll_top:0,rows_in_cluster:0},this.ds=e,this.displayedRows=t.rows,this.scroll_elem=t.scroll_elem,this.content_elem=t.content_elem,this.content_elem.hasAttribute("tabindex")||this.content_elem.setAttribute("tabindex","0");let s=this.scroll_elem.scrollTop;this.getRowsHeight(t.rows),this.insertToDom(t.rows,this.cache),this.scroll_elem.scrollTop=s,this.scroll_elem.addEventListener("scroll",this.scrollEv.bind(this)),window.addEventListener("resize",this.resizeEv.bind(this))}destroy(e){this.scroll_elem.removeEventListener("scroll",this.scrollEv.bind(this)),window.removeEventListener("resize",this.resizeEv.bind(this)),e&&this.setContentElemRows(this.generateEmptyRow())}dispose(){this.destroy()}refresh(e){(this.getRowsHeight(this.displayedRows)||e)&&this.update()}update(){let e=this.scroll_elem.scrollTop;this.ds.getNumberOfRows()*this.options.item_height<e&&(this.scroll_elem.scrollTop=0,this.last_cluster=0),this.insertToDom(this.displayedRows,this.cache),this.scroll_elem.scrollTop=e}elementUpdate(e){for(let t of this.displayedRows)e(t)}getScrollProgress(){return this.options.scroll_top/(this.ds.getNumberOfRows()*this.options.item_height)*100||0}scrollEv(){navigator.platform.toLowerCase().indexOf("mac")+1&&(this.pointer_events_set||(this.content_elem.style.pointerEvents="none"),this.pointer_events_set=!0,clearTimeout(this.scroll_debounce),this.scroll_debounce=window.setTimeout((()=>{this.content_elem.style.pointerEvents="auto",this.pointer_events_set=!1}),50)),this.last_cluster!=(this.last_cluster=this.getClusterNum(this.ds.getNumberOfRows()))&&this.insertToDom(this.displayedRows,this.cache),this.options.callbacks.scrollingProgress&&this.options.callbacks.scrollingProgress(this.getScrollProgress())}resizeEv(){clearTimeout(this.resize_debounce),this.resize_debounce=window.setTimeout(this.refresh.bind(this),100)}insertToDom(e,t){this.options.cluster_height||this.exploreEnvironment(e,t);let s=this.generate(),a=s.rows;this.displayedRows=s.rows;let i=this.checkChanges("data",a,t),n=this.checkChanges("top",s.top_offset,t),o=this.checkChanges("bottom",s.bottom_offset,t),l=this.options.callbacks,r=[];if(i||n){if(s.top_offset){if(this.options.keep_parity){let e=this.renderExtraTag("keep-parity");e.hidden=!0,r.push(e)}r.push(this.renderExtraTag("top-space",s.top_offset))}r.push(...a),s.bottom_offset&&r.push(this.renderExtraTag("bottom-space",s.bottom_offset)),l.clusterWillChange&&l.clusterWillChange(),this.setContentElemRows(r),"ol"==this.options.content_tag&&this.content_elem.setAttribute("start",s.rows_above.toString()),this.content_elem.style.counterIncrement="clusterize-counter "+(s.rows_above-1),l.clusterChanged&&l.clusterChanged()}else o&&(this.content_elem.lastChild.style.height=s.bottom_offset+"px")}exploreEnvironment(e,t){let s=this.options;s.content_tag=this.content_elem.tagName.toLowerCase(),e.length&&(this.content_elem.children.length<=1&&this.setContentElemRows([e[0],e[0],e[0]]),s.tag||(s.tag=this.content_elem.children[0].tagName.toLowerCase()),this.getRowsHeight(e))}setContentElemRows(e){this.content_elem.innerHTML="",this.content_elem.append(...e)}getRowsHeight(e){let t=this.options,s=t.item_height;t.cluster_height=0;let a=this.content_elem.children;if(e.length&&a.length){let e=a[Math.floor(a.length/2)];if(t.item_height=e.offsetHeight,"tr"==t.tag&&"collapse"!=ph("borderCollapse",this.content_elem)&&(t.item_height+=parseInt(ph("borderSpacing",this.content_elem),10)||0),"tr"!=t.tag){let s=parseInt(ph("marginTop",e),10)||0,a=parseInt(ph("marginBottom",e),10)||0;t.item_height+=Math.max(s,a)}}return t.block_height=t.item_height*t.rows_in_block,t.rows_in_cluster=t.blocks_in_cluster*t.rows_in_block,t.cluster_height=t.blocks_in_cluster*t.block_height,s!=t.item_height}generate(){let e=this.options,t=this.ds.getNumberOfRows();if(t<e.rows_in_block){let e=this.ds.generateRows(0,t);return{top_offset:0,bottom_offset:0,rows_above:0,rows:t?e:this.generateEmptyRow()}}let s=Math.max((e.rows_in_cluster-e.rows_in_block)*this.getClusterNum(t),0),a=s+e.rows_in_cluster,i=Math.max(s*e.item_height,0),n=Math.max((t-a)*e.item_height,0),o=[],l=s;return i<1&&l++,o=this.ds.generateRows(s,a),{top_offset:i,bottom_offset:n,rows_above:l,rows:o}}generateEmptyRow(){let e=this.options;if(!e.tag||!e.show_no_data_row)return[];let t,s=document.createElement(e.tag),a=document.createTextNode(e.no_data_text);return s.className=e.no_data_class,"tr"==e.tag&&(t=document.createElement("td"),t.colSpan=100,t.appendChild(a)),s.appendChild(t||a),[s]}getClusterNum(e){let t=this.options;t.scroll_top=this.scroll_elem.scrollTop;let s=Math.max(t.cluster_height-t.block_height,1),a=Math.floor(t.scroll_top/s),i=Math.floor(e*t.item_height/s);return Math.min(a,i)}renderExtraTag(e,t){let s=document.createElement(this.options.tag),a="clusterize-";return s.className=[a+"extra-row",a+e].join(" "),s.style.marginTop="0",s.style.marginBottom="0",t&&(s.style.height=t+"px"),s}checkChanges(e,t,s){var a=t!=s[e];return s[e]=t,a}}const fh={[Q.UNSPECIFIED]:"None",[Q.ALLIANCE_ONLY]:"Alliance only",[Q.HORDE_ONLY]:"Horde only"};class Ih extends ch{constructor(t,s,a){super(t,"filters-menu",{size:"md",title:"Filters"});const i=this.newSection("General"),n=e("div",{className:"ilvl-filters"});i.appendChild(n),new sh(n,s.sim,{id:"filters-min-ilvl",label:"Min ILvl",showZeroes:!1,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minIlvl,setValue:(e,t,s)=>{const a=t.getFilters();a.minIlvl=s,t.setFilters(e,a)}}),n.appendChild(e("span",{className:"ilvl-filters-separator"},"-")),new sh(n,s.sim,{id:"filters-max-ilvl",label:"Max ILvl",showZeroes:!1,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxIlvl,setValue:(e,t,s)=>{const a=t.getFilters();a.maxIlvl=s,t.setFilters(e,a)}}),new Hd(i,s.sim,{id:"filters-faction-restriction",label:"Faction Restrictions",values:[Q.UNSPECIFIED,Q.ALLIANCE_ONLY,Q.HORDE_ONLY].map((e=>({name:fh[e],value:e}))),changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().factionRestriction,setValue:(e,t,s)=>{const a=t.getFilters();a.factionRestriction=s,t.setFilters(e,a)}});const o=this.newSection("Source");o.classList.add("filters-menu-section-bool-list");lo.ALL_SOURCES.filter((e=>e!=X.SourceUnknown)).forEach((e=>{new Et(o,s.sim,{id:`filters-source-${e}`,label:Mt.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().sources.includes(e),setValue:(t,s,a)=>{const i=s.getFilters();a?i.sources.push(e):i.sources=i.sources.filter((t=>t!=e)),s.setFilters(t,i)}})}));const l=this.newSection("Raids");l.classList.add("filters-menu-section-bool-list");if(lo.ALL_RAIDS.filter((e=>e!=te.RaidUnknown)).forEach((e=>{new Et(l,s.sim,{id:`filters-raid-${e}`,label:Ut.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().raids.includes(e),setValue:(t,s,a)=>{const i=s.getFilters();a?i.raids.push(e):i.raids=i.raids.filter((t=>t!=e)),s.setFilters(t,i)}})})),$n.ARMOR_SLOTS.includes(a)){const e=Wt[s.getClass()];if(e>=Ze.ArmorTypeLeather){const t=this.newSection("Armor Type");t.classList.add("filters-menu-section-bool-list");r(Ze).filter((e=>e!=Ze.ArmorTypeUnknown)).filter((t=>t<=e)).forEach((e=>{new Et(t,s.sim,{id:`filters-armor-type-${e}`,label:Ft.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().armorTypes.includes(e),setValue:(t,s,a)=>{const i=s.getFilters();a?i.armorTypes.push(e):i.armorTypes=i.armorTypes.filter((t=>t!=e)),s.setFilters(t,i)}})}))}}else if($n.WEAPON_SLOTS.includes(a)){const e=this.newSection("Weapon Type");e.classList.add("filters-menu-section-bool-list");Ot[s.getClass()].map((e=>e.weaponType)).forEach((t=>{new Et(e,s.sim,{id:`filters-weapon-type-${t}`,label:qt.get(t),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().weaponTypes.includes(t),setValue:(e,s,a)=>{const i=s.getFilters();a?i.weaponTypes.push(t):i.weaponTypes=i.weaponTypes.filter((e=>e!=t)),s.setFilters(e,i)}})}));const t=this.newSection("Weapon Speed");t.classList.add("filters-menu-section-number-list"),new sh(t,s.sim,{id:"filters-min-weapon-speed",label:"Min MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minMhWeaponSpeed,setValue:(e,t,s)=>{const a=t.getFilters();a.minMhWeaponSpeed=s,t.setFilters(e,a)}}),new sh(t,s.sim,{id:"filters-max-weapon-speed",label:"Max MH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxMhWeaponSpeed,setValue:(e,t,s)=>{const a=t.getFilters();a.maxMhWeaponSpeed=s,t.setFilters(e,a)}}),Ht(s)&&(new sh(t,s.sim,{id:"filters-min-oh-weapon-speed",label:"Min OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minOhWeaponSpeed,setValue:(e,t,s)=>{const a=t.getFilters();a.minOhWeaponSpeed=s,t.setFilters(e,a)}}),new sh(t,s.sim,{id:"filters-max-oh-weapon-speed",label:"Max OH Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxOhWeaponSpeed,setValue:(e,t,s)=>{const a=t.getFilters();a.maxOhWeaponSpeed=s,t.setFilters(e,a)}}))}else if(a==A.ItemSlotRanged){const e=Bt[s.getClass()];if(e.length<=1)return;const t=this.newSection("Ranged Weapon Type");t.classList.add("filters-menu-section-bool-list"),e.forEach((e=>{new Et(t,s.sim,{id:`filter-ranged-weapon-type-${e}`,label:zt.get(e),inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:t=>t.getFilters().rangedWeaponTypes.includes(e),setValue:(t,s,a)=>{const i=s.getFilters();a?i.rangedWeaponTypes.push(e):i.rangedWeaponTypes=i.rangedWeaponTypes.filter((t=>t!=e)),s.setFilters(t,i)}})}));const a=this.newSection("Ranged Weapon Speed");a.classList.add("filters-menu-section-number-list"),new sh(a,s.sim,{id:"filters-min-ranged-weapon-speed",label:"Min Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().minRangedWeaponSpeed,setValue:(e,t,s)=>{const a=t.getFilters();a.minRangedWeaponSpeed=s,t.setFilters(e,a)}}),new sh(a,s.sim,{id:"filters-max-ranged-weapon-speed",label:"Max Ranged Speed",float:!0,positive:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().maxRangedWeaponSpeed,setValue:(e,t,s)=>{const a=t.getFilters();a.maxRangedWeaponSpeed=s,t.setFilters(e,a)}})}}newSection(e){const t=document.createElement("div");return t.classList.add("menu-section",`${e.toLowerCase().replaceAll(" ","-")}-section`),this.body.appendChild(t),t.innerHTML=`\n\t\t\t<div class="menu-section-header">\n\t\t\t\t<h6 class="menu-section-title">${e}</h6>\n\t\t\t</div>\n\t\t\t<div class="menu-section-content"></div>\n\t\t`,t.getElementsByClassName("menu-section-content")[0]}}class wh{constructor(s,i,n,l,r,c,d,h,m,u,p,f,I){this.sortBy=1,this.sortDirection=jt.DESC,this.id=s,this.label=d,this.simUI=n,this.player=c,this.itemData=m,this.computeEP=u,this.equippedToItemFn=p,this.onItemClick=I,this.slot=l,this.gearData=h,this.currentFilters=this.player.sim.getFilters();const w=d===r,b=g(),S=g(),x=g(),v=g(),y=g(),E=g(),k=g(),P=g(),C=g(),T=g();if(this.tabContent=e("div",{id:this.id,className:t("selector-modal-tab-pane tab-pane fade",w&&"active show")},e("div",{className:"selector-modal-filters"},e("input",{ref:b,className:"selector-modal-search form-control",type:"text",placeholder:"Search..."}),d===xh.Items&&e("button",{ref:x,className:"selector-modal-filters-button btn btn-primary"},"Filters"),e("div",{ref:y,className:"selector-modal-phase-selector"}),e("div",{ref:E,className:"sim-input selector-modal-boolean-option selector-modal-show-1h-weapons hide"}),e("div",{ref:k,className:"sim-input selector-modal-boolean-option selector-modal-show-2h-weapons hide"}),e("div",{ref:v,className:"sim-input selector-modal-boolean-option selector-modal-show-ep-values"}),e("button",{ref:C,className:"selector-modal-remove-button btn btn-danger"},"Unequip Item")),e("div",{className:"selector-modal-list-labels"},d===xh.Items&&e("h6",{className:"ilvl-label interactive",onclick:e=>{e.preventDefault(),this.sort(1)}},"ILvl"),e("h6",{className:"item-label"},d===xh.Items?"Item":d===xh.Enchants?"Enchant":""),d===xh.Items&&e("h6",{className:"source-label"},"Source"),e("h6",{className:"ep-label interactive",onclick:e=>{e.preventDefault(),this.sort(0)}},e("span",null,"EP"),e("i",{className:"fa-solid fa-plus-minus fa-2xs"}),e("button",{ref:S,className:"btn btn-link p-0 ms-1"},e("i",{className:"far fa-question-circle fa-lg"}))),e("h6",{className:"favorite-label"}),e("h6",{ref:T,className:"compare-label hide"})),e("ul",{ref:P,className:"selector-modal-list"})),i.appendChild(this.tabContent),this.label===xh.Items&&this.bindToggleCompare(T.value),mn(S.value,{content:$t}),d===xh.Items&&(l===A.ItemSlotMainHand||l===A.ItemSlotOffHand&&c.getClass()===o.ClassWarrior)&&(function(e,t){e.classList.remove("hide"),new Et(e,t,{id:"show-1h-weapons-selector",extraCssClasses:["show-1h-weapons-selector","mb-0"],label:"1H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().oneHandedWeapons,setValue:(e,t,s)=>{const a=t.getFilters();a.oneHandedWeapons=s,t.setFilters(e,a)}})}(E.value,c.sim),function(e,t){e.classList.remove("hide"),new Et(e,t,{id:"show-2h-weapons-selector",extraCssClasses:["show-2h-weapons-selector","mb-0"],label:"2H",inline:!0,changedEvent:e=>e.filtersChangeEmitter,getValue:e=>e.getFilters().twoHandedWeapons,setValue:(e,t,s)=>{const a=t.getFilters();a.twoHandedWeapons=s,t.setFilters(e,a)}})}(k.value,c.sim)),y.value&&function(e,t){new Hd(e,t,{id:"phase-selector",extraCssClasses:["phase-selector"],values:[{name:"Phase 6 - Naxx",value:6},{name:"Phase 5 - AQ",value:5},{name:"Phase 4 - ZG/AB",value:4},{name:"Phase 3 - BWL/R14",value:3},{name:"Phase 2 - DM/WSG/AV",value:2},{name:"Phase 1 - MC/Ony",value:1}],changedEvent:e=>e.phaseChangeEmitter,getValue:e=>e.getPhase(),setValue:(e,t,s)=>{t.setPhase(e,s)}})}(y.value,c.sim),function(e,t){new Et(e,t,{id:"show-ep-values-selector",extraCssClasses:["show-ep-values-selector","input-inline","mb-0"],label:"Show EP",inline:!0,changedEvent:e=>e.showEPValuesChangeEmitter,getValue:e=>e.getShowEPValues(),setValue:(e,t,s)=>{t.setShowEPValues(e,s)}})}(v.value,c.sim),d===xh.Items){const e=new Ih(i,c,l);x.value?.addEventListener("click",(()=>e.open()))}this.listElem=this.tabContent.getElementsByClassName("selector-modal-list")[0],this.itemsToDisplay=[],this.scroller=new gh({getNumberOfRows:()=>this.itemsToDisplay.length,generateRows:(e,t)=>{const s=[];for(let a=e;a<t&&!(a>=this.itemsToDisplay.length);++a)s.push(this.createItemElem({idx:this.itemsToDisplay[a],data:this.itemData[this.itemsToDisplay[a]]}));return s}},{rows:[],scroll_elem:this.listElem,content_elem:this.listElem,item_height:56,show_no_data_row:!1,no_data_text:"",tag:"li",rows_in_block:16,blocks_in_cluster:2});const N=C.value;if(N&&(N.addEventListener("click",(e=>{f(a.nextEventID())})),d===xh.Enchants))N.textContent="Remove Enchant";this.updateSelected(),this.searchInput=this.tabContent.getElementsByClassName("selector-modal-search")[0],this.searchInput.addEventListener("input",(()=>this.applyFilters()))}sizeRefresh(){this.scroller.refresh(!0),this.applyFilters()}dispose(){this.scroller.dispose()}getItemIdByItemType(e){if(!e)return null;switch(this.label){case xh.Enchants:return e.effectId;case xh.Items:case xh.RandomSuffixes:return e.id;default:return null}}updateSelected(){const e=this.gearData.getEquippedItem(),t=this.equippedToItemFn(e),s=this.getItemIdByItemType(t),a=t?this.computeEP(t):0;this.scroller.elementUpdate((e=>{const t=e.dataset.idx,i=this.itemData[parseFloat(t)];i.id===s?e.classList.add("active"):e.classList.remove("active");const n=e.querySelector(".selector-modal-list-item-ep-delta");if(n&&(n.textContent="",i.item)){const e=this.computeEP(i.item);a!==e&&Gt(n,a,e,0)}}))}applyFilters(){this.currentFilters=this.player.sim.getFilters();let e=new Array(this.itemData.length);for(let s=0;s<this.itemData.length;++s)e[s]=s;const t=this.player.getEquippedItem(this.slot);this.label===xh.Items?e=this.player.filterItemData(e,(e=>this.itemData[e].item),this.slot):this.label===xh.Enchants&&(e=this.player.filterEnchantData(e,(e=>this.itemData[e].item),this.slot,t)),e=e.filter((e=>{const t=this.itemData[e];if(t.phase>this.player.sim.getPhase())return!1;if(this.searchInput.value.length){const e=e=>e.toLowerCase().replaceAll(/[^a-zA-Z0-9\s]/g,""),s=e(this.searchInput.value).split(" "),a=e(t.name.toString());let i=!0;if(s.some((e=>{a.includes(e)||(i=!1)})),!i)return!1}return!0})),[A.ItemSlotTrinket1,A.ItemSlotTrinket2].includes(this.slot)||this.slot===A.ItemSlotRanged&&[o.ClassShaman,o.ClassPaladin,o.ClassDruid].includes(this.player.getClass())?this.sortBy=1:this.sortBy=0,e=this.sortIdxs(e),this.itemsToDisplay=e,this.scroller.update(),this.hideOrShowEPValues()}sort(e){this.sortBy===e?this.sortDirection=1-this.sortDirection:this.sortDirection=jt.DESC,this.sortBy=e,this.itemsToDisplay=this.sortIdxs(this.itemsToDisplay),this.scroller.update()}sortIdxs(e){let t=(e,t)=>{const s=this.sortDirection===jt.DESC?t:e,a=this.sortDirection===jt.DESC?e:t,i=this.computeEP(s)-this.computeEP(a);return Math.abs(i)<.01?s.ilvl-a.ilvl:i};if(1===this.sortBy)t=(e,t)=>{const s=this.sortDirection===jt.DESC?t:e,a=this.sortDirection===jt.DESC?e:t;return s.ilvl-a.ilvl};return e.sort(((e,s)=>{const a=this.itemData[e],i=this.itemData[s];return this.isItemFavorited(a)&&!this.isItemFavorited(i)?-1:this.isItemFavorited(i)&&!this.isItemFavorited(a)?1:t(a.item,i.item)}))}hideOrShowEPValues(){const e=this.tabContent.getElementsByClassName("ep-label"),t=this.tabContent.getElementsByClassName("selector-modal-list"),s=this.player.sim.getShowEPValues(),a=s?"":"none";for(const i of e)i.style.display=a;for(const i of t)s?i.classList.remove("hide-ep"):i.classList.add("hide-ep")}createItemElem(s){const i=s.data,n=this.computeEP(i.item),o=this.equippedToItemFn(this.gearData.getEquippedItem()),l=this.getItemIdByItemType(o),r=o?this.computeEP(o):0,c=g(),d=g(),h=g(),m=g(),u=g(),p=g(),f=g(),I=e("li",{className:t("selector-modal-list-item",l===i.id&&"active"),dataset:{idx:s.idx.toString()}},this.label===xh.Items&&e("div",{className:"selector-modal-list-item-ilvl-container"},i.item.ilvl),e("div",{className:"selector-modal-list-label-cell"},e("a",{className:"selector-modal-list-item-link",ref:d,dataset:{whtticon:"false"}},e("img",{className:"selector-modal-list-item-icon",ref:h}),e("label",{className:"selector-modal-list-item-name",ref:c},i.name))),this.label===xh.Items&&e("div",{className:"selector-modal-list-item-source-container"},this.getSourceInfo(i.item,this.player.sim)),![A.ItemSlotTrinket1,A.ItemSlotTrinket2].includes(this.slot)&&e("div",{className:"selector-modal-list-item-ep"},e("span",{className:"selector-modal-list-item-ep-value"},n<9.95?n.toFixed(1).toString():Math.round(n).toString()),e("span",{className:"selector-modal-list-item-ep-delta",ref:e=>i.item&&r!==n&&Gt(e,r,n,0)})),e("div",{className:"selector-modal-list-item-favorite-container"},e("button",{className:"selector-modal-list-item-favorite btn btn-link p-0",ref:m},e("i",{ref:u,className:"far fa-star fa-xl"}))),e("div",{ref:p,className:"selector-modal-list-item-compare-container hide"},e("button",{className:"selector-modal-list-item-compare btn btn-link p-0",ref:f},e("i",{className:"fas fa-arrow-right-arrow-left fa-xl"})))),w=e=>{const t=this.player.sim.getFilters();let s,n;switch(this.label){case xh.Items:s="favoriteItems",n=i.id;break;case xh.Enchants:s="favoriteEnchants",n=mh(i.item);break;case xh.RandomSuffixes:s="favoriteRandomSuffixes",n=i.id;break;default:return}if(e)t[s].push(n);else{const e=t[s].indexOf(n);-1!==e&&t[s].splice(e,1)}m.value.classList.toggle("text-brand"),u.value.classList.toggle("fas"),u.value.classList.toggle("far"),I.dataset.fav=e.toString(),this.player.sim.setFilters(a.nextEventID(),t)};m.value.addEventListener("click",(()=>w("false"===I.dataset.fav)));this.isItemFavorited(i)?(m.value.classList.add("text-brand"),u.value?.classList.add("fas"),I.dataset.fav="true"):(u.value?.classList.add("far"),I.dataset.fav="false");const S=mn(m.value);var x;if(x="true"===I.dataset.fav,S.setContent(x?"Remove from favorites":"Add to favorites"),this.label===xh.Items){const t=mn(f.value);this.bindToggleCompare(p.value);const s=this.simUI instanceof yf?this.simUI:null;if(s){const a=()=>s.bt.hasItem(Kt.create({id:i.id})),n=()=>{const e=a();t.setContent(e?"Remove from Batch sim":"Add to Batch sim"),f.value.classList[e?"add":"remove"]("text-brand")};n(),s.bt.itemsChangedEmitter.on((()=>{n()})),f.value.addEventListener("click",(()=>{const t=a();s.bt[t?"removeItem":"addItem"](Kt.create({id:i.id})),new gn({delay:1e3,variant:"success",body:e(b,null,e("strong",null,i.name)," was ",e(b,null,t?"removed from the batch":"added to the batch"),".")})}))}}return d.value.addEventListener("click",(e=>{if(e.preventDefault(),e.target===m.value)return!1;this.onItemClick(i)})),i.actionId.fill().then((e=>{e.setWowheadHref(d.value),h.value.src=e.iconUrl})),oh(c.value,i.quality),I}isItemFavorited(e){return this.label===xh.Items?this.currentFilters.favoriteItems.includes(e.id):this.label===xh.Enchants?this.currentFilters.favoriteEnchants.includes(mh(e.item)):this.label===xh.RandomSuffixes&&this.currentFilters.favoriteRandomSuffixes.includes(e.id)}getSourceInfo(t,s){const a=(t,s)=>e("a",{href:t,target:"_blank",dataset:{whtticon:"false"}},e("small",null,s));if(!t.sources||0==t.sources.length)return t.randomSuffixOptions.length?a(`${x.makeItemUrl(t.id)}#dropped-by`,e("div",{className:"d-flex align-items-center"},this.getDropSourceIcon(),e("span",null,"World Drop"))):e(b,null);let i=t.sources[0];if("crafted"==i.source.oneofKind){const s=i.source.crafted;return a(s.spellId?x.makeSpellUrl(s.spellId):x.makeItemUrl(t.id),e("div",{className:"d-flex"},this.getProfessionSourceIcon(),Jt.get(s.profession)??"Unknown"))}if("drop"==i.source.oneofKind){const n=i.source.drop,o=s.db.getZone(n.zoneId),l=s.db.getNpc(n.npcId);return l?a(x.makeNpcUrl(l.id),e("div",{className:"d-flex"},this.getDropSourceIcon(),e("span",null,o&&o.name,o&&e("br",null),l.name,n.category&&` - ${n.category}`))):o?a(x.makeItemUrl(t.id),e("div",{className:"d-flex"},this.getDropSourceIcon(),e("span",null,o.name,e("br",null),n.otherName?n.otherName:"Multiple Sources"))):a(`${x.makeItemUrl(t.id)}#dropped-by`,e("div",{className:"d-flex"},this.getDropSourceIcon(),e("span",null,"Multiple Sources")))}if("quest"==i.source.oneofKind&&i.source.quest.name){const s=i.source.quest;return a(x.makeQuestUrl(s.id),e("div",{className:"d-flex"},e("span",{className:"d-flex me-1"},this.getQuestSourceIcon(),t.factionRestriction==Q.ALLIANCE_ONLY&&this.getAllianceSourceIcon(),t.factionRestriction==Q.HORDE_ONLY&&this.getHordeSourceIcon()),e("span",null,s.name)))}if("rep"==(i=t.sources.find((e=>"rep"==e.source.oneofKind))??i).source.oneofKind){const n=t.sources.filter((e=>"rep"==e.source.oneofKind)).map((e=>s.db.getFaction(e.source.rep.repFactionId))).filter((e=>!!e)),o=i.source.rep;return a(x.makeItemUrl(t.id),e("div",{className:"d-flex"},e("img",{src:"https://static.wikia.nocookie.net/wowpedia/images/1/1f/Pointer_buy_on_32x32.png",width:"16",height:"16"}),e("div",{className:"d-flex flex-column"},n.map((s=>e("div",{className:"d-flex"},(t.factionRestriction==Q.ALLIANCE_ONLY||Zt(s.id))&&e("span",{className:"d-flex me-1"},this.getAllianceSourceIcon()),(t.factionRestriction==Q.HORDE_ONLY||Yt(s.id))&&e("span",{className:"d-flex me-1"},this.getHordeSourceIcon()),s.name," - ",Qt[o.repLevel]))))))}if("soldBy"==i.source.oneofKind){const s=i.source.soldBy;return s.npcId?a(x.makeNpcUrl(s.npcId),e("div",{className:"d-flex"},this.getVendorSourceIcon(),e("span",null,s.npcName))):a(`${x.makeItemUrl(t.id)}#sold-by`,e("div",{className:"d-flex"},this.getVendorSourceIcon(),e("span",null,"Vendor")))}return e(b,null)}bindToggleCompare(e){const t=()=>e.classList[this.player.sim.getShowExperimental()?"remove":"add"]("hide");t(),this.player.sim.showExperimentalChangeEmitter.on((()=>{t()}))}getDropSourceIcon(){return e("img",{src:"https://wow.zamimg.com/images/icons/boss.gif",className:"item-source-icon-drop me-1"})}getVendorSourceIcon(){return e("img",{src:"https://static.wikia.nocookie.net/wowpedia/images/1/1f/Pointer_buy_on_32x32.png",className:"item-source-icon-vendor me-1"})}getProfessionSourceIcon(){return e("img",{src:"https://static.wikia.nocookie.net/wowpedia/images/6/63/Pointer_repair_off_32x32.png",className:"item-source-icon-profession me-1"})}getQuestSourceIcon(){return e("img",{src:"https://wow.zamimg.com/images/wow/icons/tiny/quest-start.gif",className:"item-source-icon-quest"})}getAllianceSourceIcon(){return e("img",{src:"https://wow.zamimg.com/images/icons/alliance.png",className:"item-source-icon-alliance"})}getHordeSourceIcon(){return e("img",{src:"https://wow.zamimg.com/images/icons/horde.png",className:"item-source-icon-horde"})}}const bh={[A.ItemSlotHead]:"/classic/assets/item_slots/head.jpg",[A.ItemSlotNeck]:"/classic/assets/item_slots/neck.jpg",[A.ItemSlotShoulder]:"/classic/assets/item_slots/shoulders.jpg",[A.ItemSlotBack]:"/classic/assets/item_slots/shirt.jpg",[A.ItemSlotChest]:"/classic/assets/item_slots/chest.jpg",[A.ItemSlotWrist]:"/classic/assets/item_slots/wrists.jpg",[A.ItemSlotHands]:"/classic/assets/item_slots/hands.jpg",[A.ItemSlotWaist]:"/classic/assets/item_slots/waist.jpg",[A.ItemSlotLegs]:"/classic/assets/item_slots/legs.jpg",[A.ItemSlotFeet]:"/classic/assets/item_slots/feet.jpg",[A.ItemSlotFinger1]:"/classic/assets/item_slots/finger.jpg",[A.ItemSlotFinger2]:"/classic/assets/item_slots/finger.jpg",[A.ItemSlotTrinket1]:"/classic/assets/item_slots/trinket.jpg",[A.ItemSlotTrinket2]:"/classic/assets/item_slots/trinket.jpg",[A.ItemSlotMainHand]:"/classic/assets/item_slots/mainhand.jpg",[A.ItemSlotOffHand]:"/classic/assets/item_slots/offhand.jpg",[A.ItemSlotRanged]:"/classic/assets/item_slots/ranged.jpg"};function Sh(e){return bh[e]}var xh=(e=>(e.Enchants="Enchant",e.Items="Item",e.RandomSuffixes="Random Suffix",e))(xh||{});class vh extends ch{constructor(t,s,a,i,n){super(t,"selector-modal",{disposeOnClose:!1,size:"xl"}),this.ilists=[],this.itemSlotTabElems=[],this.currentSlot=A.ItemSlotHead,this.currentTab="Item",this.disabledTabs=[],this.simUI=s,this.player=a,this.gearPicker=i,this.options={id:Qe(),...n},this.disabledTabs=this.options.disabledTabs||[],this.addItemSlotTabs(),this.header.insertAdjacentElement("afterbegin",e("div",null,e("h6",{className:"selector-modal-title"}),e("ul",{className:"nav nav-tabs selector-modal-tabs"}))),this.body.appendChild(e("div",{className:"tab-content selector-modal-tab-content"})),this.titleElem=this.rootElem.querySelector(".selector-modal-title"),this.tabsElem=this.rootElem.querySelector(".selector-modal-tabs"),this.contentElem=this.rootElem.querySelector(".selector-modal-tab-content"),this.body.appendChild(e("div",{className:"d-flex align-items-center form-text mt-auto pt-3"},e("i",{className:"fas fa-circle-exclamation fa-xl me-2"}),e("span",null,"If gear is missing, check the selected phase and your gear filters.",e("br",null),"If the problem persists, save any un-saved data, click the",e("i",{className:"fas fa-cog mx-1"}),'to open your sim options, then click the "Restore Defaults".')))}openTab(e,t,s){this.titleElem.textContent=Lt.get(e)??"",this.setData(e,t,s),this.setActiveItemSlotTab(e),this.open()}onShow(){if(this.gearPicker){const e=this.switchToPreviousItemSlotTab.bind(this),t=this.switchToNextItemSlotTab.bind(this);document.addEventListener("keydown",e),document.addEventListener("keydown",t),this.addOnHideCallback((()=>document.removeEventListener("keydown",e))),this.addOnHideCallback((()=>document.removeEventListener("keydown",t)))}}setData(e,t,s){this.tabsElem.innerText="",this.contentElem.innerText="",this.ilists=[];const a=s.getEquippedItem(),i=this.player.getItems(e),n=this.player.getEnchants(e);"Enchant"!==t||n.length||(t="Item"),this.currentTab=t,this.currentSlot=e;!this.disabledTabs?.includes("Item")&&this.addTab({id:Xt(`${this.options.id}-Item`),label:"Item",gearData:s,itemData:i.map((t=>({item:t,id:t.id,actionId:x.fromItem(t),name:t.name,quality:t.quality,phase:t.phase,baseEP:this.player.computeItemEP(t,e),ignoreEPFilter:!1,onEquip:(e,t)=>{const a=s.getEquippedItem();a?s.equipItem(e,a.withItem(t)):s.equipItem(e,new es({item:t}))}}))),computeEP:t=>this.player.computeItemEP(t,e),equippedToItemFn:e=>e?.item,onRemove:e=>{s.equipItem(e,null),this.removeTabs("Random Suffix")}});!this.disabledTabs?.includes("Enchant")&&this.addTab({id:Xt(`${this.options.id}-Enchant`),label:"Enchant",gearData:s,itemData:n.map((e=>({item:e,id:e.effectId,actionId:e.itemId?x.fromItemId(e.itemId):x.fromSpellId(e.spellId),name:e.name,quality:e.quality,phase:e.phase||1,baseEP:this.player.computeStatsEP(new yn(e.stats)),ignoreEPFilter:!0,onEquip:(e,t)=>{const a=s.getEquippedItem();a&&s.equipItem(e,a.withEnchant(t))}}))),computeEP:e=>this.player.computeEnchantEP(e),equippedToItemFn:e=>e?.enchant,onRemove:e=>{const t=s.getEquippedItem();t&&s.equipItem(e,t.withEnchant(null))}});!this.disabledTabs?.includes("Random Suffix")&&this.addRandomSuffixTab(a,s),this.ilists.find((e=>t===e.label))?.sizeRefresh()}addItemSlotTabs(){this.gearPicker&&this.dialog.prepend(e("div",{className:"gear-picker-modal-slots"},this.gearPicker.itemPickers.map((t=>{const s=g(),a=e("div",{className:"item-picker-icon-wrapper",dataset:{slot:t.slot}},e("a",{ref:s,className:"item-picker-icon",href:"javascript:void(0)",onclick:e=>{e.preventDefault(),t.slot!=this.currentSlot&&t.openSelectorModal(this.currentTab)},dataset:{whtticon:"false"}})),i=()=>{t.item?(this.player.setWowheadData(t.item,s.value),t.item.asActionId().fill().then((e=>{e.setBackgroundAndHref(s.value)}))):s.value.style.backgroundImage=`url('${Sh(t.slot)}')`};return i(),t.onUpdate((()=>i())),mn(s.value,{content:`Edit ${Lt.get(t.slot)}`,placement:"left"}),this.itemSlotTabElems.push(a),a}))))}setActiveItemSlotTab(e){this.itemSlotTabElems.forEach((t=>{t.dataset.slot===e.toString()?t.classList.add("active"):t.classList.contains("active")&&t.classList.remove("active")}))}switchToPreviousItemSlotTab(e){if("ArrowUp"===e.key&&this.gearPicker){e.preventDefault();const t=ts(this.currentSlot-1,Object.keys(A).length/2);this.gearPicker.itemPickers[t].openSelectorModal(this.currentTab)}}switchToNextItemSlotTab(e){if("ArrowDown"===e.key&&this.gearPicker){e.preventDefault();const t=ts(this.currentSlot+1,Object.keys(A).length/2);this.gearPicker.itemPickers[t].openSelectorModal(this.currentTab)}}addRandomSuffixTab(e,t){if(!e||!e.item.randomSuffixOptions.length)return;const s=e.item;this.addTab({id:Xt(`${this.options.id}-Random Suffix`),label:"Random Suffix",gearData:t,itemData:this.player.getRandomSuffixes(s).map((e=>({item:e,id:e.id,actionId:x.fromRandomSuffix(s,e),name:e.name,quality:s.quality,phase:s.phase,baseEP:this.player.computeRandomSuffixEP(e),ignoreEPFilter:!0,onEquip:(e,s)=>{const a=t.getEquippedItem();a&&t.equipItem(e,a.withItem(a.item).withRandomSuffix(s))}}))),computeEP:e=>this.player.computeRandomSuffixEP(e),equippedToItemFn:e=>e?.randomSuffix,onRemove:e=>{const s=t.getEquippedItem();s&&t.equipItem(e,s.withItem(s.item).withRandomSuffix(null))}})}addTab({id:s,label:i,gearData:n,itemData:o,computeEP:l,equippedToItemFn:r,onRemove:c,setTabContent:d}){if(!o.length)return;const h=i===this.currentTab,m=g();this.tabsElem.appendChild(e("li",{className:"nav-item"},e("button",{ref:m,className:t("nav-link selector-modal-item-tab",h&&"active"),dataset:{label:i,bsToggle:"tab",bsTarget:`#${s}`},attributes:{role:"tab","aria-selected":h}}))),d?d(m.value):m.value.textContent=i;const u=new wh(s,this.contentElem,this.simUI,this.currentSlot,this.currentTab,this.player,i,n,o,l,r,c,(e=>{const t=e;e.onEquip(a.nextEventID(),t.item);const s=ss.is(t.item),i=!!t.actionId.randomSuffixId;(s||i)&&(i||(this.removeTabs("Random Suffix"),this.addRandomSuffixTab(n.getEquippedItem(),n)))})),p=()=>{u.updateSelected()},f=()=>{u.applyFilters()},I=()=>{u.hideOrShowEPValues()};n.changeEvent.on(p),this.player.sim.phaseChangeEmitter.on(f),this.player.sim.filtersChangeEmitter.on(f),this.player.sim.showEPValuesChangeEmitter.on(I),this.addOnDisposeCallback((()=>{n.changeEvent.off(p),this.player.sim.phaseChangeEmitter.off(f),this.player.sim.filtersChangeEmitter.off(f),this.player.sim.showEPValuesChangeEmitter.off(I),u.dispose()})),m.value.addEventListener("click",(e=>{this.currentTab=i})),m.value.addEventListener("shown.bs.tab",(e=>{u.sizeRefresh()})),this.ilists.push(u)}removeTabs(e){const t=[...this.tabsElem.querySelectorAll(".selector-modal-item-tab")].filter((t=>t.dataset?.label?.includes(e))),s=t.map((e=>document.querySelector(e.dataset.bsTarget))).filter((e=>Boolean(e)));t.forEach((e=>e.parentElement?.remove())),s.forEach((e=>e.remove()))}}const yh=e("ul",{className:"text-start ps-3 mb-0"});class Eh extends p{constructor(t){super(t,"results-viewer"),this.warnings=[],this.warningsTooltip=null;const s=g(),a=g(),i=g(),n=g();this.rootElem.appendChild(e(b,null,e("div",{ref:s,className:"results-pending"},e("div",{className:"loader"})),e("div",{ref:a,className:"results-content"}),e("div",{ref:n,className:"button-zone text-center"}),e("div",{ref:i,className:"warning-zone text-center"}))),this.pendingElem=s.value,this.contentElem=a.value,this.warningElem=i.value,this.buttonElem=n.value,this.warningsLink=this.addWarningsLink(),this.updateWarnings(),this.hideAll()}addWarningLink(t){const s=e("div",{className:"sim-toolbar-item"},e("a",{href:t.href?t.href:"javascript:void(0)",target:t.href?"_blank":"_self",className:t.classes},t.icon&&e("i",{className:t.icon}),t.text?t.text:""));return t.parent.appendChild(s),t.tooltip&&(this.warningsTooltip=mn(s,{appendTo:"parent",content:t.tooltip,placement:"bottom",inlinePositioning:!0,plugins:[pn]})),s}addWarningsLink(){return this.addWarningLink({parent:this.warningElem,icon:"fas fa-exclamation-triangle fa-3x",tooltip:yh,classes:"warning link-warning"})}addWarning(e){this.warnings.push(e),e.updateOn.on((()=>this.updateWarnings())),this.updateWarnings()}updateWarnings(){const t=this.warnings.map((e=>e.getContent())).flat().filter((e=>""!==e)),s=this.warningsTooltip?.props.content?.cloneNode(!0)||e(b,null);s&&(s.innerHTML=""),s.appendChild(e(b,null,t?.map((t=>e("li",null,t))))),this.warningsLink.parentElement?.classList?.[t.length?"remove":"add"]("hide"),this.warningsTooltip?.setContent(s)}hideAll(){this.contentElem.style.display="none",this.pendingElem.style.display="none",this.buttonElem.style.display="none"}setPending(){this.contentElem.style.display="none",this.pendingElem.style.display="block"}setContent(e){"string"==typeof e?this.contentElem.innerHTML=e:(this.contentElem.innerHTML="",this.contentElem.appendChild(e)),this.contentElem.style.display="block",this.pendingElem.style.display="none"}addAbortButton(t){this.buttonElem.replaceChildren(e("button",{className:"sim-abort-button",onclick:t},e("i",{className:"fa fa-times fa-lg me-1"}),"Stop")),this.buttonElem.style.display="block"}removeAbortButton(){this.buttonElem.replaceChildren(),this.buttonElem.style.display="none"}}class kh extends p{constructor(e,t,s){super(e,"sim-tab"),this.rootElem.classList.add(s.identifier),this.simUI=t,this.config=s,this.rootElem.id=this.config.identifier,this.rootElem.classList.add("tab-pane","fade"),0==e.childNodes.length&&this.rootElem.classList.add("active","show"),this.navItem=this.buildNavItem(),this.navLink=this.navItem.children[0],this.contentContainer=document.createElement("div"),this.contentContainer.classList.add("tab-pane-content-container"),this.rootElem.appendChild(this.contentContainer),this.simUI.simHeader.addSimTabLink(this)}buildNavItem(){const e=document.createElement("fragment");return e.innerHTML=`\n\t\t\t<li class="${this.config.identifier} nav-item" role="presentation">\n\t\t\t\t<a\n\t\t\t\t\tclass="nav-link"\n\t\t\t\t\tdata-bs-toggle="tab"\n\t\t\t\t\tdata-bs-target="#${this.config.identifier}"\n\t\t\t\t\ttype="button"\n\t\t\t\t\trole="tab"\n\t\t\t\t\taria-controls="${this.config.identifier}"\n\t\t\t\t>${this.config.title}</a>\n\t\t\t</li>\n\t\t`,e.children[0]}buildColumn(e,t){let s=document.createElement("div");return s.classList.add("tab-panel-col",`${t}-${e}`),s}}class Ph extends p{constructor(e,t,s){super(e,"gear-picker-root");const a=document.createElement("div");a.classList.add("gear-picker-left","tab-panel-col"),this.rootElem.appendChild(a);const i=document.createElement("div");i.classList.add("gear-picker-right","tab-panel-col"),this.rootElem.appendChild(i);const n=[A.ItemSlotHead,A.ItemSlotNeck,A.ItemSlotShoulder,A.ItemSlotBack,A.ItemSlotChest,A.ItemSlotWrist,A.ItemSlotMainHand,A.ItemSlotOffHand,A.ItemSlotRanged].map((e=>new Th(a,this,t,s,e))),o=[A.ItemSlotHands,A.ItemSlotWaist,A.ItemSlotLegs,A.ItemSlotFeet,A.ItemSlotFinger1,A.ItemSlotFinger2,A.ItemSlotTrinket1,A.ItemSlotTrinket2].map((e=>new Th(i,this,t,s,e)));this.itemPickers=n.concat(o).sort(((e,t)=>e.slot-t.slot)),this.selectorModal=new vh(t.rootElem,t,s,this)}}class Ch extends p{constructor(t,s,a){super(t,"item-picker-root",s),this.player=a;const i=g(),n=g(),o=g(),l=g();this.rootElem.appendChild(e(b,null,e("div",{className:"item-picker-icon-wrapper"},e("span",{className:"item-picker-ilvl",ref:o}),e("a",{ref:i,className:"item-picker-icon",href:"javascript:void(0)",attributes:{role:"button"}})),e("div",{className:"item-picker-labels-container"},e("a",{ref:n,className:"item-picker-name",href:"javascript:void(0)",attributes:{role:"button"}}),e("a",{ref:l,className:"item-picker-enchant hide",href:"javascript:void(0)",attributes:{role:"button"}})))),this.iconElem=i.value,this.nameElem=n.value,this.ilvlElem=o.value,this.enchantElem=l.value}clear(){this.iconElem.removeAttribute("data-wowhead"),this.iconElem.removeAttribute("href"),this.nameElem.removeAttribute("data-wowhead"),this.nameElem.removeAttribute("href"),this.enchantElem.removeAttribute("data-wowhead"),this.enchantElem.removeAttribute("href"),this.enchantElem.classList.add("hide"),this.iconElem.style.backgroundImage="",this.nameElem.innerText="",this.ilvlElem.innerText="",this.enchantElem.innerText=""}update(e){this.nameElem.textContent=e.item.name,this.ilvlElem.textContent=e.item.ilvl.toString(),e.randomSuffix&&(this.nameElem.textContent+=" "+e.randomSuffix.name),oh(this.nameElem,e.item.quality),this.player.setWowheadData(e,this.iconElem),this.player.setWowheadData(e,this.nameElem),e.asActionId().fill().then((e=>{e.setBackgroundAndHref(this.iconElem),e.setWowheadHref(this.nameElem)})),e.enchant?(hh(e.enchant).then((e=>{this.enchantElem.textContent=e})),e.enchant.spellId?(this.enchantElem.href=x.makeSpellUrl(e.enchant.spellId),x.makeSpellTooltipData(e.enchant.spellId).then((e=>{this.enchantElem.dataset.wowhead=e}))):(this.enchantElem.href=x.makeItemUrl(e.enchant.itemId),x.makeItemTooltipData(e.enchant.itemId).then((e=>{this.enchantElem.dataset.wowhead=e}))),this.enchantElem.dataset.whtticon="false",this.enchantElem.classList.remove("hide")):this.enchantElem.classList.add("hide")}}class Th extends p{constructor(e,t,s,a,i){super(e,"item-picker-root"),this.onUpdateCallbacks=[],this._equippedItem=null,this.gearPicker=t,this.simUI=s,this.player=a,this.slot=i,this.itemElem=new Ch(e,this.rootElem,a),this.item=a.getEquippedItem(i),a.sim.waitForInit().then((()=>{const e=e=>{e.preventDefault(),this.openSelectorModal(xh.Items)};this.itemElem.iconElem.addEventListener("click",e),this.itemElem.nameElem.addEventListener("click",e),this.itemElem.enchantElem.addEventListener("click",(e=>{e.preventDefault(),this.openSelectorModal(xh.Enchants)}))})),a.gearChangeEmitter.on((()=>{this.item=this.player.getEquippedItem(this.slot)})),a.professionChangeEmitter.on((()=>{this._equippedItem&&this.player.setWowheadData(this._equippedItem,this.itemElem.iconElem)}))}createGearData(){return{equipItem:(e,t)=>{this.player.equipItem(e,this.slot,t)},getEquippedItem:()=>this.player.getEquippedItem(this.slot),changeEvent:this.player.gearChangeEmitter}}get item(){return this._equippedItem}set item(e){this.itemElem.clear(),this.itemElem.nameElem.textContent=Lt.get(this.slot)??"",oh(this.itemElem.nameElem,null),e?this.itemElem.update(e):this.itemElem.iconElem.style.backgroundImage=`url('${Sh(this.slot)}')`,this._equippedItem=e,this.onUpdateCallbacks.forEach((e=>e()))}onUpdate(e){this.onUpdateCallbacks.push(e)}openSelectorModal(e){this.gearPicker.selectorModal.openTab(this.slot,e,this.createGearData())}}class Nh extends p{constructor(t,s,a,i,n){super(t,"bulk-item-picker"),this.simUI=s,this.bulkUI=a,this.index=n,this.item=i,this.itemElem=new Ch(t,this.rootElem,s.player);const o=g();this.itemElem.rootElem.appendChild(e("button",{className:"remove-batch-item-btn",ref:o},e("i",{className:"fas fa-times"})));const l=()=>this.bulkUI.removeItemByIndex(this.index);o.value.addEventListener("click",l),this.addOnDisposeCallback((()=>o.value.removeEventListener("click",l))),this.simUI.sim.waitForInit().then((()=>{this.setItem(i);const e=as(this.item.item)[0],t=this.simUI.sim.db.getEnchants(e),s=this.item.item.randomSuffixOptions,a=a=>{a.preventDefault(),t.length?this.bulkUI.selectorModal.openTab(e,xh.Enchants,this.createGearData()):s.length&&this.bulkUI.selectorModal.openTab(e,xh.RandomSuffixes,this.createGearData())};this.itemElem.iconElem.addEventListener("click",a),this.itemElem.nameElem.addEventListener("click",a),this.itemElem.enchantElem.addEventListener("click",a)}))}setItem(e){this.itemElem.clear(),e?(this.itemElem.update(e),this.item=e):(this.itemElem.rootElem.style.opacity="30%",this.itemElem.iconElem.style.backgroundImage="url('/cata/assets/item_slots/empty.jpg')",this.itemElem.nameElem.textContent="Add new item (not implemented)",this.itemElem.rootElem.style.alignItems="center")}createGearData(){const e=new a;return{equipItem:(t,s)=>{if(s){const t=this.bulkUI.getItems();t[this.index]=s.asSpec(),this.item=s,this.bulkUI.setItems(t),e.emit(a.nextEventID())}},getEquippedItem:()=>this.item,changeEvent:e}}}class _h extends p{constructor(s,i,n,o){super(s,".bulk-sim-results");const l=n.unitMetrics.dps.avg-o.unitMetrics.dps.avg,r=g(),c=g(),d=g();if(s.appendChild(e(b,null,e("div",{className:"results-sim"},e("div",{className:"bulk-result-body-dps bulk-items-text-line results-sim-dps damage-metrics"},e("span",{className:"topline-result-avg"},this.formatDps(n.unitMetrics.dps.avg)),e("span",{ref:c,className:t(l>=0?"bulk-result-header-positive":"bulk-result-header-negative")},this.formatDpsDelta(l)),e("p",{className:"talent-loadout-text"},n.talentLoadout&&"object"==typeof n.talentLoadout?"string"==typeof n.talentLoadout.name&&e(b,null,"Talent loadout used: ",n.talentLoadout.name):e(b,null,"Current talents")))),e("div",{ref:d,className:"bulk-gear-combo"}),!!n.itemsAdded?.length&&e("button",{ref:r,className:"btn btn-primary bulk-equipit"},"Equip"))),n.itemsAdded?.length){r.value?.addEventListener("click",(()=>{n.itemsAdded.forEach((e=>{const t=i.sim.db.lookupItemSpec(e.item);i.player.equipItem(a.nextEventID(),e.slot,t),i.simHeader.activateTab("gear-tab")}))}));const t=e(b,null);for(const s of n.itemsAdded){const a=e("div",{className:"bulk-result-item"}),n=i.sim.db.lookupItemSpec(s.item),o=new Ch(t,a,i.player);o.update(n),o.nameElem.appendChild(e("a",{className:"bulk-result-item-slot"},this.itemSlotName(s))),t.appendChild(a)}d.value?.appendChild(t)}else n.talentLoadout&&"object"==typeof n.talentLoadout||(c.value?.classList.add("hide"),s.appendChild(e("p",null,"No changes - this is your currently equipped gear!")))}formatDps(e){return(Math.round(100*e)/100).toFixed(2)}formatDpsDelta(e){return(e>=0?"+":"")+this.formatDps(e)}itemSlotName(e){return JSON.parse(is.toJsonString(e,{emitDefaultValues:!0})).slot.replace("ItemSlot","")}}class Rh extends ch{constructor(t,s){super(t,"importer",{title:s.title,footer:!0,disposeOnClose:!1}),this.allowFileUpload=s.allowFileUpload||!1;const a="upload-input-"+s.title.toLowerCase().replaceAll(" ","-"),i=g(),n=g(),o=g(),l=g();this.body.replaceChildren(e(b,null,e("div",{ref:i,className:"import-description"}),e("textarea",{ref:n,className:"importer-textarea form-control",attributes:{spellcheck:!1}}))),this.footer.appendChild(e(b,null,this.allowFileUpload&&e(b,null,e("label",{htmlFor:a,className:"importer-button btn btn-primary upload-button me-2"},e("i",{className:"fas fa-file-arrow-up me-1"}),"Upload File"),e("input",{ref:l,type:"file",id:a,className:"importer-upload-input d-none",hidden:!0})),e("button",{ref:o,className:"importer-button btn btn-primary import-button"},e("i",{className:"fa fa-download me-1"}),"Import"))),this.descriptionElem=i.value,this.textElem=n.value,this.allowFileUpload&&l.value&&l.value.addEventListener("change",(async e=>{this.textElem.textContent=await e.target.files[0].text()})),this.importButton=o.value,this.importButton.addEventListener("click",(async e=>{try{await this.onImport(this.textElem.value||"")}catch(t){new gn({variant:"error",body:`Import error: ${t?.message||t}`})}}))}}const Dh=class extends Rh{constructor(e,t,s){super(e,s),this.simUI=t}async finishIndividualImport(e,t,s,i,n,o){const l=e.player.getClass();if(t!=l)throw new Error(`Wrong Class! Expected ${ns.get(l)} but found ${ns.get(t)}!`);await oe.loadLeftoversIfNecessary(i);const r=e.sim.db.lookupEquipmentSpec(i),c=i.items.map((e=>e.enchant)),d=r.asSpec().items.map((e=>e.enchant)),h=c.filter((e=>0!=e&&!d.includes(e))),m=i.items.map((e=>e.id)),u=r.asSpec().items.map((e=>e.id)),p=m.filter((e=>!u.includes(e))),g=a.nextEventID();a.freezeAllAndDo((()=>{e.player.setRace(g,s),e.player.setGear(g,r),n&&"--"!=n&&e.player.setTalentsString(g,n),o.length>0&&e.player.setProfessions(g,o)})),this.close(),0==p.length&&0==h.length?new gn({variant:"success",body:"Import successful!"}):new gn({variant:"info",body:"Import successful, but the following IDs were not found in the sim database:"+(0==p.length?"":"\n\nItems: "+p.join(", "))+(0==h.length?"":"\n\nEnchants: "+h.join(", "))})}};Dh.DEFAULT_CATEGORIES=r(fn).filter((e=>e!==fn.UISettings)),Dh.CATEGORY_PARAM="i";let Ah=Dh;class Lh extends Ah{constructor(t,s,a){super(t,s,{title:"Bag Item Import",allowFileUpload:!0}),this.bulkUI=a,this.descriptionElem.appendChild(e(b,null,e("p",null,"Import bag items from a JSON file, which can be created by the WowSimsExporter in-game AddOn."),e("p",null,"To import, upload the file or paste the text below, then click, 'Import'.")))}async onImport(e){try{const t=os.fromJsonString(e,{ignoreUnknownFields:!0});if(t?.items?.length>0){const e=await oe.loadLeftoversIfNecessary(t),s=t.items.filter((t=>t.id>0&&e.lookupItemSpec(t)));s.length>0&&this.bulkUI.addItems(s)}this.close()}catch(t){console.warn(t),alert(t.toString())}}}class Vh extends Ah{constructor(t,s){super(t,s,{title:"Sixty Upgrades Import",allowFileUpload:!0}),this.descriptionElem.appendChild(e(b,null,e("p",null,"Import settings from"," ",e("a",{href:"sixtyupgrades.com/era",target:"_blank"},"Sixty Upgrades"),"."),e("p",null,"This feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats."),e("p",null,"To import, paste the output from the site's export option below and click, 'Import'.")))}async onImport(t){const s=JSON.parse(t),a=ls(s?.character?.gameClass||"");if(a==o.ClassUnknown)throw new Error("Could not parse Class!");const i=rs(s?.character?.race||"");if(i==cs.RaceUnknown)throw new Error("Could not parse Race!");let n="";if(s?.talents?.length>0){n=function(e,t){return Fn[e].map((e=>e.talents.map((e=>{const s=e.spellIds.findIndex((e=>t.includes(e)));return-1==s?"0":String(s+1)})).join("").replace(/0+$/g,""))).join("-").replace(/-+$/g,"")}(a,s.talents.map((e=>e.spellId)))}let l=!1;const r=[],c=os.create();s.items.forEach((e=>{const t=Kt.create();t.id=e.id,e.enchant?.id&&(t.enchant=e.enchant.id),e.suffixId&&(l=!0,e.reforge?.id&&(e.reforge.id=null),r.push(e.name)),c.items.push(t)})),this.simUI.sim.db.lookupEquipmentSpec(c),this.finishIndividualImport(this.simUI,a,i,c,n,[]),l&&r.length&&new gn({variant:"warning",body:e(b,null,e("p",null,"Sixty Upgrades currently exports the wrong Random Suffixes. We have removed the random suffix on the following item(s):"),e("ul",null,r.map((t=>e("li",null,e("strong",null,t)))))),delay:8e3})}}class Mh extends Ah{constructor(t,s){super(t,s,{title:"Addon Import",allowFileUpload:!0}),this.descriptionElem.appendChild(e(b,null,e("p",null,"Import settings from the"," ",e("a",{href:"https://www.curseforge.com/wow/addons/wowsimsexporter",target:"_blank"},"WoWSims Exporter In-Game Addon"),"."),e("p",null,"This feature imports gear, race, talents, and professions. It does NOT import buffs, debuffs, consumes, rotation, or custom stats."),e("p",null,"To import, paste the output from the addon below and click, 'Import'.")))}async onImport(e){const t=JSON.parse(e),s=ls(t.class||"");if(s==o.ClassUnknown)throw new Error("Could not parse Class!");const a=rs(t.race||"");if(a==cs.RaceUnknown)throw new Error("Could not parse Race!");const i=t.professions.map((e=>ds(e.name)));i.forEach(((e,s)=>{if(e==F.ProfessionUnknown)throw new Error(`Could not parse profession '${t.professions[s]}'`)}));const n=t.talents||"",l=t.gear;delete l.version,l.items=l.items.filter((e=>null!=e));const r=os.fromJson(l);this.finishIndividualImport(this.simUI,s,a,r,n,i)}}class Uh extends Ah{constructor(t,s){super(t,s,{title:"JSON Import",allowFileUpload:!0}),this.descriptionElem.appendChild(e(b,null,e("p",null,"Import settings from a JSON file, which can be created using the JSON Export feature."),e("p",null,"To import, upload the file or paste the text below, then click, 'Import'.")))}async onImport(e){let t=null;try{t=hs.fromJsonString(e,{ignoreUnknownFields:!0})}catch{throw new Error("Please use a valid JSON object.")}t.player?.equipment&&await oe.loadLeftoversIfNecessary(t.player.equipment),this.simUI.isWithinRaidSim?t.player&&this.simUI.player.fromProto(a.nextEventID(),t.player):this.simUI.fromProto(a.nextEventID(),t),this.close()}}
/*! pako 2.1.0 https://github.com/nodeca/pako @license (MIT AND Zlib) */function Wh(e){let t=e.length;for(;--t>=0;)e[t]=0}const Fh=256,Oh=286,qh=30,Hh=15,Bh=new Uint8Array([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0]),zh=new Uint8Array([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13]),jh=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7]),$h=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),Gh=new Array(576);Wh(Gh);const Kh=new Array(60);Wh(Kh);const Jh=new Array(512);Wh(Jh);const Zh=new Array(256);Wh(Zh);const Yh=new Array(29);Wh(Yh);const Qh=new Array(qh);function Xh(e,t,s,a,i){this.static_tree=e,this.extra_bits=t,this.extra_base=s,this.elems=a,this.max_length=i,this.has_stree=e&&e.length}let em,tm,sm;function am(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}Wh(Qh);const im=e=>e<256?Jh[e]:Jh[256+(e>>>7)],nm=(e,t)=>{e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255},om=(e,t,s)=>{e.bi_valid>16-s?(e.bi_buf|=t<<e.bi_valid&65535,nm(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=s-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=s)},lm=(e,t,s)=>{om(e,s[2*t],s[2*t+1])},rm=(e,t)=>{let s=0;do{s|=1&e,e>>>=1,s<<=1}while(--t>0);return s>>>1},cm=(e,t,s)=>{const a=new Array(16);let i,n,o=0;for(i=1;i<=Hh;i++)o=o+s[i-1]<<1,a[i]=o;for(n=0;n<=t;n++){let t=e[2*n+1];0!==t&&(e[2*n]=rm(a[t]++,t))}},dm=e=>{let t;for(t=0;t<Oh;t++)e.dyn_ltree[2*t]=0;for(t=0;t<qh;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.sym_next=e.matches=0},hm=e=>{e.bi_valid>8?nm(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0},mm=(e,t,s,a)=>{const i=2*t,n=2*s;return e[i]<e[n]||e[i]===e[n]&&a[t]<=a[s]},um=(e,t,s)=>{const a=e.heap[s];let i=s<<1;for(;i<=e.heap_len&&(i<e.heap_len&&mm(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!mm(t,a,e.heap[i],e.depth));)e.heap[s]=e.heap[i],s=i,i<<=1;e.heap[s]=a},pm=(e,t,s)=>{let a,i,n,o,l=0;if(0!==e.sym_next)do{a=255&e.pending_buf[e.sym_buf+l++],a+=(255&e.pending_buf[e.sym_buf+l++])<<8,i=e.pending_buf[e.sym_buf+l++],0===a?lm(e,i,t):(n=Zh[i],lm(e,n+Fh+1,t),o=Bh[n],0!==o&&(i-=Yh[n],om(e,i,o)),a--,n=im(a),lm(e,n,s),o=zh[n],0!==o&&(a-=Qh[n],om(e,a,o)))}while(l<e.sym_next);lm(e,256,t)},gm=(e,t)=>{const s=t.dyn_tree,a=t.stat_desc.static_tree,i=t.stat_desc.has_stree,n=t.stat_desc.elems;let o,l,r,c=-1;for(e.heap_len=0,e.heap_max=573,o=0;o<n;o++)0!==s[2*o]?(e.heap[++e.heap_len]=c=o,e.depth[o]=0):s[2*o+1]=0;for(;e.heap_len<2;)r=e.heap[++e.heap_len]=c<2?++c:0,s[2*r]=1,e.depth[r]=0,e.opt_len--,i&&(e.static_len-=a[2*r+1]);for(t.max_code=c,o=e.heap_len>>1;o>=1;o--)um(e,s,o);r=n;do{o=e.heap[1],e.heap[1]=e.heap[e.heap_len--],um(e,s,1),l=e.heap[1],e.heap[--e.heap_max]=o,e.heap[--e.heap_max]=l,s[2*r]=s[2*o]+s[2*l],e.depth[r]=(e.depth[o]>=e.depth[l]?e.depth[o]:e.depth[l])+1,s[2*o+1]=s[2*l+1]=r,e.heap[1]=r++,um(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],((e,t)=>{const s=t.dyn_tree,a=t.max_code,i=t.stat_desc.static_tree,n=t.stat_desc.has_stree,o=t.stat_desc.extra_bits,l=t.stat_desc.extra_base,r=t.stat_desc.max_length;let c,d,h,m,u,p,g=0;for(m=0;m<=Hh;m++)e.bl_count[m]=0;for(s[2*e.heap[e.heap_max]+1]=0,c=e.heap_max+1;c<573;c++)d=e.heap[c],m=s[2*s[2*d+1]+1]+1,m>r&&(m=r,g++),s[2*d+1]=m,d>a||(e.bl_count[m]++,u=0,d>=l&&(u=o[d-l]),p=s[2*d],e.opt_len+=p*(m+u),n&&(e.static_len+=p*(i[2*d+1]+u)));if(0!==g){do{for(m=r-1;0===e.bl_count[m];)m--;e.bl_count[m]--,e.bl_count[m+1]+=2,e.bl_count[r]--,g-=2}while(g>0);for(m=r;0!==m;m--)for(d=e.bl_count[m];0!==d;)h=e.heap[--c],h>a||(s[2*h+1]!==m&&(e.opt_len+=(m-s[2*h+1])*s[2*h],s[2*h+1]=m),d--)}})(e,t),cm(s,c,e.bl_count)},fm=(e,t,s)=>{let a,i,n=-1,o=t[1],l=0,r=7,c=4;for(0===o&&(r=138,c=3),t[2*(s+1)+1]=65535,a=0;a<=s;a++)i=o,o=t[2*(a+1)+1],++l<r&&i===o||(l<c?e.bl_tree[2*i]+=l:0!==i?(i!==n&&e.bl_tree[2*i]++,e.bl_tree[32]++):l<=10?e.bl_tree[34]++:e.bl_tree[36]++,l=0,n=i,0===o?(r=138,c=3):i===o?(r=6,c=3):(r=7,c=4))},Im=(e,t,s)=>{let a,i,n=-1,o=t[1],l=0,r=7,c=4;for(0===o&&(r=138,c=3),a=0;a<=s;a++)if(i=o,o=t[2*(a+1)+1],!(++l<r&&i===o)){if(l<c)do{lm(e,i,e.bl_tree)}while(0!=--l);else 0!==i?(i!==n&&(lm(e,i,e.bl_tree),l--),lm(e,16,e.bl_tree),om(e,l-3,2)):l<=10?(lm(e,17,e.bl_tree),om(e,l-3,3)):(lm(e,18,e.bl_tree),om(e,l-11,7));l=0,n=i,0===o?(r=138,c=3):i===o?(r=6,c=3):(r=7,c=4)}};let wm=!1;const bm=(e,t,s,a)=>{om(e,0+(a?1:0),3),hm(e),nm(e,s),nm(e,~s),s&&e.pending_buf.set(e.window.subarray(t,t+s),e.pending),e.pending+=s};var Sm={_tr_init:e=>{wm||((()=>{let e,t,s,a,i;const n=new Array(16);for(s=0,a=0;a<28;a++)for(Yh[a]=s,e=0;e<1<<Bh[a];e++)Zh[s++]=a;for(Zh[s-1]=a,i=0,a=0;a<16;a++)for(Qh[a]=i,e=0;e<1<<zh[a];e++)Jh[i++]=a;for(i>>=7;a<qh;a++)for(Qh[a]=i<<7,e=0;e<1<<zh[a]-7;e++)Jh[256+i++]=a;for(t=0;t<=Hh;t++)n[t]=0;for(e=0;e<=143;)Gh[2*e+1]=8,e++,n[8]++;for(;e<=255;)Gh[2*e+1]=9,e++,n[9]++;for(;e<=279;)Gh[2*e+1]=7,e++,n[7]++;for(;e<=287;)Gh[2*e+1]=8,e++,n[8]++;for(cm(Gh,287,n),e=0;e<qh;e++)Kh[2*e+1]=5,Kh[2*e]=rm(e,5);em=new Xh(Gh,Bh,257,Oh,Hh),tm=new Xh(Kh,zh,0,qh,Hh),sm=new Xh(new Array(0),jh,0,19,7)})(),wm=!0),e.l_desc=new am(e.dyn_ltree,em),e.d_desc=new am(e.dyn_dtree,tm),e.bl_desc=new am(e.bl_tree,sm),e.bi_buf=0,e.bi_valid=0,dm(e)},_tr_stored_block:bm,_tr_flush_block:(e,t,s,a)=>{let i,n,o=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=(e=>{let t,s=4093624447;for(t=0;t<=31;t++,s>>>=1)if(1&s&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Fh;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0})(e)),gm(e,e.l_desc),gm(e,e.d_desc),o=(e=>{let t;for(fm(e,e.dyn_ltree,e.l_desc.max_code),fm(e,e.dyn_dtree,e.d_desc.max_code),gm(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*$h[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t})(e),i=e.opt_len+3+7>>>3,n=e.static_len+3+7>>>3,n<=i&&(i=n)):i=n=s+5,s+4<=i&&-1!==t?bm(e,t,s,a):4===e.strategy||n===i?(om(e,2+(a?1:0),3),pm(e,Gh,Kh)):(om(e,4+(a?1:0),3),((e,t,s,a)=>{let i;for(om(e,t-257,5),om(e,s-1,5),om(e,a-4,4),i=0;i<a;i++)om(e,e.bl_tree[2*$h[i]+1],3);Im(e,e.dyn_ltree,t-1),Im(e,e.dyn_dtree,s-1)})(e,e.l_desc.max_code+1,e.d_desc.max_code+1,o+1),pm(e,e.dyn_ltree,e.dyn_dtree)),dm(e),a&&hm(e)},_tr_tally:(e,t,s)=>(e.pending_buf[e.sym_buf+e.sym_next++]=t,e.pending_buf[e.sym_buf+e.sym_next++]=t>>8,e.pending_buf[e.sym_buf+e.sym_next++]=s,0===t?e.dyn_ltree[2*s]++:(e.matches++,t--,e.dyn_ltree[2*(Zh[s]+Fh+1)]++,e.dyn_dtree[2*im(t)]++),e.sym_next===e.sym_end),_tr_align:e=>{om(e,2,3),lm(e,256,Gh),(e=>{16===e.bi_valid?(nm(e,e.bi_buf),e.bi_buf=0,e.bi_valid=0):e.bi_valid>=8&&(e.pending_buf[e.pending++]=255&e.bi_buf,e.bi_buf>>=8,e.bi_valid-=8)})(e)}};var xm=(e,t,s,a)=>{let i=65535&e,n=e>>>16&65535,o=0;for(;0!==s;){o=s>2e3?2e3:s,s-=o;do{i=i+t[a++]|0,n=n+i|0}while(--o);i%=65521,n%=65521}return i|n<<16};const vm=new Uint32Array((()=>{let e,t=[];for(var s=0;s<256;s++){e=s;for(var a=0;a<8;a++)e=1&e?3988292384^e>>>1:e>>>1;t[s]=e}return t})());var ym=(e,t,s,a)=>{const i=vm,n=a+s;e^=-1;for(let o=a;o<n;o++)e=e>>>8^i[255&(e^t[o])];return~e},Em={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},km={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_MEM_ERROR:-4,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8};const{_tr_init:Pm,_tr_stored_block:Cm,_tr_flush_block:Tm,_tr_tally:Nm,_tr_align:_m}=Sm,{Z_NO_FLUSH:Rm,Z_PARTIAL_FLUSH:Dm,Z_FULL_FLUSH:Am,Z_FINISH:Lm,Z_BLOCK:Vm,Z_OK:Mm,Z_STREAM_END:Um,Z_STREAM_ERROR:Wm,Z_DATA_ERROR:Fm,Z_BUF_ERROR:Om,Z_DEFAULT_COMPRESSION:qm,Z_FILTERED:Hm,Z_HUFFMAN_ONLY:Bm,Z_RLE:zm,Z_FIXED:jm,Z_DEFAULT_STRATEGY:$m,Z_UNKNOWN:Gm,Z_DEFLATED:Km}=km,Jm=258,Zm=262,Ym=42,Qm=113,Xm=666,eu=(e,t)=>(e.msg=Em[t],t),tu=e=>2*e-(e>4?9:0),su=e=>{let t=e.length;for(;--t>=0;)e[t]=0},au=e=>{let t,s,a,i=e.w_size;t=e.hash_size,a=t;do{s=e.head[--a],e.head[a]=s>=i?s-i:0}while(--t);t=i,a=t;do{s=e.prev[--a],e.prev[a]=s>=i?s-i:0}while(--t)};let iu=(e,t,s)=>(t<<e.hash_shift^s)&e.hash_mask;const nu=e=>{const t=e.state;let s=t.pending;s>e.avail_out&&(s=e.avail_out),0!==s&&(e.output.set(t.pending_buf.subarray(t.pending_out,t.pending_out+s),e.next_out),e.next_out+=s,t.pending_out+=s,e.total_out+=s,e.avail_out-=s,t.pending-=s,0===t.pending&&(t.pending_out=0))},ou=(e,t)=>{Tm(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,nu(e.strm)},lu=(e,t)=>{e.pending_buf[e.pending++]=t},ru=(e,t)=>{e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t},cu=(e,t,s,a)=>{let i=e.avail_in;return i>a&&(i=a),0===i?0:(e.avail_in-=i,t.set(e.input.subarray(e.next_in,e.next_in+i),s),1===e.state.wrap?e.adler=xm(e.adler,t,i,s):2===e.state.wrap&&(e.adler=ym(e.adler,t,i,s)),e.next_in+=i,e.total_in+=i,i)},du=(e,t)=>{let s,a,i=e.max_chain_length,n=e.strstart,o=e.prev_length,l=e.nice_match;const r=e.strstart>e.w_size-Zm?e.strstart-(e.w_size-Zm):0,c=e.window,d=e.w_mask,h=e.prev,m=e.strstart+Jm;let u=c[n+o-1],p=c[n+o];e.prev_length>=e.good_match&&(i>>=2),l>e.lookahead&&(l=e.lookahead);do{if(s=t,c[s+o]===p&&c[s+o-1]===u&&c[s]===c[n]&&c[++s]===c[n+1]){n+=2,s++;do{}while(c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&c[++n]===c[++s]&&n<m);if(a=Jm-(m-n),n=m-Jm,a>o){if(e.match_start=t,o=a,a>=l)break;u=c[n+o-1],p=c[n+o]}}}while((t=h[t&d])>r&&0!=--i);return o<=e.lookahead?o:e.lookahead},hu=e=>{const t=e.w_size;let s,a,i;do{if(a=e.window_size-e.lookahead-e.strstart,e.strstart>=t+(t-Zm)&&(e.window.set(e.window.subarray(t,t+t-a),0),e.match_start-=t,e.strstart-=t,e.block_start-=t,e.insert>e.strstart&&(e.insert=e.strstart),au(e),a+=t),0===e.strm.avail_in)break;if(s=cu(e.strm,e.window,e.strstart+e.lookahead,a),e.lookahead+=s,e.lookahead+e.insert>=3)for(i=e.strstart-e.insert,e.ins_h=e.window[i],e.ins_h=iu(e,e.ins_h,e.window[i+1]);e.insert&&(e.ins_h=iu(e,e.ins_h,e.window[i+3-1]),e.prev[i&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=i,i++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<Zm&&0!==e.strm.avail_in)},mu=(e,t)=>{let s,a,i,n=e.pending_buf_size-5>e.w_size?e.w_size:e.pending_buf_size-5,o=0,l=e.strm.avail_in;do{if(s=65535,i=e.bi_valid+42>>3,e.strm.avail_out<i)break;if(i=e.strm.avail_out-i,a=e.strstart-e.block_start,s>a+e.strm.avail_in&&(s=a+e.strm.avail_in),s>i&&(s=i),s<n&&(0===s&&t!==Lm||t===Rm||s!==a+e.strm.avail_in))break;o=t===Lm&&s===a+e.strm.avail_in?1:0,Cm(e,0,0,o),e.pending_buf[e.pending-4]=s,e.pending_buf[e.pending-3]=s>>8,e.pending_buf[e.pending-2]=~s,e.pending_buf[e.pending-1]=~s>>8,nu(e.strm),a&&(a>s&&(a=s),e.strm.output.set(e.window.subarray(e.block_start,e.block_start+a),e.strm.next_out),e.strm.next_out+=a,e.strm.avail_out-=a,e.strm.total_out+=a,e.block_start+=a,s-=a),s&&(cu(e.strm,e.strm.output,e.strm.next_out,s),e.strm.next_out+=s,e.strm.avail_out-=s,e.strm.total_out+=s)}while(0===o);return l-=e.strm.avail_in,l&&(l>=e.w_size?(e.matches=2,e.window.set(e.strm.input.subarray(e.strm.next_in-e.w_size,e.strm.next_in),0),e.strstart=e.w_size,e.insert=e.strstart):(e.window_size-e.strstart<=l&&(e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,e.insert>e.strstart&&(e.insert=e.strstart)),e.window.set(e.strm.input.subarray(e.strm.next_in-l,e.strm.next_in),e.strstart),e.strstart+=l,e.insert+=l>e.w_size-e.insert?e.w_size-e.insert:l),e.block_start=e.strstart),e.high_water<e.strstart&&(e.high_water=e.strstart),o?4:t!==Rm&&t!==Lm&&0===e.strm.avail_in&&e.strstart===e.block_start?2:(i=e.window_size-e.strstart,e.strm.avail_in>i&&e.block_start>=e.w_size&&(e.block_start-=e.w_size,e.strstart-=e.w_size,e.window.set(e.window.subarray(e.w_size,e.w_size+e.strstart),0),e.matches<2&&e.matches++,i+=e.w_size,e.insert>e.strstart&&(e.insert=e.strstart)),i>e.strm.avail_in&&(i=e.strm.avail_in),i&&(cu(e.strm,e.window,e.strstart,i),e.strstart+=i,e.insert+=i>e.w_size-e.insert?e.w_size-e.insert:i),e.high_water<e.strstart&&(e.high_water=e.strstart),i=e.bi_valid+42>>3,i=e.pending_buf_size-i>65535?65535:e.pending_buf_size-i,n=i>e.w_size?e.w_size:i,a=e.strstart-e.block_start,(a>=n||(a||t===Lm)&&t!==Rm&&0===e.strm.avail_in&&a<=i)&&(s=a>i?i:a,o=t===Lm&&0===e.strm.avail_in&&s===a?1:0,Cm(e,e.block_start,s,o),e.block_start+=s,nu(e.strm)),o?3:1)},uu=(e,t)=>{let s,a;for(;;){if(e.lookahead<Zm){if(hu(e),e.lookahead<Zm&&t===Rm)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=iu(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==s&&e.strstart-s<=e.w_size-Zm&&(e.match_length=du(e,s)),e.match_length>=3)if(a=Nm(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=iu(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=iu(e,e.ins_h,e.window[e.strstart+1]);else a=Nm(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(a&&(ou(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,t===Lm?(ou(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ou(e,!1),0===e.strm.avail_out)?1:2},pu=(e,t)=>{let s,a,i;for(;;){if(e.lookahead<Zm){if(hu(e),e.lookahead<Zm&&t===Rm)return 1;if(0===e.lookahead)break}if(s=0,e.lookahead>=3&&(e.ins_h=iu(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==s&&e.prev_length<e.max_lazy_match&&e.strstart-s<=e.w_size-Zm&&(e.match_length=du(e,s),e.match_length<=5&&(e.strategy===Hm||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,a=Nm(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=iu(e,e.ins_h,e.window[e.strstart+3-1]),s=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,a&&(ou(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if(a=Nm(e,0,e.window[e.strstart-1]),a&&ou(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(a=Nm(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,t===Lm?(ou(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ou(e,!1),0===e.strm.avail_out)?1:2};function gu(e,t,s,a,i){this.good_length=e,this.max_lazy=t,this.nice_length=s,this.max_chain=a,this.func=i}const fu=[new gu(0,0,0,0,mu),new gu(4,4,8,4,uu),new gu(4,5,16,8,uu),new gu(4,6,32,32,uu),new gu(4,4,16,16,pu),new gu(8,16,32,32,pu),new gu(8,16,128,128,pu),new gu(8,32,128,256,pu),new gu(32,128,258,1024,pu),new gu(32,258,258,4096,pu)];function Iu(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=Km,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new Uint16Array(1146),this.dyn_dtree=new Uint16Array(122),this.bl_tree=new Uint16Array(78),su(this.dyn_ltree),su(this.dyn_dtree),su(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new Uint16Array(16),this.heap=new Uint16Array(573),su(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new Uint16Array(573),su(this.depth),this.sym_buf=0,this.lit_bufsize=0,this.sym_next=0,this.sym_end=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}const wu=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.status!==Ym&&57!==t.status&&69!==t.status&&73!==t.status&&91!==t.status&&103!==t.status&&t.status!==Qm&&t.status!==Xm?1:0},bu=e=>{if(wu(e))return eu(e,Wm);e.total_in=e.total_out=0,e.data_type=Gm;const t=e.state;return t.pending=0,t.pending_out=0,t.wrap<0&&(t.wrap=-t.wrap),t.status=2===t.wrap?57:t.wrap?Ym:Qm,e.adler=2===t.wrap?0:1,t.last_flush=-2,Pm(t),Mm},Su=e=>{const t=bu(e);var s;return t===Mm&&((s=e.state).window_size=2*s.w_size,su(s.head),s.max_lazy_match=fu[s.level].max_lazy,s.good_match=fu[s.level].good_length,s.nice_match=fu[s.level].nice_length,s.max_chain_length=fu[s.level].max_chain,s.strstart=0,s.block_start=0,s.lookahead=0,s.insert=0,s.match_length=s.prev_length=2,s.match_available=0,s.ins_h=0),t},xu=(e,t,s,a,i,n)=>{if(!e)return Wm;let o=1;if(t===qm&&(t=6),a<0?(o=0,a=-a):a>15&&(o=2,a-=16),i<1||i>9||s!==Km||a<8||a>15||t<0||t>9||n<0||n>jm||8===a&&1!==o)return eu(e,Wm);8===a&&(a=9);const l=new Iu;return e.state=l,l.strm=e,l.status=Ym,l.wrap=o,l.gzhead=null,l.w_bits=a,l.w_size=1<<l.w_bits,l.w_mask=l.w_size-1,l.hash_bits=i+7,l.hash_size=1<<l.hash_bits,l.hash_mask=l.hash_size-1,l.hash_shift=~~((l.hash_bits+3-1)/3),l.window=new Uint8Array(2*l.w_size),l.head=new Uint16Array(l.hash_size),l.prev=new Uint16Array(l.w_size),l.lit_bufsize=1<<i+6,l.pending_buf_size=4*l.lit_bufsize,l.pending_buf=new Uint8Array(l.pending_buf_size),l.sym_buf=l.lit_bufsize,l.sym_end=3*(l.lit_bufsize-1),l.level=t,l.strategy=n,l.method=s,Su(e)};var vu={deflateInit:(e,t)=>xu(e,t,Km,15,8,$m),deflateInit2:xu,deflateReset:Su,deflateResetKeep:bu,deflateSetHeader:(e,t)=>wu(e)||2!==e.state.wrap?Wm:(e.state.gzhead=t,Mm),deflate:(e,t)=>{if(wu(e)||t>Vm||t<0)return e?eu(e,Wm):Wm;const s=e.state;if(!e.output||0!==e.avail_in&&!e.input||s.status===Xm&&t!==Lm)return eu(e,0===e.avail_out?Om:Wm);const a=s.last_flush;if(s.last_flush=t,0!==s.pending){if(nu(e),0===e.avail_out)return s.last_flush=-1,Mm}else if(0===e.avail_in&&tu(t)<=tu(a)&&t!==Lm)return eu(e,Om);if(s.status===Xm&&0!==e.avail_in)return eu(e,Om);if(s.status===Ym&&0===s.wrap&&(s.status=Qm),s.status===Ym){let t=Km+(s.w_bits-8<<4)<<8,a=-1;if(a=s.strategy>=Bm||s.level<2?0:s.level<6?1:6===s.level?2:3,t|=a<<6,0!==s.strstart&&(t|=32),t+=31-t%31,ru(s,t),0!==s.strstart&&(ru(s,e.adler>>>16),ru(s,65535&e.adler)),e.adler=1,s.status=Qm,nu(e),0!==s.pending)return s.last_flush=-1,Mm}if(57===s.status)if(e.adler=0,lu(s,31),lu(s,139),lu(s,8),s.gzhead)lu(s,(s.gzhead.text?1:0)+(s.gzhead.hcrc?2:0)+(s.gzhead.extra?4:0)+(s.gzhead.name?8:0)+(s.gzhead.comment?16:0)),lu(s,255&s.gzhead.time),lu(s,s.gzhead.time>>8&255),lu(s,s.gzhead.time>>16&255),lu(s,s.gzhead.time>>24&255),lu(s,9===s.level?2:s.strategy>=Bm||s.level<2?4:0),lu(s,255&s.gzhead.os),s.gzhead.extra&&s.gzhead.extra.length&&(lu(s,255&s.gzhead.extra.length),lu(s,s.gzhead.extra.length>>8&255)),s.gzhead.hcrc&&(e.adler=ym(e.adler,s.pending_buf,s.pending,0)),s.gzindex=0,s.status=69;else if(lu(s,0),lu(s,0),lu(s,0),lu(s,0),lu(s,0),lu(s,9===s.level?2:s.strategy>=Bm||s.level<2?4:0),lu(s,3),s.status=Qm,nu(e),0!==s.pending)return s.last_flush=-1,Mm;if(69===s.status){if(s.gzhead.extra){let t=s.pending,a=(65535&s.gzhead.extra.length)-s.gzindex;for(;s.pending+a>s.pending_buf_size;){let i=s.pending_buf_size-s.pending;if(s.pending_buf.set(s.gzhead.extra.subarray(s.gzindex,s.gzindex+i),s.pending),s.pending=s.pending_buf_size,s.gzhead.hcrc&&s.pending>t&&(e.adler=ym(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex+=i,nu(e),0!==s.pending)return s.last_flush=-1,Mm;t=0,a-=i}let i=new Uint8Array(s.gzhead.extra);s.pending_buf.set(i.subarray(s.gzindex,s.gzindex+a),s.pending),s.pending+=a,s.gzhead.hcrc&&s.pending>t&&(e.adler=ym(e.adler,s.pending_buf,s.pending-t,t)),s.gzindex=0}s.status=73}if(73===s.status){if(s.gzhead.name){let t,a=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>a&&(e.adler=ym(e.adler,s.pending_buf,s.pending-a,a)),nu(e),0!==s.pending)return s.last_flush=-1,Mm;a=0}t=s.gzindex<s.gzhead.name.length?255&s.gzhead.name.charCodeAt(s.gzindex++):0,lu(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>a&&(e.adler=ym(e.adler,s.pending_buf,s.pending-a,a)),s.gzindex=0}s.status=91}if(91===s.status){if(s.gzhead.comment){let t,a=s.pending;do{if(s.pending===s.pending_buf_size){if(s.gzhead.hcrc&&s.pending>a&&(e.adler=ym(e.adler,s.pending_buf,s.pending-a,a)),nu(e),0!==s.pending)return s.last_flush=-1,Mm;a=0}t=s.gzindex<s.gzhead.comment.length?255&s.gzhead.comment.charCodeAt(s.gzindex++):0,lu(s,t)}while(0!==t);s.gzhead.hcrc&&s.pending>a&&(e.adler=ym(e.adler,s.pending_buf,s.pending-a,a))}s.status=103}if(103===s.status){if(s.gzhead.hcrc){if(s.pending+2>s.pending_buf_size&&(nu(e),0!==s.pending))return s.last_flush=-1,Mm;lu(s,255&e.adler),lu(s,e.adler>>8&255),e.adler=0}if(s.status=Qm,nu(e),0!==s.pending)return s.last_flush=-1,Mm}if(0!==e.avail_in||0!==s.lookahead||t!==Rm&&s.status!==Xm){let a=0===s.level?mu(s,t):s.strategy===Bm?((e,t)=>{let s;for(;;){if(0===e.lookahead&&(hu(e),0===e.lookahead)){if(t===Rm)return 1;break}if(e.match_length=0,s=Nm(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,s&&(ou(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Lm?(ou(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ou(e,!1),0===e.strm.avail_out)?1:2})(s,t):s.strategy===zm?((e,t)=>{let s,a,i,n;const o=e.window;for(;;){if(e.lookahead<=Jm){if(hu(e),e.lookahead<=Jm&&t===Rm)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(i=e.strstart-1,a=o[i],a===o[++i]&&a===o[++i]&&a===o[++i])){n=e.strstart+Jm;do{}while(a===o[++i]&&a===o[++i]&&a===o[++i]&&a===o[++i]&&a===o[++i]&&a===o[++i]&&a===o[++i]&&a===o[++i]&&i<n);e.match_length=Jm-(n-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(s=Nm(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(s=Nm(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),s&&(ou(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,t===Lm?(ou(e,!0),0===e.strm.avail_out?3:4):e.sym_next&&(ou(e,!1),0===e.strm.avail_out)?1:2})(s,t):fu[s.level].func(s,t);if(3!==a&&4!==a||(s.status=Xm),1===a||3===a)return 0===e.avail_out&&(s.last_flush=-1),Mm;if(2===a&&(t===Dm?_m(s):t!==Vm&&(Cm(s,0,0,!1),t===Am&&(su(s.head),0===s.lookahead&&(s.strstart=0,s.block_start=0,s.insert=0))),nu(e),0===e.avail_out))return s.last_flush=-1,Mm}return t!==Lm?Mm:s.wrap<=0?Um:(2===s.wrap?(lu(s,255&e.adler),lu(s,e.adler>>8&255),lu(s,e.adler>>16&255),lu(s,e.adler>>24&255),lu(s,255&e.total_in),lu(s,e.total_in>>8&255),lu(s,e.total_in>>16&255),lu(s,e.total_in>>24&255)):(ru(s,e.adler>>>16),ru(s,65535&e.adler)),nu(e),s.wrap>0&&(s.wrap=-s.wrap),0!==s.pending?Mm:Um)},deflateEnd:e=>{if(wu(e))return Wm;const t=e.state.status;return e.state=null,t===Qm?eu(e,Fm):Mm},deflateSetDictionary:(e,t)=>{let s=t.length;if(wu(e))return Wm;const a=e.state,i=a.wrap;if(2===i||1===i&&a.status!==Ym||a.lookahead)return Wm;if(1===i&&(e.adler=xm(e.adler,t,s,0)),a.wrap=0,s>=a.w_size){0===i&&(su(a.head),a.strstart=0,a.block_start=0,a.insert=0);let e=new Uint8Array(a.w_size);e.set(t.subarray(s-a.w_size,s),0),t=e,s=a.w_size}const n=e.avail_in,o=e.next_in,l=e.input;for(e.avail_in=s,e.next_in=0,e.input=t,hu(a);a.lookahead>=3;){let e=a.strstart,t=a.lookahead-2;do{a.ins_h=iu(a,a.ins_h,a.window[e+3-1]),a.prev[e&a.w_mask]=a.head[a.ins_h],a.head[a.ins_h]=e,e++}while(--t);a.strstart=e,a.lookahead=2,hu(a)}return a.strstart+=a.lookahead,a.block_start=a.strstart,a.insert=a.lookahead,a.lookahead=0,a.match_length=a.prev_length=2,a.match_available=0,e.next_in=o,e.input=l,e.avail_in=n,a.wrap=i,Mm},deflateInfo:"pako deflate (from Nodeca project)"};const yu=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);var Eu={assign:function(e){const t=Array.prototype.slice.call(arguments,1);for(;t.length;){const s=t.shift();if(s){if("object"!=typeof s)throw new TypeError(s+"must be non-object");for(const t in s)yu(s,t)&&(e[t]=s[t])}}return e},flattenChunks:e=>{let t=0;for(let a=0,i=e.length;a<i;a++)t+=e[a].length;const s=new Uint8Array(t);for(let a=0,i=0,n=e.length;a<n;a++){let t=e[a];s.set(t,i),i+=t.length}return s}};let ku=!0;try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(_f){ku=!1}const Pu=new Uint8Array(256);for(let Rf=0;Rf<256;Rf++)Pu[Rf]=Rf>=252?6:Rf>=248?5:Rf>=240?4:Rf>=224?3:Rf>=192?2:1;Pu[254]=Pu[254]=1;var Cu={string2buf:e=>{if("function"==typeof TextEncoder&&TextEncoder.prototype.encode)return(new TextEncoder).encode(e);let t,s,a,i,n,o=e.length,l=0;for(i=0;i<o;i++)s=e.charCodeAt(i),55296==(64512&s)&&i+1<o&&(a=e.charCodeAt(i+1),56320==(64512&a)&&(s=65536+(s-55296<<10)+(a-56320),i++)),l+=s<128?1:s<2048?2:s<65536?3:4;for(t=new Uint8Array(l),n=0,i=0;n<l;i++)s=e.charCodeAt(i),55296==(64512&s)&&i+1<o&&(a=e.charCodeAt(i+1),56320==(64512&a)&&(s=65536+(s-55296<<10)+(a-56320),i++)),s<128?t[n++]=s:s<2048?(t[n++]=192|s>>>6,t[n++]=128|63&s):s<65536?(t[n++]=224|s>>>12,t[n++]=128|s>>>6&63,t[n++]=128|63&s):(t[n++]=240|s>>>18,t[n++]=128|s>>>12&63,t[n++]=128|s>>>6&63,t[n++]=128|63&s);return t},buf2string:(e,t)=>{const s=t||e.length;if("function"==typeof TextDecoder&&TextDecoder.prototype.decode)return(new TextDecoder).decode(e.subarray(0,t));let a,i;const n=new Array(2*s);for(i=0,a=0;a<s;){let t=e[a++];if(t<128){n[i++]=t;continue}let o=Pu[t];if(o>4)n[i++]=65533,a+=o-1;else{for(t&=2===o?31:3===o?15:7;o>1&&a<s;)t=t<<6|63&e[a++],o--;o>1?n[i++]=65533:t<65536?n[i++]=t:(t-=65536,n[i++]=55296|t>>10&1023,n[i++]=56320|1023&t)}}return((e,t)=>{if(t<65534&&e.subarray&&ku)return String.fromCharCode.apply(null,e.length===t?e:e.subarray(0,t));let s="";for(let a=0;a<t;a++)s+=String.fromCharCode(e[a]);return s})(n,i)},utf8border:(e,t)=>{(t=t||e.length)>e.length&&(t=e.length);let s=t-1;for(;s>=0&&128==(192&e[s]);)s--;return s<0||0===s?t:s+Pu[e[s]]>t?s:t}};var Tu=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0};const Nu=Object.prototype.toString,{Z_NO_FLUSH:_u,Z_SYNC_FLUSH:Ru,Z_FULL_FLUSH:Du,Z_FINISH:Au,Z_OK:Lu,Z_STREAM_END:Vu,Z_DEFAULT_COMPRESSION:Mu,Z_DEFAULT_STRATEGY:Uu,Z_DEFLATED:Wu}=km;function Fu(e){this.options=Eu.assign({level:Mu,method:Wu,chunkSize:16384,windowBits:15,memLevel:8,strategy:Uu},e||{});let t=this.options;t.raw&&t.windowBits>0?t.windowBits=-t.windowBits:t.gzip&&t.windowBits>0&&t.windowBits<16&&(t.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Tu,this.strm.avail_out=0;let s=vu.deflateInit2(this.strm,t.level,t.method,t.windowBits,t.memLevel,t.strategy);if(s!==Lu)throw new Error(Em[s]);if(t.header&&vu.deflateSetHeader(this.strm,t.header),t.dictionary){let e;if(e="string"==typeof t.dictionary?Cu.string2buf(t.dictionary):"[object ArrayBuffer]"===Nu.call(t.dictionary)?new Uint8Array(t.dictionary):t.dictionary,s=vu.deflateSetDictionary(this.strm,e),s!==Lu)throw new Error(Em[s]);this._dict_set=!0}}function Ou(e,t){const s=new Fu(t);if(s.push(e,!0),s.err)throw s.msg||Em[s.err];return s.result}Fu.prototype.push=function(e,t){const s=this.strm,a=this.options.chunkSize;let i,n;if(this.ended)return!1;for(n=t===~~t?t:!0===t?Au:_u,"string"==typeof e?s.input=Cu.string2buf(e):"[object ArrayBuffer]"===Nu.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;)if(0===s.avail_out&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),(n===Ru||n===Du)&&s.avail_out<=6)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else{if(i=vu.deflate(s,n),i===Vu)return s.next_out>0&&this.onData(s.output.subarray(0,s.next_out)),i=vu.deflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Lu;if(0!==s.avail_out){if(n>0&&s.next_out>0)this.onData(s.output.subarray(0,s.next_out)),s.avail_out=0;else if(0===s.avail_in)break}else this.onData(s.output)}return!0},Fu.prototype.onData=function(e){this.chunks.push(e)},Fu.prototype.onEnd=function(e){e===Lu&&(this.result=Eu.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var qu={Deflate:Fu,deflate:Ou,deflateRaw:function(e,t){return(t=t||{}).raw=!0,Ou(e,t)},gzip:function(e,t){return(t=t||{}).gzip=!0,Ou(e,t)},constants:km};const Hu=16209;var Bu=function(e,t){let s,a,i,n,o,l,r,c,d,h,m,u,p,g,f,I,w,b,S,x,v,y,E,k;const P=e.state;s=e.next_in,E=e.input,a=s+(e.avail_in-5),i=e.next_out,k=e.output,n=i-(t-e.avail_out),o=i+(e.avail_out-257),l=P.dmax,r=P.wsize,c=P.whave,d=P.wnext,h=P.window,m=P.hold,u=P.bits,p=P.lencode,g=P.distcode,f=(1<<P.lenbits)-1,I=(1<<P.distbits)-1;e:do{u<15&&(m+=E[s++]<<u,u+=8,m+=E[s++]<<u,u+=8),w=p[m&f];t:for(;;){if(b=w>>>24,m>>>=b,u-=b,b=w>>>16&255,0===b)k[i++]=65535&w;else{if(!(16&b)){if(64&b){if(32&b){P.mode=16191;break e}e.msg="invalid literal/length code",P.mode=Hu;break e}w=p[(65535&w)+(m&(1<<b)-1)];continue t}for(S=65535&w,b&=15,b&&(u<b&&(m+=E[s++]<<u,u+=8),S+=m&(1<<b)-1,m>>>=b,u-=b),u<15&&(m+=E[s++]<<u,u+=8,m+=E[s++]<<u,u+=8),w=g[m&I];;){if(b=w>>>24,m>>>=b,u-=b,b=w>>>16&255,16&b){if(x=65535&w,b&=15,u<b&&(m+=E[s++]<<u,u+=8,u<b&&(m+=E[s++]<<u,u+=8)),x+=m&(1<<b)-1,x>l){e.msg="invalid distance too far back",P.mode=Hu;break e}if(m>>>=b,u-=b,b=i-n,x>b){if(b=x-b,b>c&&P.sane){e.msg="invalid distance too far back",P.mode=Hu;break e}if(v=0,y=h,0===d){if(v+=r-b,b<S){S-=b;do{k[i++]=h[v++]}while(--b);v=i-x,y=k}}else if(d<b){if(v+=r+d-b,b-=d,b<S){S-=b;do{k[i++]=h[v++]}while(--b);if(v=0,d<S){b=d,S-=b;do{k[i++]=h[v++]}while(--b);v=i-x,y=k}}}else if(v+=d-b,b<S){S-=b;do{k[i++]=h[v++]}while(--b);v=i-x,y=k}for(;S>2;)k[i++]=y[v++],k[i++]=y[v++],k[i++]=y[v++],S-=3;S&&(k[i++]=y[v++],S>1&&(k[i++]=y[v++]))}else{v=i-x;do{k[i++]=k[v++],k[i++]=k[v++],k[i++]=k[v++],S-=3}while(S>2);S&&(k[i++]=k[v++],S>1&&(k[i++]=k[v++]))}break}if(64&b){e.msg="invalid distance code",P.mode=Hu;break e}w=g[(65535&w)+(m&(1<<b)-1)]}}break}}while(s<a&&i<o);S=u>>3,s-=S,u-=S<<3,m&=(1<<u)-1,e.next_in=s,e.next_out=i,e.avail_in=s<a?a-s+5:5-(s-a),e.avail_out=i<o?o-i+257:257-(i-o),P.hold=m,P.bits=u};const zu=15,ju=new Uint16Array([3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0]),$u=new Uint8Array([16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78]),Gu=new Uint16Array([1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0]),Ku=new Uint8Array([16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64]);var Ju=(e,t,s,a,i,n,o,l)=>{const r=l.bits;let c,d,h,m,u,p,g=0,f=0,I=0,w=0,b=0,S=0,x=0,v=0,y=0,E=0,k=null;const P=new Uint16Array(16),C=new Uint16Array(16);let T,N,_,R=null;for(g=0;g<=zu;g++)P[g]=0;for(f=0;f<a;f++)P[t[s+f]]++;for(b=r,w=zu;w>=1&&0===P[w];w--);if(b>w&&(b=w),0===w)return i[n++]=20971520,i[n++]=20971520,l.bits=1,0;for(I=1;I<w&&0===P[I];I++);for(b<I&&(b=I),v=1,g=1;g<=zu;g++)if(v<<=1,v-=P[g],v<0)return-1;if(v>0&&(0===e||1!==w))return-1;for(C[1]=0,g=1;g<zu;g++)C[g+1]=C[g]+P[g];for(f=0;f<a;f++)0!==t[s+f]&&(o[C[t[s+f]]++]=f);if(0===e?(k=R=o,p=20):1===e?(k=ju,R=$u,p=257):(k=Gu,R=Ku,p=0),E=0,f=0,g=I,u=n,S=b,x=0,h=-1,y=1<<b,m=y-1,1===e&&y>852||2===e&&y>592)return 1;for(;;){T=g-x,o[f]+1<p?(N=0,_=o[f]):o[f]>=p?(N=R[o[f]-p],_=k[o[f]-p]):(N=96,_=0),c=1<<g-x,d=1<<S,I=d;do{d-=c,i[u+(E>>x)+d]=T<<24|N<<16|_}while(0!==d);for(c=1<<g-1;E&c;)c>>=1;if(0!==c?(E&=c-1,E+=c):E=0,f++,0==--P[g]){if(g===w)break;g=t[s+o[f]]}if(g>b&&(E&m)!==h){for(0===x&&(x=b),u+=I,S=g-x,v=1<<S;S+x<w&&(v-=P[S+x],!(v<=0));)S++,v<<=1;if(y+=1<<S,1===e&&y>852||2===e&&y>592)return 1;h=E&m,i[h]=b<<24|S<<16|u-n}}return 0!==E&&(i[u+E]=g-x<<24|64<<16),l.bits=b,0};const{Z_FINISH:Zu,Z_BLOCK:Yu,Z_TREES:Qu,Z_OK:Xu,Z_STREAM_END:ep,Z_NEED_DICT:tp,Z_STREAM_ERROR:sp,Z_DATA_ERROR:ap,Z_MEM_ERROR:ip,Z_BUF_ERROR:np,Z_DEFLATED:op}=km,lp=16180,rp=16190,cp=16191,dp=16192,hp=16194,mp=16199,up=16200,pp=16206,gp=16209,fp=e=>(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24);function Ip(){this.strm=null,this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Uint16Array(320),this.work=new Uint16Array(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}const wp=e=>{if(!e)return 1;const t=e.state;return!t||t.strm!==e||t.mode<lp||t.mode>16211?1:0},bp=e=>{if(wp(e))return sp;const t=e.state;return e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=lp,t.last=0,t.havedict=0,t.flags=-1,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Int32Array(852),t.distcode=t.distdyn=new Int32Array(592),t.sane=1,t.back=-1,Xu},Sp=e=>{if(wp(e))return sp;const t=e.state;return t.wsize=0,t.whave=0,t.wnext=0,bp(e)},xp=(e,t)=>{let s;if(wp(e))return sp;const a=e.state;return t<0?(s=0,t=-t):(s=5+(t>>4),t<48&&(t&=15)),t&&(t<8||t>15)?sp:(null!==a.window&&a.wbits!==t&&(a.window=null),a.wrap=s,a.wbits=t,Sp(e))},vp=(e,t)=>{if(!e)return sp;const s=new Ip;e.state=s,s.strm=e,s.window=null,s.mode=lp;const a=xp(e,t);return a!==Xu&&(e.state=null),a};let yp,Ep,kp=!0;const Pp=e=>{if(kp){yp=new Int32Array(512),Ep=new Int32Array(32);let t=0;for(;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Ju(1,e.lens,0,288,yp,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Ju(2,e.lens,0,32,Ep,0,e.work,{bits:5}),kp=!1}e.lencode=yp,e.lenbits=9,e.distcode=Ep,e.distbits=5},Cp=(e,t,s,a)=>{let i;const n=e.state;return null===n.window&&(n.wsize=1<<n.wbits,n.wnext=0,n.whave=0,n.window=new Uint8Array(n.wsize)),a>=n.wsize?(n.window.set(t.subarray(s-n.wsize,s),0),n.wnext=0,n.whave=n.wsize):(i=n.wsize-n.wnext,i>a&&(i=a),n.window.set(t.subarray(s-a,s-a+i),n.wnext),(a-=i)?(n.window.set(t.subarray(s-a,s),0),n.wnext=a,n.whave=n.wsize):(n.wnext+=i,n.wnext===n.wsize&&(n.wnext=0),n.whave<n.wsize&&(n.whave+=i))),0};var Tp={inflateReset:Sp,inflateReset2:xp,inflateResetKeep:bp,inflateInit:e=>vp(e,15),inflateInit2:vp,inflate:(e,t)=>{let s,a,i,n,o,l,r,c,d,h,m,u,p,g,f,I,w,b,S,x,v,y,E=0;const k=new Uint8Array(4);let P,C;const T=new Uint8Array([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]);if(wp(e)||!e.output||!e.input&&0!==e.avail_in)return sp;s=e.state,s.mode===cp&&(s.mode=dp),o=e.next_out,i=e.output,r=e.avail_out,n=e.next_in,a=e.input,l=e.avail_in,c=s.hold,d=s.bits,h=l,m=r,y=Xu;e:for(;;)switch(s.mode){case lp:if(0===s.wrap){s.mode=dp;break}for(;d<16;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}if(2&s.wrap&&35615===c){0===s.wbits&&(s.wbits=15),s.check=0,k[0]=255&c,k[1]=c>>>8&255,s.check=ym(s.check,k,2,0),c=0,d=0,s.mode=16181;break}if(s.head&&(s.head.done=!1),!(1&s.wrap)||(((255&c)<<8)+(c>>8))%31){e.msg="incorrect header check",s.mode=gp;break}if((15&c)!==op){e.msg="unknown compression method",s.mode=gp;break}if(c>>>=4,d-=4,v=8+(15&c),0===s.wbits&&(s.wbits=v),v>15||v>s.wbits){e.msg="invalid window size",s.mode=gp;break}s.dmax=1<<s.wbits,s.flags=0,e.adler=s.check=1,s.mode=512&c?16189:cp,c=0,d=0;break;case 16181:for(;d<16;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}if(s.flags=c,(255&s.flags)!==op){e.msg="unknown compression method",s.mode=gp;break}if(57344&s.flags){e.msg="unknown header flags set",s.mode=gp;break}s.head&&(s.head.text=c>>8&1),512&s.flags&&4&s.wrap&&(k[0]=255&c,k[1]=c>>>8&255,s.check=ym(s.check,k,2,0)),c=0,d=0,s.mode=16182;case 16182:for(;d<32;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}s.head&&(s.head.time=c),512&s.flags&&4&s.wrap&&(k[0]=255&c,k[1]=c>>>8&255,k[2]=c>>>16&255,k[3]=c>>>24&255,s.check=ym(s.check,k,4,0)),c=0,d=0,s.mode=16183;case 16183:for(;d<16;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}s.head&&(s.head.xflags=255&c,s.head.os=c>>8),512&s.flags&&4&s.wrap&&(k[0]=255&c,k[1]=c>>>8&255,s.check=ym(s.check,k,2,0)),c=0,d=0,s.mode=16184;case 16184:if(1024&s.flags){for(;d<16;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}s.length=c,s.head&&(s.head.extra_len=c),512&s.flags&&4&s.wrap&&(k[0]=255&c,k[1]=c>>>8&255,s.check=ym(s.check,k,2,0)),c=0,d=0}else s.head&&(s.head.extra=null);s.mode=16185;case 16185:if(1024&s.flags&&(u=s.length,u>l&&(u=l),u&&(s.head&&(v=s.head.extra_len-s.length,s.head.extra||(s.head.extra=new Uint8Array(s.head.extra_len)),s.head.extra.set(a.subarray(n,n+u),v)),512&s.flags&&4&s.wrap&&(s.check=ym(s.check,a,u,n)),l-=u,n+=u,s.length-=u),s.length))break e;s.length=0,s.mode=16186;case 16186:if(2048&s.flags){if(0===l)break e;u=0;do{v=a[n+u++],s.head&&v&&s.length<65536&&(s.head.name+=String.fromCharCode(v))}while(v&&u<l);if(512&s.flags&&4&s.wrap&&(s.check=ym(s.check,a,u,n)),l-=u,n+=u,v)break e}else s.head&&(s.head.name=null);s.length=0,s.mode=16187;case 16187:if(4096&s.flags){if(0===l)break e;u=0;do{v=a[n+u++],s.head&&v&&s.length<65536&&(s.head.comment+=String.fromCharCode(v))}while(v&&u<l);if(512&s.flags&&4&s.wrap&&(s.check=ym(s.check,a,u,n)),l-=u,n+=u,v)break e}else s.head&&(s.head.comment=null);s.mode=16188;case 16188:if(512&s.flags){for(;d<16;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}if(4&s.wrap&&c!==(65535&s.check)){e.msg="header crc mismatch",s.mode=gp;break}c=0,d=0}s.head&&(s.head.hcrc=s.flags>>9&1,s.head.done=!0),e.adler=s.check=0,s.mode=cp;break;case 16189:for(;d<32;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}e.adler=s.check=fp(c),c=0,d=0,s.mode=rp;case rp:if(0===s.havedict)return e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,s.hold=c,s.bits=d,tp;e.adler=s.check=1,s.mode=cp;case cp:if(t===Yu||t===Qu)break e;case dp:if(s.last){c>>>=7&d,d-=7&d,s.mode=pp;break}for(;d<3;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}switch(s.last=1&c,c>>>=1,d-=1,3&c){case 0:s.mode=16193;break;case 1:if(Pp(s),s.mode=mp,t===Qu){c>>>=2,d-=2;break e}break;case 2:s.mode=16196;break;case 3:e.msg="invalid block type",s.mode=gp}c>>>=2,d-=2;break;case 16193:for(c>>>=7&d,d-=7&d;d<32;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}if((65535&c)!=(c>>>16^65535)){e.msg="invalid stored block lengths",s.mode=gp;break}if(s.length=65535&c,c=0,d=0,s.mode=hp,t===Qu)break e;case hp:s.mode=16195;case 16195:if(u=s.length,u){if(u>l&&(u=l),u>r&&(u=r),0===u)break e;i.set(a.subarray(n,n+u),o),l-=u,n+=u,r-=u,o+=u,s.length-=u;break}s.mode=cp;break;case 16196:for(;d<14;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}if(s.nlen=257+(31&c),c>>>=5,d-=5,s.ndist=1+(31&c),c>>>=5,d-=5,s.ncode=4+(15&c),c>>>=4,d-=4,s.nlen>286||s.ndist>30){e.msg="too many length or distance symbols",s.mode=gp;break}s.have=0,s.mode=16197;case 16197:for(;s.have<s.ncode;){for(;d<3;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}s.lens[T[s.have++]]=7&c,c>>>=3,d-=3}for(;s.have<19;)s.lens[T[s.have++]]=0;if(s.lencode=s.lendyn,s.lenbits=7,P={bits:s.lenbits},y=Ju(0,s.lens,0,19,s.lencode,0,s.work,P),s.lenbits=P.bits,y){e.msg="invalid code lengths set",s.mode=gp;break}s.have=0,s.mode=16198;case 16198:for(;s.have<s.nlen+s.ndist;){for(;E=s.lencode[c&(1<<s.lenbits)-1],f=E>>>24,I=E>>>16&255,w=65535&E,!(f<=d);){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}if(w<16)c>>>=f,d-=f,s.lens[s.have++]=w;else{if(16===w){for(C=f+2;d<C;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}if(c>>>=f,d-=f,0===s.have){e.msg="invalid bit length repeat",s.mode=gp;break}v=s.lens[s.have-1],u=3+(3&c),c>>>=2,d-=2}else if(17===w){for(C=f+3;d<C;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}c>>>=f,d-=f,v=0,u=3+(7&c),c>>>=3,d-=3}else{for(C=f+7;d<C;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}c>>>=f,d-=f,v=0,u=11+(127&c),c>>>=7,d-=7}if(s.have+u>s.nlen+s.ndist){e.msg="invalid bit length repeat",s.mode=gp;break}for(;u--;)s.lens[s.have++]=v}}if(s.mode===gp)break;if(0===s.lens[256]){e.msg="invalid code -- missing end-of-block",s.mode=gp;break}if(s.lenbits=9,P={bits:s.lenbits},y=Ju(1,s.lens,0,s.nlen,s.lencode,0,s.work,P),s.lenbits=P.bits,y){e.msg="invalid literal/lengths set",s.mode=gp;break}if(s.distbits=6,s.distcode=s.distdyn,P={bits:s.distbits},y=Ju(2,s.lens,s.nlen,s.ndist,s.distcode,0,s.work,P),s.distbits=P.bits,y){e.msg="invalid distances set",s.mode=gp;break}if(s.mode=mp,t===Qu)break e;case mp:s.mode=up;case up:if(l>=6&&r>=258){e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,s.hold=c,s.bits=d,Bu(e,m),o=e.next_out,i=e.output,r=e.avail_out,n=e.next_in,a=e.input,l=e.avail_in,c=s.hold,d=s.bits,s.mode===cp&&(s.back=-1);break}for(s.back=0;E=s.lencode[c&(1<<s.lenbits)-1],f=E>>>24,I=E>>>16&255,w=65535&E,!(f<=d);){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}if(I&&!(240&I)){for(b=f,S=I,x=w;E=s.lencode[x+((c&(1<<b+S)-1)>>b)],f=E>>>24,I=E>>>16&255,w=65535&E,!(b+f<=d);){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}c>>>=b,d-=b,s.back+=b}if(c>>>=f,d-=f,s.back+=f,s.length=w,0===I){s.mode=16205;break}if(32&I){s.back=-1,s.mode=cp;break}if(64&I){e.msg="invalid literal/length code",s.mode=gp;break}s.extra=15&I,s.mode=16201;case 16201:if(s.extra){for(C=s.extra;d<C;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}s.length+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}s.was=s.length,s.mode=16202;case 16202:for(;E=s.distcode[c&(1<<s.distbits)-1],f=E>>>24,I=E>>>16&255,w=65535&E,!(f<=d);){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}if(!(240&I)){for(b=f,S=I,x=w;E=s.distcode[x+((c&(1<<b+S)-1)>>b)],f=E>>>24,I=E>>>16&255,w=65535&E,!(b+f<=d);){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}c>>>=b,d-=b,s.back+=b}if(c>>>=f,d-=f,s.back+=f,64&I){e.msg="invalid distance code",s.mode=gp;break}s.offset=w,s.extra=15&I,s.mode=16203;case 16203:if(s.extra){for(C=s.extra;d<C;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}s.offset+=c&(1<<s.extra)-1,c>>>=s.extra,d-=s.extra,s.back+=s.extra}if(s.offset>s.dmax){e.msg="invalid distance too far back",s.mode=gp;break}s.mode=16204;case 16204:if(0===r)break e;if(u=m-r,s.offset>u){if(u=s.offset-u,u>s.whave&&s.sane){e.msg="invalid distance too far back",s.mode=gp;break}u>s.wnext?(u-=s.wnext,p=s.wsize-u):p=s.wnext-u,u>s.length&&(u=s.length),g=s.window}else g=i,p=o-s.offset,u=s.length;u>r&&(u=r),r-=u,s.length-=u;do{i[o++]=g[p++]}while(--u);0===s.length&&(s.mode=up);break;case 16205:if(0===r)break e;i[o++]=s.length,r--,s.mode=up;break;case pp:if(s.wrap){for(;d<32;){if(0===l)break e;l--,c|=a[n++]<<d,d+=8}if(m-=r,e.total_out+=m,s.total+=m,4&s.wrap&&m&&(e.adler=s.check=s.flags?ym(s.check,i,m,o-m):xm(s.check,i,m,o-m)),m=r,4&s.wrap&&(s.flags?c:fp(c))!==s.check){e.msg="incorrect data check",s.mode=gp;break}c=0,d=0}s.mode=16207;case 16207:if(s.wrap&&s.flags){for(;d<32;){if(0===l)break e;l--,c+=a[n++]<<d,d+=8}if(4&s.wrap&&c!==(4294967295&s.total)){e.msg="incorrect length check",s.mode=gp;break}c=0,d=0}s.mode=16208;case 16208:y=ep;break e;case gp:y=ap;break e;case 16210:return ip;default:return sp}return e.next_out=o,e.avail_out=r,e.next_in=n,e.avail_in=l,s.hold=c,s.bits=d,(s.wsize||m!==e.avail_out&&s.mode<gp&&(s.mode<pp||t!==Zu))&&Cp(e,e.output,e.next_out,m-e.avail_out),h-=e.avail_in,m-=e.avail_out,e.total_in+=h,e.total_out+=m,s.total+=m,4&s.wrap&&m&&(e.adler=s.check=s.flags?ym(s.check,i,m,e.next_out-m):xm(s.check,i,m,e.next_out-m)),e.data_type=s.bits+(s.last?64:0)+(s.mode===cp?128:0)+(s.mode===mp||s.mode===hp?256:0),(0===h&&0===m||t===Zu)&&y===Xu&&(y=np),y},inflateEnd:e=>{if(wp(e))return sp;let t=e.state;return t.window&&(t.window=null),e.state=null,Xu},inflateGetHeader:(e,t)=>{if(wp(e))return sp;const s=e.state;return 2&s.wrap?(s.head=t,t.done=!1,Xu):sp},inflateSetDictionary:(e,t)=>{const s=t.length;let a,i,n;return wp(e)?sp:(a=e.state,0!==a.wrap&&a.mode!==rp?sp:a.mode===rp&&(i=1,i=xm(i,t,s,0),i!==a.check)?ap:(n=Cp(e,t,s,s),n?(a.mode=16210,ip):(a.havedict=1,Xu)))},inflateInfo:"pako inflate (from Nodeca project)"};var Np=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1};const _p=Object.prototype.toString,{Z_NO_FLUSH:Rp,Z_FINISH:Dp,Z_OK:Ap,Z_STREAM_END:Lp,Z_NEED_DICT:Vp,Z_STREAM_ERROR:Mp,Z_DATA_ERROR:Up,Z_MEM_ERROR:Wp}=km;function Fp(e){this.options=Eu.assign({chunkSize:65536,windowBits:15,to:""},e||{});const t=this.options;t.raw&&t.windowBits>=0&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(t.windowBits>=0&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),t.windowBits>15&&t.windowBits<48&&(15&t.windowBits||(t.windowBits|=15)),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Tu,this.strm.avail_out=0;let s=Tp.inflateInit2(this.strm,t.windowBits);if(s!==Ap)throw new Error(Em[s]);if(this.header=new Np,Tp.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=Cu.string2buf(t.dictionary):"[object ArrayBuffer]"===_p.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(s=Tp.inflateSetDictionary(this.strm,t.dictionary),s!==Ap)))throw new Error(Em[s])}function Op(e,t){const s=new Fp(t);if(s.push(e),s.err)throw s.msg||Em[s.err];return s.result}Fp.prototype.push=function(e,t){const s=this.strm,a=this.options.chunkSize,i=this.options.dictionary;let n,o,l;if(this.ended)return!1;for(o=t===~~t?t:!0===t?Dp:Rp,"[object ArrayBuffer]"===_p.call(e)?s.input=new Uint8Array(e):s.input=e,s.next_in=0,s.avail_in=s.input.length;;){for(0===s.avail_out&&(s.output=new Uint8Array(a),s.next_out=0,s.avail_out=a),n=Tp.inflate(s,o),n===Vp&&i&&(n=Tp.inflateSetDictionary(s,i),n===Ap?n=Tp.inflate(s,o):n===Up&&(n=Vp));s.avail_in>0&&n===Lp&&s.state.wrap>0&&0!==e[s.next_in];)Tp.inflateReset(s),n=Tp.inflate(s,o);switch(n){case Mp:case Up:case Vp:case Wp:return this.onEnd(n),this.ended=!0,!1}if(l=s.avail_out,s.next_out&&(0===s.avail_out||n===Lp))if("string"===this.options.to){let e=Cu.utf8border(s.output,s.next_out),t=s.next_out-e,i=Cu.buf2string(s.output,e);s.next_out=t,s.avail_out=a-t,t&&s.output.set(s.output.subarray(e,e+t),0),this.onData(i)}else this.onData(s.output.length===s.next_out?s.output:s.output.subarray(0,s.next_out));if(n!==Ap||0!==l){if(n===Lp)return n=Tp.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,!0;if(0===s.avail_in)break}}return!0},Fp.prototype.onData=function(e){this.chunks.push(e)},Fp.prototype.onEnd=function(e){e===Ap&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Eu.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg};var qp={Inflate:Fp,inflate:Op,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Op(e,t)},ungzip:Op,constants:km};const{Deflate:Hp,deflate:Bp,deflateRaw:zp,gzip:jp}=qu,{Inflate:$p,inflate:Gp,inflateRaw:Kp,ungzip:Jp}=qp;var Zp={Deflate:Hp,deflate:Bp,deflateRaw:zp,gzip:jp,Inflate:$p,inflate:Gp,inflateRaw:Kp,ungzip:Jp,constants:km};class Yp{static tryParseUrlLocation(e){let t=e.hash;if(t.length<=1)return null;t=t.substring(1);const s=atob(t),a=new Uint8Array(s.length);for(let r=0;r<a.length;r++)a[r]=s.charCodeAt(r);const i=Zp.inflate(a),n=hs.fromBinary(i);let o=Ah.DEFAULT_CATEGORIES;const l=new URLSearchParams(window.location.search);if(l.has(Ah.CATEGORY_PARAM)){o=l.get(Ah.CATEGORY_PARAM).split("").map((e=>[...In.entries()].find((t=>t[1]==e)))).filter((e=>e)).map((e=>e[0]))}return{settings:n,categories:o}}}const Qp=class t extends Ah{constructor(t,s){super(t,s,{title:"Wowhead Import",allowFileUpload:!0}),this.descriptionElem.appendChild(e(b,null,e("p",null,"Import settings from"," ",e("a",{href:"https://www.wowhead.com/classic/gear-planner",target:"_blank"},"Wowhead Gear Planner"),"."),e("p",null,"This feature imports gear, race, and (optionally) talents. It does NOT import buffs, debuffs, consumes, rotation, or custom stats."),e("p",null,"To import, paste the gear planner link below and click, 'Import'.")))}async onImport(e){const s=e.match(/www\.wowhead\.com\/classic\/gear-planner\/([a-z\-]+)\/([a-z\-]+)\/([a-zA-Z0-9_\-]+)/);if(!s)throw new Error(`Invalid WCL URL ${e}, must look like "https://www.wowhead.com/classic/gear-planner/CLASS/RACE/XXXX"`);const a=ls(s[1].replaceAll("-",""));if(a==o.ClassUnknown)throw new Error("Could not parse Class: "+s[1]);const i=rs(s[2].replaceAll("-",""));if(i==cs.RaceUnknown)throw new Error("Could not parse Race: "+s[2]);const n=s[3].replaceAll("_","/").replaceAll("-","+"),l=Uint8Array.from(atob(n),(e=>e.charCodeAt(0))),r=l[3],c=l.subarray(4,4+r),d=ms(c).split("f").slice(0,3).join("-"),h=l.subarray(r),m=os.create();let u=0;for(;u<h.length;){const e=Kt.create(),s=63&h[u],a=Boolean(128&h[u]);u++;const i=31&h[u];if(u++,e.id=(i<<16)+(h[u]<<8)+h[u+1],u+=2,a){const t=(h[u]<<16)+(h[u+1]<<8)+h[u+2];e.enchant=this.simUI.sim.db.enchantSpellIdToEffectId(t),u+=3}null!=Object.entries(t.slotIDs).find((e=>e[1]==s))&&m.items.push(e)}this.simUI.sim.db.lookupEquipmentSpec(m),this.finishIndividualImport(this.simUI,a,i,m,d,[])}};Qp.slotIDs={[A.ItemSlotHead]:1,[A.ItemSlotNeck]:2,[A.ItemSlotShoulder]:3,[A.ItemSlotBack]:15,[A.ItemSlotChest]:5,[A.ItemSlotWrist]:9,[A.ItemSlotHands]:10,[A.ItemSlotWaist]:6,[A.ItemSlotLegs]:7,[A.ItemSlotFeet]:8,[A.ItemSlotFinger1]:11,[A.ItemSlotFinger2]:12,[A.ItemSlotTrinket1]:13,[A.ItemSlotTrinket2]:14,[A.ItemSlotMainHand]:16,[A.ItemSlotOffHand]:17,[A.ItemSlotRanged]:18};class Xp extends kh{constructor(t,s){super(t,s,{identifier:"bulk-tab",title:"Batch"}),this.itemsChangedEmitter=new a,this.column1=this.buildColumn(1,"raid-settings-col"),this.items=new Array,this.simUI=s,this.leftPanel=e("div",{className:"bulk-tab-left tab-panel-left"},this.column1),this.rightPanel=e("div",{className:"bulk-tab-right tab-panel-right"}),this.pendingDiv=e("div",{className:"results-pending-overlay d-flex hide"}),this.pendingResults=new Eh(this.pendingDiv),this.pendingResults.hideAll(),this.selectorModal=new vh(this.simUI.rootElem,this.simUI,this.simUI.player,void 0,{id:"bulk-selector-modal",disabledTabs:[xh.Items]}),this.contentContainer.appendChild(e(b,null,this.leftPanel,this.rightPanel,this.pendingDiv)),this.doCombos=!0,this.fastMode=!0,this.autoEnchant=!0,this.savedTalents=[],this.simTalents=!1,this.buildTabContent(),this.simUI.sim.waitForInit().then((()=>{this.loadSettings()}))}getSettingsKey(){return this.simUI.getStorageKey("bulk-settings.v1")}loadSettings(){const e=window.localStorage.getItem(this.getSettingsKey());if(null!=e){const t=us.fromJsonString(e,{ignoreUnknownFields:!0});this.doCombos=t.combinations,this.fastMode=t.fastMode,this.autoEnchant=t.autoEnchant,this.savedTalents=t.talentsToSim,this.simTalents=t.simTalents}}storeSettings(){const e=this.createBulkSettings(),t=us.toJsonString(e,{enumAsInteger:!0});window.localStorage.setItem(this.getSettingsKey(),t)}createBulkSettings(){return us.create({items:this.items,combinations:this.doCombos,fastMode:this.fastMode,autoEnchant:this.autoEnchant,simTalents:this.simTalents,talentsToSim:this.savedTalents,iterationsPerCombo:this.simUI.sim.getIterations()})}createBulkItemsDatabase(){const e=ps.create();for(const t of this.items){const s=this.simUI.sim.db.lookupItemSpec(t);if(!s)throw new Error(`item with ID ${t.id} not found in database`);e.items.push(gs.fromJson(ss.toJson(s.item),{ignoreUnknownFields:!0})),s.enchant&&e.enchants.push(fs.fromJson(Is.toJson(s.enchant),{ignoreUnknownFields:!0}))}return e}addItem(e){this.addItems([e])}addItems(e){this.items=[...this.items||[],...e],this.itemsChangedEmitter.emit(a.nextEventID())}setItems(e){this.items=e,this.itemsChangedEmitter.emit(a.nextEventID())}removeItem(e){const t=this.items.findIndex((t=>Kt.equals(t,e)));-1!==t&&(this.items.splice(t,1),this.itemsChangedEmitter.emit(a.nextEventID()))}removeItemByIndex(e){this.items.length<e?new gn({variant:"error",body:"Failed to remove item, please report this issue."}):(this.items.splice(e,1),this.itemsChangedEmitter.emit(a.nextEventID()))}clearItems(){this.items=new Array,this.itemsChangedEmitter.emit(a.nextEventID())}hasItem(e){return this.items.some((t=>Kt.equals(t,e)))}getItems(){const e=new Array;return this.items.forEach((t=>{e.push(Kt.clone(t))})),e}setCombinations(e){this.doCombos=e,this.itemsChangedEmitter.emit(a.nextEventID())}setFastMode(e){this.fastMode=e,this.itemsChangedEmitter.emit(a.nextEventID())}async runBulkSim(e){this.pendingResults.setPending();try{const t=await this.simUI.sim.runBulkSim(this.createBulkSettings(),this.createBulkItemsDatabase(),e);t.error?.type==W.ErrorOutcomeAborted&&new gn({variant:"info",body:"Bulk sim cancelled."})}catch(t){this.simUI.handleCrash(t)}}buildTabContent(){const s=new lh(this.column1,"bulk-items",{header:{title:"Items"}});s.bodyElement.classList.add("gear-picker-root","gear-picker-root-bulk");const a=e("div",{className:"bulk-items-text-line"},e("i",null,"Notice: This is under very early but active development and experimental. You may also need to update your WoW AddOn if you want to import your bags.")),i=e("div",{className:"tab-panel-col bulk-gear-combo"});this.itemsChangedEmitter.on((()=>{const t=e(b,null);if(this.items.length){a.textContent="The following items will be simmed together with your equipped gear.";for(let e=0;e<this.items.length;++e){const s=this.items[e],a=this.simUI.sim.db.lookupItemSpec(s);new Nh(t,this.simUI,this,a,e)}}i.replaceChildren(t)})),s.bodyElement.appendChild(e(b,null,a,i)),this.clearItems();const n=new lh(this.column1,"bulk-results",{header:{title:"Results",extraCssClasses:["bulk-results-header"]}});n.rootElem.hidden=!0,n.bodyElement.classList.add("gear-picker-root","gear-picker-root-bulk","tab-panel-col"),this.simUI.sim.bulkSimStartEmitter.on((()=>{n.rootElem.hidden=!0})),this.simUI.sim.bulkSimResultEmitter.on(((e,t)=>{n.rootElem.hidden=0==t.results.length,n.bodyElement.replaceChildren();for(const s of t.results){const e=new lh(n.bodyElement,"bulk-result",{header:{title:""},bodyClasses:["bulk-results-body"]});new _h(e.bodyElement,this.simUI,s,t.equippedGearResult)}}));const o=new lh(this.rightPanel,"bulk-settings",{header:{title:"Setup"}}),l=e("button",{className:"btn btn-primary w-100 bulk-settings-button"},"Simulate Batch");let r=!1;l.addEventListener("click",(async()=>{if(r)return;r=!0,l.disabled=!0,this.pendingDiv.classList.remove("hide"),this.leftPanel.classList.add("blurred"),this.rightPanel.classList.add("blurred");const t=ws(l);l.disabled=!0,l.classList.add("disabled"),l.replaceChildren(e(b,null,e("i",{className:"fa fa-spinner fa-spin"})," Running"));let s=!1;try{await this.simUI.sim.signalManager.abortType(ze.All),this.pendingResults.addAbortButton((async()=>{if(!s)try{s=!0,await this.simUI.sim.signalManager.abortType(ze.BulkSim)}catch(e){console.error("Error on bulk sim abort!"),console.error(e)}finally{s=!1,r||(l.disabled=!1)}}));let e=(new Date).getTime(),t=0,a=0,i=0,n=0;await this.runBulkSim((s=>{const o=(new Date).getTime()-e,l=s.completedIterations/(o/1e3);0===n&&(n=s.totalSims),this.fastMode&&(0===a&&s.totalSims>0&&(a=Math.ceil(Math.log(s.totalSims/20)/Math.log(2))+1,i=1),s.totalSims<t&&(i+=1,e=(new Date).getTime())),this.setSimProgress(s,l,i,a,n),t=s.totalSims}))}catch(a){console.error(a)}finally{r=!1,s||(l.disabled=!1),this.pendingDiv.classList.add("hide"),this.leftPanel.classList.remove("blurred"),this.rightPanel.classList.remove("blurred"),this.pendingResults.hideAll(),l.classList.remove("disabled"),l.replaceChildren(...t)}}));const c=e("button",{className:"btn btn-secondary w-100 bulk-settings-button"},e("i",{className:"fa fa-download"})," Import From Bags");c.addEventListener("click",(()=>new Lh(this.simUI.rootElem,this.simUI,this).open()));const d=e("button",{className:"btn btn-secondary w-100 bulk-settings-button"},e("i",{className:"fa fa-download"})," Import Favorites");d.addEventListener("click",(()=>{const e=this.simUI.player.sim.getFilters().favoriteItems.map((e=>Kt.create({id:e})));this.addItems(e)}));const h=g(),m=g(),u=e("div",{className:"search-wrapper hide"},e("input",{ref:h,type:"text",placeholder:"Search...",className:"batch-search-input form-control hide"}),e("ul",{ref:m,className:"batch-search-results hide"}));let p=Array();h.value?.addEventListener("keyup",(e=>{if("Enter"==e.key){const e=Array();m.value?.childNodes.forEach((t=>{const s=t.getAttribute("data-item-id");null!=s&&e.push(Kt.create({id:Number.parseInt(s)}))})),this.addItems(e)}})),h.value?.addEventListener("input",(t=>{const s=h.value?.value||"";if(!s.length)return m.value?.replaceChildren(),void m.value?.classList.add("hide");const a=s.split(" "),i=e(b,null);p.forEach((t=>{let s=!0;const n=t.name.toLowerCase(),o=t.setName.toLowerCase();if(a.forEach((e=>{const t=e.toLowerCase();return!(!n.includes(t)&&!o.includes(t))||(s=!1,!1)})),s){const s=g(),a=g();i.appendChild(e("li",{ref:s,dataset:{itemId:t.id.toString()}},e("span",{ref:a},t.name),t.heroic&&e("span",{className:"item-quality-uncommon"},"[H]"),t.factionRestriction===Q.HORDE_ONLY&&e("span",{className:"faction-horde"},"(H)"),t.factionRestriction===Q.ALLIANCE_ONLY&&e("span",{className:"faction-alliance"},"(A)"))),oh(a.value,t.quality),s.value?.addEventListener("click",(()=>this.addItem(Kt.create({id:t.id}))))}})),m.value?.replaceChildren(i),m.value?.classList.remove("hide")}));const f=e(b,null,e("i",{className:"fa fa-search"})," Add Item"),I=e("button",{className:"btn btn-secondary w-100 bulk-settings-button"},f.cloneNode(!0));I.addEventListener("click",(()=>{h.value?.classList.contains("hide")?(u?.classList.remove("hide"),I.replaceChildren(e(b,null,"Close Search Results")),p=this.simUI.sim.db.getAllItems().filter((e=>M(this.simUI.player,e,void 0))),h.value?.classList.remove("hide"),h.value?.value&&m.value?.classList.remove("hide"),h.value?.focus()):(I.replaceChildren(f.cloneNode(!0)),u?.classList.add("hide"),h.value?.classList.add("hide"),m.value?.replaceChildren(),m.value?.classList.add("hide"))}));const w=e("button",{className:"btn btn-secondary w-100 bulk-settings-button"},"Clear all");w.addEventListener("click",(()=>{this.clearItems(),n.rootElem.hidden=!0,n.bodyElement.replaceChildren()}));const S=g(),x=e("div",{className:t("talents-picker-container",!this.simTalents&&"hide")},e("label",{className:"mb-2"},"Pick talents to sim (will increase time to sim)"),e("div",{ref:S,className:"talents-container"})),v=window.localStorage.getItem(this.simUI.getSavedTalentsStorageKey());let y;try{null!==v&&(y=JSON.parse(v))}catch(k){console.warn("Invalid json for local storage value: "+v)}const E=(e,t)=>{const s=e.querySelector(".saved-data-set-chip");if(this.savedTalents.some((e=>e.name===t.name))){const e=this.savedTalents.findIndex((e=>e.name===t.name));this.savedTalents.splice(e,1),s?.classList.remove("active")}else this.savedTalents.push(t),s?.classList.add("active")};for(const g in y)try{const s={talentsString:bs.fromJson(y[g]).talentsString,name:g},a=this.savedTalents.findIndex((e=>JSON.stringify(e)===JSON.stringify(s))),i=e("div",{className:t("saved-data-set-chip badge rounded-pill",-1!==a&&"active")},e("a",{href:"javascript:void(0)",className:"saved-data-set-name",attributes:{role:"button"}},g));S.value.appendChild(i),i.addEventListener("click",(()=>E(i,s)))}catch(k){console.log(k),console.warn("Failed parsing saved data: "+y[g])}o.bodyElement.appendChild(e(b,null,l,c,d,I,u,w,x)),new Et(o.bodyElement,this,{id:"bulk-fast-mode",label:"Fast Mode",labelTooltip:"Fast mode reduces accuracy but will run faster.",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.fastMode,setValue:(e,t,s)=>{t.fastMode=s}}),new Et(o.bodyElement,this,{id:"bulk-combinations",label:"Combinations",labelTooltip:"When checked bulk simulator will create all possible combinations of the items. When disabled trinkets and rings will still run all combinations becausee they have two slots to fill each.",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.doCombos,setValue:(e,t,s)=>{t.doCombos=s}}),new Et(o.bodyElement,this,{id:"bulk-auto-enchant",label:"Auto Enchant",labelTooltip:"When checked bulk simulator apply the current enchant for a slot to each replacement item it can.",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.autoEnchant,setValue:(e,t,s)=>{t.autoEnchant=s}}),new Et(o.bodyElement,this,{id:"bulk-sim-talents",label:"Sim Talents",labelTooltip:"When checked bulk simulator will sim chosen talent setups. Warning, it might cause the bulk sim to run for a lot longer",changedEvent:e=>this.itemsChangedEmitter,getValue:e=>this.simTalents,setValue:(e,t,s)=>{t.simTalents=s,x.classList[s?"remove":"add"]("hide")}})}setSimProgress(t,s,a,i,n){const o=((t.totalIterations-t.completedIterations)/s).toFixed();this.pendingResults.setContent(e("div",{className:"results-sim"},e("div",null,n," total combinations."),e("div",null,i>0&&e(b,null,a," / ",i," refining rounds")),e("div",null,t.completedSims," / ",t.totalSims,e("br",null),"simulations complete"),e("div",null,t.completedIterations," / ",t.totalIterations,e("br",null),"iterations complete"),e("div",null,o," seconds remaining.")))}}class eg extends ch{constructor(t,s){if(super(t,"exporter",{title:s.title,header:!0,footer:!0}),this.changedEvent=new a,this.textElem=e("textarea",{spellcheck:!1,className:"exporter-textarea form-control"}),this.body.append(this.textElem),new En(this.footer,{extraCssClasses:["btn-primary","me-2"],getContent:()=>this.textElem.innerHTML,text:"Copy",tooltip:"Copy to clipboard"}),s.allowDownload){const t=g();this.footer.appendChild(e("button",{className:"exporter-button btn btn-primary download-button",ref:t},e("i",{className:"fa fa-download me-1"}),"Download"));t.value.addEventListener("click",(e=>{const t=this.textElem.textContent;Ss(t,"wowsims.json")}))}}open(){super.open(),this.init()}init(){this.changedEvent.on((()=>this.updateContent())),this.updateContent()}updateContent(){this.textElem.textContent=this.getData()}}const tg=class t extends eg{constructor(s,a,i){super(s,i),this.simUI=a;const n={};if(r(fn).forEach((e=>n[e]=Ah.DEFAULT_CATEGORIES.includes(e))),this.exportCategories=n,i.selectCategories){const s=e("div",{className:"exporter-category-pickers"});this.body.prepend(s),t.exportPickerConfigs.forEach((e=>{const t=e.category;new Et(s,this,{id:`link-exporter-${t}`,label:e.label,labelTooltip:e.labelTooltip,inline:!0,getValue:()=>this.exportCategories[t],setValue:(e,s,a)=>{this.exportCategories[t]=a,this.changedEvent.emit(e)},changedEvent:()=>this.changedEvent})}))}}};tg.exportPickerConfigs=[{category:fn.Gear,label:"Gear",labelTooltip:"Also includes bonus stats and weapon swaps."},{category:fn.Talents,label:"Talents",labelTooltip:"Talents and Glyphs."},{category:fn.Rotation,label:"Rotation",labelTooltip:"Includes everything found in the Rotation tab."},{category:fn.Consumes,label:"Consumes",labelTooltip:"Flask, pots, food, etc."},{category:fn.External,label:"Buffs & Debuffs",labelTooltip:"All settings which are applied by other raid members."},{category:fn.Miscellaneous,label:"Misc",labelTooltip:"Spec-specific settings, front/back of target, distance from target, etc."},{category:fn.Encounter,label:"Encounter",labelTooltip:"Fight-related settings."}];let sg=tg;const ag=class e extends sg{constructor(e,t){super(e,t,{title:"Sixty Upgrades EP Export",allowDownload:!0})}getData(){const t=this.simUI.player,s=t.getEpWeights(),a=vn.getAll(),i={};return a.forEach((t=>{const a=e.getName(t),n=s.getUnitStat(t);0!=n&&""!=a&&(i[a]?i[a]+=n:i[a]=n)})),`https://sixtyupgrades.com/sod/ep/import?name=${encodeURIComponent(`${xs[t.spec]} WoWSims Weights`)}`+Object.keys(i).map((e=>`&${e}=${i[e].toFixed(3)}`)).join("")}static getName(t){return t.isStat()?e.statNames[t.getStat()]:e.pseudoStatNames[t.getPseudoStat()]||""}};ag.statNames={[c.StatStrength]:"strength",[c.StatAgility]:"agility",[c.StatStamina]:"stamina",[c.StatIntellect]:"intellect",[c.StatSpirit]:"spirit",[c.StatSpellPower]:"spellPower",[c.StatSpellDamage]:"spellDamage",[c.StatArcanePower]:"arcaneDamage",[c.StatHolyPower]:"holyDamage",[c.StatFirePower]:"fireDamage",[c.StatFrostPower]:"frostDamage",[c.StatNaturePower]:"natureDamage",[c.StatShadowPower]:"shadowDamage",[c.StatMP5]:"mp5",[c.StatSpellHit]:"spellHit",[c.StatSpellCrit]:"spellCrit",[c.StatSpellHaste]:"spellHaste",[c.StatSpellPenetration]:"spellPen",[c.StatAttackPower]:"attackPower",[c.StatMeleeHit]:"hit",[c.StatMeleeCrit]:"crit",[c.StatMeleeHaste]:"haste",[c.StatArmorPenetration]:"armorPen",[c.StatExpertise]:"expertise",[c.StatMana]:"mana",[c.StatEnergy]:"energy",[c.StatRage]:"rage",[c.StatArmor]:"armor",[c.StatRangedAttackPower]:"attackPower",[c.StatDefense]:"defense",[c.StatBlock]:"block",[c.StatBlockValue]:"blockValue",[c.StatDodge]:"dodge",[c.StatParry]:"parry",[c.StatResilience]:"resilience",[c.StatHealth]:"health",[c.StatArcaneResistance]:"arcaneResistance",[c.StatFireResistance]:"fireResistance",[c.StatFrostResistance]:"frostResistance",[c.StatNatureResistance]:"natureResistance",[c.StatShadowResistance]:"shadowResistance",[c.StatBonusArmor]:"armorBonus",[c.StatHealingPower]:"healing",[c.StatFeralAttackPower]:"feralAttackPower"},ag.pseudoStatNames={[d.PseudoStatMainHandDps]:"dps",[d.PseudoStatRangedDps]:"rangedDps",[d.PseudoStatUnarmedSkill]:"unarmedSkill",[d.PseudoStatDaggersSkill]:"daggerSkill",[d.PseudoStatSwordsSkill]:"swordSkill",[d.PseudoStatMacesSkill]:"maceSkill",[d.PseudoStatAxesSkill]:"axeSkill",[d.PseudoStatTwoHandedSwordsSkill]:"sword2hSkill",[d.PseudoStatTwoHandedMacesSkill]:"mace2hSkill",[d.PseudoStatTwoHandedAxesSkill]:"axe2hSkill",[d.PseudoStatPolearmsSkill]:"polearmSkill",[d.PseudoStatStavesSkill]:"staffSkill",[d.PseudoStatBowsSkill]:"bowSkill",[d.PseudoStatCrossbowsSkill]:"crossbowSkill",[d.PseudoStatGunsSkill]:"gunSkill",[d.PseudoStatThrownSkill]:"thrownSkill"};let ig=ag;class ng extends sg{constructor(e,t){super(e,t,{title:"JSON Export",allowDownload:!0,selectCategories:!0})}getData(){return ng.getData(this.simUI,r(fn).filter((e=>this.exportCategories[e])))}static getData(e,t){return t||(t=Ah.DEFAULT_CATEGORIES),vs(hs.toJson(e.toProto(t)),2,((e,t)=>!!["stats","pseudoStats"].includes(t[t.length-1])||(["player","equipment","items"].every(((e,s)=>t[s]==e))||!("player"!=t[0]||"rotation"!=t[1]||!["prepullActions","priorityList"].includes(t[2])))&&t.length>3))}}class og extends sg{constructor(e,t){super(e,t,{title:"Shareable Link",selectCategories:!0})}getData(){return og.createLink(this.simUI,r(fn).filter((e=>this.exportCategories[e])))}static createLink(e,t){t||(t=Ah.DEFAULT_CATEGORIES);const s=e.toProto(t),a=hs.toBinary(s),i=Zp.deflate(a,{to:"string"}),n=btoa(String.fromCharCode(...i)),o=new URL(window.location.href);if(o.hash=n,ys(t,Ah.DEFAULT_CATEGORIES))o.searchParams.delete(Ah.CATEGORY_PARAM);else{const e=t.map((e=>In.get(e))).join("");o.searchParams.set(Ah.CATEGORY_PARAM,e)}return o.toString()}}const lg=class e extends sg{constructor(e,t){super(e,t,{title:"Pawn EP Export",allowDownload:!0})}getData(){const t=this.simUI.player,s=t.getEpWeights(),a=vn.getAll(),i={};return a.forEach((t=>{const a=e.getName(t),n=s.getUnitStat(t);0!=n&&""!=a&&(i[a]?i[a]+=n:i[a]=n)})),`( Pawn: v1: "${xs[t.spec]} WoWSims Weights": Class=${ns.get(t.getClass())},`+Object.keys(i).map((e=>`${e}=${i[e].toFixed(3)}`)).join(",")+" )"}static getName(t){return t.isStat()?e.statNames[t.getStat()]:e.pseudoStatNames[t.getPseudoStat()]||""}};lg.statNames={[c.StatStrength]:"Strength",[c.StatAgility]:"Agility",[c.StatStamina]:"Stamina",[c.StatIntellect]:"Intellect",[c.StatSpirit]:"Spirit",[c.StatSpellPower]:"SpellDamage",[c.StatSpellDamage]:"SpellDamage",[c.StatArcanePower]:"ArcaneSpellDamage",[c.StatFirePower]:"FireSpellDamage",[c.StatFrostPower]:"FrostSpellDamage",[c.StatHolyPower]:"HolySpellDamage",[c.StatNaturePower]:"NatureSpellDamage",[c.StatShadowPower]:"ShadowSpellDamage",[c.StatMP5]:"Mp5",[c.StatSpellHit]:"SpellHitRating",[c.StatSpellCrit]:"SpellCritRating",[c.StatSpellHaste]:"SpellHasteRating",[c.StatSpellPenetration]:"SpellPen",[c.StatAttackPower]:"Ap",[c.StatMeleeHit]:"HitRating",[c.StatMeleeCrit]:"CritRating",[c.StatMeleeHaste]:"HasteRating",[c.StatArmorPenetration]:"ArmorPenetration",[c.StatExpertise]:"ExpertiseRating",[c.StatMana]:"Mana",[c.StatEnergy]:"Energy",[c.StatRage]:"Rage",[c.StatArmor]:"Armor",[c.StatRangedAttackPower]:"Ap",[c.StatDefense]:"DefenseRating",[c.StatBlock]:"BlockRating",[c.StatBlockValue]:"BlockValue",[c.StatDodge]:"DodgeRating",[c.StatParry]:"ParryRating",[c.StatResilience]:"ResilienceRating",[c.StatHealth]:"Health",[c.StatArcaneResistance]:"ArcaneResistance",[c.StatFireResistance]:"FireResistance",[c.StatFrostResistance]:"FrostResistance",[c.StatNatureResistance]:"NatureResistance",[c.StatShadowResistance]:"ShadowResistance",[c.StatBonusArmor]:"Armor2",[c.StatHealingPower]:"Healing",[c.StatFeralAttackPower]:"FeralAttackPower"},lg.pseudoStatNames={[d.PseudoStatMainHandDps]:"MeleeDps",[d.PseudoStatRangedDps]:"RangedDps"};let rg=lg;class cg extends p{constructor(t,s,a){super(t,"saved-data-manager-root"),this.modObject=s,this.config=a,this.userData=[],this.presets=[],this.frozen=!1;const i=new lh(this.rootElem,"saved-data",{header:a.header}),n=g(),o=g(),l=g();i.bodyElement.replaceChildren(e("div",{ref:n,className:"saved-data-container hide"},e("div",{ref:o,className:"saved-data-presets"}),e("div",{ref:l,className:"saved-data-custom"}))),this.savedDataDiv=n.value,this.presetDataDiv=o.value,this.customDataDiv=l.value,a.presetsOnly||i.bodyElement.appendChild(this.buildCreateContainer())}addSavedData(e){this.savedDataDiv.classList.remove("hide");const t=this.makeSavedData(e),s=e.isPreset?this.presets:this.userData,a=s.findIndex((t=>t.name==e.name));-1==a?(e.isPreset?this.presetDataDiv.appendChild(t.elem):this.customDataDiv.appendChild(t.elem),s.push(t)):(s[a].elem.replaceWith(t.elem),s[a]=t)}makeSavedData(t){const s=g(),i=e("div",{className:"saved-data-set-chip badge rounded-pill"},e("a",{href:"javascript:void(0)",className:"saved-data-set-name",attributes:{role:"button"}},t.name),!t.isPreset&&e("a",{ref:s,href:"javascript:void(0)",className:"saved-data-set-delete",attributes:{role:"button"}},e("i",{className:"fa fa-times fa-lg"})));if(i.addEventListener("click",(()=>{this.config.setData(a.nextEventID(),this.modObject,t.data),t.onLoad?.(this.modObject),this.saveInput&&(this.saveInput.value=t.name)})),!t.isPreset&&s.value){const e=mn(s.value,{content:`Delete saved ${this.config.label}`});s.value.addEventListener("click",(s=>{s.stopPropagation();if(!confirm(`Delete saved ${this.config.label} '${t.name}'?`))return;e.destroy();const a=this.userData.findIndex((e=>e.name==t.name));this.userData[a].elem.remove(),this.userData.splice(a,1),this.saveUserData()}))}t.tooltip&&mn(i,{content:t.tooltip,placement:"bottom"});const n=()=>{this.config.equals(t.data,this.config.getData(this.modObject))?(i.classList.add("active"),this.saveInput&&(this.saveInput.value=t.name)):i.classList.remove("active"),t.enableWhen&&!t.enableWhen(this.modObject)?i.classList.add("disabled"):i.classList.remove("disabled")};return n(),this.config.changeEmitters.forEach((e=>e.on(n))),{name:t.name,data:t.data,elem:i,enableWhen:t.enableWhen,onLoad:t.onLoad}}saveUserData(){const e={};this.userData.forEach((t=>{e[t.name]=this.config.toJson(t.data)})),0==this.userData.length&&0==this.presets.length&&this.savedDataDiv.classList.add("hide"),window.localStorage.setItem(this.config.storageKey,JSON.stringify(e))}loadUserData(){const e=window.localStorage.getItem(this.config.storageKey);if(!e)return;let t;try{t=JSON.parse(e)}catch(s){console.warn("Invalid json for local storage value: "+e)}for(const a in t)try{this.addSavedData({name:a,data:this.config.fromJson(t[a])})}catch(s){console.warn("Failed parsing saved data: "+t[a])}}freeze(){this.frozen=!0,this.rootElem.classList.add("frozen")}buildCreateContainer(){const t=g(),s=g(),a=e("div",{className:"saved-data-create-container"},e("label",{className:"form-label"},this.config.label," Name"),e("input",{ref:s,className:"saved-data-save-input form-control",type:"text",placeholder:"Name"}),e("button",{ref:t,className:"saved-data-save-button btn btn-primary"},"Save ",this.config.label));return this.saveInput=s.value,t.value?.addEventListener("click",(()=>{if(this.frozen)return;const e=this.saveInput?.value;e?e in this.presets?alert(`${this.config.label} with name ${e} already exists.`):(this.addSavedData({name:e,data:this.config.getData(this.modObject)}),this.saveUserData()):alert(`Choose a label for your saved ${this.config.label}!`)})),a}}class dg extends p{constructor(t,s,i){if(super(t,"preset-configuration-picker-root"),this.rootElem.classList.add("saved-data-manager-root"),this.simUI=s,this.builds=(this.simUI.individualConfig.presets.builds??[]).filter((e=>Object.keys(e).some((t=>i?.includes(t)&&!!e[t])))),!this.builds.length)return void this.rootElem.classList.add("hide");const n=new lh(this.rootElem,"saved-data",{header:{title:"Preset Configurations",tooltip:"Preset configurations can apply an optimal combination of gear, talents, rotation and encounter settings."}}),o=g(),l=e("div",{className:"saved-data-container"},e("div",{className:"saved-data-presets",ref:o}));this.simUI.sim.waitForInit().then((()=>{this.builds.forEach((t=>{const s=g();o.value.appendChild(e("button",{className:"saved-data-set-chip badge rounded-pill",ref:s},e("span",{className:"saved-data-set-name",attributes:{role:"button"},onclick:()=>this.applyBuild(t)},t.name))),mn(s.value,{content:e(b,null,e("p",{className:"mb-1"},"This preset affects the following settings:"),e("ul",{className:"mb-0 text-capitalize"},Object.keys(t).filter((e=>"name"!==e)).map((s=>t[s]?e("li",null,s):void 0))))});const i=()=>s.value.classList[this.isBuildActive(t)?"add":"remove"]("active");i(),a.onAny([this.simUI.player.changeEmitter,this.simUI.sim.settingsChangeEmitter,this.simUI.sim.raid.changeEmitter,this.simUI.sim.encounter.changeEmitter]).on(i)})),n.bodyElement.replaceChildren(l)}))}applyBuild({gear:e,rotation:t,rotationType:s,talents:i,epWeights:n,encounter:o,race:l,options:r}){const c=a.nextEventID();a.freezeAllAndDo((()=>{e&&this.simUI.player.setGear(c,this.simUI.sim.db.lookupEquipmentSpec(e.gear)),l&&this.simUI.player.setRace(c,l),i&&this.simUI.player.setTalentsString(c,i.data.talentsString),s?(this.simUI.player.aplRotation.type=s,this.simUI.player.rotationChangeEmitter.emit(c)):t?.rotation.rotation&&this.simUI.player.setAplRotation(c,t.rotation.rotation),n&&this.simUI.player.setEpWeights(c,n.epWeights),o&&(o.encounter&&this.simUI.sim.encounter.fromProto(c,o.encounter),o.healingModel&&this.simUI.player.setHealingModel(c,o.healingModel),o.tanks&&this.simUI.sim.raid.setTanks(c,o.tanks),o.buffs&&this.simUI.player.setBuffs(c,o.buffs),o.debuffs&&this.simUI.sim.raid.setDebuffs(c,o.debuffs),o.raidBuffs&&this.simUI.sim.raid.setBuffs(c,o.raidBuffs),o.consumes&&this.simUI.player.setConsumes(c,o.consumes)),r&&this.simUI.player.setSpecOptions(c,{...this.simUI.player.getSpecOptions(),...r})}))}isBuildActive({gear:e,rotation:t,rotationType:s,talents:a,epWeights:i,encounter:n,race:o,options:l}){const r=!e||os.equals(e.gear,this.simUI.player.getGear().asSpec()),c="number"!=typeof o||o===this.simUI.player.getRace(),d=!a||bs.equals(a.data,bs.create({talentsString:this.simUI.player.getTalentsString()}));let h=!0;if(s)h=s===this.simUI.player.getRotationType();else if(t){const e=this.simUI.player.getResolvedAplRotation();e.type===K.TypeAuto&&(e.type=K.TypeAPL),h=t.rotation?.rotation?.type===K.TypeSimple&&t.rotation.rotation?.simple?.specRotationJson?this.simUI.player.specTypeFunctions.rotationEquals(this.simUI.player.specTypeFunctions.rotationFromJson(JSON.parse(t.rotation.rotation.simple.specRotationJson)),this.simUI.player.getSimpleRotation()):N.equals(t.rotation.rotation,e)}const m=!i||this.simUI.player.getEpWeights().equals(i.epWeights),u=!n?.encounter||pe.equals(n.encounter,this.simUI.sim.encounter.toProto()),p=!n?.healingModel||_.equals(n.healingModel,this.simUI.player.getHealingModel()),g=!l||this.containsAllFields(this.simUI.player.getSpecOptions(),l);return r&&c&&d&&h&&m&&u&&p&&g}containsAllFields(e,t){return Object.keys(t).every((s=>s in e&&e[s]===t[s]))}}class hg extends kh{constructor(e,t){super(e,t,{identifier:"gear-tab",title:"Gear"}),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("gear-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("gear-tab-right","tab-panel-right"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildGearPickers(),this.buildPresetConfigurationPicker(),this.buildSavedGearsetPicker()}buildGearPickers(){new Ph(this.leftPanel,this.simUI,this.simUI.player)}buildPresetConfigurationPicker(){new dg(this.rightPanel,this.simUI,["gear"])}buildSavedGearsetPicker(){const e=new cg(this.rightPanel,this.simUI.player,{header:{title:"Gear Sets"},label:"Gear Set",storageKey:this.simUI.getSavedGearStorageKey(),getData:e=>Es.create({gear:e.getGear().asSpec(),bonusStatsStats:e.getBonusStats().toProto()}),setData:(e,t,s)=>{a.freezeAllAndDo((()=>{t.setGear(e,this.simUI.sim.db.lookupEquipmentSpec(s.gear||os.create())),t.setBonusStats(e,yn.fromProto(s.bonusStatsStats||u.create()))}))},changeEmitters:[this.simUI.player.changeEmitter],equals:(e,t)=>Es.equals(e,t),toJson:e=>Es.toJson(e),fromJson:e=>Es.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),this.simUI.individualConfig.presets.gear.forEach((t=>{e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:Es.create({gear:this.simUI.sim.db.lookupEquipmentSpec(t.gear).asSpec(),bonusStatsStats:(new yn).toProto()}),enableWhen:t.enableWhen})}))}))}}class mg extends f{constructor(e,t,s){super(e,"adaptive-string-picker-root",t,s),this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.id=s.id,this.inputElem.classList.add("form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(()=>{this.inputChanged(a.nextEventID())}),{signal:this.signal}),this.inputElem.addEventListener("input",(()=>{this.updateSize()}),{signal:this.signal}),this.updateSize()}getInputElem(){return this.inputElem}getInputValue(){return this.inputElem.value}setInputValue(e){this.inputElem.value=e,this.updateSize()}updateSize(){const e=Math.max(3,this.inputElem.value.length);this.inputElem.size!=e&&(this.inputElem.size=e)}}const ug={actions:{create:{useIcon:!1}}};let pg=null;class gg extends f{constructor(t,s,i){if(i.isCompact&&(i.extraCssClasses=[...i.extraCssClasses||[],"list-picker-compact"]),super(t,"list-picker-root",s,i),this.config={...ug,...i},this.itemPickerPairs=[],this.rootElem.appendChild(e(b,null,i.title&&e("label",{className:"list-picker-title form-label"},i.title),e("div",{className:"list-picker-items"}))),this.config.hideUi&&this.rootElem.classList.add("d-none"),this.config.horizontalLayout&&(this.config.inlineMenuBar=!0,this.rootElem.classList.add("horizontal")),this.config.titleTooltip){const e=mn(this.rootElem.querySelector(".list-picker-title"),{content:this.config.titleTooltip});this.addOnDisposeCallback((()=>e?.destroy()))}if(this.itemsDiv=this.rootElem.getElementsByClassName("list-picker-items")[0],this.actionEnabled("create")){let t=null,s=null;this.config.actions?.create?.useIcon?(t=gg.makeActionElem("link-success","fa-plus"),s=mn(t,{allowHTML:!1,content:`New ${i.itemLabel}`}),this.addOnDisposeCallback((()=>s?.destroy()))):t=e("button",{className:"btn btn-primary"},"New ",i.itemLabel),t.classList.add("list-picker-new-button"),t.addEventListener("click",(()=>{const e=this.config.newItem(),t=this.config.getValue(this.modObject).concat([e]);this.config.setValue(a.nextEventID(),this.modObject,t),s&&s.hide()}),{signal:this.signal}),this.rootElem.appendChild(t)}this.init()}getInputElem(){return this.rootElem}getInputValue(){return this.itemPickerPairs.map((e=>e.picker.getInputValue()))}setInputValue(e){if(e.length<this.itemPickerPairs.length)this.itemPickerPairs.slice(e.length).forEach((e=>e.elem.remove())),this.itemPickerPairs=this.itemPickerPairs.slice(0,e.length);else if(e.length>this.itemPickerPairs.length){const t=e.length-this.itemPickerPairs.length;for(let e=0;e<t;e++)this.addNewPicker()}e.forEach(((e,t)=>this.itemPickerPairs[t].picker.setInputValue(e)))}actionEnabled(e){return!this.config.allowedActions||this.config.allowedActions.includes(e)}addNewPicker(){const e=this.itemPickerPairs.length,t=document.createElement("div");t.classList.add("list-picker-item-container"),this.config.inlineMenuBar&&t.classList.add("inline"),this.itemsDiv.appendChild(t);const s=document.createElement("div");s.classList.add("list-picker-item");const i=document.createElement("div");if(i.classList.add("list-picker-item-header"),this.config.inlineMenuBar)t.appendChild(s),t.appendChild(i);else if(t.appendChild(i),t.appendChild(s),this.config.itemLabel){const e=document.createElement("h6");e.classList.add("list-picker-item-title"),e.textContent=`${this.config.itemLabel} ${this.itemPickerPairs.length+1}`,i.appendChild(e)}const n=this.config.newItemPicker(s,this,e,{changedEvent:this.config.changedEvent,getValue:()=>this.getSourceValue()[e],setValue:(t,s,a)=>{const i=this.getSourceValue();i[e]=a,this.config.setValue(t,s,i)}}),o={elem:t,picker:n,idx:e};if(this.actionEnabled("move")){const s=gg.makeActionElem("list-picker-item-move","fa-arrows-up-down");i.appendChild(s);const n=mn(s,{allowHTML:!1,content:"Move (Drag+Drop)"});s.addEventListener("click",(()=>{n.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>{n?.destroy()})),s.draggable=!0,s.addEventListener("dragstart",(e=>{e.target==s&&(e.dataTransfer.dropEffect="move",e.dataTransfer.effectAllowed="move",t.classList.add("dragfrom"),pg={listPicker:this,item:o})}),{signal:this.signal});let l=0;t.addEventListener("dragenter",(e=>{pg&&pg.listPicker==this&&(e.preventDefault(),l++,t.classList.add("dragto"))}),{signal:this.signal}),t.addEventListener("dragleave",(e=>{pg&&pg.listPicker==this&&(e.preventDefault(),l--,l<=0&&t.classList.remove("dragto"))}),{signal:this.signal}),t.addEventListener("dragover",(e=>{pg&&pg.listPicker==this&&e.preventDefault()}),{signal:this.signal}),t.addEventListener("drop",(s=>{if(!pg||pg.listPicker!=this)return;s.preventDefault(),l=0,t.classList.remove("dragto"),pg.item.elem.classList.remove("dragfrom");const i=pg.item.idx,n=e,o=this.config.getValue(this.modObject),r=o[i];o.splice(i,1),o.splice(n,0,r),this.config.setValue(a.nextEventID(),this.modObject,o),pg=null}),{signal:this.signal})}if(this.actionEnabled("copy")){const t=gg.makeActionElem("list-picker-item-copy","fa-copy");i.appendChild(t);const s=mn(t,{allowHTML:!1,content:`Copy to New ${this.config.itemLabel}`});t.addEventListener("click",(()=>{const t=this.config.getValue(this.modObject).slice();t.splice(e,0,this.config.copyItem(t[e])),this.config.setValue(a.nextEventID(),this.modObject,t),s.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>s?.destroy()))}if(this.actionEnabled("delete")&&(!this.config.minimumItems||e+1>this.config.minimumItems)){const t=gg.makeActionElem("list-picker-item-delete","fa-times");t.classList.add("link-danger"),i.appendChild(t);const s=mn(t,{allowHTML:!1,content:`Delete ${this.config.itemLabel}`});t.addEventListener("click",(()=>{const t=this.config.getValue(this.modObject);t.splice(e,1),this.config.setValue(a.nextEventID(),this.modObject,t),s.hide()}),{signal:this.signal}),this.addOnDisposeCallback((()=>s?.destroy()))}this.itemPickerPairs.push(o)}static makeActionElem(s,a){return e("a",{href:"javascript:void(0)",className:t("list-picker-item-action",s),attributes:{role:"button"}},e("i",{className:t("fa","fa-xl",a)}))}static getItemHeaderElem(e){const t=e.rootElem.parentElement,s=t.nextElementSibling||t.previousElementSibling;if(!s?.classList.contains("list-picker-item-header"))throw new Error("Could not find list item header");return s}}const fg={auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),a=new RegExp(`${s} \\(Rank [0-9]+\\)`),i=e.getAuras().filter((e=>!!e.id.name.match(a))).length>1;return{value:t.id,submenu:i?[t.id.name.replace(/ \(Rank \d+\)/g,"")]:[]}}))},stackable_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.maxStacks>0)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),a=new RegExp(`${s} \\(Rank [0-9]+\\)`),i=e.getAuras().filter((e=>!!e.id.name.match(a))).length>1;return{value:t.id,submenu:i?[s]:[]}}))},icd_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.hasIcd)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),a=new RegExp(`${s} \\(Rank [0-9]+\\)`),i=e.getAuras().filter((e=>!!e.id.name.match(a))).length>1;return{value:t.id,submenu:i?[s]:[]}}))},exclusive_effect_auras:{defaultLabel:"Aura",getActionIDs:async e=>e.getAuras().filter((e=>e.data.hasExclusiveEffect)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),a=new RegExp(`${s} \\(Rank [0-9]+\\)`),i=e.getAuras().filter((e=>!!e.id.name.match(a))).length>1;return{value:t.id,submenu:i?[s]:[]}}))},castable_spells:{defaultLabel:"Spell",getActionIDs:async e=>{const t=e.getSpells().filter((e=>e.data.isCastable)),{spells:s,cooldowns:a}=Ns(t,(e=>e.data.isMajorCooldown?"cooldowns":"spells")),i=[[_s.OtherActionPotion,"Uses the potion selected in consumables settings."],[_s.OtherActionOffensiveEquip,"Use any offensive on-use equipment."],[_s.OtherActionDefensiveEquip,"Use any defensive on-use equipment."]];return[[{value:x.fromEmpty(),headerText:"Spells",submenu:["Spells"]}],(s||[]).map((e=>{const t=e.id.name.replace(/ \(Rank \d+\)/g,""),a=new RegExp(`${t.replace("(","\\(").replace(")","\\)")} \\(Rank [0-9]+\\)`),i=s.filter((e=>!!e.id.name.match(a))).length>1;return{value:e.id,submenu:i?["Spells",t]:["Spells"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]}})),[{value:x.fromEmpty(),headerText:"Cooldowns",submenu:["Cooldowns"]}],(a||[]).map((e=>{const t=e.id.name.replace(/ \([\w\s%]+\)/g,""),s=new RegExp(`${t} \\(Rank [0-9]+\\)`),i=a.filter((e=>!!e.id.name.match(s))).length>1;return{value:e.id,submenu:i?["Cooldowns",t]:["Cooldowns"],extraCssClasses:e.data.prepullOnly?["apl-prepull-actions-only"]:e.data.encounterOnly?["apl-priority-list-only"]:[]}})),[{value:x.fromEmpty(),headerText:"Placeholders",submenu:["Placeholders"]}],i.map((([e,t])=>({value:x.fromOtherId(e),submenu:["Placeholders"],tooltip:t})))].flat()}},channel_spells:{defaultLabel:"Channeled Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.isCastable&&e.data.isChanneled)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),a=new RegExp(`${s} \\(Rank [0-9]+\\)`),i=e.getSpells().filter((e=>!!e.id.name.match(a))).length>1;return{value:t.id,submenu:i?[s]:[]}}))},dot_spells:{defaultLabel:"DoT Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.hasDot)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),a=new RegExp(`${s.replace("(","\\(").replace(")","\\)")} \\(Rank [0-9]+\\)`),i=e.getSpells().filter((e=>!!e.id.name.match(a))).length>1;return{value:t.id,submenu:i?[s]:[]}}))},shield_spells:{defaultLabel:"Shield Spell",getActionIDs:async e=>e.getSpells().filter((e=>e.data.hasShield)).map((t=>{const s=t.id.name.replace(/ \(Rank \d+\)/g,""),a=new RegExp(`${s} \\(Rank [0-9]+\\)`),i=e.getSpells().filter((e=>!!e.id.name.match(a))).length>1;return{value:t.id,submenu:i?[s]:[]}}))}};class Ig extends Ps{constructor(t,s,a){const i=fg[a.actionIdSet];super(t,s,{...a,sourceToValue:e=>e?x.fromProto(e):x.fromEmpty(),valueToSource:e=>e.toProto(),defaultLabel:i.defaultLabel,equals:(e,t)=>null==e==(null==t)&&(!e||e.equals(t)),setOptionContent:(t,s)=>{const i=s.value,n=g(),o=["auras","stackable_auras","icd_auras","exclusive_effect_auras"].includes(a.actionIdSet);t.appendChild(e(b,null,e("a",{ref:n,className:"apl-actionid-item-icon",dataset:{whtticon:!1}}),i.name)),i.setBackgroundAndHref(n.value),i.setWowheadDataset(n.value,{useBuffAura:o})},createMissingValue:e=>0==e.anyId()?new Promise((()=>{i.defaultLabel})):e.fill().then((e=>({value:e}))),values:[]});const n=a.getUnitRef,o="self"==a.defaultUnitRef?we.create({type:Ie.Self}):we.create({type:Ie.CurrentTarget}),l=i.getActionIDs,r=async()=>{const e=n(s),t=s.sim.getUnitMetadata(e,s,o);if(t){const e=await l(t);this.setOptions(e)}};r();const c=s.sim.unitMetadataEmitter.on(r),d=s.rotationChangeEmitter.on(r);this.addOnDisposeCallback((()=>{c.dispose(),d.dispose()}))}}class wg extends Ps{constructor(e,t,s){super(e,t,{...s,sourceToValue:e=>null,valueToSource:e=>ks.create({rawId:{oneofKind:"spellId",spellId:0}}),defaultLabel:"Runes",equals:(e,t)=>e==t,setOptionContent:(e,t)=>{const s=x.fromSpellId(0),a=document.createElement("a");a.classList.add("apl-actionid-item-icon"),a.dataset.whtticon="false",a.classList.add("apl-actionid-item-icon"),s.fillAndSet(a,!0,!0),e.appendChild(a);const i=document.createTextNode("");e.appendChild(i)},values:[]});(async()=>{this.setOptions([])})(),t.rotationChangeEmitter.on((()=>this.update))}}const bg={aura_sources:{getUnits:e=>[void 0,e.getPetMetadatas().asList().map(((e,t)=>we.create({type:Ie.Pet,index:t,owner:we.create({type:Ie.Self})}))),we.create({type:Ie.CurrentTarget}),e.sim.encounter.targetsMetadata.asList().map(((e,t)=>we.create({type:Ie.Target,index:t})))].flat()},aura_sources_targets_first:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map(((e,t)=>we.create({type:Ie.Target,index:t}))),we.create({type:Ie.Self}),e.getPetMetadatas().asList().map(((e,t)=>we.create({type:Ie.Pet,index:t,owner:we.create({type:Ie.Self})})))].flat()},targets:{targetUI:!0,getUnits:e=>[void 0,e.sim.encounter.targetsMetadata.asList().map(((e,t)=>we.create({type:Ie.Target,index:t})))].flat()}};class Sg extends Cs{constructor(e,t,s){const a=!!bg[s.unitSet].targetUI;super(e,t,{...s,sourceToValue:e=>Sg.refToValue(e,t,a),valueToSource:e=>e.value,values:[],hideLabelWhenDefaultSelected:!0}),this.unitSet=s.unitSet,this.rootElem.classList.add("apl-unit-picker"),this.updateValues();const i=t.sim.unitMetadataEmitter.on((()=>this.updateValues()));this.addOnDisposeCallback((()=>{i.dispose()}))}static refToValue(e,t,s){if(!e||e.type==Ie.Unknown)return{value:e,iconUrl:s?"fa-bullseye":"fa-user",text:s?"Current Target":"Self"};if(e.type==Ie.Self)return{value:e,iconUrl:"fa-user",text:"Self"};if(e.type==Ie.CurrentTarget)return{value:e,iconUrl:"fa-bullseye",text:"Current Target"};if(e.type==Ie.Player){const s=t.sim.raid.getPlayer(e.index);if(s)return{value:e,iconUrl:s.getSpecIcon(),text:`Player ${e.index+1}`}}else if(e.type==Ie.Target){if(t.sim.encounter.targetsMetadata.asList()[e.index])return{value:e,iconUrl:Ts,text:`Target ${e.index+1}`}}else if(e.type==Ie.Pet){const s=t.sim.getUnitMetadata(e,t,we.create({type:Ie.Self}));let a=`Pet ${e.index+1}`,i="fa-paw";if(s){const e=s.getName();if(e){const t=e.indexOf(" - ");a=e.substring(t+3),i=Rs(a)||i}}return{value:e,iconUrl:i,text:a}}return{value:e}}updateValues(){const e=bg[this.unitSet],t=e.getUnits(this.modObject);this.setOptions(t.map((t=>{const s={value:Sg.refToValue(t,this.modObject,e.targetUI)};return t&&t.type==Ie.Pet&&(e.targetUI?s.submenu=[Sg.refToValue(t.owner,this.modObject,e.targetUI)]:s.submenu=[Sg.refToValue(void 0,this.modObject,e.targetUI)]),s})))}}class xg extends f{constructor(e,t,s){super(e,"apl-picker-builder-root",t,s),this.config=s,this.fieldPickers=s.fields.map((e=>xg.makeFieldPicker(this,e))),this.init()}static makeFieldPicker(e,t){const s=t.field,a=t.factory(e.rootElem,e.modObject,{label:t.label,labelTooltip:t.labelTooltip,id:Qe(),changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const a=e.getSourceValue();return a[s]||(a[s]=t.newValue()),a[s]},setValue:(t,a,i)=>{e.getSourceValue()[s]=i,a.rotationChangeEmitter.emit(t)}},(()=>e.getSourceValue()));return"vals"!==s&&"actions"!==s||a.rootElem.classList.add("apl-picker-builder-multi"),{...t,picker:a}}getInputElem(){return this.rootElem}getInputValue(){const e=this.config.newValue();return this.fieldPickers.forEach((t=>{e[t.field]=t.picker.getInputValue()})),e}setInputValue(e){this.fieldPickers.forEach((t=>{t.picker.setInputValue(e[t.field])}))}}function vg(e,t,s,a,i){return{field:e,newValue:()=>ks.create(),factory:(e,i,n,o)=>new Ig(e,i,{id:Qe(),...n,actionIdSet:t,getUnitRef:()=>s?o()[s]:we.create(),defaultUnitRef:a||"self"}),...i||{}}}function yg(e,t,s){return{field:e,newValue:()=>{},factory:(e,s,a)=>new Sg(e,s,{id:Qe(),...a,unitSet:t}),...s||{}}}function Eg(e,t,s){return{field:e,newValue:()=>!1,factory:(e,t,s)=>(s.extraCssClasses=["input-inline"].concat(s.extraCssClasses||[]),new Et(e,t,{id:Qe(),...s})),...s||{},label:t}}function kg(e,t,s){return{field:e,newValue:()=>0,factory:(e,s,a)=>{const i=a;return i.float=t,i.extraCssClasses=["input-inline"].concat(a.extraCssClasses||[]),new sh(e,s,i)},...s||{}}}function Pg(e,t){return{field:e,newValue:()=>"",factory:(e,t,s)=>(s.extraCssClasses=["input-inline"].concat(s.extraCssClasses||[]),new mg(e,t,{id:Qe(),...s})),...t||{}}}function Cg(e,t){return(s,a,i)=>new xg(s,a,{...i,newValue:e,fields:t})}class Tg extends f{constructor(e,t,s){super(e,"apl-value-picker-root",t,s);const a=null!==this.rootElem.closest(".apl-prepull-action-picker"),i=Object.keys(Dg).filter((e=>Dg[e].includeIf?.(t,a)??!0));this.kindPicker=new Ba(this.rootElem,t,{id:Qe(),defaultLabel:"No Condition",values:[{value:void 0,label:"<None>"}].concat(i.map((e=>{const t=Dg[e];return{value:e,label:t.label,submenu:t.submenu,tooltip:t.fullDescription?`<p>${t.shortDescription}</p> ${t.fullDescription}`:t.shortDescription}}))),equals:(e,t)=>e===t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.value.oneofKind,setValue:(e,t,s)=>{const a=this.getSourceValue(),i=a?.value.oneofKind;if(i!==s){if(s){const t=Dg[s];let n=this.makeAPLValue(s,t.newValue());a&&i&&this.valuePicker&&("not"===s?n.value.not.val=this.makeAPLValue(i,this.valuePicker.getInputValue()):"not"===a.value.oneofKind&&a.value.not.val?.value.oneofKind===s?n=a.value.not.val:"and"===s?"or"===a.value.oneofKind?n.value.and.vals=a.value.or.vals:n.value.and.vals=[this.makeAPLValue(i,this.valuePicker.getInputValue())]:"or"===s?"and"===a.value.oneofKind?n.value.or.vals=a.value.and.vals:n.value.or.vals=[this.makeAPLValue(i,this.valuePicker.getInputValue())]:"min"===s?"max"===a.value.oneofKind?n.value.min.vals=a.value.max.vals:n.value.min.vals=[this.makeAPLValue(i,this.valuePicker.getInputValue())]:"max"===s?"min"===a.value.oneofKind?n.value.max.vals=a.value.min.vals:n.value.max.vals=[this.makeAPLValue(i,this.valuePicker.getInputValue())]:"and"===a.value.oneofKind&&a.value.and.vals?.[0]?.value.oneofKind===s?n=a.value.and.vals[0]:"or"===a.value.oneofKind&&a.value.or.vals?.[0]?.value.oneofKind===s?n=a.value.or.vals[0]:"min"===a.value.oneofKind&&a.value.min.vals?.[0]?.value.oneofKind===s?n=a.value.min.vals[0]:"max"===a.value.oneofKind&&a.value.max.vals?.[0]?.value.oneofKind===s?n=a.value.max.vals[0]:"cmp"===s&&(n.value.cmp.lhs=this.makeAPLValue(i,this.valuePicker.getInputValue()))),a?a.value=n.value:this.setSourceValue(e,n)}else this.setSourceValue(e,void 0);t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.valuePicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return e?Ja.create({value:{oneofKind:e,...(()=>{const t={};return e&&this.valuePicker&&(t[e]=this.valuePicker.getInputValue()),t})()}}):void 0}setInputValue(e){const t=e?.value.oneofKind;this.updateValuePicker(t),t&&e&&this.valuePicker.setInputValue(e.value[t])}makeAPLValue(e,t){if(!e)return Ja.create();const s={oneofKind:e};return s[e]=t,Ja.create({value:s})}updateValuePicker(e){const t=this.currentKind;if(e===t)return;if(this.currentKind=e,this.valuePicker&&(this.valuePicker.rootElem.remove(),this.valuePicker=null),!e)return;this.kindPicker.setInputValue(e);const s=Dg[e];this.valuePicker=s.factory(this.rootElem,this.modObject,{changedEvent:e=>e.rotationChangeEmitter,getValue:()=>{const t=this.getSourceValue();return t&&t.value[e]||s.newValue()},setValue:(t,s,a)=>{const i=this.getSourceValue();i&&(i.value[e]=a),s.rotationChangeEmitter.emit(t)}})}}function Ng(e,t){return{field:e,newValue:Ja.create,factory:(e,t,s)=>new Tg(e,t,s),...t||{}}}function _g(e){return{field:e,newValue:()=>[],factory:(e,t,s)=>new gg(e,t,{...s,setValue:(e,t,a)=>{s.setValue(e,t,a.map((e=>e||Ja.create())))},itemLabel:"Value",newItem:Ja.create,copyItem:e=>e?Ja.clone(e):e,newItemPicker:(e,s,a,i)=>new Tg(e,t,i),allowedActions:["create","delete"],actions:{create:{useIcon:!0}}})}}function Rg(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,newValue:e.newValue,includeIf:e.includeIf,factory:Cg(e.newValue,e.fields)}}const Dg={const:Rg({label:"Const",shortDescription:"A fixed value.",fullDescription:"\n\t\t<p>\n\t\t\tExamples:\n\t\t\t<ul>\n\t\t\t\t<li><b>Number:</b> '123', '0.5', '-10'</li>\n\t\t\t\t<li><b>Time:</b> '100ms', '5s', '3m'</li>\n\t\t\t\t<li><b>Percentage:</b> '30%'</li>\n\t\t\t</ul>\n\t\t</p>\n\t\t",newValue:Ds.create,fields:[Pg("val")]}),cmp:Rg({label:"Compare",submenu:["Logic"],shortDescription:"Compares two values.",newValue:As.create,fields:[Ng("lhs"),(Ag="op",{field:Ag,newValue:()=>Ha.OpEq,factory:(e,t,s)=>new Ba(e,t,{id:Qe(),...s,defaultLabel:"None",equals:(e,t)=>e===t,values:[{value:Ha.OpEq,label:"=="},{value:Ha.OpNe,label:"!="},{value:Ha.OpGe,label:">="},{value:Ha.OpGt,label:">"},{value:Ha.OpLe,label:"<="},{value:Ha.OpLt,label:"<"}]})}),Ng("rhs")]}),math:Rg({label:"Math",submenu:["Logic"],shortDescription:"Do basic math on two values.",newValue:Ls.create,fields:[Ng("lhs"),function(e){return{field:e,newValue:()=>za.OpAdd,factory:(e,t,s)=>new Ba(e,t,{id:Qe(),...s,defaultLabel:"None",equals:(e,t)=>e===t,values:[{value:za.OpAdd,label:"+"},{value:za.OpSub,label:"-"},{value:za.OpMul,label:"*"},{value:za.OpDiv,label:"/"}]})}}("op"),Ng("rhs")]}),max:Rg({label:"Max",submenu:["Logic"],shortDescription:"Returns the largest value among the subvalues.",newValue:Vs.create,fields:[_g("vals")]}),min:Rg({label:"Min",submenu:["Logic"],shortDescription:"Returns the smallest value among the subvalues.",newValue:Ms.create,fields:[_g("vals")]}),and:Rg({label:"All of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if all of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:Us.create,fields:[_g("vals")]}),or:Rg({label:"Any of",submenu:["Logic"],shortDescription:"Returns <b>True</b> if any of the sub-values are <b>True</b>, otherwise <b>False</b>",newValue:Ws.create,fields:[_g("vals")]}),not:Rg({label:"Not",submenu:["Logic"],shortDescription:"Returns the opposite of the inner value, i.e. <b>True</b> if the value is <b>False</b> and vice-versa.",newValue:Fs.create,fields:[Ng("val")]}),currentTime:Rg({label:"Current Time",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration.",newValue:Os.create,fields:[]}),currentTimePercent:Rg({label:"Current Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the current sim iteration, as a percentage.",newValue:qs.create,fields:[]}),remainingTime:Rg({label:"Remaining Time",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration.",newValue:Hs.create,fields:[]}),remainingTimePercent:Rg({label:"Remaining Time (%)",submenu:["Encounter"],shortDescription:"Elapsed time of the remaining sim iteration, as a percentage.",newValue:Bs.create,fields:[]}),isExecutePhase:Rg({label:"Is Execute Phase",submenu:["Encounter"],shortDescription:"<b>True</b> if the encounter is in Execute Phase, meaning the target's health is less than the given threshold, otherwise <b>False</b>.",newValue:zs.create,fields:[function(e){return{field:e,newValue:()=>Ga.E20,factory:(e,t,s)=>new Ba(e,t,{id:Qe(),...s,defaultLabel:"None",equals:(e,t)=>e===t,values:[{value:Ga.E20,label:"20%"},{value:Ga.E25,label:"25%"},{value:Ga.E35,label:"35%"}]})}}("threshold")]}),numberTargets:Rg({label:"Number of Targets",submenu:["Encounter"],shortDescription:"Count of targets in the current encounter",newValue:js.create,fields:[]}),frontOfTarget:Rg({label:"Front of Target",submenu:["Encounter"],shortDescription:"<b>True</b> if facing from of target",newValue:$s.create,fields:[]}),currentHealth:Rg({label:"Health",submenu:["Resources"],shortDescription:"Amount of currently available Health.",newValue:Gs.create,fields:[yg("sourceUnit","aura_sources")]}),currentHealthPercent:Rg({label:"Health (%)",submenu:["Resources"],shortDescription:"Amount of currently available Health, as a percentage.",newValue:Ks.create,fields:[yg("sourceUnit","aura_sources")]}),maxHealth:Rg({label:"Max Health",submenu:["Resources"],shortDescription:"Maximum amount of Health.",newValue:Js.create,fields:[]}),currentMana:Rg({label:"Mana",submenu:["Resources"],shortDescription:"Amount of currently available Mana.",newValue:Zs.create,fields:[],includeIf:(e,t)=>e.getClass()!==o.ClassRogue&&e.getClass()!==o.ClassWarrior}),currentManaPercent:Rg({label:"Mana (%)",submenu:["Resources"],shortDescription:"Amount of currently available Mana, as a percentage.",newValue:Ys.create,fields:[],includeIf:(e,t)=>e.getClass()!==o.ClassRogue&&e.getClass()!==o.ClassWarrior}),maxMana:Rg({label:"Max Mana",submenu:["Resources"],shortDescription:"Maximum amount of Mana.",newValue:Qs.create,fields:[],includeIf:(e,t)=>e.getClass()!==o.ClassRogue&&e.getClass()!==o.ClassWarrior}),currentRage:Rg({label:"Rage",submenu:["Resources"],shortDescription:"Amount of currently available Rage.",newValue:Xs.create,fields:[],includeIf:(e,t)=>e.getClass()===o.ClassWarrior||e.getClass()===o.ClassDruid}),currentEnergy:Rg({label:"Energy",submenu:["Resources"],shortDescription:"Amount of currently available Energy.",newValue:ea.create,fields:[],includeIf:(e,t)=>e.getClass()===o.ClassRogue||e.getClass()===o.ClassDruid}),timeToEnergyTick:Rg({label:"Time to Next Energy Tick",submenu:["Resources"],shortDescription:"Time until the next energy regen tick will happen",newValue:ta.create,fields:[],includeIf:(e,t)=>e.getClass()===o.ClassRogue||e.getClass()===o.ClassDruid}),energyThreshold:Rg({label:"Energy Threshold",submenu:["Resources"],shortDescription:"Compares current energy to a threshold value.",newValue:sa.create,fields:[kg("threshold",!1,{label:">=",labelTooltip:"Energy threshold. Subtracted from maximum energy if negative."})],includeIf:(e,t)=>e.getClass()===o.ClassRogue||e.getClass()===o.ClassDruid}),currentComboPoints:Rg({label:"Combo Points",submenu:["Resources"],shortDescription:"Amount of currently available Combo Points.",newValue:aa.create,fields:[],includeIf:(e,t)=>e.getClass()===o.ClassRogue||e.getClass()===o.ClassDruid}),currentAttackPower:Rg({label:"Current Attack Power",submenu:["Stats"],shortDescription:"Current Attack Power includuing temporary bonuses.",newValue:ia.create,fields:[]}),gcdIsReady:Rg({label:"GCD Is Ready",submenu:["GCD"],shortDescription:"<b>True</b> if the GCD is not on cooldown, otherwise <b>False</b>.",newValue:na.create,fields:[]}),gcdTimeToReady:Rg({label:"GCD Time To Ready",submenu:["GCD"],shortDescription:"Amount of time remaining before the GCD comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:oa.create,fields:[]}),autoTimeToNext:Rg({label:"Time To Next Auto",submenu:["Auto"],shortDescription:"Amount of time remaining before the next Main-hand or Off-hand melee attack, or <b>0</b> if autoattacks are not engaged.",newValue:la.create,fields:[function(e){return{field:e,newValue:()=>ja.Any,factory:(e,t,s)=>new Ba(e,t,{id:Qe(),...s,defaultLabel:"None",equals:(e,t)=>e===t,values:[{value:ja.Any,label:"Any"},{value:ja.Melee,label:"Melee"},{value:ja.MainHand,label:"Main Hand"},{value:ja.OffHand,label:"Off Hand"},{value:ja.Ranged,label:"Ranged"}]})}}("autoType")]}),autoSwingTime:Rg({label:"Auto Swing Time",submenu:["Auto"],shortDescription:"Total swing duration including all haste buffs.",newValue:ra.create,fields:[function(e){return{field:e,newValue:()=>$a.MainHand,factory:(e,t,s)=>new Ba(e,t,{id:Qe(),...s,defaultLabel:"None",equals:(e,t)=>e===t,values:[{value:$a.MainHand,label:"Main Hand"},{value:$a.OffHand,label:"Off Hand"},{value:$a.Ranged,label:"Ranged"}]})}}("autoType")]}),spellIsKnown:Rg({label:"Spell Known",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is currently known, otherwise <b>False</b>.",newValue:ca.create,fields:[vg("spellId","castable_spells","")]}),spellCurrentCost:Rg({label:"Current Cost",submenu:["Spell"],shortDescription:"Returns current resource cost of spell",newValue:da.create,fields:[vg("spellId","castable_spells","")]}),spellCanCast:Rg({label:"Can Cast",submenu:["Spell"],shortDescription:"<b>True</b> if all requirements for casting the spell are currently met, otherwise <b>False</b>.",fullDescription:"\n\t\t\t<p>The <b>Cast Spell</b> action does not need to be conditioned on this, because it applies this check automatically.</p>\n\t\t",newValue:ha.create,fields:[vg("spellId","castable_spells","")]}),spellIsReady:Rg({label:"Is Ready",submenu:["Spell"],shortDescription:"<b>True</b> if the spell is not on cooldown, otherwise <b>False</b>.",newValue:ma.create,fields:[vg("spellId","castable_spells","")]}),spellTimeToReady:Rg({label:"Time To Ready",submenu:["Spell"],shortDescription:"Amount of time remaining before the spell comes off cooldown, or <b>0</b> if it is not on cooldown.",newValue:ua.create,fields:[vg("spellId","castable_spells","")]}),spellCastTime:Rg({label:"Cast Time",submenu:["Spell"],shortDescription:"Amount of time to cast the spell including any haste and spell cast time adjustments.",newValue:pa.create,fields:[vg("spellId","castable_spells","")]}),spellTravelTime:Rg({label:"Travel Time",submenu:["Spell"],shortDescription:"Amount of time for the spell to travel to the target.",newValue:ga.create,fields:[vg("spellId","castable_spells","")]}),spellInFlight:Rg({label:"In Flight",submenu:["Spell"],shortDescription:"<b>True</b> if the spell has a missile in flight, otherwise <b>False</b>.",newValue:fa.create,fields:[vg("spellId","castable_spells","")]}),spellCpm:Rg({label:"CPM",submenu:["Spell"],shortDescription:"Casts Per Minute for the spell so far in the current iteration.",newValue:fa.create,fields:[vg("spellId","castable_spells","")]}),spellIsChanneling:Rg({label:"Is Channeling",submenu:["Spell"],shortDescription:"<b>True</b> if this spell is currently being channeled, otherwise <b>False</b>.",newValue:Ia.create,fields:[vg("spellId","channel_spells","")]}),spellChanneledTicks:Rg({label:"Channeled Ticks",submenu:["Spell"],shortDescription:"The number of completed ticks in the current channel of this spell, or <b>0</b> if the spell is not being channeled.",newValue:wa.create,fields:[vg("spellId","channel_spells","")]}),channelClipDelay:Rg({label:"Channel Clip Delay",submenu:["Spell"],shortDescription:"The amount of time specified by the <b>Channel Clip Delay</b> setting.",newValue:ba.create,fields:[]}),auraIsKnown:Rg({label:"Aura Known",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently known, otherwise <b>False</b>.",newValue:Sa.create,fields:[yg("sourceUnit","aura_sources"),vg("auraId","auras","sourceUnit")]}),auraIsActive:Rg({label:"Aura Active",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active, otherwise <b>False</b>.",newValue:xa.create,fields:[yg("sourceUnit","aura_sources"),vg("auraId","auras","sourceUnit")]}),auraIsActiveWithReactionTime:Rg({label:"Aura Active (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura is currently active AND it has been active for at least as long as the player reaction time (configured in Settings), otherwise <b>False</b>.",newValue:va.create,fields:[yg("sourceUnit","aura_sources"),vg("auraId","auras","sourceUnit")]}),auraRemainingTime:Rg({label:"Aura Remaining Time",submenu:["Aura"],shortDescription:"Time remaining before this aura will expire, or 0 if the aura is not currently active.",newValue:ya.create,fields:[yg("sourceUnit","aura_sources"),vg("auraId","auras","sourceUnit")]}),auraNumStacks:Rg({label:"Aura Num Stacks",submenu:["Aura"],shortDescription:"Number of stacks of the aura.",newValue:Ea.create,fields:[yg("sourceUnit","aura_sources"),vg("auraId","stackable_auras","sourceUnit")]}),auraInternalCooldown:Rg({label:"Aura Remaining ICD",submenu:["Aura"],shortDescription:"Time remaining before this aura's internal cooldown will be ready, or <b>0</b> if the ICD is ready now.",newValue:ka.create,fields:[yg("sourceUnit","aura_sources"),vg("auraId","icd_auras","sourceUnit")]}),auraIcdIsReadyWithReactionTime:Rg({label:"Aura ICD Is Ready (with Reaction Time)",submenu:["Aura"],shortDescription:"<b>True</b> if the aura's ICD is currently ready OR it was put on CD recently, within the player's reaction time (configured in Settings), otherwise <b>False</b>.",newValue:Pa.create,fields:[yg("sourceUnit","aura_sources"),vg("auraId","icd_auras","sourceUnit")]}),auraShouldRefresh:Rg({label:"Should Refresh Aura",submenu:["Aura"],shortDescription:"Whether this aura should be refreshed, e.g. for the purpose of maintaining a debuff.",fullDescription:"\n\t\t<p>This condition checks not only the specified aura but also any other auras on the same unit, including auras applied by other raid members, which apply the same debuff category.</p>\n\t\t<p>For example, 'Should Refresh Debuff(Sunder Armor)' will return <b>False</b> if the unit has an active Expose Armor aura.</p>\n\t\t",newValue:()=>Ca.create({maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[yg("sourceUnit","aura_sources_targets_first"),vg("auraId","exclusive_effect_auras","sourceUnit","currentTarget"),Ng("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before the aura expires when it may be refreshed."})]}),runeIsEquipped:Rg({label:"Rune Equipped",submenu:["Rune"],shortDescription:"<b>True</b> if the rune is currently equipped, otherwise <b>False</b>.",newValue:Ta.create,fields:[function(e){return{field:e,newValue:()=>ks.create(),factory:(e,t,s,a)=>new wg(e,t,{id:Qe(),...s})}}("runeId")]}),dotIsActive:Rg({label:"Dot Is Active",submenu:["DoT"],shortDescription:"<b>True</b> if the specified dot is currently ticking, otherwise <b>False</b>.",newValue:Na.create,fields:[yg("targetUnit","targets"),vg("spellId","dot_spells","")]}),dotRemainingTime:Rg({label:"Dot Remaining Time",submenu:["DoT"],shortDescription:"Time remaining before the last tick of this DoT will occur, or 0 if the DoT is not currently ticking.",newValue:_a.create,fields:[yg("targetUnit","targets"),vg("spellId","dot_spells","")]}),sequenceIsComplete:Rg({label:"Sequence Is Complete",submenu:["Sequence"],shortDescription:"<b>True</b> if there are no more subactions left to execute in the sequence, otherwise <b>False</b>.",newValue:Ra.create,fields:[Pg("sequenceName")]}),sequenceIsReady:Rg({label:"Sequence Is Ready",submenu:["Sequence"],shortDescription:"<b>True</b> if the next subaction in the sequence is ready to be executed, otherwise <b>False</b>.",newValue:Da.create,fields:[Pg("sequenceName")]}),sequenceTimeToReady:Rg({label:"Sequence Time To Ready",submenu:["Sequence"],shortDescription:"Returns the amount of time remaining until the next subaction in the sequence will be ready.",newValue:Aa.create,fields:[Pg("sequenceName")]}),totemRemainingTime:Rg({label:"Totem Remaining Time",submenu:["Shaman"],shortDescription:"Returns the amount of time remaining until the totem will expire.",newValue:La.create,includeIf:(e,t)=>e.getClass()===o.ClassShaman,fields:[function(e){return{field:e,newValue:()=>Ka.Water,factory:(e,t,s)=>new Ba(e,t,{id:Qe(),...s,defaultLabel:"None",equals:(e,t)=>e===t,values:[{value:Ka.Earth,label:"Earth"},{value:Ka.Air,label:"Air"},{value:Ka.Fire,label:"Fire"},{value:Ka.Water,label:"Water"}]})}}("totemType")]}),catExcessEnergy:Rg({label:"Excess Energy",submenu:["Feral Druid"],shortDescription:"Returns the amount of excess energy available, after subtracting energy that will be needed to maintain DoTs.",newValue:Va.create,includeIf:(e,t)=>e.spec===j.SpecFeralDruid,fields:[]}),warlockShouldRecastDrainSoul:Rg({label:"Should Recast Drain Soul",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Drain Soul channel should be immediately recast, to get a better snapshot.",newValue:Ma.create,includeIf:(e,t)=>e.getClass()===o.ClassWarlock,fields:[]}),warlockShouldRefreshCorruption:Rg({label:"Should Refresh Corruption",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the current Corruption has expired, or should be refreshed to get a better snapshot.",newValue:Ua.create,includeIf:(e,t)=>e.getClass()===o.ClassWarlock,fields:[yg("targetUnit","targets")]}),warlockPetIsActive:Rg({label:"Pet is Active",submenu:["Warlock"],shortDescription:"Returns <b>True</b> if the Warlock has a pet active.",newValue:Wa.create,includeIf:(e,t)=>e.getClass()===o.ClassWarlock,fields:[]}),warlockCurrentPetMana:Rg({label:"Pet Mana",submenu:["Warlock"],shortDescription:"Amount of currently available pet mana.",newValue:Fa.create,includeIf:(e,t)=>e.getClass()===o.ClassWarlock,fields:[]}),warlockCurrentPetManaPercent:Rg({label:"Pet Mana (%)",submenu:["Warlock"],shortDescription:"Amount of currently available pet mana, as a percentage.",newValue:Oa.create,includeIf:(e,t)=>e.getClass()===o.ClassWarlock,fields:[]}),currentSealRemainingTime:Rg({label:"Current Seal Remaining Time",submenu:["Paladin"],shortDescription:"Returns the amount of time remaining until the Paladin's current Seal aura will expire.",newValue:qa.create,includeIf:(e,t)=>e.getClass()===o.ClassPaladin,fields:[]})};var Ag;class Lg extends f{constructor(e,t,s){super(e,"apl-action-picker-root",t,s),this.conditionPicker=new Tg(this.rootElem,this.modObject,{label:"If:",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.condition,setValue:(e,t,s)=>{const a=this.getSourceValue();a?(a.condition=s,t.rotationChangeEmitter.emit(e)):this.setSourceValue(e,fi.create({condition:s}))}}),this.conditionPicker.rootElem.classList.add("apl-action-condition","apl-priority-list-only"),this.actionDiv=document.createElement("div"),this.actionDiv.classList.add("apl-action-picker-action"),this.rootElem.appendChild(this.actionDiv);const a=null!=this.rootElem.closest(".apl-prepull-action-picker"),i=Object.keys(Ug).filter((e=>Ug[e].includeIf?.(t,a)??!0));this.kindPicker=new Ba(this.actionDiv,t,{id:Qe(),defaultLabel:"Action",values:i.map((e=>{const t=Ug[e];return{value:e,label:t.label,submenu:t.submenu,tooltip:t.fullDescription?`<p>${t.shortDescription}</p> ${t.fullDescription}`:t.shortDescription}})),equals:(e,t)=>e==t,changedEvent:e=>e.rotationChangeEmitter,getValue:e=>this.getSourceValue()?.action.oneofKind,setValue:(e,t,s)=>{const a=this.getSourceValue(),i=a?.action.oneofKind;if(i!=s){if(s){const t=Ug[s];let n=this.makeAPLAction(s,t.newValue());a&&i&&this.actionPicker&&("sequence"==s?"strictSequence"==a.action.oneofKind?n.action.sequence.actions=a.action.strictSequence.actions:n.action.sequence.actions=[this.makeAPLAction(i,this.actionPicker.getInputValue())]:"strictSequence"==s?"sequence"==a.action.oneofKind?n.action.strictSequence.actions=a.action.sequence.actions:n.action.strictSequence.actions=[this.makeAPLAction(i,this.actionPicker.getInputValue())]:"sequence"==a.action.oneofKind&&a.action.sequence.actions?.[0]?.action.oneofKind==s?n=a.action.sequence.actions[0]:"strictSequence"==a.action.oneofKind&&a.action.strictSequence.actions?.[0]?.action.oneofKind==s&&(n=a.action.strictSequence.actions[0])),a?a.action=n.action:this.setSourceValue(e,n)}else a.action={oneofKind:s};t.rotationChangeEmitter.emit(e)}}}),this.currentKind=void 0,this.actionPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){const e=this.kindPicker.getInputValue();return fi.create({condition:this.conditionPicker.getInputValue(),action:{oneofKind:e,...(()=>{const t={};return e&&this.actionPicker&&(t[e]=this.actionPicker.getInputValue()),t})()}})}setInputValue(e){if(!e)return;this.conditionPicker.setInputValue(e.condition||Ja.create());const t=e.action.oneofKind;this.updateActionPicker(t),t&&this.actionPicker.setInputValue(e.action[t])}makeAPLAction(e,t){if(!e)return fi.create();const s={oneofKind:e};return s[e]=t,fi.create({action:s})}updateActionPicker(e){const t=this.currentKind;if(e==t)return;if(this.currentKind=e,this.actionPicker&&(this.actionPicker.rootElem.remove(),this.actionPicker=null),!e)return;this.kindPicker.setInputValue(e);const s=Ug[e];this.actionPicker=s.factory(this.actionDiv,this.modObject,{changedEvent:e=>e.rotationChangeEmitter,getValue:()=>this.getSourceValue()?.action?.[e]||s.newValue(),setValue:(t,s,a)=>{const i=this.getSourceValue();i&&((i?.action)[e]=a),s.rotationChangeEmitter.emit(t)}}),this.actionPicker.rootElem.classList.add("apl-action-"+e)}}function Vg(e){return{field:e,newValue:()=>[],factory:(e,t,s)=>new gg(e,t,{...s,setValue:(e,t,a)=>{s.setValue(e,t,a.map((e=>e||fi.create())))},itemLabel:"Action",newItem:fi.create,copyItem:e=>e?fi.clone(e):e,newItemPicker:(e,s,a,i)=>new Lg(e,t,i),allowedActions:["create","delete","move"],actions:{create:{useIcon:!0}}})}}function Mg(e){return{label:e.label,submenu:e.submenu,shortDescription:e.shortDescription,fullDescription:e.fullDescription,includeIf:e.includeIf,newValue:e.newValue,factory:Cg(e.newValue,e.fields)}}const Ug={castSpell:Mg({label:"Cast",shortDescription:"Casts the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",newValue:Za.create,fields:[vg("spellId","castable_spells",""),yg("target","targets")]}),multidot:Mg({label:"Multi Dot",submenu:["Casting"],shortDescription:"Keeps a DoT active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t,newValue:()=>Ya.create({maxDots:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[vg("spellId","dot_spells",""),kg("maxDots",!1,{label:"Max Dots",labelTooltip:"Maximum number of DoTs to simultaneously apply."}),Ng("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a DoT expires when it may be refreshed."})]}),multishield:Mg({label:"Multi Shield",submenu:["Casting"],shortDescription:"Keeps a Shield active on multiple targets by casting the specified spell.",includeIf:(e,t)=>!t&&Qa(e.spec),newValue:()=>Xa.create({maxShields:3,maxOverlap:{value:{oneofKind:"const",const:{val:"0ms"}}}}),fields:[vg("spellId","shield_spells",""),kg("maxShields",!1,{label:"Max Shields",labelTooltip:"Maximum number of Shields to simultaneously apply."}),Ng("maxOverlap",{label:"Overlap",labelTooltip:"Maximum amount of time before a Shield expires when it may be refreshed."})]}),channelSpell:Mg({label:"Channel",submenu:["Casting"],shortDescription:"Channels the spell if possible, i.e. resource/cooldown/GCD/etc requirements are all met.",fullDescription:"\n\t\t\t<p>The difference between channeling a spell vs casting the spell is that channels can be interrupted. If the <b>Interrupt If</b> parameter is empty, this action is equivalent to <b>Cast</b>.</p>\n\t\t\t<p>The channel will be interrupted only if Instant Interrupt is true OR all of the following are true:</p>\n\t\t\t<ul>\n\t\t\t\t<li>Immediately following a tick of the channel</li>\n\t\t\t\t<li>The <b>Interrupt If</b> condition evaluates to <b>True</b></li>\n\t\t\t\t<li>Another action in the APL list is available</li>\n\t\t\t</ul>\n\t\t\t<p>Note that if you simply want to allow other actions to interrupt the channel, set <b>Interrupt If</b> to <b>True</b>.</p>\n\t\t",newValue:()=>ei.create({interruptIf:{value:{oneofKind:"gcdIsReady",gcdIsReady:{}}}}),fields:[vg("spellId","channel_spells",""),yg("target","targets"),Ng("interruptIf",{label:"Interrupt If",labelTooltip:"Condition which must be true to allow the channel to be interrupted."}),Eg("instantInterrupt","Instant Interrupt",{labelTooltip:"If checked, interrupts of this channel will happen instantly after the cast."}),Eg("allowRecast","Recast",{labelTooltip:"If checked, interrupts of this channel will recast the spell."})]}),autocastOtherCooldowns:Mg({label:"Autocast Other Cooldowns",submenu:["Casting"],shortDescription:"Auto-casts cooldowns as soon as they are ready.",fullDescription:"\n\t\t\t<ul>\n\t\t\t\t<li>Does not auto-cast cooldowns which are already controlled by other actions in the priority list.</li>\n\t\t\t\t<li>Cooldowns are usually cast immediately upon becoming ready, but there are some basic smart checks in place, e.g. don't use Mana CDs when near full mana.</li>\n\t\t\t</ul>\n\t\t",includeIf:(e,t)=>!t,newValue:ti.create,fields:[]}),wait:Mg({label:"Wait",submenu:["Timing"],shortDescription:"Pauses all APL actions for a specified amount of time.",includeIf:(e,t)=>!t,newValue:()=>si.create({duration:{value:{oneofKind:"const",const:{val:"1000ms"}}}}),fields:[Ng("duration")]}),waitUntil:Mg({label:"Wait Until",submenu:["Timing"],shortDescription:"Pauses all APL actions until the specified condition is <b>True</b>.",includeIf:(e,t)=>!t,newValue:()=>ai.create(),fields:[Ng("condition")]}),schedule:Mg({label:"Scheduled Action",submenu:["Timing"],shortDescription:"Executes the inner action once at each specified timing.",includeIf:(e,t)=>!t,newValue:()=>ii.create({schedule:"0s, 60s",innerAction:{action:{oneofKind:"castSpell",castSpell:{}}}}),fields:[Pg("schedule",{label:"Do At",labelTooltip:"Comma-separated list of timings. The inner action will be performed once at each timing."}),function(e){return{field:e,newValue:Ja.create,factory:(e,t,s)=>new Lg(e,t,s)}}("innerAction")]}),sequence:Mg({label:"Sequence",submenu:["Sequences"],shortDescription:"A list of sub-actions to execute in the specified order.",fullDescription:"\n\t\t\t<p>Once one of the sub-actions has been performed, the next sub-action will not necessarily be immediately executed next. The system will restart at the beginning of the whole actions list (not the sequence). If the sequence is executed again, it will perform the next sub-action.</p>\n\t\t\t<p>When all actions have been performed, the sequence does NOT automatically reset; instead, it will be skipped from now on. Use the <b>Reset Sequence</b> action to reset it, if desired.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:ni.create,fields:[Pg("name"),Vg("actions")]}),resetSequence:Mg({label:"Reset Sequence",submenu:["Sequences"],shortDescription:"Restarts a sequence, so that the next time it executes it will perform its first sub-action.",fullDescription:"\n\t\t\t<p>Use the <b>name</b> field to refer to the sequence to be reset. The desired sequence must have the same (non-empty) value for its <b>name</b>.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:oi.create,fields:[Pg("sequenceName")]}),strictSequence:Mg({label:"Strict Sequence",submenu:["Sequences"],shortDescription:"Like a regular <b>Sequence</b>, except all sub-actions are executed immediately after each other and the sequence resets automatically upon completion.",fullDescription:"\n\t\t\t<p>Strict Sequences do not begin unless ALL sub-actions are ready.</p>\n\t\t",includeIf:(e,t)=>!t,newValue:li.create,fields:[Vg("actions")]}),changeTarget:Mg({label:"Change Target",submenu:["Misc"],shortDescription:"Sets the current target, which is the target of auto attacks and most casts by default.",newValue:()=>ri.create(),fields:[yg("newTarget","targets")]}),activateAura:Mg({label:"Activate Aura",submenu:["Misc"],shortDescription:"Activates an aura",includeIf:(e,t)=>t,newValue:()=>ci.create(),fields:[vg("auraId","auras")]}),activateAuraWithStacks:Mg({label:"Activate Aura With Stacks",submenu:["Misc"],shortDescription:"Activates an aura with the specified number of stacks",includeIf:(e,t)=>t,newValue:()=>di.create({numStacks:"1"}),fields:[vg("auraId","stackable_auras"),Pg("numStacks",{label:"stacks",labelTooltip:"Desired number of initial aura stacks."})]}),addComboPoints:Mg({label:"Add Combo Points",submenu:["Misc"],shortDescription:"Add combo points to target.",includeIf:(e,t)=>t,newValue:()=>hi.create({numPoints:"1"}),fields:[Pg("numPoints",{labelTooltip:"Desired number of initial combo points."})]}),cancelAura:Mg({label:"Cancel Aura",submenu:["Misc"],shortDescription:"Deactivates an aura, equivalent to /cancelaura.",newValue:()=>mi.create(),fields:[vg("auraId","auras")]}),triggerIcd:Mg({label:"Trigger ICD",submenu:["Misc"],shortDescription:"Triggers an aura's ICD, putting it on cooldown. Example usage would be to desync an ICD cooldown before combat starts.",includeIf:(e,t)=>t,newValue:()=>ui.create(),fields:[vg("auraId","icd_auras")]}),itemSwap:Mg({label:"Item Swap",submenu:["Misc"],shortDescription:"Swaps items, using the swap set specified in Settings.",includeIf:(e,t)=>vf.includes(e.spec),newValue:()=>Ii.create(),fields:[function(e){return{field:e,newValue:()=>Si.Swap1,factory:(e,t,s)=>new Ba(e,t,{id:Qe(),...s,defaultLabel:"None",equals:(e,t)=>e==t,values:[{value:Si.Main,label:"Main"},{value:Si.Swap1,label:"Swapped"}]})}}("swapSet")]}),move:Mg({label:"Move",submenu:["Misc"],shortDescription:"Starts a move to the desired range from target.",newValue:()=>pi.create(),fields:[Ng("rangeFromTarget",{label:"to Range",labelTooltip:"Desired range from target."})]}),customRotation:Mg({label:"Custom Rotation",shortDescription:"INTERNAL ONLY",includeIf:(e,t)=>!1,newValue:()=>wi.create(),fields:[]}),catOptimalRotationAction:Mg({label:"Optimal Rotation Action",submenu:["Feral Druid"],shortDescription:"Executes optimized Feral DPS rotation using hardcoded legacy algorithm.",includeIf:(e,t)=>e.spec==j.SpecFeralDruid,newValue:()=>gi.create({minCombosForRip:3,maxWaitTime:2,maintainFaerieFire:!1,useShredTrick:!1}),fields:[kg("minCombosForRip",!1,{label:"Min Rip CP",labelTooltip:"Combo Point threshold for allowing a Rip cast"}),kg("maxWaitTime",!0,{label:"Max Wait Time",labelTooltip:"Max seconds to wait for an Energy tick to cast rather than powershifting"}),Eg("maintainFaerieFire","Maintain Faerie Fire",{labelTooltip:"If checked, bundle Faerie Fire refreshes with powershifts. Ignored if an external Faerie Fire debuff is selected in settings."}),Eg("useShredTrick","Use Shred Trick",{labelTooltip:'If checked, enable the "Shred trick" micro-optimization. This should only be used on short fight lengths with full powershifting uptime.'})]}),castPaladinPrimarySeal:Mg({label:"Cast Primary Seal",submenu:["Paladin"],shortDescription:"Casts the Paladin's designated primary seal spell.",includeIf:(e,t)=>e.spec==j.SpecRetributionPaladin||e.spec==j.SpecProtectionPaladin,newValue:()=>bi.create({}),fields:[]})};class Wg extends p{constructor(e,t,s){super(e,"apl-rotation-picker-root"),new gg(this.rootElem,s,{extraCssClasses:["apl-prepull-action-picker"],title:"Prepull Actions",titleTooltip:"Actions to perform before the pull.",itemLabel:"Prepull Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.prepullActions,setValue:(e,t,s)=>{t.aplRotation.prepullActions=s,t.rotationChangeEmitter.emit(e)},newItem:()=>xi.create({action:{},doAtValue:{value:{oneofKind:"const",const:{val:"-1s"}}}}),copyItem:e=>xi.clone(e),newItemPicker:(e,t,a,i)=>new Fg(e,s,i,a),inlineMenuBar:!0}),new gg(this.rootElem,s,{extraCssClasses:["apl-list-item-picker"],title:"Priority List",titleTooltip:"At each decision point, the simulation will perform the first valid action from this list.",itemLabel:"Action",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.aplRotation.priorityList,setValue:(e,t,s)=>{t.aplRotation.priorityList=s,t.rotationChangeEmitter.emit(e)},newItem:()=>vi.create({action:{}}),copyItem:e=>vi.clone(e),newItemPicker:(e,t,a,i)=>new Og(e,s,i,a),inlineMenuBar:!0})}}class Fg extends f{getItem(){return this.getSourceValue()||xi.create({action:{}})}constructor(e,t,s,a){s.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",t,s),this.player=t;const i=gg.getItemHeaderElem(this);qg(i,t,(e=>e.getCurrentStats().rotationStats?.prepullActions[a]?.warnings||[])),this.hidePicker=new Hg(i,t,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,s)=>{this.getItem().hide=s,this.player.rotationChangeEmitter.emit(e)}}),this.doAtPicker=new mg(this.rootElem,this.player,{id:Qe(),label:"Do At",labelTooltip:"Time before pull to do the action. Should be negative, and formatted like, '-1s' or '-2500ms'.",extraCssClasses:["apl-prepull-actions-doat"],changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().doAtValue?.value?.const.val||"",setValue:(e,t,s)=>{this.getItem().doAtValue=s?Ja.create({value:{oneofKind:"const",const:{val:s}}}):void 0,this.player.rotationChangeEmitter.emit(e)},inline:!0}),this.actionPicker=new Lg(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,s)=>{this.getItem().action=s,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getInputElem(){return this.rootElem}getInputValue(){return xi.create({hide:this.hidePicker.getInputValue(),doAtValue:{value:{oneofKind:"const",const:{val:this.doAtPicker.getInputValue()}}},action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.doAtPicker.setInputValue(e.doAtValue?.value?.const.val||""),this.actionPicker.setInputValue(e.action||fi.create()))}}class Og extends f{getItem(){return this.getSourceValue()||vi.create({action:{}})}constructor(e,t,s,a){s.enableWhen=()=>!this.getItem().hide,super(e,"apl-list-item-picker-root",t,s),this.player=t;const i=gg.getItemHeaderElem(this);qg(i,t,(e=>e.getCurrentStats().rotationStats?.priorityList[a]?.warnings||[])),this.hidePicker=new Hg(i,t,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().hide,setValue:(e,t,s)=>{this.getItem().hide=s,this.player.rotationChangeEmitter.emit(e)}}),this.actionPicker=new Lg(this.rootElem,this.player,{changedEvent:()=>this.player.rotationChangeEmitter,getValue:()=>this.getItem().action,setValue:(e,t,s)=>{this.getItem().action=s,this.player.rotationChangeEmitter.emit(e)}}),this.init()}getInputElem(){return this.rootElem}getInputValue(){return vi.create({hide:this.hidePicker.getInputValue(),action:this.actionPicker.getInputValue()})}setInputValue(e){e&&(this.hidePicker.setInputValue(e.hide),this.actionPicker.setInputValue(e.action||fi.create()))}}function qg(e,t,s){const a=gg.makeActionElem("apl-warnings","fa-exclamation-triangle");a.classList.add("warning","link-warning"),a.setAttribute("data-bs-html","true");const i=mn(a,{theme:"dropdown-tooltip",content:"Warnings"});e.appendChild(a);const n=async()=>{if(!yi(a))return i?.destroy(),a?.remove(),void t.currentStatsEmitter.off(n);i.setContent("");const e=s(t);if(e.length){a.style.visibility="visible";const t=await Promise.all(e.map((e=>x.replaceAllInString(e))));i.setContent(`\n\t\t\t\t<p>This action has warnings, and might not behave as expected.</p>\n\t\t\t\t<ul>\n\t\t\t\t\t${t.map((e=>`<li>${e}</li>`)).join("")}\n\t\t\t\t</ul>\n\t\t\t`)}else a.style.visibility="hidden"};n(),t.currentStatsEmitter.on(n)}class Hg extends f{constructor(e,t,s){super(e,"hide-picker-root",t,s),this.inputElem=gg.makeActionElem("hide-picker-button","fa-eye"),this.iconElem=this.inputElem.childNodes[0],this.rootElem.appendChild(this.inputElem),this.tooltip=mn(this.inputElem,{content:"Enable/Disable"}),this.init(),this.inputElem.addEventListener("click",(()=>{this.setInputValue(!this.getInputValue()),this.inputChanged(a.nextEventID())}))}getInputElem(){return this.inputElem}getInputValue(){return this.iconElem.classList.contains("fa-eye-slash")}setInputValue(e){e?(this.iconElem.classList.add("fa-eye-slash"),this.iconElem.classList.remove("fa-eye"),this.tooltip.setContent("Enable Action")):(this.iconElem.classList.add("fa-eye"),this.iconElem.classList.remove("fa-eye-slash"),this.tooltip.setContent("Disable Action"))}}class Bg extends f{constructor(e,t,s){super(e,"number-list-picker-root",t,s),this.inputElem=document.createElement("input"),this.inputElem.type="text",this.inputElem.placeholder=s.placeholder||"",this.inputElem.classList.add("number-list-picker-input","form-control"),this.rootElem.appendChild(this.inputElem),this.init(),this.inputElem.addEventListener("change",(e=>{this.inputChanged(a.nextEventID())}))}getInputElem(){return this.inputElem}getInputValue(){const e=this.inputElem.value;return e?e.split(",").map(parseFloat).filter((e=>!isNaN(e))):[]}setInputValue(e){ys(this.getInputValue(),e)||(this.inputElem.value=e.map((e=>String(e))).join(","))}}class zg extends p{constructor(e,t){super(e,"cooldowns-picker-root"),this.player=t,this.cooldownPickers=[],a.onAny([this.player.rotationChangeEmitter,this.player.sim.unitMetadataEmitter]).on((e=>{this.update()})),this.update()}update(){this.rootElem.innerHTML="";const e=this.player.getSimpleCooldowns().cooldowns;this.cooldownPickers=[];for(let t=0;t<e.length+1;t++){const s=e[t],i=document.createElement("div");i.classList.add("cooldown-picker"),t==e.length&&i.classList.add("add-cooldown-picker"),this.rootElem.appendChild(i),this.makeActionPicker(i,t);const n=document.createElement("label");n.classList.add("cooldown-picker-label","form-label"),s&&s.id&&x.fromProto(s.id).fill(this.player.getRaidIndex()).then((e=>n.textContent=e.name)),i.appendChild(n),this.makeTimingsPicker(i,t);const o=document.createElement("fragment");o.innerHTML='\n\t\t\t\t<a\n\t\t\t\t\thref="javascript:void(0)"\n\t\t\t\t\tclass="delete-cooldown link-danger"\n\t\t\t\t\trole="button"\n\t\t\t\t>\n\t\t\t\t\t<i class="fa fa-times fa-xl"></i>\n\t\t\t\t</a>\n\t\t\t';const l=o.children[0],r=mn(l,{content:"Delete Cooldown"});l.addEventListener("click",(e=>{const s=this.player.getSimpleCooldowns();s.cooldowns.splice(t,1),this.player.setSimpleCooldowns(a.nextEventID(),s),r.hide()})),i.appendChild(l),this.cooldownPickers.push(i)}}makeActionPicker(e,t){const s=this.player.getMetadata().getSpells().filter((e=>e.data.isMajorCooldown)).map((e=>e.id));return new mo(e,this.player,{extraCssClasses:["cooldown-action-picker"],numColumns:3,values:[{color:"#grey",value:ks.create()}].concat(s.map((e=>({actionId:()=>e,value:e.toProto()})))),equals:(e,t)=>ks.equals(e,t),zeroValue:ks.create(),backupIconUrl:e=>x.fromProto(e),changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.id||ks.create(),setValue:(e,s,a)=>{const i=s.getSimpleCooldowns();for(;i.cooldowns.length<t;)i.cooldowns.push(Ei.create());i.cooldowns[t]=Ei.create({id:a,timings:[]}),s.setSimpleCooldowns(e,i)}})}makeTimingsPicker(e,t){return new Bg(e,this.player,{extraCssClasses:["cooldown-timings-picker"],placeholder:"20, 40, ...",changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getSimpleCooldowns().cooldowns[t]?.timings||[],setValue:(e,s,a)=>{const i=s.getSimpleCooldowns();i.cooldowns[t].timings=a,s.setSimpleCooldowns(e,i)},enableWhen:e=>{const s=e.getSimpleCooldowns().cooldowns[t];return s&&!ks.equals(s.id,ks.create())}})}}class jg extends kh{constructor(t,s){super(t,s,{identifier:"rotation-tab",title:"Rotation"}),this.leftCol=this.buildColumn(1,"rotation-tab-col"),this.simUI=s,this.leftPanel=e("div",{className:"rotation-tab-left tab-panel-left"}),this.rightPanel=e("div",{className:"rotation-tab-right tab-panel-right"}),this.leftPanel.appendChild(this.leftCol),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent(),this.updateSections(),this.simUI.player.rotationChangeEmitter.on((()=>this.updateSections()))}buildTabContent(){this.buildHeader(),this.buildAutoContent(),this.buildAplContent(),this.buildSimpleContent(),this.buildPresetConfigurationPicker(),this.buildSavedDataPickers()}updateSections(){this.rootElem.classList.remove("rotation-type-auto","rotation-type-simple","rotation-type-apl","rotation-type-legacy");let e="";switch(this.simUI.player.getRotationType()){case K.TypeAuto:e="rotation-type-auto";break;case K.TypeSimple:e="rotation-type-simple";break;case K.TypeAPL:e="rotation-type-apl"}this.rootElem.classList.add(e)}buildHeader(){const t=g(),s=g(),i=g();this.leftCol.appendChild(e("div",{ref:t,className:"rotation-tab-header d-flex justify-content-between align-items-baseline"},e("div",{ref:i}),e("button",{ref:s,className:"btn btn-sm btn-link btn-reset summary-table-reset-button"},e("i",{className:"fas fa-times me-1"}),"Reset APL"))),s.value.addEventListener("click",(()=>{this.simUI.applyEmptyAplRotation(a.nextEventID())})),this.simUI.player.rotationChangeEmitter.on((()=>{const e=this.simUI.player.getRotationType();s.value?.classList[e===K.TypeAPL?"remove":"add"]("hide")})),new Hd(i.value,this.simUI.player,{extraCssClasses:["w-auto"],id:"rotation-tab-rotation-type",label:"Rotation Type",labelTooltip:"Which set of options to use for specifying the rotation.",inline:!0,values:this.simUI.player.hasSimpleRotationGenerator()?[{value:K.TypeAuto,name:"Auto"},{value:K.TypeSimple,name:"Simple"},{value:K.TypeAPL,name:"APL"}]:[{value:K.TypeAuto,name:"Auto"},{value:K.TypeAPL,name:"APL"}],changedEvent:e=>e.rotationChangeEmitter,getValue:e=>e.getRotationType(),setValue:(e,t,s)=>{t.aplRotation.type=s,t.rotationChangeEmitter.emit(e)}})}buildAutoContent(){this.leftCol.appendChild(e("div",{className:"rotation-tab-auto"}))}buildAplContent(){const t=g();this.leftCol.appendChild(e("div",{ref:t,className:"rotation-tab-apl"})),new Wg(t.value,this.simUI,this.simUI.player)}buildSimpleContent(){if(!this.simUI.player.hasSimpleRotationGenerator()||!this.simUI.individualConfig.rotationInputs)return;const e="rotation-tab-simple",t=new lh(this.leftCol,"rotation-settings",{header:{title:"Rotation"}});t.rootElem.classList.add(e);const s=f.newGroupContainer();s.classList.add("rotation-icon-group","icon-group"),t.bodyElement.appendChild(s),this.simUI.individualConfig.rotationIconInputs?.length&&this.configureIconSection(s,this.simUI.individualConfig.rotationIconInputs.map((e=>Ro(s,this.simUI.player,e))),!0),this.configureInputSection(t.bodyElement,this.simUI.individualConfig.rotationInputs);const a=new lh(this.leftCol,"cooldown-settings",{header:{title:"Cooldowns",tooltip:ki}});a.rootElem.classList.add(e),new zg(a.bodyElement,this.simUI.player)}configureInputSection(e,t){t.inputs.forEach((t=>{t.extraCssClasses=[...t.extraCssClasses||[],"input-inline"],"number"==t.type?new sh(e,this.simUI.player,{...t,inline:!0}):"boolean"==t.type?new Et(e,this.simUI.player,{...t,inline:!0}):"enum"==t.type&&new Hd(e,this.simUI.player,{...t,inline:!0})}))}configureIconSection(e,t,s){t.length?s&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`)):e.classList.add("hide")}buildPresetConfigurationPicker(){new dg(this.rightPanel,this.simUI,["rotation"])}buildSavedDataPickers(){const e=new cg(this.rightPanel,this.simUI.player,{label:"Rotation",header:{title:"Saved Rotations"},storageKey:this.simUI.getSavedRotationStorageKey(),getData:e=>Pi.create({rotation:N.clone(e.aplRotation)}),setData:(e,t,s)=>{a.freezeAllAndDo((()=>{t.setAplRotation(e,s.rotation||N.create())}))},changeEmitters:[this.simUI.player.rotationChangeEmitter,this.simUI.player.talentsChangeEmitter],equals:(e,t)=>Pi.equals(e,t),toJson:e=>Pi.toJson(e),fromJson:e=>Pi.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),(this.simUI.individualConfig.presets.rotations||[]).forEach((t=>{const s=t.rotation;s.rotation||(s.rotation=N.create()),e.addSavedData({name:t.name,tooltip:t.tooltip,isPreset:!0,data:s,enableWhen:t.enableWhen,onLoad:t.onLoad})}))}))}}class $g extends p{constructor(e,t,s,i){super(e,"encounter-picker-root"),Zg(this.rootElem,t,s.showExecuteProportion),t.sim.waitForInit().then((()=>{const e=t.sim.db.getAllPresetTargets();new Hd(this.rootElem,t,{id:"encounter-npc",extraCssClasses:["damage-metrics","npc-picker"],label:"NPC",labelTooltip:"Selects a preset NPC configuration.",values:[{name:"Custom",value:-1}].concat(e.map(((e,t)=>({name:e.path,value:t})))),changedEvent:e=>e.changeEmitter,getValue:t=>e.findIndex((e=>Qg(t.primaryTarget,e.target))),setValue:(t,s,a)=>{-1!=a&&s.applyPresetTarget(t,e[a],0)}}),i.isIndividualSim()&&Qa(i.player.spec)&&new sh(this.rootElem,i.sim.raid,{id:"encounter-num-allies",label:"Num Allies",labelTooltip:"Number of allied players in the raid.",changedEvent:e=>e.targetDummiesChangeEmitter,getValue:e=>e.getTargetDummies(),setValue:(e,t,s)=>{t.setTargetDummies(e,s)}}),i.isIndividualSim()&&re(i.player.spec)&&new sh(this.rootElem,t,{id:"encounter-min-base-damage",label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:e=>e.changeEmitter,getValue:e=>e.primaryTarget.minBaseDamage,setValue:(e,t,s)=>{t.primaryTarget.minBaseDamage=s,t.targetsChangeEmitter.emit(e)}});const s=e.findIndex((e=>t.primaryTarget.id==e.target?.id)),n=e[s]?.target?.targetInputs||[];(n.length!=t.primaryTarget.targetInputs.length||t.primaryTarget.targetInputs.some(((e,t)=>e.label!=n[t].label)))&&(t.primaryTarget.targetInputs=n,t.targetsChangeEmitter.emit(a.nextEventID())),Yg(this.rootElem,t,0);const o=new Gg(i.rootElem,i,t),l=document.createElement("button");l.classList.add("advanced-button","btn","btn-primary"),l.textContent="Advanced",l.addEventListener("click",(()=>o.open())),this.rootElem.appendChild(l)}))}}class Gg extends ch{constructor(e,t,s){super(e,"advanced-encounter-picker-modal"),this.encounter=s,this.addHeader(),this.body.innerHTML='\n\t\t\t<div class="encounter-header"></div>\n\t\t\t<div class="encounter-targets"></div>\n\t\t';const a=this.rootElem.getElementsByClassName("encounter-header")[0],i=this.rootElem.getElementsByClassName("encounter-targets")[0];Zg(a,this.encounter,!0),t.isIndividualSim()||new Et(a,s,{id:"encounter-use-health",label:"Use Health",labelTooltip:"Uses a damage limit in place of a duration limit. Damage limit is equal to sum of all targets health.",inline:!0,changedEvent:e=>e.changeEmitter,getValue:e=>e.getUseHealth(),setValue:(e,t,s)=>{t.setUseHealth(e,s)}}),new gg(i,this.encounter,{extraCssClasses:["targets-picker","mb-0"],itemLabel:"Target",changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets,setValue:(e,t,s)=>{t.targets=s,t.targetsChangeEmitter.emit(e)},newItem:()=>Gn.getDefaultTarget(t.sim).target,copyItem:e=>ue.clone(e),newItemPicker:(e,t,a,i)=>new Kg(e,s,a,i),minimumItems:1})}addHeader(){const e=this.encounter.sim.db.getAllPresetEncounters();new Hd(this.header,this.encounter,{id:"encounter-preset-encouter",label:"Encounter",extraCssClasses:["encounter-picker","mb-0","pe-2","order-first"],values:[{name:"Custom",value:-1}].concat(e.map(((e,t)=>({name:e.path,value:t})))),changedEvent:e=>e.changeEmitter,getValue:t=>e.findIndex((e=>t.matchesPreset(e))),setValue:(t,s,a)=>{-1!=a&&s.applyPreset(t,e[a])}})}}class Kg extends f{getTarget(){return this.encounter.targets[this.targetIndex]||ue.create()}constructor(e,t,s,a){super(e,"target-picker-root",t,a),this.encounter=t,this.targetIndex=s,this.rootElem.innerHTML='\n\t\t\t<div class="picker-group target-picker-section target-picker-section1"></div>\n\t\t\t<div class="picker-group target-picker-section target-picker-section2"></div>\n\t\t\t<div class="picker-group target-picker-section target-picker-section3 threat-metrics"></div>\n\t\t';const i=this.rootElem.getElementsByClassName("target-picker-section1")[0],n=this.rootElem.getElementsByClassName("target-picker-section2")[0],o=this.rootElem.getElementsByClassName("target-picker-section3")[0],l=t.sim.db.getAllPresetTargets();new Hd(i,null,{id:"encounter-npc-picker",extraCssClasses:["npc-picker"],label:"NPC",labelTooltip:"Selects a preset NPC configuration.",values:[{name:"Custom",value:-1}].concat(l.map(((e,t)=>({name:e.path,value:t})))),changedEvent:()=>t.targetsChangeEmitter,getValue:()=>l.findIndex((e=>Qg(this.getTarget(),e.target))),setValue:(e,s,a)=>{-1!=a&&(t.applyPresetTarget(e,l[a],this.targetIndex),t.targetsChangeEmitter.emit(e))}}),this.aiPicker=new Hd(i,null,{id:"encounter-ai-picker",extraCssClasses:["ai-picker"],label:"AI",labelTooltip:"\n\t\t\t\t<p>Determines the target's ability rotation.</p>\n\t\t\t\t<p>Note that most rotations are not yet implemented.</p>\n\t\t\t",values:[{name:"None",value:0}].concat(l.map((e=>({name:e.path,value:e.target.id})))),changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().id,setValue:(e,s,a)=>{const i=this.getTarget();i.id=a,i.targetInputs=(l.find((e=>i.id==e.target?.id))?.target?.targetInputs||[]).map((e=>Ti.clone(e))),t.targetsChangeEmitter.emit(e)}}),this.levelPicker=new Hd(i,null,{id:"encounter-level-picker",label:"Level",values:[{name:"63",value:63},{name:"62",value:62},{name:"61",value:61},{name:"60",value:60},{name:"53",value:53},{name:"52",value:52},{name:"51",value:51},{name:"50",value:50},{name:"43",value:43},{name:"42",value:42},{name:"41",value:41},{name:"40",value:40},{name:"28",value:28},{name:"27",value:27},{name:"26",value:26},{name:"25",value:25}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().level,setValue:(e,s,a)=>{this.getTarget().level=a,t.targetsChangeEmitter.emit(e)}}),this.mobTypePicker=new Hd(i,null,{id:"encounter-mob-type",label:"Mob Type",values:ef,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().mobType,setValue:(e,s,a)=>{this.getTarget().mobType=a,t.targetsChangeEmitter.emit(e)}}),this.tankIndexPicker=new Hd(i,null,{id:"target-picker-tanked-by",extraCssClasses:["threat-metrics"],label:"Tanked By",labelTooltip:"Determines which player in the raid this enemy will attack. If no player is assigned to the specified tank slot, this enemy will not attack.",values:[{name:"None",value:-1},{name:"Main Tank",value:0},{name:"Tank 2",value:1},{name:"Tank 3",value:2},{name:"Tank 4",value:3}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().tankIndex,setValue:(e,s,a)=>{this.getTarget().tankIndex=a,t.targetsChangeEmitter.emit(e)}}),this.targetInputPickers=Yg(i,t,this.targetIndex),this.statPickers=Xg.map((e=>{const s=e.stat;return new sh(n,null,{id:`target-picker-stats-${e.stat}`,inline:!0,extraCssClasses:e.extraCssClasses,label:Ni.get(s),labelTooltip:e.tooltip,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().stats[s],setValue:(e,a,i)=>{this.getTarget().stats[s]=i,t.targetsChangeEmitter.emit(e)}})})),this.swingSpeedPicker=new sh(o,null,{id:"target-picker-swing-speed",label:"Swing Speed",labelTooltip:"Time in seconds between auto attacks. Set to 0 to disable auto attacks.",float:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().swingSpeed,setValue:(e,s,a)=>{this.getTarget().swingSpeed=a,t.targetsChangeEmitter.emit(e)}}),this.minBaseDamagePicker=new sh(o,null,{id:"target-picker-min-base-damage",label:"Min Base Damage",labelTooltip:"Base damage for auto attacks, i.e. lowest roll with 0 AP against a 0-armor Player.",changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().minBaseDamage,setValue:(e,s,a)=>{this.getTarget().minBaseDamage=a,t.targetsChangeEmitter.emit(e)}}),this.damageSpreadPicker=new sh(o,null,{id:"target-picker-damage-spread",label:"Damage Spread",labelTooltip:"Fractional spread between the minimum and maximum auto-attack damage from this enemy at 0 Attack Power.",float:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().damageSpread,setValue:(e,s,a)=>{this.getTarget().damageSpread=a,t.targetsChangeEmitter.emit(e)}}),this.dualWieldPicker=new Et(o,null,{id:"target-picker-dual-wield",label:"Dual Wield",labelTooltip:"Uses 2 separate weapons to attack.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().dualWield,setValue:(e,s,a)=>{this.getTarget().dualWield=a,t.targetsChangeEmitter.emit(e)}}),this.dwMissPenaltyPicker=new Et(o,null,{id:"target-picker-dw-miss-penalty",label:"DW Miss Penalty",labelTooltip:"Enables the Dual Wield Miss Penalty (+19% chance to miss) if dual wielding. Bosses in Hyjal/BT/SWP usually have this disabled to stop tanks from avoidance stacking.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().dualWieldPenalty,setValue:(e,s,a)=>{this.getTarget().dualWieldPenalty=a,t.targetsChangeEmitter.emit(e)},enableWhen:()=>this.getTarget().dualWield}),this.parryHastePicker=new Et(o,null,{id:"target-picker-parry-haste",label:"Parry Haste",labelTooltip:"Whether this enemy will gain parry haste when parrying attacks.",inline:!0,reverse:!0,changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().parryHaste,setValue:(e,s,a)=>{this.getTarget().parryHaste=a,t.targetsChangeEmitter.emit(e)}}),this.spellSchoolPicker=new Hd(o,null,{id:"target-picker-spell-school",label:"Spell School",labelTooltip:"Type of damage caused by auto attacks. This is usually Physical, but some enemies have elemental attacks.",values:[{name:"Physical",value:_i.SpellSchoolPhysical},{name:"Arcane",value:_i.SpellSchoolArcane},{name:"Fire",value:_i.SpellSchoolFire},{name:"Frost",value:_i.SpellSchoolFrost},{name:"Holy",value:_i.SpellSchoolHoly},{name:"Nature",value:_i.SpellSchoolNature},{name:"Shadow",value:_i.SpellSchoolShadow}],changedEvent:()=>t.targetsChangeEmitter,getValue:()=>this.getTarget().spellSchool,setValue:(e,s,a)=>{this.getTarget().spellSchool=a,t.targetsChangeEmitter.emit(e)}}),this.init()}getInputElem(){return null}getInputValue(){return ue.create({id:this.aiPicker.getInputValue(),level:this.levelPicker.getInputValue(),mobType:this.mobTypePicker.getInputValue(),tankIndex:this.tankIndexPicker.getInputValue(),swingSpeed:this.swingSpeedPicker.getInputValue(),minBaseDamage:this.minBaseDamagePicker.getInputValue(),dualWield:this.dualWieldPicker.getInputValue(),dualWieldPenalty:this.dwMissPenaltyPicker.getInputValue(),parryHaste:this.parryHastePicker.getInputValue(),spellSchool:this.spellSchoolPicker.getInputValue(),damageSpread:this.damageSpreadPicker.getInputValue(),stats:this.statPickers.map((e=>e.getInputValue())).map(((e,t)=>(new yn).withStat(Xg[t].stat,e))).reduce(((e,t)=>e.add(t))).asArray(),targetInputs:this.targetInputPickers.getInputValue()})}setInputValue(e){e&&(this.aiPicker.setInputValue(e.id),this.levelPicker.setInputValue(e.level),this.mobTypePicker.setInputValue(e.mobType),this.tankIndexPicker.setInputValue(e.tankIndex),this.swingSpeedPicker.setInputValue(e.swingSpeed),this.minBaseDamagePicker.setInputValue(e.minBaseDamage),this.dualWieldPicker.setInputValue(e.dualWield),this.dwMissPenaltyPicker.setInputValue(e.dualWieldPenalty),this.parryHastePicker.setInputValue(e.parryHaste),this.spellSchoolPicker.setInputValue(e.spellSchool),this.damageSpreadPicker.setInputValue(e.damageSpread),Xg.forEach(((t,s)=>this.statPickers[s].setInputValue(e.stats[t.stat]))),this.targetInputPickers.setInputValue(e.targetInputs))}}class Jg extends f{getTargetInput(){return this.encounter.targets[this.targetIndex].targetInputs[this.targetInputIndex]||Ti.create()}clearPickers(){this.boolPicker&&(this.boolPicker.rootElem.remove(),this.boolPicker=null),this.numberPicker&&(this.numberPicker.rootElem.remove(),this.numberPicker=null),this.enumPicker&&(this.enumPicker.rootElem.remove(),this.enumPicker=null)}constructor(e,t,s,a,i){super(e,"target-input-picker-root",t,i),this.encounter=t,this.targetIndex=s,this.targetInputIndex=a,this.boolPicker=null,this.numberPicker=null,this.enumPicker=null,this.init()}getInputElem(){return this.rootElem}getInputValue(){return Ti.create({boolValue:this.boolPicker?this.boolPicker.getInputValue():void 0,numberValue:this.numberPicker?this.numberPicker.getInputValue():void 0,enumValue:this.enumPicker?this.enumPicker.getInputValue():void 0})}setInputValue(e){if(e)if(e.inputType==Ri.Number){if(this.numberPicker&&this.numberPicker.inputConfig.label===e.label)return;this.clearPickers(),this.numberPicker=new sh(this.rootElem,null,{id:Qe(),label:e.label,labelTooltip:e.tooltip,changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().numberValue,setValue:(e,t,s)=>{this.getTargetInput().numberValue=s,this.encounter.targetsChangeEmitter.emit(e)}})}else if(e.inputType==Ri.Bool){if(this.boolPicker&&this.boolPicker.inputConfig.label===e.label)return;this.clearPickers(),this.boolPicker=new Et(this.rootElem,null,{id:Qe(),label:e.label,labelTooltip:e.tooltip,extraCssClasses:["input-inline"],changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().boolValue,setValue:(e,t,s)=>{this.getTargetInput().boolValue=s,this.encounter.targetsChangeEmitter.emit(e)}})}else e.inputType==Ri.Enum&&(this.clearPickers(),this.enumPicker=new Hd(this.rootElem,null,{id:Qe(),label:e.label,labelTooltip:e.tooltip,values:e.enumOptions.map(((e,t)=>({value:t,name:e}))),changedEvent:()=>this.encounter.targetsChangeEmitter,getValue:()=>this.getTargetInput().enumValue,setValue:(e,t,s)=>{this.getTargetInput().enumValue=s,this.encounter.targetsChangeEmitter.emit(e)}}))}}function Zg(e,t,s){const a=f.newGroupContainer();if(e.appendChild(a),new sh(a,t,{id:"encounter-duration",label:"Duration",labelTooltip:"The fight length for each sim iteration, in seconds.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDuration(),setValue:(e,t,s)=>{t.setDuration(e,s)},enableWhen:e=>!t.getUseHealth()}),new sh(a,t,{id:"encounter-duration-variation",label:"Duration +/-",labelTooltip:"Adds a random amount of time, in seconds, between [value, -1 * value] to each sim iteration. For example, setting Duration to 180 and Duration +/- to 10 will result in random durations between 170s and 190s.",changedEvent:e=>e.changeEmitter,getValue:e=>e.getDurationVariation(),setValue:(e,t,s)=>{t.setDurationVariation(e,s)},enableWhen:e=>!t.getUseHealth()}),s){const s=f.newGroupContainer();s.classList.add("execute-group"),e.appendChild(s),new sh(s,t,{id:"encounter-execute-proportion",label:"Execute Duration 20 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 20% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion20(),setValue:(e,t,s)=>{t.setExecuteProportion20(e,s/100)},enableWhen:e=>!t.getUseHealth()}),new sh(s,t,{id:"encounter-execute-proportion-25",label:"Execute Duration 25 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 25% HP) for the purpose of effects like Warlock's Drain Soul.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion25(),setValue:(e,t,s)=>{t.setExecuteProportion25(e,s/100)},enableWhen:e=>!t.getUseHealth()}),new sh(s,t,{id:"encounter-execute-proportion-35",label:"Execute Duration 35 (%)",labelTooltip:"Percentage of the total encounter duration, for which the targets will be considered to be in execute range (< 35% HP) for the purpose of effects like Warrior Execute or Mage Molten Fury.",changedEvent:e=>e.changeEmitter,getValue:e=>100*e.getExecuteProportion35(),setValue:(e,t,s)=>{t.setExecuteProportion35(e,s/100)},enableWhen:e=>!t.getUseHealth()})}}function Yg(e,t,s){return new gg(e,t,{allowedActions:[],itemLabel:"Target Input",extraCssClasses:["mb-0","w-100"],isCompact:!0,horizontalLayout:!0,changedEvent:e=>e.targetsChangeEmitter,getValue:e=>e.targets[s].targetInputs,setValue:(e,t,a)=>{t.targets[s].targetInputs=a,t.targetsChangeEmitter.emit(e)},newItem:()=>Ti.create(),copyItem:e=>Ti.clone(e),newItemPicker:(e,a,i,n)=>new Jg(e,t,s,i,n)})}function Qg(e,t){if(null==e!=(null==t))return!1;if(null==e)return!0;const s=ue.clone(t);return s.targetInputs=e.targetInputs,ue.equals(e,s)}const Xg=[{stat:c.StatHealth,tooltip:"",extraCssClasses:[]},{stat:c.StatArmor,tooltip:"",extraCssClasses:[]},{stat:c.StatArcaneResistance,tooltip:"",extraCssClasses:[]},{stat:c.StatFireResistance,tooltip:"",extraCssClasses:[]},{stat:c.StatFrostResistance,tooltip:"",extraCssClasses:[]},{stat:c.StatNatureResistance,tooltip:"",extraCssClasses:[]},{stat:c.StatShadowResistance,tooltip:"",extraCssClasses:[]},{stat:c.StatAttackPower,tooltip:"",extraCssClasses:["threat-metrics"]},{stat:c.StatBlockValue,tooltip:"",extraCssClasses:["threat-metrics"]}],ef=[{name:"None",value:Ci.MobTypeUnknown},{name:"Beast",value:Ci.MobTypeBeast},{name:"Demon",value:Ci.MobTypeDemon},{name:"Dragonkin",value:Ci.MobTypeDragonkin},{name:"Elemental",value:Ci.MobTypeElemental},{name:"Giant",value:Ci.MobTypeGiant},{name:"Humanoid",value:Ci.MobTypeHumanoid},{name:"Mechanical",value:Ci.MobTypeMechanical},{name:"Undead",value:Ci.MobTypeUndead}];function tf(e,t){return e.filter((e=>!t.individualConfig.excludeBuffDebuffInputs.includes(e.config)&&(0==e.stats.length||e.stats.some((e=>t.individualConfig.displayStats.includes(e)||Di.includes(e)))||t.individualConfig.includeBuffDebuffInputs.includes(e.config))))}class sf extends p{constructor(e,t){super(e,"consumes-picker-root"),this.simUI=t,this.simUI.sim.waitForInit().then((()=>{this.buildPotionsPicker(),this.buildFlaskPicker(),this.buildWeaponImbuePicker(),this.buildFoodPicker(),this.buildPhysicalBuffPickers(),this.buildDefensiveBuffPickers(),this.buildSpellPowerBuffPickers(),this.buildMiscConsumesPickers(),this.buildEngPickers(),this.buildPetPicker()}))}buildPotionsPicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Potions</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-potions"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-potions"),i=sd(tf(td,this.simUI),"Potions"),n=pr(tf(ur,this.simUI)),o=[Ro(s,this.simUI.player,i),Ro(s,this.simUI.player,n)];a.onAny([this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,o))),this.updateRow(t,o)}buildFlaskPicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Flasks</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-flasks"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-flasks"),i=Cr(tf(Pr,this.simUI)),n=[Ro(s,this.simUI.player,i)];a.onAny([this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,n))),this.updateRow(t,n)}buildWeaponImbuePicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Weapon Imbues</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-weapon-imbues"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-weapon-imbues"),i=Od(tf(Fd,this.simUI),"Main-Hand"),n=qd(tf(Wd,this.simUI),"Off-Hand"),o=[Ro(s,this.simUI.player,i),Ro(s,this.simUI.player,n)];a.onAny([this.simUI.player.gearChangeEmitter,this.simUI.player.raceChangeEmitter]).on((()=>this.updateRow(t,o))),this.updateRow(t,o)}buildFoodPicker(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Food</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-food"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-food"),a=Or(tf(Fr,this.simUI)),i=Kr(tf(Gr,this.simUI)),n=[Ro(s,this.simUI.player,a),Ro(s,this.simUI.player,qr),Ro(s,this.simUI.player,i)];this.updateRow(t,n)}buildPhysicalBuffPickers(){const e=this.simUI.individualConfig.epStats.includes(c.StatAgility),t=this.simUI.individualConfig.epStats.includes(c.StatStrength);if(!e&&!t)return;const s=document.createElement("fragment");s.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Physical</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-physical"></div>\n\t\t\t</div>\n\t\t';const a=this.rootElem.appendChild(s.children[0]),i=this.rootElem.querySelector(".consumes-physical"),n=cc(tf(rc,this.simUI),"Attack Power"),o=fc(tf(gc,this.simUI),"Agility"),l=vc(tf(xc,this.simUI),"Strength"),r=[Ro(i,this.simUI.player,n),Ro(i,this.simUI.player,o),Ro(i,this.simUI.player,l)];this.updateRow(a,r)}buildDefensiveBuffPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Defensive</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-defensive"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-defensive"),a=nc(tf(ic,this.simUI),"Health"),i=tc(tf(ec,this.simUI),"Armor"),n=[Ro(s,this.simUI.player,a),Ro(s,this.simUI.player,i)];this.updateRow(t,n)}buildSpellPowerBuffPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Spells</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-spells"></div>\n\t\t\t</div>\n    \t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-spells"),a=od(tf(nd,this.simUI),"Spell Damage"),i=dd(tf(cd,this.simUI),"Fire Damage"),n=ud(tf(md,this.simUI),"Frost Damage"),o=gd(tf(pd,this.simUI),"Shadow Damage"),l=Id(tf(fd,this.simUI),"Mana Regen"),r=[Ro(s,this.simUI.player,a),Ro(s,this.simUI.player,i),Ro(s,this.simUI.player,n),Ro(s,this.simUI.player,o),Ro(s,this.simUI.player,l)];this.updateRow(t,r)}buildMiscConsumesPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Miscellaneous</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-misc"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-misc"),a=Nc(tf(Tc,this.simUI),"Zanza Buffs"),i=tf(Ac,this.simUI),n=tf(Wc,this.simUI),o=[Ro(s,this.simUI.player,a),Lc(s,this.simUI.player,this.simUI,i),Fc(s,this.simUI.player,this.simUI,n)];this.updateRow(t,o)}buildEngPickers(){const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Engineering</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-engi"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-engi"),i=Sr(tf(wr,this.simUI),"Explosives"),n=xr(tf(br,this.simUI),"Sappers"),o=[Ro(s,this.simUI.player,n),Ro(s,this.simUI.player,i)];a.onAny([this.simUI.player.professionChangeEmitter]).on((()=>this.updateRow(t,o))),this.updateRow(t,o)}buildPetPicker(){if(!this.simUI.individualConfig.petConsumeInputs?.length)return;const e=document.createElement("fragment");e.innerHTML='\n\t\t\t<div class="consumes-row input-root input-inline">\n\t\t\t\t<label class="form-label">Pet</label>\n\t\t\t\t<div class="picker-group icon-group consumes-row-inputs consumes-pet"></div>\n\t\t\t</div>\n\t\t';const t=this.rootElem.appendChild(e.children[0]),s=this.rootElem.querySelector(".consumes-pet"),a=[...this.simUI.individualConfig.petConsumeInputs.map((e=>Ro(s,this.simUI.player,e)))];this.updateRow(t,a)}updateRow(e,t){t.find((e=>e?.showWhen()))?e.classList.remove("hide"):e.classList.add("hide")}}class af extends p{constructor(e,t,s,a){super(e,"icon-picker-root"),this.rootElem.classList.add("icon-picker"),this.player=s,this.slot=a,this.iconAnchor=document.createElement("a"),this.iconAnchor.classList.add("icon-picker-button"),this.iconAnchor.target="_blank",this.rootElem.prepend(this.iconAnchor);const i=new vh(t.rootElem,t,this.player);s.sim.waitForInit().then((()=>{this.iconAnchor.addEventListener("click",(e=>{e.preventDefault(),i.openTab(this.slot,xh.Items,this.createGearData())}))})),s.itemSwapChangeEmitter.on((()=>{this.update(s.getItemSwapGear().getEquippedItem(a))}))}update(e){this.iconAnchor.style.backgroundImage=`url('${Sh(this.slot)}')`,this.iconAnchor.removeAttribute("data-wowhead"),this.iconAnchor.href="#",e?(this.iconAnchor.classList.add("active"),e.asActionId().fillAndSet(this.iconAnchor,!0,!0),this.player.setWowheadData(e,this.iconAnchor)):this.iconAnchor.classList.remove("active")}createGearData(){return{equipItem:(e,t)=>{this.player.equipItemSwapitem(e,this.slot,t)},getEquippedItem:()=>this.player.getItemSwapItem(this.slot),changeEvent:this.player.itemSwapChangeEmitter}}}class nf extends p{constructor(t,s,i,n){super(t,"item-swap-picker-root"),this.itemSlots=n.itemSlots,this.enableItemSwapPicker=new Et(this.rootElem,i,{id:"enable-item-swap",reverse:!0,label:"Enable Item Swapping",labelTooltip:"Allows configuring an Item Swap Set which is used with the <b>Item Swap</b> APL action.",extraCssClasses:["input-inline"],getValue:e=>e.getEnableItemSwap(),setValue(e,t,s){t.setEnableItemSwap(e,s)},changedEvent:e=>e.itemSwapChangeEmitter});const o=document.createElement("div");let l;o.classList.add("input-root","input-inline"),this.rootElem.appendChild(o),n.note&&(l=this.rootElem.appendChild(e("p",{className:"form-text"},n.note)));const r=()=>{i.getEnableItemSwap()?(o.classList.remove("hide"),l?.classList.remove("hide")):(o.classList.add("hide"),l?.classList.add("hide"))};i.itemSwapChangeEmitter.on(r),r();const c=document.createElement("label");c.classList.add("form-label"),c.textContent="Item Swap",o.appendChild(c);const d=f.newGroupContainer();d.classList.add("icon-group"),o.appendChild(d);const h=e("a",{href:"javascript:void(0)",className:"gear-swap-icon",attributes:{role:"button"}},e("i",{className:"fas fa-arrows-rotate me-1"}));h.addEventListener("click",(e=>this.swapWithGear(a.nextEventID(),i))),d.appendChild(h),mn(h,{content:"Swap with equipped items"}),this.itemSlots.forEach((e=>{new af(d,s,i,e)}))}swapWithGear(e,t){let s=t.getGear(),i=t.getItemSwapGear();this.itemSlots.forEach((e=>{const a=t.getGear().getEquippedItem(e),n=t.getItemSwapGear().getEquippedItem(e);s=s.withEquippedItem(e,n),i=i.withEquippedItem(e,a)})),a.freezeAllAndDo((()=>{t.setGear(e,s),t.setItemSwapGear(e,i)}))}}class of extends kh{constructor(e,t){super(e,t,{identifier:"settings-tab",title:"Settings"}),this.column1=this.buildColumn(1,"settings-left-col"),this.column2=this.buildColumn(2,"settings-left-col"),this.column3=this.buildColumn(3,"settings-left-col"),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("settings-tab-left","tab-panel-left"),this.leftPanel.appendChild(this.column1),this.leftPanel.appendChild(this.column2),this.leftPanel.appendChild(this.column3),this.simUI.isWithinRaidSim&&(this.column4=this.buildColumn(4,"settings-left-col"),this.leftPanel.appendChild(this.column4)),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("settings-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.simUI.isWithinRaidSim||this.buildEncounterSettings(),this.simUI.sim.waitForInit().then((()=>{this.buildPlayerSettings(),this.buildCustomSettingsSections(),this.buildConsumesSection(),this.buildOtherSettings(),this.buildIsbSettings(),this.buildStormstrikeSettings(),this.simUI.isWithinRaidSim||(this.buildBuffsSettings(),this.buildWorldBuffsSettings(),this.buildDebuffsSettings(),this.buildPresetConfigurationPicker(),this.buildSavedDataPickers())}))}buildEncounterSettings(){const e=new lh(this.column1,"encounter-settings",{header:{title:"Encounter"}});new $g(e.bodyElement,this.simUI.sim.encounter,this.simUI.individualConfig.encounterPicker,this.simUI)}buildPlayerSettings(){const e=new lh(this.column1,"player-settings",{header:{title:"Player"}}),t=f.newGroupContainer();t.classList.add("player-icon-group","icon-group"),e.bodyElement.appendChild(t),this.configureIconSection(t,this.simUI.individualConfig.playerIconInputs.map((e=>Ro(t,this.simUI.player,e))),!0);const s=D[this.simUI.player.spec];new Hd(e.bodyElement,this.simUI.player,{id:"player-race",label:"Race",values:s.map((e=>({name:Ai.get(e),value:e}))),changedEvent:e=>e.raceChangeEmitter,getValue:e=>e.getRace(),setValue:(e,t,s)=>t.setRace(e,s)}),this.simUI.individualConfig.playerInputs?.inputs.length&&this.configureInputSection(e.bodyElement,this.simUI.individualConfig.playerInputs);const a=f.newGroupContainer();e.bodyElement.appendChild(a);const i=r(F);new Hd(a,this.simUI.player,{id:"player-profession-1",label:"Profession 1",values:i.map((e=>({name:Jt.get(e),value:e}))),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession1(),setValue:(e,t,s)=>t.setProfession1(e,s)}),new Hd(a,this.simUI.player,{id:"player-profession-2",label:"Profession 2",values:i.map((e=>({name:Jt.get(e),value:e}))),changedEvent:e=>e.professionChangeEmitter,getValue:e=>e.getProfession2(),setValue:(e,t,s)=>t.setProfession2(e,s)})}buildCustomSettingsSections(){(this.simUI.individualConfig.customSections||[]).forEach((e=>{e(this.column2,this.simUI).rootElem.classList.add("custom-section")}))}buildConsumesSection(){const e=this.simUI.isWithinRaidSim?this.column3:this.column2,t=new lh(e,"consumes-settings",{header:{title:"Consumables"}});new sf(t.bodyElement,this.simUI)}buildOtherSettings(){const e=this.simUI.individualConfig.otherInputs?.inputs.filter((e=>!e.extraCssClasses||!e.extraCssClasses?.includes("within-raid-sim-hide"))),t=this.simUI.individualConfig.itemSwapConfig;if(e.length||t?.itemSlots.length){const s=new lh(this.column2,"other-settings",{header:{title:"Other"}});e.length&&(this.configureInputSection(s.bodyElement,this.simUI.individualConfig.otherInputs),s.bodyElement.querySelectorAll(".input-root").forEach((e=>{e.classList.add("input-inline")}))),t?.itemSlots.length&&new nf(s.bodyElement,this.simUI,this.simUI.player,t)}}buildIsbSettings(){if(!this.simUI.isWithinRaidSim){const e=new lh(this.column1,"other-settings",{header:{title:"Improved Shadow Bolt"}});this.configureInputSection(e.bodyElement,Gd),a.onAny([this.simUI.player.talentsChangeEmitter,this.simUI.player.getRaid().debuffsChangeEmitter]).on((()=>{const t=this.simUI.player?.getTalents().improvedShadowBolt>0;1==this.simUI.player.getRaid()?.getDebuffs()?.improvedShadowBolt||t?e.rootElem.classList.remove("hide"):e.rootElem.classList.add("hide")}))}}buildStormstrikeSettings(){if(!this.simUI.isWithinRaidSim){const e=new lh(this.column1,"other-settings",{header:{title:"Stormstrike"}});this.configureInputSection(e.bodyElement,Kd),this.simUI.player.getRaid().debuffsChangeEmitter.on((()=>{this.simUI.player.getRaid()?.getDebuffs()?.stormstrike?e.rootElem.classList.remove("hide"):e.rootElem.classList.add("hide")}))}}buildBuffsSettings(){const e=tf($l,this.simUI),t=tf(Gl,this.simUI),s=new lh(this.column3,"buffs-settings",{header:{title:"Raid Buffs",tooltip:Li}});this.configureIconSection(s.bodyElement,e.map((e=>e.picker&&new e.picker(s.bodyElement,this.simUI.player,e.config,this.simUI)))),t.length&&new Ho(s.bodyElement,this.simUI.player,{values:t.map((e=>e.config)),label:"Misc Buffs"},this.simUI)}buildWorldBuffsSettings(){const e=new lh(this.column3,"world-buffs-settings",{header:{title:"World Buffs",tooltip:Vi}}),t=tf(Jl,this.simUI);new mo(e.bodyElement,this.simUI.player,wl(t));const s=tf(Kl,this.simUI);this.configureIconSection(e.bodyElement,s.map((t=>t.picker&&new t.picker(e.bodyElement,this.simUI.player,t.config,this.simUI))))}buildDebuffsSettings(){const e=tf(Zl,this.simUI),t=tf(Yl,this.simUI);if(!e.length&&!t.length)return;const s=new lh(this.column3,"debuffs-settings",{header:{title:"Debuffs",tooltip:Mi}});this.configureIconSection(s.bodyElement,e.map((e=>e.picker&&new e.picker(s.bodyElement,this.simUI.player,e.config,this.simUI)))),t.length&&new Ho(s.bodyElement,this.simUI.player,{values:t.map((e=>e.config)),label:"Misc Debuffs"},this.simUI),this.simUI.player.getRaid()?.debuffsChangeEmitter.emit(a.nextEventID())}buildPresetConfigurationPicker(){new dg(this.rightPanel,this.simUI,["encounter","options"])}buildSavedDataPickers(){const e=new cg(this.rightPanel,this.simUI.sim.encounter,{label:"Encounter",header:{title:"Saved Encounters"},storageKey:this.simUI.getSavedEncounterStorageKey(),getData:e=>Ui.create({encounter:e.toProto()}),setData:(e,t,s)=>t.fromProto(e,s.encounter),changeEmitters:[this.simUI.sim.encounter.changeEmitter],equals:(e,t)=>Ui.equals(e,t),toJson:e=>Ui.toJson(e),fromJson:e=>Ui.fromJson(e)}),t=new cg(this.rightPanel,this.simUI,{label:"Settings",header:{title:"Saved Settings"},storageKey:this.simUI.getSavedSettingsStorageKey(),getData:e=>{const t=e.player;return Wi.create({raidBuffs:e.sim.raid.getBuffs(),partyBuffs:t.getParty()?.getBuffs()||s.create(),playerBuffs:t.getBuffs(),debuffs:e.sim.raid.getDebuffs(),consumes:t.getConsumes(),race:t.getRace(),professions:t.getProfessions(),enableItemSwap:t.getEnableItemSwap(),itemSwap:t.getItemSwapGear().toProto(),reactionTimeMs:t.getReactionTime(),channelClipDelayMs:t.getChannelClipDelay(),inFrontOfTarget:t.getInFrontOfTarget(),distanceFromTarget:t.getDistanceFromTarget(),healingModel:t.getHealingModel()})},setData:(e,t,i)=>{a.freezeAllAndDo((()=>{t.sim.raid.setBuffs(e,i.raidBuffs||ge.create()),t.sim.raid.setDebuffs(e,i.debuffs||fe.create());const a=t.player.getParty();a&&a.setBuffs(e,i.partyBuffs||s.create()),t.player.setBuffs(e,i.playerBuffs||k.create()),t.player.setConsumes(e,i.consumes||P.create()),t.player.setRace(e,i.race),t.player.setProfessions(e,i.professions),t.player.setEnableItemSwap(e,i.enableItemSwap),t.player.setItemSwapGear(e,t.sim.db.lookupItemSwap(i.itemSwap||Fi.create())),t.player.setReactionTime(e,i.reactionTimeMs),t.player.setChannelClipDelay(e,i.channelClipDelayMs),t.player.setInFrontOfTarget(e,i.inFrontOfTarget),t.player.setDistanceFromTarget(e,i.distanceFromTarget),t.player.setHealingModel(e,i.healingModel||_.create())}))},changeEmitters:[this.simUI.sim.raid.buffsChangeEmitter,this.simUI.sim.raid.debuffsChangeEmitter,this.simUI.player.getParty().buffsChangeEmitter,this.simUI.player.buffsChangeEmitter,this.simUI.player.consumesChangeEmitter,this.simUI.player.raceChangeEmitter,this.simUI.player.professionChangeEmitter,this.simUI.player.itemSwapChangeEmitter,this.simUI.player.miscOptionsChangeEmitter,this.simUI.player.inFrontOfTargetChangeEmitter,this.simUI.player.distanceFromTargetChangeEmitter,this.simUI.player.healingModelChangeEmitter],equals:(e,t)=>Wi.equals(e,t),toJson:e=>Wi.toJson(e),fromJson:e=>Wi.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),t.loadUserData()}))}configureInputSection(e,t){t.inputs.forEach((t=>{"number"==t.type?new sh(e,this.simUI.player,t):"boolean"==t.type?new Et(e,this.simUI.player,{...t,reverse:!0}):"enum"==t.type&&new Hd(e,this.simUI.player,t)}))}configureIconSection(e,t,s){0==t.length?e.classList.add("hide"):s&&(t.length<=4?e.style.gridTemplateColumns=`repeat(${t.length}, 1fr)`:t.length>4&&t.length<8&&(e.style.gridTemplateColumns=`repeat(${Math.ceil(t.length/2)}, 1fr)`))}}class lf extends kh{constructor(e,t){super(e,t,{identifier:"talents-tab",title:"Talents"}),this.simUI=t,this.leftPanel=document.createElement("div"),this.leftPanel.classList.add("talents-tab-left","tab-panel-left"),this.rightPanel=document.createElement("div"),this.rightPanel.classList.add("talents-tab-right","tab-panel-right","within-raid-sim-hide"),this.contentContainer.appendChild(this.leftPanel),this.contentContainer.appendChild(this.rightPanel),this.buildTabContent()}buildTabContent(){this.buildTalentsPicker(this.leftPanel),this.buildPresetConfigurationPicker(),this.buildSavedTalentsPicker()}buildTalentsPicker(e){new kn(e,this.simUI.player,{klass:this.simUI.player.getClass(),trees:Fn[this.simUI.player.getClass()],changedEvent:e=>e.talentsChangeEmitter,getValue:e=>e.getTalentsString(),setValue:(e,t,s)=>{t.setTalentsString(e,s)},pointsPerRow:5})}buildPresetConfigurationPicker(){new dg(this.rightPanel,this.simUI,["talents"])}buildSavedTalentsPicker(){const e=new cg(this.rightPanel,this.simUI.player,{label:"Talents",header:{title:"Saved Talents"},storageKey:this.simUI.getSavedTalentsStorageKey(),getData:e=>bs.create({talentsString:e.getTalentsString()}),setData:(e,t,s)=>{a.freezeAllAndDo((()=>{t.setTalentsString(e,s.talentsString)}))},changeEmitters:[this.simUI.player.talentsChangeEmitter],equals:(e,t)=>bs.equals(e,t),toJson:e=>bs.toJson(e),fromJson:e=>bs.fromJson(e)});this.simUI.sim.waitForInit().then((()=>{e.loadUserData(),this.simUI.individualConfig.presets.talents.forEach((t=>{t.isPreset=!0,e.addSavedData({name:t.name,isPreset:!0,data:t.data,enableWhen:t.enableWhen})}))}))}}const rf=class e extends ch{constructor(e,t,s,i){super(e.rootElem,"ep-weights-menu",function(e){const t={footer:!0,scrollContents:!0};return e.sim.getShowThreatMetrics()&&e.sim.getShowExperimental()?{size:"xl",...t}:t}(e)),this.showAllStats=!1,this.simUI=e,this.statsType="ep",this.epStats=t,this.epPseudoStats=s,this.epReferenceStat=i,this.header?.insertAdjacentHTML("afterbegin",'<h5 class="modal-title">Calculate Stat Weights</h5>'),this.body.innerHTML='\n\t\t\t<div class="ep-weights-options row">\n\t\t\t\t<div class="col col-sm-3">\n\t\t\t\t\t<select class="ep-type-select form-select">\n\t\t\t\t\t\t<option value="ep">EP</option>\n\t\t\t\t\t\t<option value="weight">Weights</option>\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="show-all-stats-container col col-sm-3"></div>\n\t\t\t</div>\n\t\t\t<div class="ep-reference-options row experimental">\n\t\t\t\t<div class="col col-sm-4 damage-metrics">\n\t\t\t\t\t<span>DPS/TPS reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select damage-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col col-sm-4 healing-metrics">\n\t\t\t\t\t<span>Healing reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select healing-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<div class="col col-sm-4 threat-metrics">\n\t\t\t\t\t<span>Mitigation reference:</span>\n\t\t\t\t\t<select class="ref-stat-select form-select threat-metrics">\n\t\t\t\t\t</select>\n\t\t\t\t</div>\n\t\t\t\t<p>The above stat selectors control which reference stat is used for EP normalisation for the different EP columns.</p>\n\t\t\t</div>\n\t\t\t<p>The \'Current EP\' column displays the values currently used by the item pickers to sort items.</br>\n\t\t\tUse the <a href=\'javascript:void(0)\' class="fa fa-copy"></a> icon above the EPs to use newly calculated EPs.</p>\n\t\t\t<div class="results-ep-table-container modal-scroll-table">\n\t\t\t\t<div class="results-pending-overlay"></div>\n\t\t\t\t<table class="results-ep-table">\n\t\t\t\t\t<thead>\n\t\t\t\t\t\t<tr>\n\t\t\t\t\t\t\t<th>Stat</th>\n\t\t\t\t\t\t\t<th class="damage-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>DPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="damage-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>DPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="healing-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>HPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="healing-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>HPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>TPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>TPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight">\n\t\t\t\t\t\t\t\t<span>DTPS Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep">\n\t\t\t\t\t\t\t\t<span>DTPS EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight experimental">\n\t\t\t\t\t\t\t\t<span>TMI Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep experimental">\n\t\t\t\t\t\t\t\t<span>TMI EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-weight experimental">\n\t\t\t\t\t\t\t\t<span>Death Weight</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th class="threat-metrics type-ep experimental">\n\t\t\t\t\t\t\t\t<span>Death EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fa fa-copy"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t\t<th style="text-align: center">\n\t\t\t\t\t\t\t\t<span>Current EP</span>\n\t\t\t\t\t\t\t\t<a href="javascript:void(0)" role="button" class="col-action">\n\t\t\t\t\t\t\t\t\t<i class="fas fa-arrows-rotate"></i>\n\t\t\t\t\t\t\t\t</a>\n\t\t\t\t\t\t\t</th>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t\t<tr class="ep-ratios">\n\t\t\t\t\t\t\t<td>EP Ratio</td>\n\t\t\t\t\t\t\t<td class="damage-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="damage-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="healing-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="healing-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-weight experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td class="threat-metrics type-ratio type-ep experimental">\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t\t<td style="text-align: center; vertical-align: middle;">\n\t\t\t\t\t\t\t\t<button class="btn btn-primary compute-ep">\n\t\t\t\t\t\t\t\t\t<i class="fas fa-calculator"></i>\n\t\t\t\t\t\t\t\t\t<span class="not-tiny">Update </span>EP\n\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t</td>\n\t\t\t\t\t\t</tr>\n\t\t\t\t\t</thead>\n\t\t\t\t\t<tbody></tbody>\n\t\t\t\t</table>\n\t\t\t</div>\n\t\t',this.footer.innerHTML='\n\t\t\t<button class="btn btn-primary calc-weights">\n\t\t\t\t<i class="fas fa-calculator"></i>\n\t\t\t\tCalculate\n\t\t\t</button>\n\t\t',this.container=this.rootElem.querySelector(".results-ep-table-container"),this.table=this.rootElem.querySelector(".results-ep-table"),this.tableBody=this.rootElem.querySelector(".results-ep-table tbody");const n=this.rootElem.querySelector(".results-pending-overlay");this.resultsViewer=new Eh(n);const o=()=>{"ep"==this.statsType?(this.table.classList.remove("stats-type-weight"),this.table.classList.add("stats-type-ep")):(this.table.classList.add("stats-type-weight"),this.table.classList.remove("stats-type-ep"))},l=this.rootElem.getElementsByClassName("ep-type-select")[0];l.addEventListener("input",(e=>{this.statsType=l.value,o()})),l.value=this.statsType,o();const r=e=>void 0!==e?h(e,this.simUI.player.getClass()):"??",c=e=>{for(const t of this.epStats)if(r(t)==e)return t},d=()=>{this.simUI.player.epRefStatChangeEmitter.emit(a.nextEventID()),this.simUI.prevEpSimResult=this.calculateEp(this.getPrevSimResult()),this.updateTable()};this.rootElem.querySelectorAll(".ref-stat-select").forEach(((e,t)=>{this.epStats.forEach((t=>{e.options[e.options.length]=new Option(r(t))})),e.classList.contains("damage-metrics")?(e.addEventListener("input",(t=>{this.simUI.dpsRefStat=c(e.value),d()})),e.value=r(this.getDpsEpRefStat())):e.classList.contains("healing-metrics")?(e.addEventListener("input",(t=>{this.simUI.healRefStat=c(e.value),d()})),e.value=r(this.getHealEpRefStat())):e.classList.contains("threat-metrics")&&(e.addEventListener("input",(t=>{this.simUI.tankRefStat=c(e.value),d()})),e.value=r(this.getTankEpRefStat()))}));const m=this.rootElem.getElementsByClassName("calc-weights")[0];let u=!1;m.addEventListener("click",(async t=>{if(u)return;u=!0;try{await this.simUI.sim.signalManager.abortType(ze.All)}catch(l){return void console.error(l)}m.disabled=!0;const s=m.innerHTML;m.style.width=`${m.getBoundingClientRect().width.toFixed(3)}px`,m.innerHTML='<i class="fa fa-spinner fa-spin"></i>&nbsp;Running',this.container.scrollTo({top:0}),this.container.classList.add("pending"),this.resultsViewer.setPending();const i=this.simUI.sim.getIterations();let n=!1;this.resultsViewer.addAbortButton((async()=>{if(!n)try{n=!0,await e.sim.signalManager.abortType(ze.StatWeights)}catch(l){console.error("Error on stat weight abort!"),console.error(l)}finally{n=!1,u||(m.disabled=!1,m.innerHTML=s)}}));const o=await this.simUI.player.computeStatWeights(a.nextEventID(),this.epStats,this.epPseudoStats,this.epReferenceStat,(e=>{this.setSimProgress(e)}));this.container.classList.remove("pending"),this.resultsViewer.hideAll(),u=!1,n||(m.disabled=!1,m.innerHTML=s),o&&(this.simUI.prevEpIterations=i,this.simUI.prevEpSimResult=this.calculateEp(o),this.updateTable())})),this.addOnHideCallback((()=>{this.simUI.sim.signalManager.abortType(ze.StatWeights).catch(console.error)}));const p=Array.from(this.rootElem.getElementsByClassName("col-action")),g=(e,t,s,i,n)=>{const o=e.previousElementSibling;mn(o,{content:()=>{if(!n)return t;const e=r(n());return t+` Normalized by ${e}.`}}),mn(e,{content:s}),e.addEventListener("click",(e=>{this.simUI.player.setEpWeights(a.nextEventID(),yn.fromProto(i())),this.updateTable()}))};g(p[0],"Per-point increase in DPS (Damage Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dps.weights)),g(p[1],"EP (Equivalency Points) for DPS (Damage Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dps.epValues),(()=>this.getDpsEpRefStat())),g(p[2],"Per-point increase in HPS (Healing Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().hps.weights)),g(p[3],"EP (Equivalency Points) for HPS (Healing Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().hps.epValues),(()=>this.getHealEpRefStat())),g(p[4],"Per-point increase in TPS (Threat Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tps.weights)),g(p[5],"EP (Equivalency Points) for TPS (Threat Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tps.epValues),(()=>this.getDpsEpRefStat())),g(p[6],"Per-point increase in DTPS (Damage Taken Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dtps.weights)),g(p[7],"EP (Equivalency Points) for DTPS (Damage Taken Per Second) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().dtps.epValues),(()=>this.getTankEpRefStat())),g(p[8],"Per-point decrease in TMI (Theck-Meloree Index) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tmi.weights)),g(p[9],"EP (Equivalency Points) for TMI (Theck-Meloree Index) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().tmi.epValues),(()=>this.getTankEpRefStat())),g(p[10],"Per-point decrease in p(death) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().pDeath.weights)),g(p[11],"EP (Equivalency Points) for p(death) for each stat.","Copy to Current EP",(()=>this.getPrevSimResult().pDeath.epValues),(()=>this.getTankEpRefStat())),g(p[12],"Current EP Weights. Used to sort the gear selector menus.","Restore Default EP",(()=>this.simUI.individualConfig.defaults.epWeights.toProto()));const f=this.rootElem.getElementsByClassName("show-all-stats-container")[0];new Et(f,this,{id:"ep-show-all-stats",label:"Show All Stats",inline:!0,changedEvent:()=>new a,getValue:()=>this.showAllStats,setValue:(e,t,s)=>{this.showAllStats=s,this.updateTable()}}),this.updateTable();const I=(e,t)=>{new sh(e,this.simUI.player,{id:`ep-ratio-${t}`,float:!0,changedEvent:e=>e.epRatiosChangeEmitter,getValue:e=>this.simUI.player.getEpRatios()[t],setValue:(e,s,a)=>{const i=s.getEpRatios();i[t]=a,s.setEpRatios(e,i)}})};this.body.querySelectorAll(".type-ratio.type-ep").forEach(I),this.simUI.player.epRatiosChangeEmitter.on((e=>this.updateTable()));this.body.querySelectorAll(".type-ratio.type-weight").forEach(I);const w=this.rootElem.getElementsByClassName("compute-ep")[0];mn(w,{content:"Compute Weighted EP"}),w.addEventListener("click",(e=>{const t=this.getPrevSimResult(),s=this.simUI.player.getEpRatios();if("ep"==this.statsType){const e=yn.fromProto(t.dps.epValues).scale(s[0]),i=yn.fromProto(t.hps.epValues).scale(s[1]),n=yn.fromProto(t.tps.epValues).scale(s[2]),o=yn.fromProto(t.dtps.epValues).scale(s[3]),l=yn.fromProto(t.tmi.epValues).scale(s[4]),r=yn.fromProto(t.pDeath.epValues).scale(s[5]),c=e.add(i).add(n).add(o).add(l).add(r);this.simUI.player.setEpWeights(a.nextEventID(),c)}else{const e=yn.fromProto(t.dps.weights).scale(s[0]),i=yn.fromProto(t.hps.weights).scale(s[1]),n=yn.fromProto(t.tps.weights).scale(s[2]),o=yn.fromProto(t.dtps.weights).scale(s[3]),l=yn.fromProto(t.tmi.weights).scale(s[4]),r=yn.fromProto(t.pDeath.weights).scale(s[5]),c=e.add(i).add(n).add(o).add(l).add(r);this.simUI.player.setEpWeights(a.nextEventID(),c)}this.updateTable()}))}setSimProgress(e){this.resultsViewer.setContent(`\n\t\t\t<div class="results-sim">\n\t\t\t\t<div class=""> ${e.completedSims} / ${e.totalSims}<br>simulations complete</div>\n\t\t\t\t<div class="">\n\t\t\t\t\t${e.completedIterations} / ${e.totalIterations}<br>iterations complete\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t`)}updateTable(){this.tableBody.innerHTML="",e.epUnitStats.forEach((e=>{if(!this.showAllStats&&e.isStat()&&!this.epStats.includes(e.getStat())||e.isPseudoStat()&&!this.epPseudoStats.includes(e.getPseudoStat()))return;const t=this.makeTableRow(e);this.tableBody.appendChild(t)}))}makeTableRow(e){const t=document.createElement("tr"),s=this.simUI.prevEpSimResult,a=this.simUI.player.getEpRatios(),i=function(e,t,s){return s?(s.dps?.epValues?t[0]*e.getProtoValue(s.dps.epValues):0)+(s.hps?.epValues?t[1]*e.getProtoValue(s.hps.epValues):0)+(s.tps?.epValues?t[2]*e.getProtoValue(s.tps.epValues):0)+(s.dtps?.epValues?t[3]*e.getProtoValue(s.dtps.epValues):0)+(s.tmi?.epValues?t[4]*e.getProtoValue(s.tmi.epValues):0)+(s.pDeath?.epValues?t[5]*e.getProtoValue(s.pDeath.epValues):0):0}(e,a,s);t.innerHTML=`\n\t\t\t<td>${e.getName(this.simUI.player.getClass())}</td>\n\t\t\t${this.makeTableRowCells(e,s?.dps,"damage-metrics",i,a[0])}\n\t\t\t${this.makeTableRowCells(e,s?.hps,"healing-metrics",i,a[1])}\n\t\t\t${this.makeTableRowCells(e,s?.tps,"threat-metrics",i,a[2])}\n\t\t\t${this.makeTableRowCells(e,s?.dtps,"threat-metrics",i,a[3])}\n\t\t\t${this.makeTableRowCells(e,s?.tmi,"threat-metrics experimental",i,a[4])}\n\t\t\t${this.makeTableRowCells(e,s?.pDeath,"threat-metrics experimental",i,a[5])}\n\t\t\t<td class="current-ep"></td>\n\t\t`;const n=t.querySelector(".current-ep");return new sh(n,this.simUI.player,{id:`ep-weight-stat-${e}`,float:!0,changedEvent:e=>e.epWeightsChangeEmitter,getValue:t=>this.simUI.player.getEpWeights().getUnitStat(e),setValue:(t,s,a)=>{const i=s.getEpWeights().withUnitStat(e,a);s.setEpWeights(t,i)}}),t}makeTableRowCells(e,t,s,a,i){let n,o;if(t){const s=e.getProtoValue(t.weights),a=e.getProtoValue(t.weightsStdev);n=this.makeTableCellContents(s,a);const i=e.getProtoValue(t.epValues),l=e.getProtoValue(t.epValuesStdev);o=this.makeTableCellContents(i,l)}else n='<span class="results-avg notapplicable">N/A</span>',o=n;const l=document.createElement("template");if(l.innerHTML=`\n\t\t\t<td class="stdev-cell ${s} type-weight">\n\t\t\t\t${n}\n\t\t\t</td>\n\t\t\t<td class="stdev-cell ${s} type-ep">\n\t\t\t\t${o}\n\t\t\t</td>\n\t\t`,!t)return l.innerHTML;if(0==i){return l.content.querySelectorAll(".stdev-cell").forEach((e=>e.classList.add("unused-ep"))),l.innerHTML}const r=a-this.simUI.player.getEpWeights().getUnitStat(e),c=l.content.querySelector(".type-ep .results-avg");return"0.00"==r.toFixed(2)||(r>0?c.classList.add("positive"):r<0&&c.classList.add("negative")),l.innerHTML}makeTableCellContents(e,t){const s=this.simUI.prevEpIterations||1;return`\n\t\t\t<span class="results-avg">${e.toFixed(2)}</span>\n\t\t\t<span class="results-stdev">\n\t\t\t\t(<i class="fas fa-plus-minus fa-xs"></i>${Oi(t,s).toFixed(2)})\n\t\t\t</span>\n\t\t`}calculateEp(t){const s=_e.clone(t),a=(t,s)=>{const a=vn.fromStat(t),i=a.getProtoValue(s.weights),n=a.getProtoValue(s.weightsStdev);e.epUnitStats.forEach((e=>{const t=e.getProtoValue(s.weights);e.setProtoValue(s.epValues,0==i?0:t/i);const a=e.getProtoValue(s.weightsStdev);e.setProtoValue(s.epValuesStdev,0==n?0:a/n)}))};return void 0!==this.simUI.dpsRefStat&&(a(this.simUI.dpsRefStat,s.dps),a(this.simUI.dpsRefStat,s.tps)),void 0!==this.simUI.healRefStat&&a(this.simUI.healRefStat,s.hps),void 0!==this.simUI.tankRefStat&&(a(this.simUI.tankRefStat,s.dtps),a(this.simUI.tankRefStat,s.tmi),a(this.simUI.tankRefStat,s.pDeath)),s}getDpsEpRefStat(){return void 0!==this.simUI.dpsRefStat?this.simUI.dpsRefStat:this.epReferenceStat}getHealEpRefStat(){return void 0!==this.simUI.healRefStat?this.simUI.healRefStat:this.epReferenceStat}getTankEpRefStat(){return void 0!==this.simUI.tankRefStat?this.simUI.tankRefStat:c.StatArmor}getPrevSimResult(){return this.simUI.prevEpSimResult||_e.create({dps:{weights:(new yn).toProto(),weightsStdev:(new yn).toProto(),epValues:(new yn).toProto(),epValuesStdev:(new yn).toProto()},hps:{weights:(new yn).toProto(),weightsStdev:(new yn).toProto(),epValues:(new yn).toProto(),epValuesStdev:(new yn).toProto()},tps:{weights:(new yn).toProto(),weightsStdev:(new yn).toProto(),epValues:(new yn).toProto(),epValuesStdev:(new yn).toProto()},dtps:{weights:(new yn).toProto(),weightsStdev:(new yn).toProto(),epValues:(new yn).toProto(),epValuesStdev:(new yn).toProto()},tmi:{weights:(new yn).toProto(),weightsStdev:(new yn).toProto(),epValues:(new yn).toProto(),epValuesStdev:(new yn).toProto()},pDeath:{weights:(new yn).toProto(),weightsStdev:(new yn).toProto(),epValues:(new yn).toProto(),epValuesStdev:(new yn).toProto()}})}};rf.epUnitStats=vn.getAll().filter((e=>!!e.isStat()||[d.PseudoStatMainHandDps,d.PseudoStatOffHandDps,d.PseudoStatRangedDps,d.BonusPhysicalDamage,d.PseudoStatMeleeSpeedMultiplier,d.PseudoStatRangedSpeedMultiplier,d.PseudoStatCastSpeedMultiplier].includes(e.getPseudoStat())));let cf=rf;var df=(e=>(e[e.Unlaunched=0]="Unlaunched",e[e.Alpha=1]="Alpha",e[e.Beta=2]="Beta",e[e.Launched=3]="Launched",e))(df||{});const hf={phase:qi.Phase1,status:0},mf={[j.SpecBalanceDruid]:{phase:qi.Phase1,status:0},[j.SpecFeralDruid]:{phase:qi.Phase2,status:1},[j.SpecFeralTankDruid]:{phase:qi.Phase1,status:0},[j.SpecRestorationDruid]:{phase:qi.Phase1,status:0},[j.SpecElementalShaman]:{phase:qi.Phase2,status:3},[j.SpecEnhancementShaman]:{phase:qi.Phase1,status:3},[j.SpecRestorationShaman]:{phase:qi.Phase1,status:0},[j.SpecWardenShaman]:{phase:qi.Phase1,status:3},[j.SpecHunter]:{phase:qi.Phase1,status:1},[j.SpecMage]:{phase:qi.Phase1,status:1},[j.SpecRogue]:{phase:qi.Phase1,status:1},[j.SpecHolyPaladin]:{phase:qi.Phase1,status:0},[j.SpecProtectionPaladin]:{phase:qi.Phase1,status:0},[j.SpecRetributionPaladin]:{phase:qi.Phase1,status:0},[j.SpecHealingPriest]:{phase:qi.Phase1,status:0},[j.SpecShadowPriest]:{phase:qi.Phase1,status:1},[j.SpecWarlock]:{phase:qi.Phase1,status:1},[j.SpecWarrior]:{phase:qi.Phase1,status:1},[j.SpecTankWarrior]:{phase:qi.Phase1,status:1}};function uf(e){return Object.keys(E).map((e=>parseInt(e))).filter((t=>E[t]==e&&mf[t].status>0))}class pf extends ch{constructor(t,s){super(t,"settings-menu",{title:"Options",footer:!0}),this.simUI=s;const i=g(),n=g(),o=g(),l=g(),r=g(),c=g(),d=g(),h=g(),m=g(),u=g(),p=e("div",null,e("div",{className:"picker-group"},e("div",{className:"fixed-rng-seed-container"},e("div",{ref:n,className:"fixed-rng-seed"}),e("div",{className:"form-text"},e("span",null,"Last used RNG seed:")," ",e("span",{ref:o,className:"last-used-rng-seed"},"0"))),e("div",{ref:l,className:"language-picker within-raid-sim-hide"})),e("div",{ref:r,className:"show-threat-metrics-picker w-50 pe-2"}),e("div",{ref:c,className:"show-experimental-picker w-50 pe-2"}),e("div",{ref:d,className:"show-quick-swap-picker w-50 pe-2"}),e("div",{ref:h,className:"use-concurrency-container w-50 pe-2"},e("div",{ref:m,className:"use-concurrent-workers-picker"}),e("div",{ref:u,className:"form-text",hidden:!0})));this.body.replaceChildren(p);const f=e("button",{ref:i,className:"restore-defaults-button btn btn-primary"},"Restore Defaults");if(this.footer&&this.footer.replaceChildren(f),i.value&&(mn(i.value,{content:"Restores all default settings (gear, consumes, buffs, talents, EP weights, etc). Saved settings are preserved."}),i.value.addEventListener("click",(()=>{this.simUI.applyDefaults(a.nextEventID()),new gn({variant:"success",body:"Restored to default settings."})}))),n.value&&new sh(n.value,this.simUI.sim,{id:"simui-fixed-rng-seed",label:"Fixed RNG Seed",labelTooltip:"Seed value for the random number generator used during sims, or 0 to use different randomness each run. Use this to share exact sim results or for debugging.",extraCssClasses:["mb-0"],changedEvent:e=>e.fixedRngSeedChangeEmitter,getValue:e=>e.getFixedRngSeed(),setValue:(e,t,s)=>{t.setFixedRngSeed(e,s)}}),o.value&&(o.value.textContent=String(this.simUI.sim.getLastUsedRngSeed()),this.simUI.sim.lastUsedRngSeedChangeEmitter.on((()=>{o.value&&(o.value.textContent=String(this.simUI.sim.getLastUsedRngSeed()))}))),l.value){const e=Object.keys(Hi),t=e.indexOf("en");new Hd(l.value,this.simUI.sim,{id:"simui-language-picker",label:"Language",labelTooltip:"Controls the language for Wowhead tooltips.",values:e.map(((e,t)=>({name:Hi[e],value:t}))),changedEvent:e=>e.languageChangeEmitter,getValue:s=>{const a=e.indexOf(s.getLanguage());return-1==a?t:a},setValue:(t,s,a)=>{s.setLanguage(t,e[a]||"en")}}).changeEmitter.on((()=>setTimeout((()=>location.reload()),100)))}if(r.value&&new Et(r.value,this.simUI.sim,{id:"simui-show-threat-metrics",label:"Show Threat/Tank Options",labelTooltip:"Shows all options and metrics relevant to tanks, like TPS/DTPS.",inline:!0,changedEvent:e=>e.showThreatMetricsChangeEmitter,getValue:e=>e.getShowThreatMetrics(),setValue:(e,t,s)=>{t.setShowThreatMetrics(e,s)}}),c.value&&new Et(c.value,this.simUI.sim,{id:"simui-show-experimental",label:"Show Experimental",labelTooltip:"Shows experimental options, if there are any active experiments.",inline:!0,changedEvent:e=>e.showExperimentalChangeEmitter,getValue:e=>e.getShowExperimental(),setValue:(e,t,s)=>{t.setShowExperimental(e,s)}}),h.value&&m.value){const e=[{value:0,name:"Off"}];for(let t=2;t<=navigator.hardwareConcurrency;t++)e.push({value:t,name:t.toString()});if(new Hd(m.value,this.simUI.sim,{id:"simui-concurrent-workers-picker",label:"Use Multiple CPU Cores",labelTooltip:"Use web workers to spread sim workload over multiple CPU cores.",changedEvent:e=>e.wasmConcurrencyChangeEmitter,getValue:e=>e.getWasmConcurrency(),setValue:(e,t,s)=>t.setWasmConcurrency(e,s),values:e}),u.value&&navigator.userAgent.toLowerCase().includes("firefox")){const e=u.value;e.hidden=!1,e.textContent="Too many workers can cause significant memory usage! If sim doesn't finish due to RAM running out use a lower number."}this.simUI.sim.isWasm().then((e=>{e||(h.value.hidden=!0)}))}}}class gf extends p{static buildDiscordLink(){const t=e("a",{href:"https://discord.gg/p3DgvmnDCS",target:"_blank",className:"discord-link link-alt",dataset:{tippyContent:"Join us on Discord"}},e("i",{className:"fab fa-discord fa-lg"}));return mn(t),t}static buildGitHubLink(){const t=e("a",{href:"https://github.com/wowsims/classic",target:"_blank",className:"github-link link-alt",dataset:{tippyContent:"Contribute on GitHub"}},e("i",{className:"fab fa-github fa-lg"}));return mn(t),t}static buildPatreonLink(){const t=e("a",{href:"https://patreon.com/wowsims",target:"_blank",className:"patreon-link link-alt",dataset:{tippyContent:"Support us on Patreon"}},e("i",{className:"fab fa-patreon fa-lg"})," Patreon");return mn(t),t}}class ff extends p{constructor(t,s){super(t,"sim-header"),this.simUI=s,this.simTabsContainer=this.rootElem.querySelector(".sim-tabs"),this.simToolbar=this.rootElem.querySelector(".sim-toolbar"),this.knownIssuesContent=e("ul",{className:"text-start ps-3 mb-0"}),this.knownIssuesLink=this.addKnownIssuesLink(),this.addBugReportLink(),this.addDownloadBinaryLink(),this.addSimOptionsLink(),this.addSocialLinks(),new IntersectionObserver((([e])=>e.target.classList.toggle("stuck",e.intersectionRatio<1)),{threshold:[1]}).observe(this.rootElem)}activateTab(e){this.simTabsContainer.getElementsByClassName(e)[0].click()}addTab(t,s){const a=0==this.simTabsContainer.children.length,i=e("li",{className:`${s} nav-item`,attributes:{role:"presentation"}},e("a",{className:`nav-link ${a&&"active"}`,dataset:{bsToggle:"tab",bsTarget:`#${s}`},attributes:{role:"tab","aria-selected":a},type:"button"},t));i.setAttribute("aria-controls",s),this.simTabsContainer.appendChild(i)}addSimTabLink(e){const t=0==this.simTabsContainer.children.length;e.navLink.setAttribute("aria-selected",t.toString()),t&&e.navLink.classList.add("active","show"),this.simTabsContainer.appendChild(e.navItem)}addImportLink(e,t,s){this.addImportExportLink(".import-dropdown",e,t,s)}addExportLink(e,t,s){this.addImportExportLink(".export-dropdown",e,t,s)}addImportExportLink(t,s,a,i){const n=this.rootElem.querySelector(t).querySelector(".dropdown-menu"),o=g();n.appendChild(e("li",null,e("a",{ref:o,href:"javascript:void(0)",className:"dropdown-item",attributes:{role:"button"}},s))),o.value?.addEventListener("click",(()=>a.open()))}addToolbarLink(t){const s=g();return t.parent.appendChild(e("div",{className:"sim-toolbar-item"},e("a",{ref:s,href:t.href?t.href:"javascript:void(0)",className:t.classes||"",target:t.href?"_blank":"_self"},t.icon&&e("i",{className:t.icon}),t.text?` ${t.text} `:""))),s.value&&(t.onclick&&s.value.addEventListener("click",t.onclick),t.tooltip&&mn(s.value,{content:t.tooltip,placement:"bottom"})),s.value}addKnownIssuesLink(){return this.addToolbarLink({parent:this.simToolbar,text:"Known Issues",tooltip:this.knownIssuesContent,classes:"known-issues link-danger hide"})}addKnownIssue(t){const s=e("li",null);s.innerHTML=t,this.knownIssuesContent.appendChild(s),this.knownIssuesLink.classList.remove("hide"),this.knownIssuesLink._tippy?.setContent(this.knownIssuesContent)}addBugReportLink(){this.addToolbarLink({href:"https://github.com/wowsims/classic/issues/new/choose",parent:this.simToolbar,icon:"fas fa-bug fa-lg",tooltip:"Report a bug or<br>Request a feature"})}addDownloadBinaryLink(){const e="https://github.com/wowsims/classic/releases",t="fas fa-gauge-high fa-lg",s=this.simToolbar;Bi()?fetch("/version").then((a=>{a.json().then((a=>{2==a.outdated&&this.addToolbarLink({href:e,parent:s,icon:t,tooltip:"Newer version of simulator available for download",classes:"downbin link-danger"})})).catch((e=>{console.warn("No version info found!")}))})):this.addToolbarLink({href:e,parent:s,icon:t,tooltip:"Download simulator for faster simulating",classes:"downbin"})}addSimOptionsLink(){const e=new pf(this.simUI.rootElem,this.simUI);this.addToolbarLink({parent:this.simToolbar,icon:"fas fa-cog fa-lg",tooltip:"Show Sim Options",classes:"sim-options",onclick:()=>e.open()})}addSocialLinks(){const e=document.createElement("div");e.classList.add("sim-toolbar-socials"),this.simToolbar.appendChild(e),this.addDiscordLink(e),this.addGitHubLink(e),this.addPatreonLink(e)}addDiscordLink(t){t.appendChild(e("div",{className:"sim-toolbar-item"},gf.buildDiscordLink()))}addGitHubLink(t){t.appendChild(e("div",{className:"sim-toolbar-item"},gf.buildGitHubLink()))}addPatreonLink(t){t.appendChild(e("div",{className:"sim-toolbar-item"},gf.buildPatreonLink()))}customRootElement(){return e("header",{className:"sim-header"},e("div",{className:"sim-header-container"},e("ul",{className:"sim-tabs nav nav-tabs",attributes:{role:"tablist"}}),e("div",{className:"import-export within-raid-sim-hide"},e("div",{className:"dropdown sim-dropdown-menu import-dropdown"},e("a",{href:"javascript:void(0)",className:"import-link",attributes:{role:"button","aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},e("i",{className:"fa fa-download"})," Import "),e("ul",{className:"dropdown-menu"})),e("div",{className:"dropdown sim-dropdown-menu export-dropdown"},e("a",{href:"javascript:void(0)",className:"export-link",attributes:{role:"button","aria-expanded":"false"},dataset:{bsToggle:"dropdown",bsDisplay:"dynamic"}},e("i",{className:"fa fa-right-from-bracket"})," Export "),e("ul",{className:"dropdown-menu"}))),e("div",{className:"sim-toolbar"})))}}class If extends p{constructor(e,t,s={}){super(e,"sim-title-dropdown-root"),this.specLabels={[j.SpecBalanceDruid]:"Balance",[j.SpecFeralDruid]:"Feral DPS",[j.SpecFeralTankDruid]:"Feral Tank",[j.SpecRestorationDruid]:"Restoration",[j.SpecElementalShaman]:"Elemental",[j.SpecEnhancementShaman]:"Enhancement",[j.SpecRestorationShaman]:"Restoration",[j.SpecWardenShaman]:"Warden",[j.SpecHunter]:"Hunter",[j.SpecMage]:"Mage",[j.SpecRogue]:"DPS",[j.SpecHolyPaladin]:"Holy",[j.SpecProtectionPaladin]:"Protection",[j.SpecRetributionPaladin]:"Retribution",[j.SpecHealingPriest]:"Healing",[j.SpecShadowPriest]:"Shadow",[j.SpecWarlock]:"DPS",[j.SpecWarrior]:"DPS",[j.SpecTankWarrior]:"Tank"};const a=null===t?{type:"Raid"}:{type:"Spec",index:t},i=this.buildRootSimLink(a);s.noDropdown?this.rootElem.innerHTML=i.outerHTML:(this.rootElem.innerHTML=`\n      <div class="dropdown sim-link-dropdown">\n        ${i.outerHTML}\n        <ul class="dropdown-menu"></ul>\n      </div>\n    `,this.dropdownMenu=this.rootElem.getElementsByClassName("dropdown-menu")[0],this.buildDropdown(),this.dropdownMenu.addEventListener("click",(e=>{e.target.closest('a:not([href="javascript:void(0)"]')||(e.stopPropagation(),e.preventDefault())})))}buildDropdown(){zi.forEach((e=>{const t=document.createElement("li"),s=uf(e);1==s.length?(t.appendChild(this.buildClassLink(e)),this.dropdownMenu?.appendChild(t)):s.length>1&&(t.appendChild(this.buildClassDropdown(e)),this.dropdownMenu?.appendChild(t))}))}buildClassDropdown(e){const t=uf(e),s=document.createElement("fragment"),a=document.createElement("ul");a.classList.add("dropdown-menu");const i=this.buildClassLink(e);return t.forEach((e=>{const t=document.createElement("li"),s=this.buildSpecLink(e);t.appendChild(s),a.appendChild(t)})),s.innerHTML=`\n\t\t\t<div class="dropend sim-link-dropdown">\n\t\t\t\t${i.outerHTML}\n\t\t\t\t${a.outerHTML}\n\t\t\t</div>\n    \t`,s.children[0]}buildRootSimLink(s){let a;if("Raid"==s.type)a=Qi;else{const e=E[s.index];a=uf(e).length>1?xs[s.index]:Gi[e]}return e("a",{href:"javascript:void(0)",className:t("sim-link",this.getContextualKlass(s)),dataset:{bsToggle:"dropdown",bsTrigger:"click"}},e("div",{className:"sim-link-content"},e("img",{src:this.getSimIconPath(s),className:"sim-link-icon"}),e("div",{className:"d-flex flex-column"},e("span",{className:"sim-link-label text-white"},"WoWSims - Classic"),e("span",{className:"sim-link-title"},a),this.launchStatusLabel(s))))}buildRaidLink(){const e=this.getContextualKlass({type:"Raid"}),t=this.getSimIconPath({type:"Raid"}),s=Qi,a=document.createElement("fragment");return a.innerHTML=`\n      <a href="${ji}" class="sim-link ${e}">\n        <div class="sim-link-content">\n          <img src="${t}" class="sim-link-icon">\n          <div class="d-flex flex-column">\n            <span class="sim-link-title">${s}</span>\n            ${this.launchStatusLabel({type:"Raid"})}\n          </div>\n        </div>\n      </a>\n    `,a.children[0]}buildClassLink(s){const a=uf(s),i=a.length>1,n=i?"javascript:void(0)":$i(a[0]);return e("a",{href:n,className:t("sim-link",this.getContextualKlass({type:"Class",index:s})),dataset:i?{bsToggle:"dropdown"}:{}},e("div",{className:"sim-link-content"},e("img",{src:this.getSimIconPath({type:"Class",index:s}),className:"sim-link-icon"}),e("div",{className:"d-flex flex-column"},e("span",{className:"sim-link-title"},Gi[s]),!i&&this.launchStatusLabel({type:"Spec",index:a[0]}))))}buildSpecLink(s){const a=$i(s);return e("a",{href:a,className:t("sim-link",this.getContextualKlass({type:"Spec",index:s}))},e("div",{className:"sim-link-content"},e("img",{src:this.getSimIconPath({type:"Spec",index:s}),className:"sim-link-icon"}),e("div",{className:"d-flex flex-column"},e("span",{className:"sim-link-label"},Gi[E[s]]),e("span",{className:"sim-link-title"},this.specLabels[s]),this.launchStatusLabel({type:"Spec",index:s}))))}launchStatusLabel(t){const s="Raid"==t.type?hf.status:mf[t.index].status,a="Raid"==t.type?hf.phase:mf[t.index].phase;return e("span",{className:"launch-status-label text-brand"},s===df.Unlaunched?e(b,null,"Not Yet Supported"):e(b,null,"Phase ",a,s!=df.Launched&&e(b,null," - ",df[s])))}getSimIconPath(e){let t;return t="Raid"==e.type?Xi:"Class"==e.type?Ki[e.index]:Ji[e.index],t}getContextualKlass(e){return"Raid"==e.type?"text-white":"Class"==e.type?Zi(e.index):Yi(e.index)}}const wf=[];class bf extends p{constructor(t,s,i){super(t,"sim-ui"),this.sim=s,this.cssClass=i.cssClass,this.cssScheme=i.cssScheme,this.isWithinRaidSim=null!=this.rootElem.closest(".within-raid-sim");const n=e(b,null,e("div",{className:"sim-root"},e("div",{className:"sim-bg"}),i.noticeText?e("div",{className:"notices-banner alert border-bottom mb-0 text-center within-raid-sim-hide"},i.noticeText):null,e("div",{className:"sim-container"},e("aside",{className:"sim-sidebar"},e("div",{className:"sim-title"}),e("div",{className:"sim-sidebar-content"},e("div",{className:"sim-sidebar-actions within-raid-sim-hide"}),e("div",{className:"sim-sidebar-results within-raid-sim-hide"}),e("div",{className:"sim-sidebar-stats"}),e("div",{className:"sim-sidebar-socials"}))),e("div",{className:"sim-content container-fluid"}))),e("div",{className:"sim-toast-container p-3 bottom-0 right-0",id:"toastContainer"}));this.rootElem.appendChild(n),this.simContentContainer=this.rootElem.querySelector(".sim-content"),this.simHeader=new ff(this.simContentContainer,this),this.simMain=document.createElement("main"),this.simMain.classList.add("sim-main","tab-content"),this.simContentContainer.appendChild(this.simMain),this.rootElem.classList.add(this.cssClass),this.isWithinRaidSim||this.rootElem.classList.add("not-within-raid-sim"),this.changeEmitter=a.onAny([this.sim.changeEmitter],"SimUIChange"),this.sim.crashEmitter.on(((e,t)=>this.handleCrash(t)));const o=()=>{this.sim.getShowDamageMetrics()?this.rootElem.classList.remove("hide-damage-metrics"):this.rootElem.classList.add("hide-damage-metrics")};o(),this.sim.showDamageMetricsChangeEmitter.on(o);const l=()=>{this.sim.getShowThreatMetrics()?this.rootElem.classList.remove("hide-threat-metrics"):this.rootElem.classList.add("hide-threat-metrics")};l(),this.sim.showThreatMetricsChangeEmitter.on(l);const r=()=>{this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-healing-metrics"):this.rootElem.classList.add("hide-healing-metrics")};r(),this.sim.showHealingMetricsChangeEmitter.on(r);const c=()=>{this.sim.getShowThreatMetrics()||this.sim.getShowDamageMetrics()&&this.sim.getShowHealingMetrics()?this.rootElem.classList.remove("hide-ep-ratios"):this.rootElem.classList.add("hide-ep-ratios")};c(),this.sim.showDamageMetricsChangeEmitter.on(c),this.sim.showHealingMetricsChangeEmitter.on(c),this.sim.showThreatMetricsChangeEmitter.on(c);const d=()=>{this.sim.getShowExperimental()?this.rootElem.classList.remove("hide-experimental"):this.rootElem.classList.add("hide-experimental")};d(),this.sim.showExperimentalChangeEmitter.on(d),this.addKnownIssues(i);const h=this.rootElem.querySelector(".sim-title");new If(h,i.spec,{noDropdown:this.isWithinRaidSim}),this.simActionsContainer=this.rootElem.querySelector(".sim-sidebar-actions"),this.iterationsPicker=new sh(this.simActionsContainer,this.sim,{id:"simui-iterations",label:"Iterations",extraCssClasses:["iterations-picker","within-raid-sim-hide"],changedEvent:e=>e.iterationsChangeEmitter,getValue:e=>e.getIterations(),setValue:(e,t,s)=>{t.setIterations(e,s)}}).rootElem;const m=this.rootElem.querySelector(".sim-sidebar-results");this.resultsViewer=new Eh(m);const u=this.rootElem.querySelector(".sim-sidebar-socials");u.appendChild(gf.buildDiscordLink()),u.appendChild(gf.buildGitHubLink()),u.appendChild(gf.buildPatreonLink()),this.simTabContentsContainer=this.rootElem.querySelector(".sim-main.tab-content"),this.isWithinRaidSim||window.addEventListener("message",(async e=>{"runOnce"==e.data&&this.runSimOnce()}))}addAction(e,t,s){const a=document.createElement("button");a.classList.add("btn","btn-primary","w-100",t),a.textContent=e,a.addEventListener("click",s),this.simActionsContainer.appendChild(a)}addTab(e,t,s){const a=t.replace(/\s+/g,"-")+"-tab",i=0==this.simTabContentsContainer.children.length;this.simHeader.addTab(e,a);const n=document.createElement("fragment");n.innerHTML=`\n\t\t\t<div\n\t\t\t\tid="${a}"\n\t\t\t\tclass="tab-pane fade ${i?"active show":""}"\n\t\t\t>${s}</div>\n\t\t`,this.simTabContentsContainer.appendChild(n.children[0])}addSimTab(e){this.simHeader.addSimTabLink(e)}addWarning(e){this.resultsViewer.addWarning(e)}addKnownIssues(e){let t="";t=e.simStatus.status==df.Unlaunched?"This sim is a WORK IN PROGRESS. It is not fully developed and should not be used for general purposes.":e.simStatus.status==df.Alpha?"This sim is in ALPHA status. Some items may not yet be functional and further testing is needed.":"This sim is in BETA status. Items should be mostly functional.",t&&(e.knownIssues=[t].concat(e.knownIssues||[])),e.knownIssues&&e.knownIssues.length&&e.knownIssues.forEach((e=>this.simHeader.addKnownIssue(e))),wf.forEach((e=>this.simHeader.addKnownIssue(e)))}getSettingsStorageKey(){return this.getStorageKey("__currentSettings__")}getSavedEncounterStorageKey(){return"sharedData__savedEncounter__"}isIndividualSim(){return this.rootElem.classList.contains("individual-sim-ui")}async runSim(e){this.resultsViewer.setPending();try{await this.sim.signalManager.abortType(ze.All);const t=await this.sim.runRaidSim(a.nextEventID(),e);t instanceof je||t.type!=W.ErrorOutcomeAborted||new gn({variant:"info",body:"Raid sim cancelled."})}catch(t){this.resultsViewer.hideAll(),this.handleCrash(t)}}async runSimOnce(){this.resultsViewer.setPending();try{await this.sim.runRaidSimWithLogs(a.nextEventID())}catch(e){this.resultsViewer.hideAll(),this.handleCrash(e)}}async handleCrash(e){if(!(e instanceof ro))return void alert(e);const t=e.errorStr;if(t.startsWith("[USER_ERROR] ")){let e=t.substring(13);return e=await x.replaceAllInString(e),void alert(e)}if(window.confirm("Simulation Failure:\n"+t+"\nPress Ok to file crash report")){const e=this.hashCode(t),s=this.toLink(),a=this.sim.getLastUsedRngSeed();fetch("https://api.github.com/search/issues?q=is:issue+is:open+repo:wowsims/classic+"+e).then((i=>{i.json().then((i=>{if(i.total_count>0)window.open(i.items[0].html_url,"_blank");else{const i=`${"https://github.com/wowsims/classic/issues/new?assignees=&labels=&title=Crash%20Report%20"}${e}&body=`,n=2048-i.length;let o=encodeURIComponent(`Link:\n${s}\n\nRNG Seed: ${a}\n\n${t}`);s.includes("/raid/")&&(o=encodeURIComponent(`${t}\nRNG Seed: ${a}\nLink:\n${s}`));let l=!1;for(;o.length>n-(l?3:0);)o=o.slice(0,o.lastIndexOf("%")),l=!0;l&&(o+="...",new Sf(this.rootElem,s)),window.open(i+o,"_blank")}}))})).catch((e=>{alert("Failed to file report... try again another time:"+e)}))}}hashCode(e){let t=0;for(let s=0,a=e.length;s<a;s++){t=(t<<5)-t+e.charCodeAt(s),t|=0}return t}}class Sf extends ch{constructor(e,t){super(e,"crash",{title:"Extra Crash Information"}),this.body.innerHTML='\n\t\t\t<div class="sim-crash-report">\n\t\t\t\t<h3 class="sim-crash-report-header">Please append the following complete link to the issue you just created. This will simplify debugging the issue.</h3>\n\t\t\t\t<textarea class="sim-crash-report-text form-control"></textarea>\n\t\t\t</div>\n\t\t';const s=document.createTextNode(t);this.body.querySelector("textarea")?.appendChild(s)}}function xf(e,t){return function(e,t){Bn[e]=t}(e,t),t}const vf=[];class yf extends bf{constructor(e,t,s){super(e,t.sim,{cssClass:s.cssClass,cssScheme:s.cssScheme,spec:t.spec,knownIssues:s.knownIssues,simStatus:mf[t.spec]}),this.rootElem.classList.add("individual-sim-ui"),this.player=t,this.individualConfig=s,this.raidSimResultsManager=null,this.prevEpIterations=0,this.prevEpSimResult=null,(s.itemSwapConfig?.itemSlots||[]).length>0&&!vf.includes(t.spec)&&vf.push(t.spec),this.addWarning({updateOn:a.onAny([this.player.gearChangeEmitter,this.player.professionChangeEmitter]),getContent:()=>{const e=this.player.getGear().getFailedProfessionRequirements(this.player.getProfessions());return 0==e.length?"":e.map((e=>`${e.name} requires ${Jt.get(e.requiredProfession)}, but it is not selected.`))}}),this.addWarning({updateOn:a.onAny([this.player.talentsChangeEmitter]),getContent:()=>{const e=en(this.player.getTalentsString());return 0==e?"":e<v?tn:e>v?sn:""}}),(s.warnings||[]).forEach((e=>this.addWarning(e(this)))),this.isWithinRaidSim||this.sim.waitForInit().then((()=>{this.loadSettings(),Qa(this.player.spec)&&alert(an)})),this.addSidebarComponents(),this.addGearTab(),this.bt=this.addBulkTab(),this.addSettingsTab(),this.addTalentsTab(),this.addRotationTab(),this.isWithinRaidSim||this.addDetailedResultsTab(),this.addTopbarComponents()}loadSettings(){const e=a.nextEventID();a.freezeAllAndDo((()=>{this.applyDefaults(e);const t=window.localStorage.getItem(this.getSettingsStorageKey());if(null!=t)try{const s=hs.fromJsonString(t);this.fromProto(e,s)}catch(s){console.warn("Failed to parse saved settings: "+s)}try{const t=Yp.tryParseUrlLocation(window.location);t&&this.fromProto(e,t.settings,t.categories)}catch(s){console.warn("Failed to parse link settings: "+s)}window.location.hash="",this.player.setName(e,"Player"),this.changeEmitter.on((e=>{const t=hs.toJsonString(this.toProto());window.localStorage.setItem(this.getSettingsStorageKey(),t)}))}))}addSidebarComponents(){var e,t,s,a;this.raidSimResultsManager=nn(this),e=this,t=this.individualConfig.epStats.concat(on),s=this.individualConfig.epPseudoStats,a=this.individualConfig.epReferenceStat,e.addAction("Stat Weights","ep-weights-action",(()=>{new cf(e,t,s||[],a).open()}));const i=[];this.individualConfig.displayStats.forEach((e=>i.push(vn.fromStat(e)))),Di.forEach((e=>i.push(vn.fromStat(e)))),this.individualConfig.displayPseudoStats.forEach((e=>i.push(vn.fromPseudoStat(e)))),ln.forEach((e=>i.push(vn.fromPseudoStat(e)))),new ih(this.rootElem.getElementsByClassName("sim-sidebar-stats")[0],this.player,i,this.individualConfig.modifyDisplayStats)}addGearTab(){new hg(this.simTabContentsContainer,this).rootElem.classList.add("active","show")}addBulkTab(){const e=new Xp(this.simTabContentsContainer,this);return e.navLink.hidden=!this.sim.getShowExperimental(),this.sim.showExperimentalChangeEmitter.on((()=>{e.navLink.hidden=!this.sim.getShowExperimental()})),e}addSettingsTab(){new of(this.simTabContentsContainer,this)}addTalentsTab(){new lf(this.simTabContentsContainer,this)}addRotationTab(){new jg(this.simTabContentsContainer,this)}addDetailedResultsTab(){this.addTab("Results","detailed-results-tab",'\n\t\t\t<div class="detailed-results">\n\t\t\t</div>\n\t\t'),new rn(this.rootElem.getElementsByClassName("detailed-results")[0],this,this.raidSimResultsManager)}addTopbarComponents(){this.simHeader.addImportLink("JSON",new Uh(this.rootElem,this),!0),this.simHeader.addImportLink("60U SoD",new Vh(this.rootElem,this),!0),this.simHeader.addImportLink("Addon",new Mh(this.rootElem,this),!0),this.simHeader.addExportLink("Link",new og(this.rootElem,this),!1),this.simHeader.addExportLink("JSON",new ng(this.rootElem,this),!0),this.simHeader.addExportLink("60U SoD EP",new ig(this.rootElem,this),!1),this.simHeader.addExportLink("Pawn EP",new rg(this.rootElem,this),!1)}applyEmptyAplRotation(e){a.freezeAllAndDo((()=>{this.player.setAplRotation(e,N.create({type:K.TypeAPL}))}))}applyDefaults(e){a.freezeAllAndDo((()=>{const t=re(this.player.spec),s=Qa(this.player.spec);this.player.applySharedDefaults(e),this.player.setRace(e,this.individualConfig.defaults.race??D[this.player.spec][0]),this.player.setGear(e,this.sim.db.lookupEquipmentSpec(this.individualConfig.defaults.gear)),this.player.setItemSwapGear(e,new T({})),this.player.setConsumes(e,this.individualConfig.defaults.consumes),this.player.setTalentsString(e,this.individualConfig.defaults.talents.talentsString),this.player.setSpecOptions(e,this.individualConfig.defaults.specOptions),this.player.setBuffs(e,this.individualConfig.defaults.individualBuffs),this.player.getParty().setBuffs(e,this.individualConfig.defaults.partyBuffs),this.player.getRaid().setBuffs(e,this.individualConfig.defaults.raidBuffs),this.player.setEpWeights(e,this.individualConfig.defaults.epWeights);const a=this.player.getDefaultEpRatios(t,s);this.player.setEpRatios(e,a),this.player.setProfession1(e,this.individualConfig.defaults.other?.profession1||F.Engineering),this.player.setProfession2(e,this.individualConfig.defaults.other?.profession2||F.ProfessionUnknown),this.player.setDistanceFromTarget(e,this.individualConfig.defaults.other?.distanceFromTarget||0),this.player.setChannelClipDelay(e,this.individualConfig.defaults.other?.channelClipDelay||0),this.isWithinRaidSim?this.sim.raid.setTargetDummies(e,0):(this.sim.raid.setTargetDummies(e,s?9:0),this.sim.encounter.applyDefaults(e),this.sim.raid.setDebuffs(e,this.individualConfig.defaults.debuffs),this.sim.applyDefaults(e,t,s),t?this.sim.raid.setTanks(e,[this.player.makeUnitReference()]):this.sim.raid.setTanks(e,[]))}))}getSavedGearStorageKey(){return this.getStorageKey("__savedGear__")}getSavedRotationStorageKey(){return this.getStorageKey("__savedRotation__")}getSavedSettingsStorageKey(){return this.getStorageKey("__savedSettings__")}getSavedTalentsStorageKey(){return this.getStorageKey("__savedTalents__")}getStorageKey(e){return cn[this.player.spec]+e}toProto(e){const t=t=>!e||0==e.length||e.includes(t),a=hs.create({player:this.player.toProto(!0,!1,e)});return t(fn.Miscellaneous)&&hs.mergePartial(a,{tanks:this.sim.raid.getTanks()}),t(fn.Encounter)&&hs.mergePartial(a,{encounter:this.sim.encounter.toProto()}),t(fn.External)&&hs.mergePartial(a,{partyBuffs:this.player.getParty()?.getBuffs()||s.create(),raidBuffs:this.sim.raid.getBuffs(),debuffs:this.sim.raid.getDebuffs(),targetDummies:this.sim.raid.getTargetDummies()}),t(fn.UISettings)&&hs.mergePartial(a,{settings:this.sim.toProto(),epWeightsStats:this.player.getEpWeights().toProto(),epRatios:this.player.getEpRatios(),dpsRefStat:this.dpsRefStat,healRefStat:this.healRefStat,tankRefStat:this.tankRefStat}),a}toLink(){return og.createLink(this)}fromProto(e,t,i){const n=e=>!i||0==i.length||i.includes(e),o=re(this.player.spec),l=Qa(this.player.spec);a.freezeAllAndDo((()=>{if(t.player){if(this.player.fromProto(e,t.player,i),n(fn.Miscellaneous)&&this.sim.raid.setTanks(e,t.tanks||[]),n(fn.External)){this.sim.raid.setBuffs(e,t.raidBuffs||ge.create()),this.sim.raid.setDebuffs(e,t.debuffs||fe.create());const a=this.player.getParty();a&&a.setBuffs(e,t.partyBuffs||s.create()),this.sim.raid.setTargetDummies(e,t.targetDummies)}if(n(fn.Encounter)&&this.sim.encounter.fromProto(e,t.encounter||pe.create()),n(fn.UISettings)){t.epWeightsStats?this.player.setEpWeights(e,yn.fromProto(t.epWeightsStats)):this.player.setEpWeights(e,this.individualConfig.defaults.epWeights);const s=this.player.getDefaultEpRatios(o,l);if(t.epRatios){const a=new Array(s.length-t.epRatios.length).fill(0);this.player.setEpRatios(e,t.epRatios.concat(a))}else this.player.setEpRatios(e,s);t.dpsRefStat&&(this.dpsRefStat=t.dpsRefStat),t.healRefStat&&(this.healRefStat=t.healRefStat),t.tankRefStat&&(this.tankRefStat=t.tankRefStat),t.settings?this.sim.fromProto(e,t.settings):this.sim.applyDefaults(e,o,l)}}}))}}function Ef(e,t,s){return function(e,t,s){const a=[];null!=s.talentTree&&a.push((e=>e.getTalentTree()==s.talentTree));null!=s.talentTrees&&a.push((e=>(s.talentTrees||[]).includes(e.getTalentTree())));null!=s.faction&&a.push((e=>e.getFaction()==s.faction));null!=s.customCondition&&a.push(s.customCondition);return{name:e,tooltip:s.tooltip||dn,gear:t,enableWhen:a.length>0?e=>a.every((t=>t(e))):void 0,onLoad:s?.onLoad}}(e,os.fromJson(t),s||{})}function kf(e,t,s){const a=[];return s&&s.customCondition&&a.push(s.customCondition),{name:e,data:t,enableWhen:a.length>0?e=>a.every((t=>t(e))):void 0}}function Pf(e,t,s){return Tf(e,Pi.create({rotation:N.fromJson(t)}),s)}function Cf(e,t,s,a){return Tf(e,Pi.create({rotation:{type:K.TypeSimple,simple:{specRotationJson:JSON.stringify(y[t].rotationToJson(s))}}}),a)}function Tf(e,t,s){const a=[];return null!=s?.talentTree&&a.push((e=>e.getTalentTree()==s.talentTree)),null!=s?.customCondition&&a.push(s.customCondition),{name:e,rotation:t,enableWhen:a.length>0?e=>a.every((t=>t(e))):void 0,onLoad:s?.onLoad}}const Nf=(e,{gear:t,talents:s,rotation:a,epWeights:i,encounter:n,race:o,options:l})=>({name:e,gear:t,talents:s,rotation:a,epWeights:i,encounter:n,race:o,options:l});export{th as $,gc as A,ch as B,lh as C,$d as D,eg as E,cd as F,el as G,jd as H,Rh as I,wo as J,bo as K,fo as L,Kn as M,Cf as N,Xo as O,$n as P,al as Q,Bd as R,lo as S,Jd as T,il as U,ql as V,ol as W,Zd as X,Yd as Y,Qd as Z,Xd as _,Gn as a,eh as a0,ko as a1,_o as a2,vo as a3,Oc as a4,qc as a5,Hc as a6,qr as a7,Ko as a8,go as a9,Nf as aa,Wl as ab,hl as ac,zd as ad,Cl as ae,Tl as af,Nl as ag,Zo as ah,Yo as ai,tl as aj,Qo as ak,nl as al,ml as am,zl as an,jl as ao,Hd as b,wn as c,kh as d,cg as e,mo as f,zn as g,$g as h,ho as i,bf as j,Pf as k,kf as l,Ef as m,xf as n,yn as o,Zp as p,Ll as q,hf as r,Vl as s,Ml as t,xc as u,md as v,pd as w,yf as x,hd as y,xo as z};
